{
  "hash": "a9910d9c41948098eb9b7772b34e44b7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Research Methods II\"\nsubtitle: \"Session 3: Measuring Inequality\"\nauthor: Fernando Rios-Avila\nformat: \n  revealjs: \n    slide-number: true\n    width: 1600\n    height: 900\n    code-fold: true\n    echo: true\n    css: styles.css \n    highlight-style: github\n---\n\n# Measuring Inequality\n\n## What is Inequality?\n\n- **Economic inequality** refers to how economic variables are distributed among individuals in a group, among groups in a population, or among countries. \n- Inequality of What? \n    - inequality of opportunities, for example access to employment or education\n    - inequality of outcomes, for example material dimensions of human well-being, such as the level of income, educational attainment, health status and so on.\n\n- For now we will focus on **income** inequality.\n\n## How do you analyze (measure) inequality?\n\n- There are various approaches that have been used for the analysis of Inequality\n\n  - Intuitive approach\n    - Unaxiomatic approach used to describe inequality.\n  - Normative approach-Social welfare\n    - Uses explicit concepts of welfare functions to quantify inequality \n  - Information theory\n    - Quantifies inequality treating it as a problem of comparing income distribution probabilities.\n  - Axiomatic approach\n    - Uses a series of axioms to create measures of inequality\n\n## Preliminaries\n\n- Regardless of the approach, there are some basic steps required to measure inequality\n  - Define the population of interest\n  - Define the measure of interest\n  - Adjust for prices (if necessary)\n  - Adjust for individual heterogeneity (needs) (if necessary)\n\n## Mathematical Preliminaries\n\n- Let $y_i$ be the income of individual $i$ in the population. Assume that $y_i>>0$.\n- Assume that $y_i$ can be characterized by a probability distribution function $f(y)$.\n  \n$$\\begin{aligned}\ny_i &\\sim f(y) \\rightarrow \\int_{-\\infty}^{z} f(y) dy = F(z) \\\\\nF(0)&=0 \\ \\& \\ F(\\infty)=1 \\\\\nF(Q_y(p)) &=p \\rightarrow Q_y(p) = F^{-1}(p) \n\\end{aligned}\n$$\n\nThe $p_{th}$ quantile of $y_i$ is the value $Q_y(p)$ such that $p$ percent of the population has income below $Q_y(p)$.\n\n## Mathematical Preliminaries\n\nMean of Standard of Living:\n\n$$\\mu_y = E(y) = \\int_{-\\infty}^{\\infty} y f(y) dy=\\int_0^1Q(p)dp\n$$\n\nFinally, the inequality measure can be written as:\n\n$$I(y)=I(\\mu_y, f(.)) = I(\\mu_y, F(.))\n$$\n\n## Visualization tools\n\n- There are several tools that can be used to visualize income distribution:\n  - Density Function/Histogram\n  - Pen_parade/Cumulative Distribution Function\n  - Lorenz Curve\n\n## \n\n:::{.panel-tabset}\n\n## Density/Histogram\n\n- Density functions and histograms are used to visualize the distribution of income in the population.\n- They could be used to detect multimodality, skewness, etc\n- And could be used to compare distributions across groups.\n\n- `Stata` Commands\n\n  `histogram varname [weight] [if]`\n\n  `kdensity varname [weight] [if]`\n\n## Plots\n\n::: {#9431883f .cell execution_count=1}\n``` {.stata .cell-code code-fold=\"true\"}\nset scheme white2\nset linesize 255\ncolor_style tableau\nqui:frause oaxaca, clear\nsum wt, meanonly\ngen int wt2 = round(wt/r(min))\nqui:two histogram lnwage [fw=wt2] ///\n    || kdensity lnwage [w=wt2], ///\n    ysize(5) xsize(9) xtitle(\"Log Wages\") ///\n    legend(order(1 \"Histogram\" 2 \"Kernel Density\") pos(6) col(2)) \n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](session_3_files/figure-revealjs/cell-2-output-2.png){}\n:::\n:::\n\n\n:::\n\n## \n\n:::{.panel-tabset}\n\n## PenParade/CDF\n\n- A different approach to visualize the distribution.\n- The Pen Parade plots the values of the variable of interest in ascending order.\n  - y-axis: Q(p); x-axis: p\n- The CDF plots the cumulative distribution of the variable of interest.\n  - y-axis: p; x-axis: Q(p)\n- They give you a sense of the distribution, and easy comparison across high and low values.\n\n## plot\n\n::: {#e3b34790 .cell layout-ncol='2' execution_count=2}\n``` {.stata .cell-code code-fold=\"true\"}\nqui:pctile qlnwage = lnwage [w=wt], nq(100)\nqui:gen  qwage = exp(qlnwage)\nqui:gen p = _n if _n<100\nscatter qwage p, connect(l) name(m1, replace) ysize(5) xsize(8)\nscatter p qwage, connect(l) name(m2, replace) ysize(5) xsize(8)\n```\n\n::: {.cell-output .cell-output-display}\n![Pen-Parade](session_3_files/figure-revealjs/cell-3-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![Cum Distribution Function](session_3_files/figure-revealjs/cell-3-output-2.png){}\n:::\n\nDistribution plots\n:::\n\n\n:::\n\n##\n\n:::{.panel-tabset}\n\n## Lorenz Curve\n\n- Perhaps the most popular tool to visualize income distribution.\n- This curve plots the cumulative share of income vs the cumulative share of population.\n  - How much of total income is held by the bottom X% of the population ?\n\n- \"Easy\" to read:\n  - The closest it is to the 45 degree line, the more equal the distribution.\n\n- Not easy to implement with negative and zero incomes.\n\n- Comparison across groups may be ambiguous.\n\n- its always increasing at an increasing rate respect to X%\n\n## Code \n\nAssume data is sorted by income\n\n:::: {.columns}\n\n::: {.column width=\"47%\"}\n\nx-axis: Cum share of population\n\n$$P_j = \\frac{\\sum_{i=1}^j w_i}{\\sum_{i=1}^n w_i}$$\n\n:::\n\n::: {.column width=\"47%\"}\ny-axis: Cum  share of income\n\n$$LC_j = \\frac{\\sum_{i=1}^j y_i w_i}{\\sum_{i=1}^n y_iw_i}$$\n:::\n\n::::\n\n::: {#8267fbeb .cell execution_count=3}\n``` {.stata .cell-code code-fold=\"false\"}\nfrause oaxaca, clear\ngen wage = exp(lnwage)\nsort wage wt  // sort by income and weight \n// Estimate Totals for non missing data\negen twage = sum(wage * wt) if wage!=.\negen tpop  = sum(wt) \t\tif wage!=.\n// get cumulative shares\ngen lc_i = sum( (wage*wt/twage) )*100 if wage!=.\ngen p_i  = sum( (wt/tpop) )*100      if wage!=.\n```\n:::\n\n\n## Plot\n\n::: {#c8a4a4b0 .cell execution_count=4}\n``` {.stata .cell-code code-fold=\"true\"}\ntwo (line lc_i p_i) /// Lorenz Curve\n    ( function x, range(0 100) ) , /// 45 degree line\n    aspect(1) ysize(5) xsize(8) ///\n    xtitle(\"Cumulative Share of Population\") ///\n    ytitle(\"Cumulative Share of Income\") ///\n    legend(off)\n```\n\n::: {.cell-output .cell-output-display}\n![Lorenz Curve](session_3_files/figure-revealjs/cell-5-output-1.png){}\n:::\n:::\n\n\n## Alternative:\n\n```stata\nssc install glcurve // installs command for Generalized Lorenz Curve\nglcurve wage [aw = wt], /// provides variable and weight\n    lorenz // Request ploting the Lorenz Curve\n```\n\n:::\n\n## Inequality Measures\n\nThere are several measures of inequality. The most popular are:\n\n- Interquantile Range (IQR) (or normalizations)\n  $$IQR(\\#1,\\#2) = Q(\\#2) - Q(\\#1)\n  $$\n\n- Interquantile Share Ratio (Palma ratio (10/40))\n  $$ISR(\\#1,\\#2) = \\frac{1-LC(\\#2)}{LC(\\#1)}\n  $$  \n\n- Coefficient of Variation (CV)\n  $$CV = \\frac{\\sigma_y}{\\mu_y}\n  $$\n\n## Inequality Measures\n\n- Lorenz Curve:\n\n$$LC(p) = \\frac{\\int_0^p Q_y(u)du}{\\int_0^1 Q_y(u)du} \n= \\frac{1}{\\mu_y} \\int_0^p Q_y(u)du\n$$\n\n- Properties\n\n$$\\frac{\\partial LC(p)}{\\partial p} = \\frac{Q_y(p)}{\\mu_y} \\geq 0$$\n\n$$\\frac{\\partial^2 LC(p)}{\\partial p^2} = \\frac{1}{\\mu_y f(y)} \\geq 0$$\n\n## Inequality Measures: Gini Coefficient\n\n- The Gini coefficient is the most popular measure of inequality.\n- It is defined as (2x) the area between the Lorenz Curve and the 45 degree line.\n\n$$Gini(y) = 2 \\int_0^1 (p-LC(p)) dp$$\n\n- where $p-LC(p)$ is the \"loss\" of income the Bottom $p$ percent of the population experiences.\n  \n- It is bounded between 0 (perfect Equality) and 1 (complete Inequality).\n  \n- When Lorenz do not cross, Gini provides unambiguous ranking of inequality.\n\n$$Gini(y) = \\frac{2}{\\mu_y} Cov(y_p,p)$$\n\n\n## Implementation {.scrollable}\n\n- `Stata` has plenty of commands that can be used to estimate Gini\n  - `search gini` for few examples\n- I suggest 3 commands:\n  - `fastgini` (`ssc install fastgini`)\n  - `ineqdeco` (`ssc install ineqdeco`)\n  - `sgini` (`ssc install sgini`)\n  - `rif` (`ssc install rif`)\n\n## {.scrollable}\n\n::: {#dca5644f .cell execution_count=5}\n``` {.stata .cell-code code-fold=\"false\"}\nsgini wage \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nGini coefficient for wage\n\n-----------------------\n    Variable |      v=2\n-------------+---------\n        wage |   0.2460\n-----------------------\n```\n:::\n:::\n\n\n::: {#d5ecae7f .cell execution_count=6}\n``` {.stata .cell-code code-fold=\"false\"}\nineqdeco wage [pw=wt]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n \nPercentile ratios\n\n----------------------------------------------------------\n  All obs |    p90/p10     p90/p50     p10/p50     p75/p25\n----------+-----------------------------------------------\n          |      3.154       1.694       0.537       1.771\n----------------------------------------------------------\n  \nGeneralized Entropy indices GE(a), where a = income difference\n sensitivity parameter, and Gini coefficient\n\n----------------------------------------------------------------------\n  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini\n----------+-----------------------------------------------------------\n          |    0.23199     0.14240     0.12282     0.13398     0.26273\n----------------------------------------------------------------------\n   \nAtkinson indices, A(e), where e > 0 is the inequality aversion parameter\n\n----------------------------------------------\n  All obs |     A(0.5)        A(1)        A(2)\n----------+-----------------------------------\n          |    0.06292     0.13273     0.31693\n----------------------------------------------\n```\n:::\n:::\n\n\n## Other Inequality Measures\n\n- There are other approaches that can be used to measure inequality.\n\n  - Normative approach-Social welfare: Uses explicit concepts of welfare functions to quantify inequality\n\n$$I_A(y,\\varepsilon) = 1 - \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{y_i}{\\mu_y}\\right)^{1-\\varepsilon} \\right)^\\frac{1}{1-\\varepsilon}\n$$  \n\nwhere \\varepsilon is a measure of inequality aversion.\n  \n  - Information theory: Quantifies inequality treating it as a problem of comparing income distribution probabilities. How far are we from Full Entropy\n\n$$I_{GE}(Y,\\alpha)=\\frac{1}{\\alpha(1-\\alpha)}\\left[\\frac{1}{N} \\sum \\left(\\frac{y_i}{\\mu_y}\\right)^\\alpha -1\\right] \n$$\n\n  - Axiomatic approach\n    - Uses a series of axioms to create measures of inequality\n\n# How to Compare Inequality \na note\n\n## Significance test\n\n- As discussed in Session 1, we can use a t-test to compare means.\n  - This requires estimating the standard error of the mean, use `mean` command, or `regress`\n- Similarly, it may be as important to test whether two distributions (or inequality measures) are different.\n  - This requires estimating the standard error of the inequality measure.\n  - This is not as straightforward as the mean.\n- Easiest methods:\n  - **Bootstrap**: requires *bootstrap weights* for survey data.\n  - **Influence function**: requires deriving the influence function of the inequality measure.  \n\n## Bootstrap {.scrollable}\n\n- Bootstrap its a non-parametric method to estimate the standard error of a statistic. Its based on Resampling and re-estimating data.\n  \n`bootstrap gini=r(coeff): sgini wage`\n\n::: {#b2422772 .cell execution_count=7}\n\n::: {.cell-output .cell-output-stdout}\n```\n\nwarning: sgini does not set e(sample), so no observations will be excluded from the resampling because of missing values or other reasons. To exclude observations, press Break, save the data, drop any observations that are to be excluded, and rerun\n         bootstrap.\n\nBootstrap results                                        Number of obs = 1,647\n                                                         Replications  =    50\n\n      Command: sgini wage\n         gini: r(coeff)\n\n------------------------------------------------------------------------------\n             |   Observed   Bootstrap                         Normal-based\n             | coefficient  std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n        gini |   .2460329   .0063639    38.66   0.000     .2335599    .2585059\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n- RIF (Recentered Influence Function) is a method that uses the moment conditions to estimate the standard error of a statistic.\n\n`rifhdreg wage , rif(gini)`\n\n::: {#9ac42876 .cell execution_count=8}\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLinear regression                               Number of obs     =      1,434\n                                                F(0, 1433)        =       0.00\n                                                Prob > F          =          .\n                                                R-squared         =     0.0000\n                                                Root MSE          =     .24613\n\n------------------------------------------------------------------------------\n             |               Robust\n        wage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       _cons |   .2460329   .0064995    37.85   0.000     .2332833    .2587825\n------------------------------------------------------------------------------\nDistributional Statistic: gini\nSample Mean    RIF gini :  .24603\n```\n:::\n:::\n\n\n- Better yet, because you can use regressions (RIF-regressions), you can use weights, and test for differences in inequality across groups.\n\n`rifhdreg wage ibn.female [pw=wt], rif(gini) over(female) noconstant`\n\n::: {#210ca084 .cell execution_count=9}\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLinear regression                               Number of obs     =      1,434\n                                                F(2, 1432)        =     640.56\n                                                Prob > F          =     0.0000\n                                                R-squared         =     0.5056\n                                                Root MSE          =     .25631\n\n------------------------------------------------------------------------------\n             |               Robust\n        wage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n      female |\n          0  |   .2377884   .0084103    28.27   0.000     .2212907    .2542862\n          1  |   .2820059   .0128488    21.95   0.000     .2568015    .3072103\n------------------------------------------------------------------------------\nDistributional Statistic: gini\nSample Mean    RIF gini :  .25805\n```\n:::\n:::\n\n\n`rifhdreg wage i.female [pw=wt], rif(gini) over(female)`\n\n::: {#cc080e10 .cell execution_count=10}\n\n::: {.cell-output .cell-output-stdout}\n```\n\nLinear regression                               Number of obs     =      1,434\n                                                F(1, 1432)        =       8.29\n                                                Prob > F          =     0.0040\n                                                R-squared         =     0.0073\n                                                Root MSE          =     .25631\n\n------------------------------------------------------------------------------\n             |               Robust\n        wage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n    1.female |   .0442175   .0153565     2.88   0.004     .0140938    .0743412\n       _cons |   .2377884   .0084103    28.27   0.000     .2212907    .2542862\n------------------------------------------------------------------------------\nDistributional Statistic: gini\nSample Mean    RIF gini :  .25805\n```\n:::\n:::\n\n\n# How to Decompose Inequality\n\n\n## Introduction\n\n- Some times, we may be interested in determining what factors, and what extent, explain inequality.\n  - But what do we mean by \"explain\"?\n- There are several approaches to decompose inequality.\n  - by sources: Explain how inequality is related to source of income\n  - by groups: How much of the inequality is explained by inequality within groups, and between groups.\n- We could also consider how inequality gaps are related to characteristics or returns to such characteristics.\n\n## Decompose by sources\n\n- Some inequality indices are well suited to decompose inequality by sources.\n  - Variance Decomposition (Sorrocks 1998)\n  - Gini Decomposition by source (Lerman and Yitzhaki 1985)\n\n- The idea is assess inequality (or concentration) of each source of income, and then combine them to obtain their contribution to overall inequality.\n\n##\n### Variance Decomposition\n\nSetup:\n$$\\begin{aligned}\nY &= y_1 + y_2 + \\cdots + y_n  \\\\\nI_V(Y) &= V(Y) = Cov(Y,Y) \\\\\n &= Cov(Y,y_1) + Cov(Y,y_2) + \\cdots \\\\\n\\end{aligned}\n$$\n\nCovariance, however could be rewritten as: $Cov(Y,y_k)=\\rho_k \\sigma_Y \\sigma_{y_k}$, thus\n\n$$\\begin{aligned}\nV(y) = \\sigma^2_Y &= \\rho_1 \\sigma_Y \\sigma_{y_1} + \\rho_2 \\sigma_Y \\sigma_{y_2} + \\cdots \\\\\n\\sigma_Y&=   \\rho_1 \\sigma_{y_1} + \\rho_2 \\sigma_{y_2} + \\cdots  \\\\\n\\end{aligned}\n$$\n\nFinally, if we divide all by $\\mu_y$ and multiply by $\\mu_{yk}/\\mu_{yk}$, we get:\n\n$$\\begin{aligned}\n\\frac{\\sigma_Y}{\\mu_y} = CV(y) &=   \\rho_1 \\frac{1}{\\mu_{y}} \\frac{\\mu_{y1}}{\\mu_{y1}}\\sigma_{y_1} + \\rho_2 \\frac{1}{\\mu_{y}} \\frac{\\mu_{y2}}{\\mu_{y2}}  \\sigma_{y_2} + \\cdots  \\\\\n&= \\rho_1 sh_1 CV(y_1) + \\rho_2 sh_2 CV(y_2) + \\cdots  \\\\\n\\end{aligned}\n$$\n\n## Example `Stata` {.scrollable}\n\n`ssc install ineqfac`\n\n::: {#dd674441 .cell .larger execution_count=11}\n``` {.stata .cell-code code-fold=\"false\"}\nfrause limew1972.dta, clear\n\nineqfac basemi inchomewealth incnonhomewealth govtr_n pubcon tx_n valhp [aw=hhwgt]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n \nInequality decomposition by factor components (Shorrocks' method)\n-------------------------------------------------------------------------------\nFactor              |  100*s_f     S_f   100*m_f/m  rho_f   CV_f CV_f/CV(Total)\n--------------------+----------------------------------------------------------\nbasemi              |   29.115    0.284   44.434   0.711   0.900    0.922\ninchomewealth       |    1.872    0.018    4.302   0.318   1.335    1.367\nincnonhomewealth    |   43.136    0.421    7.905   0.754   7.065    7.235\ngovtr_n             |   -0.979   -0.010    5.868  -0.107   1.528    1.565\npubcon              |    2.091    0.020    8.303   0.238   1.035    1.060\ntx_n                |   15.629    0.153   11.462   0.754   1.767    1.809\nvalhp               |    9.136    0.089   17.726   0.502   1.003    1.027\n--------------------+----------------------------------------------------------\nTotal               |  100.000    0.977  100.000   1.000   0.977    1.000\n-------------------------------------------------------------------------------\nNote: s_f is the proportionate contribution of factor f\n to inequality of Total, where ...\n s_f = rho_f*sd(f)/sd(Total) \n     = rho_f*[m(factor_f)/m(totvar)]*[CV(factor_f)/CV(totvar)].\n S_f = s_f*CV(Total). rho_f = corr(f,Total). \n m_f = mean(f). sd(f) = std.dev. of f. CV_f = sd(f)/m_f.\n```\n:::\n:::\n\n\n##\n### Gini Decomposition by source\n\n- The Gini index could also be decomposed by source of income. \n\n$$\\begin{aligned}\nGini(y) &= \\frac{2}{\\mu_y} Cov(y,F(y)) = \\frac{2}{\\mu_y} Cov\\left(\\sum y_k,F(y)\\right) =\\frac{2}{\\mu_y} \\sum Cov\\left( y_k,F(y)\\right)\n\\end{aligned}\n$$ \n\n- So Gini is the sum of the covariance of each source of income with $F(y)$  \n\n$$\\begin{aligned}\nGini(y) &= \\sum \\frac{2}{\\mu_y} \\times Cov( y_k,F(y)) \\times \\frac{\\mu_{yk}}{\\mu_{yk}} \\times \\frac{Cov( y_k,F(y_k))}{Cov ( y_k,F(y_k))} \\\\\n&=\\sum \\frac{Cov ( y_k,F(y) )}{Cov ( y_k,F(y_k) )} \\times \\frac{2Cov( y_k,F(y_k)}{\\mu_{yk}} \\times \\frac{\\mu_{yk}}{\\mu_y}  \\\\\n&= \\sum R_k \\times G_k \\times sh_k\n\\end{aligned} \n$$ \n\n##\n### Gini Decomposition by source\n\n$$\\begin{aligned}\nGini(y)&= \\sum R_k \\times G_k \\times sh_k\n\\end{aligned} \n$$ \n\n- $R_k$ = Gini Correlation; $G_k$ = Gini of source $k$; $sh_k$ = share of source $k$ in total income.\n- $R_k\\timex G_k$ is the Concentration Index of $Y_k$\n\n## Example `Stata` {.scrollable}\n\nYou probably  already have it installed\n\n`ssc install sgini`\n\n::: {#49904102 .cell .larger execution_count=12}\n``` {.stata .cell-code code-fold=\"false\"}\nsgini basemi inchomewealth incnonhomewealth govtr_n pubcon tx_n valhp [aw=hhwgt], source\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nGini coefficient for basemi, inchomewealth, incnonhomewealth, govtr_n, pubcon, tx_n, valhp\n\nNote: inchomewealth has 690 negative observations (used in calculations).\nNote: incnonhomewealth has 10359 negative observations (used in calculations).\n-----------------------\n    Variable |      v=2\n-------------+---------\n      basemi |   0.4787\ninchomewea~h |   0.6161\nincnonhome~h |   0.9503\n     govtr_n |   0.7099\n      pubcon |   0.4913\n        tx_n |   0.6036\n       valhp |   0.5021\n-----------------------\n\nDecomposition by source:\n  TOTAL =  basemi +  inchomewealth +  incnonhomewealth +  govtr_n +  pubcon +  tx_n +  valhp\n\n\nParameter: v=2\n--------------------------------------------------------------------------------\n             |    Share   Coeff.    Corr.    Conc.  Contri.  %Contri. Elasticity\n    Variable |        s        g        r    c=g*r    s*g*r   s*g*r/G  s*g*r/G-s\n-------------+------------------------------------------------------------------\n      basemi |   0.4443   0.4787   0.8870   0.4246   0.1887   0.4868    0.0425\ninchomewea~h |   0.0430   0.6161   0.4617   0.2845   0.0122   0.0316   -0.0114\nincnonhome~h |   0.0790   0.9503   0.7724   0.7340   0.0580   0.1497    0.0707\n     govtr_n |   0.0587   0.7099  -0.2298  -0.1631  -0.0096  -0.0247   -0.0834\n      pubcon |   0.0830   0.4913   0.4593   0.2257   0.0187   0.0483   -0.0347\n        tx_n |   0.1146   0.6036   0.8776   0.5297   0.0607   0.1567    0.0420\n       valhp |   0.1773   0.5021   0.6601   0.3314   0.0587   0.1516   -0.0257\n-------------+------------------------------------------------------------------\n       TOTAL |   1.0000   0.3876   1.0000   0.3876   0.3876   1.0000    0.0000\n--------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n## Decompose by groups\n\n- There is a second type of decomposition one may be interested in.\n  - How much of the inequality is explained by inequality within groups, and between groups.\n- For example, consider two cases:\n  - Two (eq size) groups that have access to the same level of income, but within each group, all resources are held by one individual.\n  - Two (eq size) groups, one has 80% of the income, and the other 20%, but within groups income is equally distributed.\n- It is possible to understand the source of inequality by decomposing it by groups.\n  - Entropy Indices (and Atkinson) are well suited for this type of decomposition. (see help ineqdeco)\n  - GINI is not as straight forward but possible.\n\n##\n### GINI Decomposition by groups\n\n- Decomposition of the GINI coefficient by groups Milanovic and Yitzhaki (2002)\n\n- The method: To decompose the GINI by groups, one can use the following:\n\n$$\\begin{aligned}\nGini(y) &= \\sum_{k=1}^K s_k O_k Gini(y_k) + Gini_{bw}\n\\end{aligned}\n$$\n\n- where $s_i$ is the share of group $i$ in total income, $Gini(y_k)$ is the Gini of group $k$, $O_k$ is a measure of overlapping across groups, and $Gini_{bw}$ is the Gini between groups.\n\n$$Gini_{bw} = \\frac{2}{\\mu_y} Cov(\\mu_i,\\bar F_i)$$\n\n##\n### Overlapping \n\n- Overlapping $O_k$ measures to what extend the distribution of income in group $k$ overlaps with the distribution of income in other groups.\n- If there is no overlapping, then $O_k=p_i$ (the population share of group k, and incomes are fully stratified). \n  \n- Otherwise, this adjustment factors ensures that the sum of the Gini of each group is equal to the Gini of the total population + Between Gini.\n\n## Example `Stata` {.scrollable}\n\n`ssc install anogi` (Tom Masterson is one of the authors)  \n`ssc install moremata` (needed for `anogi`)\n\n::: {#5c677780 .cell .larger execution_count=13}\n``` {.stata .cell-code code-fold=\"false\"}\nanogi limew [aw= hhwgt ], by(educl) detail\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nAnalysis of Gini\n\n--------------------------------------------------\n                          |      Coef.          %\n--------------------------+-----------------------\nOverall Gini              |   .3875623     100.00\n                          |\nG_wo = sum s_i*G_i*O_i    |   .3405469      87.87\nG_b                       |   .0470154      12.13\n                          |\nIG   = sum s_i*G_i        |   .3657639      94.38\nIGO  = sum s_i*G_i(O_i-1) |   -.025217      -6.51\nBGp  = G_bp               |   .1317698      34.00\nBGO  = G_b - G_bp         |  -.0847544     -21.87\n--------------------------+-----------------------\nMean of limew             |    20403.6\nN. of obs                 |      44872\nN. of subgroups           |          4\n--------------------------------------------------\n\n\nDetailed statistics for subgroups\n\n-------------------------------------------------------------------------------------------\n             |         N          p       mean          s          G          O          F \n-------------+-----------------------------------------------------------------------------\n           1 |  18244.58   .4065916   15466.07   .3081992   .3844549   .9986868   .3963075 \n           2 |  14552.19   .3243045   21019.76   .3340981    .338758   .9239628   .5363091 \n           3 |  5609.305   .1250068   22705.72   .1391112   .3640736   .9435821   .5546081 \n           4 |  6465.924   .1440971   30951.73   .2185916   .3817625   .8370495   .6634934 \n-------------------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n# Thats all for today...\nUntil next week!-> HW1\n\n",
    "supporting": [
      "session_3_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}