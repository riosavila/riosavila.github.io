{
  "hash": "1d028b367da0aa11b0d686592bdd69c7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: RCT Implementation\nformat:\n  html:\n    code-fold: true\n---\n\n## Randomized Control Trial\n\nIn this excecise, I'll provide some simple examples of how to implement a basic RCT analysis.\n\nBefore we start, however, we need to create some data. \n\n@. Estimate two wages models. For men and women, using an heteroskedastic regression model.\n\nThe goal: estimate two potential outcomes for wages. One following Womens wage structure, and the other using Men wage structure.\n\n::: {#c7941507 .cell execution_count=1}\n``` {.stata .cell-code}\nset linesize 255 \nfrause oaxaca, clear\nset seed 101\nqui:hetreg lnwage age agesq married divorced kids6 kids714 if female==0, het(age agesq married divorced kids6 kids714)\nest sto m1\npredict xb1, xb\npredict s1, sigma\nqui:hetreg lnwage age agesq married divorced kids6 kids714 if female==1, het(age agesq married divorced kids6 kids714)\nest sto m2\npredict xb0, xb\npredict s0, sigma\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n(Excerpt from the Swiss Labor Market Survey 1998)\n```\n:::\n:::\n\n\nHere, as I did for UQregression, I obtain the predicted mean and predicted standard errors. and simulate two wages. I will use \nwage differences between simulated men and women predicted log wages as the treated effect\n\n$$\n\\begin{aligned}\nTE= ln\\hat w_1 - ln\\hat w_0  \\\\\nln\\hat w_1 \\sim N(xb_1,s^2_1) \\\\\nln\\hat w_0 \\sim N(xb_0,s_0^2)\n\\end{aligned} \n$$\n\n::: {#c735cddb .cell execution_count=2}\n``` {.stata .cell-code}\ngen lnwage1 = rnormal(xb0,s0)\ngen lnwage0 = rnormal(xb1,s1)\ngen teff=lnwage1-lnwage0\n```\n:::\n\n\nI will create a randomzed treatment, and assume those treated get the treatment effect\n\n$$\nY_i = Y_i(0) + trt_i * \\delta_i\n$$\n\n::: {#032d4348 .cell execution_count=3}\n``` {.stata .cell-code}\ngen trt = runiform()<.5\nreplace lnwage = lnwage0 + trt * teff\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(1,647 real changes made)\n```\n:::\n:::\n\n\n## Visual Exploration\n\nNow that we have a randomized treatment, we could start exploring the data:\n\n::: {#f049b4b1 .cell execution_count=4}\n``` {.stata .cell-code}\ntwo (kdensity lnwage if trt == 1) (kdensity lnwage if trt == 0) , ///\n    legend(order(1 \"Treated\" 2 \"Untreated\"))\n```\n\n::: {.cell-output .cell-output-display}\n![Log wage distribution between Treated and untreated](PO_RCT_files/figure-html/cell-5-output-1.png){}\n:::\n:::\n\n\nIn order to estimate the treatment effects, we could simple estimate a regression model \nof the outcome. Compare it to the treatment effect\n\n## Estimation of ATE Effect\n\n::: {#82aad361 .cell execution_count=5}\n``` {.stata .cell-code}\n** True Effect\nsum teff\n** Simple Regression\nset linesize 255\nreg lnwage  trt, robust\nest sto m0\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n    Variable |        Obs        Mean    Std. dev.       Min        Max\n-------------+---------------------------------------------------------\n        teff |      1,647   -.2121816    .6613419  -3.024343   2.704082\n\nLinear regression                               Number of obs     =      1,647\n                                                F(1, 1645)        =      79.85\n                                                Prob > F          =     0.0000\n                                                R-squared         =     0.0464\n                                                Root MSE          =      .5017\n\n------------------------------------------------------------------------------\n             |               Robust\n      lnwage | Coefficient  std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n         trt |  -.2213292   .0247679    -8.94   0.000    -.2699092   -.1727492\n       _cons |   3.465982   .0150123   230.88   0.000     3.436537    3.495427\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\nBecause treatment is randomized, we could also add other controls to the model, and improve on precision\n\n``` {.stata .cell-code}\nqui:reg lnwage  trt age agesq , robust\nest sto m1\nqui:reg lnwage  trt age agesq married divorced , robust\nest sto m2\nqui:reg lnwage  trt age agesq married divorced kids6 kids714 , robust\nest sto m3\n\nesttab m0 m1 m2 m3, se nonum mtitle(\"m0\" \"m1\" \"m2\" \"m3\") keep(trt) md\n```\n\n\n|              |           m0                  |           m1                  |           m2                  |           m3                  |\n| ------------ | :---------------------------: | :---------------------------: | :---------------------------: | :---------------------------: |\n| trt          |       -0.221<sup>\\*\\*\\*</sup> |       -0.214<sup>\\*\\*\\*</sup> |       -0.213<sup>\\*\\*\\*</sup> |       -0.212<sup>\\*\\*\\*</sup> |\n|              |     (0.0248)                  |     (0.0225)                  |     (0.0225)                  |     (0.0224)                  |\n| *N*          |         1647                  |         1647                  |         1647                  |         1647                  |\n\nStandard errors in parentheses<br>\n<sup>\\*</sup> *p* < 0.05, <sup>\\*\\*</sup> *p* < 0.01, <sup>\\*\\*\\*</sup> *p* < 0.001\n\n\n\n## Falsification \n\nWe could just use other outcomes that shouldnt be affected by the treatment. \nYou expect they have no impact on outcome\n\n``` {.stata .cell-code}\nqui:reg exper  trt age agesq married divorced kids6 kids714 , robust\nest sto m0\nqui:reg tenure trt age agesq married divorced kids6 kids714 , robust\nest sto m1\nesttab m0 m1 , se nonum mtitle(\"m0\" \"m1\") keep(trt) md\n```\n\n\n|              |           m0                  |           m1                  |\n| ------------ | :---------------------------: | :---------------------------: |\n| trt          |       -0.104                  |       -0.458                  |\n|              |      (0.366)                  |      (0.335)                  |\n| *N*          |         1434                  |         1434                  |\n\nStandard errors in parentheses<br>\n<sup>\\*</sup> *p* < 0.05, <sup>\\*\\*</sup> *p* < 0.01, <sup>\\*\\*\\*</sup> *p* < 0.001\n\n\n\n## Balance test\n\nYou should also try to create balance tables, where you compare and test if characteristics are similar across \ntreated and control groups:\n\n::: {#b20550bb .cell execution_count=8}\n``` {.stata .cell-code}\ntabstat age agesq married divorced kids6 kids714 , by(trt)\nsureg age agesq married divorced kids6 kids714 =trt, \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nSummary statistics: Mean\nGroup variable: trt \n\n     trt |       age     agesq   married  divorced     kids6   kids714\n---------+------------------------------------------------------------\n       0 |  39.14475   1649.63    .53076  .1206273  .2979493  .3365501\n       1 |   39.3643  1675.521  .5158924  .1466993  .2713936  .3215159\n---------+------------------------------------------------------------\n   Total |  39.25379  1662.489  .5233758  .1335762  .2847602  .3290832\n----------------------------------------------------------------------\n\nSeemingly unrelated regression\n------------------------------------------------------------------------------\nEquation             Obs   Params         RMSE  \"R-squared\"      chi2   P>chi2\n------------------------------------------------------------------------------\nage                1,647        1     11.02798      0.0001       0.16   0.6862\nagesq              1,647        1     893.7224      0.0002       0.35   0.5566\nmarried            1,647        1     .4993979      0.0002       0.36   0.5458\ndivorced           1,647        1     .3399466      0.0015       2.42   0.1197\nkids6              1,647        1     .6626276      0.0004       0.66   0.4161\nkids714            1,647        1     .7071256      0.0001       0.19   0.6662\n------------------------------------------------------------------------------\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nage          |\n         trt |   .2195505   .5434865     0.40   0.686    -.8456636    1.284765\n       _cons |   39.14475   .3830175   102.20   0.000     38.39405    39.89545\n-------------+----------------------------------------------------------------\nagesq        |\n         trt |   25.89111   44.04489     0.59   0.557    -60.43528    112.2175\n       _cons |    1649.63   31.04026    53.14   0.000     1588.792    1710.467\n-------------+----------------------------------------------------------------\nmarried      |\n         trt |  -.0148675   .0246116    -0.60   0.546    -.0631054    .0333703\n       _cons |     .53076   .0173448    30.60   0.000     .4967648    .5647552\n-------------+----------------------------------------------------------------\ndivorced     |\n         trt |    .026072   .0167534     1.56   0.120    -.0067641    .0589081\n       _cons |   .1206273   .0118068    10.22   0.000     .0974863    .1437682\n-------------+----------------------------------------------------------------\nkids6        |\n         trt |  -.0265557    .032656    -0.81   0.416    -.0905602    .0374488\n       _cons |   .2979493    .023014    12.95   0.000     .2528427     .343056\n-------------+----------------------------------------------------------------\nkids714      |\n         trt |  -.0150342   .0348489    -0.43   0.666    -.0833368    .0532685\n       _cons |   .3365501   .0245595    13.70   0.000     .2884143    .3846858\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\nHere, the goal is just to see if `trt` is not-significant across groups\n\n",
    "supporting": [
      "PO_RCT_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}