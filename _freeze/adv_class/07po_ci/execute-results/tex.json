{
  "hash": "deb59637b3a8be0bce11f60be9dc54c1",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Potential outcomes and Causal Models\nsubtitle: What if?\nauthor: Fernando Rios-Avila\nformat:\n  revealjs:\n    slide-number: true\n    width: 1500\n    height: 900\n    code-fold: true\n    echo: true\n    css: styles.css\n    theme: serif\n  pdf: default\nexecute:\n  freeze: true\n---\n\n## Introduction: What if?\n\nFrom here on, the whole purpose of the methodologies we will dicusess is the analysis of causal effects of some: \n\n >Policy, treatment, experiment, or otherwise event\n\nBut, How is it different from what we did before?\n\nIt isn't. \n\nUnder Exogeneity assumption $E(e|X)=0$, one can make causal effect claims.\n\n:::{.callout-important }\n## We seek the truth\nHow much of the change in outcome is caused by the program alone?\n:::\n\nBut this is not as easy.\n\n## Examples...Where is the challenge? \n\nA few examples for Causal effect questions:\n\n- Do minimum wages increase unemployment ?\n- Do Conditional cash transfers improve health outcomes in children?\n- Do Covid Vaccines help reduce the Spread of Covid?\n\nThese questions are, however, difficult to answer. \n\n- How do you make sure the \"treatment\" is the Only factor that explains the difference in outcome across groups??\n\nTo do this we need strategies that rule out any other explanation that could \"take away\" the connection we seek.\n\n> We need to close ***all*** back doors, block all **alternative** explanations, or nuisanse factors\n\n# We need to figure out what is what we seek\n\n## Potential Outcomes\n\n![Choice](resources/fig0.jpg)\n\n--- \n\nIn a world of quantum mechanics, multiverses, parallel worlds, and other infinite number of scenarios, Causal Inference would be extreamly simple:\n\n$$\n\\begin{aligned}\nPath1 &: Neo \\rightarrow RedPill \\rightarrow wakesup \\rightarrow SavesWorld \\\\\\\nPath2 &: Neo \\rightarrow BluePill \\rightarrow goestoSleep \\rightarrow Nothing \\ happend\n\\end{aligned}\n$$\n\nThen just compare the outcomes:  The read Pill Saved the world.\n\nThus, treatment effect is simply the difference in the potential outcomes: ***Two counterfactuals!***\n\nThis difference captures the TRUE treatment effect. Easy enough...\n\n\n## The Path not taken\n\nThe way we express the $TE_i$, compares *counterfactuals*. Two possible States of the world, where an allknowing researcher can perfectly identify TE.\n\nUnfortunately,  the same person cannot take both paths, and we cannot see both options. A person is either **Treated** or **Untreated**. Thus, the first approach to Casual effects is impossible. \n\n...\n\nBut it does provide us with a clue of how to go ahead and analyze Causal effects. We \"simply\" need to estimate the counterfactual!\n\nBut before going deeper into how to estimate the counterfactuals And treatment effects some notation\n\n## Potential Outcomes: Notation\n\n- $i$ will represent a unit. Person, city, country, school, classroom, etc\n\n- $D$ will indicate the treatment Status of a unit. $D=1$ means is treated, and $D=0$ is untreated.\n\n- Each unit has two potential outcomes $Y_i(D=1)$ and $Y_i(D=0)$\n\n- All units have only **one** effective or realized outcome: $Y_i$, which is what we observe, and depends on their treatment status:\n\n$$Y_i=(1-D_i)*Y_i(0)+D_i*Y_i(1)$$\n\n- Unit Specific causal effect is the difference between potential outcomes:\n$$\\delta_i = Y_i(1)-Y_i(0)$$\n\n- $\\pi$ is the proportion of treated units\n\n## Parameters of Interest\n\nAssume we can see the true USCE (unit specific casual effect) for all units. In addition to their Treatment Status.\n\nThere are three parameters one might be interested in analyzing: \n\n$$\n\\begin{aligned}\nATE &= E(\\delta_i) \\\\\nATT &= E(\\delta_i|D_i=1) \\\\\nATU &= E(\\delta_i|D_i=0)\n\\end{aligned}\n$$\n\nIn general, this three estimands may tell very different stories.\n\nLets Put some numbers here\n\n## Simulating effects `Stata`{.scrollable}\n\n::: {.cell execution_count=1}\n``` {.stata .cell-code}\nclear\nset linesize 255\nset seed 101\nset obs 1000\ngen y0 = rnormal(5)\ngen t  = rnormal(0.0,0.5)\ngen y1 = y0+t\n** Assume only those with t>0 take treatment\ngen trt =(t>0)\ngen y = y0 * (1-trt) +  y1 * (trt)\nformat y0 y1 y t %4.3f \nlist in 1/10, sep(0) clean\n** For Everyone 100 obs\ntabstat t, by(trt)\n```\n\n::: {.cell-output .cell-output-display}\n```\n<IPython.core.display.HTML object>\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of observations (_N) was 0, now 1,000.\n\n          y0        t      y1   trt       y  \n  1.   5.254   -0.801   4.453     0   5.254  \n  2.   4.997    0.039   5.035     1   5.035  \n  3.   2.608   -0.490   2.118     0   2.608  \n  4.   6.280   -0.579   5.700     0   6.280  \n  5.   5.761    0.090   5.850     1   5.850  \n  6.   6.132    0.211   6.342     1   6.342  \n  7.   4.928    0.153   5.081     1   5.081  \n  8.   4.377   -0.073   4.304     0   4.377  \n  9.   3.142    0.427   3.569     1   3.569  \n 10.   6.050   -0.332   5.718     0   6.050  \n\nSummary for variables: t\nGroup variable: trt \n\n     trt |      Mean\n---------+----------\n       0 | -.3984745\n       1 |  .3748617\n---------+----------\n   Total | -.0187664\n--------------------\n```\n:::\n:::\n\n\n## But there is only 1 {.scrollable}\n\nBut, we never see potential outcomes, nor unit specific effects. \n\nThe most naive estimator is to just estimate the mean difference in \"post-treatment\" outcome after treatment was in place. But that would be very biased!\n\n::: {.cell execution_count=2}\n``` {.stata .cell-code}\ngen yy0 = y if trt==0\ngen yy1 = y if trt==1\nlist y yy1 yy0 trt in 1/10\nreg  y trt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(491 missing values generated)\n(509 missing values generated)\n\n     +-----------------------------------+\n     |     y        yy1        yy0   trt |\n     |-----------------------------------|\n  1. | 5.254          .   5.254051     0 |\n  2. | 5.035   5.035442          .     1 |\n  3. | 2.608          .   2.608155     0 |\n  4. | 6.280          .    6.27964     0 |\n  5. | 5.850   5.850478          .     1 |\n     |-----------------------------------|\n  6. | 6.342    6.34237          .     1 |\n  7. | 5.081   5.080995          .     1 |\n  8. | 4.377          .   4.376629     0 |\n  9. | 3.569   3.568727          .     1 |\n 10. | 6.050          .   6.049989     0 |\n     +-----------------------------------+\n\n      Source |       SS           df       MS      Number of obs   =     1,000\n-------------+----------------------------------   F(1, 998)       =     49.49\n       Model |  49.4759442         1  49.4759442   Prob > F        =    0.0000\n    Residual |  997.714103       998   .99971353   R-squared       =    0.0472\n-------------+----------------------------------   Adj R-squared   =    0.0463\n       Total |  1047.19005       999  1.04823829   Root MSE        =    .99986\n\n------------------------------------------------------------------------------\n           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n         trt |   .4449359   .0632467     7.03   0.000      .320824    .5690477\n       _cons |   4.988793   .0443179   112.57   0.000     4.901826     5.07576\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n## Bias Direction \n\n$$\n\\begin{aligned}\nE(Y_i|D_i=1)-E(Y_i|D_i=0) &= ATE  \\\\\n&  +E(Y(0)|D=1)-E(Y(0)|D=0) \\\\\n& +(1-\\pi)(ATT-ATU)\n\\end{aligned}\n$$\n\nIntuition:\nSimple Difference will be biases because\n\n1. There could be a selection bias (one group baseline outcome is different from the other)\n\n2. Treatment Heterogeneity. Some groups are affected differently from others\n\nFrom these two problems, the second one is easier to handle (either concentrate on ATT or ATU). \n\nThe first one, however, requires using strategies to be able to account for selection bias.\n\n## Independence assumption\n\nWhile the Simple mean estimator is most likely to be biased, under Independence assumption, it may still work:\n\n$$\nY(1),Y(0) \\perp D\n$$\n\nThis means that Treatment Status should NOT depend on the potential outcomes.\n\nIn other words, there shouldnt be any differneces in the potential outcomes *before* or *after* treatment takes place.\n\nThis eliminates the selection bias. And group Heterogeneity.\n\n$$\n\\begin{aligned}\nATT - ATU &= E(Y|D=1) -  E(Y(0)|D=1) \\\\\n&- E(Y(1)|D=0) -  E(Y|D=0)\n\\end{aligned}\n$$\n\n## SUTVA \n### Stable Unit Treatment value assumption\n\nThis is a strong assumption that is still required to estimate of treatment effects.\n\nIt assumes that:\n\n- **Treatment is Homogenous**. Same intensity, quality, type of treatment among all treated.\n- **There are no spill overs**. Your Treatment Status effects you and you only, and you are only affected by your treatment status. \n    No externalities nor Spillovers.\n- Also, there are no general equibrium effects\n- And NO Anticipation.\n\nThis assumptions namely guaranties that when a unit is not treated, its/his/her outcome will not change.\n\n## Narrowing down the problem\n\n1. Individual level effects are impossible to identify. We only observe one outcome at a time. (not both)\n2. It is possible to identify causal effects on groups (treated, not-treated, kind-of-treated). But..\n3. Simple Mean difference will not identify causal effects, unless Independence and Sutva assumptions hold\n\nThis however, suggests a path. Constructing good counterfactuals can help idenfiying the Causal effects. \n\nGoal:\n\n- Identify a control/comparison group that is statistically identical to the treated group, except for the **Treatment Status**\n\n## The Gold Standard: Randomized Control Trials\n\n:::{.callout-important }\n## To keep in mind\nSearching for good controls doesnt require having access to perfect \"*clones*\". However, in average, we need groups (T vs UT) that are very similar to each other.\n:::\n\nIn general, research designed is guided by the rules of program or treatment assignment on participants.\n\nWhen researchers have control on the assingment rules, the best approach is to design a randomized control trial. \n\nIn an RCT, randomized assigment, eliminates any selection-bias problems (although SUTVA remains as an assumption)\n\n## RCT and Selection Problems\n\nConsider the example of the Health Impacts of Hospitals. \n\n- Hospitals (or health care) should improve health of individuals. but\n- Only unhealthy people will use Health care services. Selection bias\n- Thus It may look that Hospitals Hurt people's health becuase those who used it have lower health than those who dont:\n$$ \nE(Y|D=1)-E(Y|D=0) = ATT + E(Y(0)|D=1)-E(Y(0)|D=0)\n$$\n\nSo even if Health services help those in need (ATT). If the selection bias is large, Naive estimations may suggest Hospitals are harmful.\n\nThis is a problem caused because Treatment(going to the Hospital) is affected by pre-conditions or potential treatment outcomes.\n\n---\n\nUnder Random assigment, and SUTVA, this can be fixed:\n\n1. If assigment is given as a lottery, potential benefits (Treatment effects) will not be affected by the lottery.\n2. Here, ATT will be the same as ATU. which will allow us to estimte ATE as:\n$$\n\\begin{aligned}\nATE &= E(Y|D=1)-E(Y|D=0) \\\\\n    &= E(Y|D=1)-E(Y(0)|D=1) \\\\\n    &= E(Y(1)|D=0)-E(Y|D=0) \\\\\n\\end{aligned}\n$$\n\n## Stata Example {.scrollable}\n\n::: {.cell execution_count=3}\n``` {.stata .cell-code}\ngen trt2=rnormal()>0\ngen yrct = y0 * (1-trt2) +  y1 * (trt2)\ntabstat t y0 y1 yrct, by(trt2)\nreg yrct trt2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nSummary statistics: Mean\nGroup variable: trt2 \n\n    trt2 |         t        y0        y1      yrct\n---------+----------------------------------------\n       0 | -.0097507  5.061626  5.051875  5.061626\n       1 |  -.027891  4.984309  4.956418  4.956418\n---------+----------------------------------------\n   Total | -.0187664  5.023199  5.004433  5.009338\n--------------------------------------------------\n\n      Source |       SS           df       MS      Number of obs   =     1,000\n-------------+----------------------------------   F(1, 998)       =      2.64\n       Model |  2.76706003         1  2.76706003   Prob > F        =    0.1046\n    Residual |  1046.22695       998   1.0483236   R-squared       =    0.0026\n-------------+----------------------------------   Adj R-squared   =    0.0016\n       Total |  1048.99401       999  1.05004406   Root MSE        =    1.0239\n\n------------------------------------------------------------------------------\n        yrct | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n        trt2 |  -.1052076   .0647568    -1.62   0.105    -.2322827    .0218675\n       _cons |   5.061626   .0456524   110.87   0.000      4.97204    5.151212\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n## Internal vs External Validity\n\nRCTs are not the only strategy that allows you to control the Rules of Treatment. In ***Experimental Economics*** this is done quite often\n\n> you select your sample (of students), and randomly assigned treatments of interest (Experimental design).\n\nThere are, however, further considerations to be taken: \n\n:::{.callout-important}\n## Internal Validity\nThe estimated Impact is net of all other confunding factors (Random assigment)\n:::\n\n:::{.callout-important}\n## External Validity\nThe estimated impact can be generalized to the population in general. (Random Sample)\n:::\n\n:::{.callout-important}\n## How to Randomize\nDepends mostly on how reasonable is to mantain SUTVA assumption\n:::\n\n## Examples\n\n:::{.callout-note}\n## CCT and Education in Mexico\nProgresa/Prospera is a CCT program for poor mothers based on children school enrollment to suport education attainment.\n\nEligibility was based on Census data on Poverty levels and Baseline Data collection. But during phase-in period, only 2/3 if localities were selected to receive the Transfer\n:::\n\n:::{.callout-note}\n## Water and Sanitation Intervention in Bolivia\nIn 2012 IADB and Bolivian Goverment implemented a random assigment of water/sanitation interventions in Small Rural Communities.\n\nFrom 369 eliginle communities, 182 were selected at random for the program implementation, via public lotteries, constraining on Community Size\n:::\n\n## How to Analyze the Data\n\n1. **Verify Data Balance**:  Even if treatment was assigned at random, it is important to verify of groups remain comparable. (Thus avoid compossition effects)\n2. **Mean Difference**: Because of Random Assigment, one could use simple mean differences to estimate ATE \n3. **Consider using controls**: Under RA, controls will not affect the outcome, but may improve precision: $y_i = \\alpha_0 + \\tau D_i + x_i\\beta + \\varepsilon_i$.\n   - But controls should not be affected by the treatment itself (thus should be pre-treatment)\n4. May consider **falsification** tests\n5. And Other Robustness test: Outliers, or distributional impacts may be of interest\n\n# Example\nSchool subsidies for the poor: \n\nEvaluating the Mexican Progresa poverty program\n\nPaul Schultz (2004)\n\n## Background\n\nProgresa is a Cash Transfer Program designed to increase School Enrollment among the poor, minimizing desincentives to work.\n\nThis program provided Grants to families whos children attended school for atleast 85% of the school year, covering between 50/75% of school cost.\n\nWhile there were 495 localities that were eligible to benefit from the program, only 314 were **randomly** selected to start reciving resources for the first 2 years. With the unselected localities being treated a couple of years later. \n\n> The program continued beyond the original scope of the policy, now its known as Progresa/Oportunidades\n\n## Method\n\nGoal. Estimate the impact of Progresa (P) on Enrollment (S)\n$$\nS_i = a_0 +a_1 P_i + a_2 E_i + a_3 P_iE_i + \\delta Enrolled_c + \\beta X + e_i\n$$\n\n$P_i=1$ if the comunity is eligible\n\n$E_i=1$ if the child is Poor\n\n$P_i * E_i$ the impact on Poor Chilren in eligible communities.\n\nModel can be estimated Separately (5 years), or using pooled data\n\nThis is a kind of DIDID model. However, we could consider it as a simple mean comparison between those Effectively treated and those untreated.\n\n## Differences in Characteristics \n\n![](resources/fig3.png)\n![](resources/fig4.png)\n\n## Raw Differences\n\n![Poor HH](resources/fig1.png)\n\n---\n\n![Non Poor HH](resources/fig2.png)\n\n## With Controls\n\n![](resources/fig6.png)\n\n## Other Outcomes\n\n![](resources/fig5.png)\n\n# Next Class: REG and Panel FE\n\n",
    "supporting": [
      "07po_ci_files\\figure-pdf"
    ],
    "filters": []
  }
}