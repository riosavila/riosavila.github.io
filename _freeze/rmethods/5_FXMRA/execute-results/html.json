{
  "hash": "c91bc10d977869b4226fc9f20edd8f11",
  "result": {
    "markdown": "---\ntitle: Multiple Regression Analysis\nsubtitle: Adding and Understanding features\ntitle-slide-attributes:\n  data-background-image: 'https://www.mysantacruzrealestate.com/uploads/shutterstock_179346260_500.jpg'\n  data-background-size: contain\n  data-background-opacity: '0.3'\nauthor: Fernando Rios-Avila\nformat:\n  revealjs:\n    slide-number: true\n    width: 1600\n    height: 900\n    code-fold: true\n    echo: true\n    css: styles.css\n    chalkboard: true\n---\n\n## Introduction\n\n- Multiple Linear Regression models (MLRM), estimated via OLS, have very good properties, if all Assumptions (A1-A5,A6') Hold.\n\n- Up until now, we have discussed how to estimate them, and analyze them under \"optimal\" assumptions, in simplified cases. \n\n- Today we will be adding other \"minor\" Features to MLR, and aim to better understand its features\n\n## Scaling and shifting\n\n1. Something that we do not emphasize enough. Before analyzing your data, its important to analyze the nature of the data (summary stats, ranges, scales)\n   \n2. When I talk about Scaling and shifting, I refer exclusibly to afine transormations of the following type:\n\n$$x^* = a*x+c \\text{ or } x^* = a*(x+c1)+c2\n$$\n\nThey either Shift, or change the scale of the data. Not the shape! (logs change shape)\n\n3. If one applies afine transformations to the data, it will have **NO** effect on your model what-so-ever. (Same t's same F's, same $R^2$)\n\n4. But, your $\\beta's$ will change. This could help understading and explaining the results.\n\n## Example: {.smaller}\n\n::: {#756878ab .cell execution_count=1}\n``` {.stata .cell-code}\nset linesize 255\nfrause bwght, clear\ngen bwkg = bwghtlbs*0.454\ngen bwgr = bwkg*1000\nregress bwght male white cigs lfaminc \nest sto m1\nregress bwghtlbs male white cigs lfaminc\nest sto m2\nregress bwkg male white cigs lfaminc\nest sto m3\nregress bwgr male white cigs lfaminc\nest sto m4\n```\n:::\n\n\n\n\n|              |           Oz    |              |          lbs    |              |          Kgs    |              |           Gr    |              |\n| ------------ | :-------------: | :----------: | :-------------: | :----------: | :-------------: | :----------: | :-------------: | :----------: |\n| male         |        3.123*** |              |        0.195*** |              |        0.089*** |              |       88.605*** |              |\n|              |      (1.071)    |      [2.916] |      (0.067)    |      [2.916] |      (0.030)    |      [2.916] |     (30.389)    |      [2.916] |\n| white        |        5.404*** |              |        0.338*** |              |        0.153*** |              |      153.346*** |              |\n|              |      (1.392)    |      [3.882] |      (0.087)    |      [3.882] |      (0.039)    |      [3.882] |     (39.497)    |      [3.882] |\n| cigs         |       -0.480*** |              |       -0.030*** |              |       -0.014*** |              |      -13.628*** |              |\n|              |      (0.091)    |     [-5.288] |      (0.006)    |     [-5.288] |      (0.003)    |     [-5.288] |      (2.577)    |     [-5.288] |\n| lfaminc      |        1.053*   |              |        0.066*   |              |        0.030*   |              |       29.867*   |              |\n|              |      (0.632)    |      [1.664] |      (0.040)    |      [1.664] |      (0.018)    |      [1.664] |     (17.946)    |      [1.664] |\n| \\_cons       |      110.603*** |              |        6.913*** |              |        3.138*** |              |     3138.351*** |              |\n|              |      (2.071)    |     [53.410] |      (0.129)    |     [53.410] |      (0.059)    |     [53.410] |     (58.760)    |     [53.410] |\n| *N*          |         1388    |              |         1388    |              |         1388    |              |         1388    |              |\n| *R*<sup>2</sup> |        0.046    |              |        0.046    |              |        0.046    |              |        0.046    |              |\n\n: Birthweight and Cig {.striped .hover}\n\n\n\n## Scaling X's and Y's\n\n- Re-scaling $y$ will affect the all coefficients.\n  - Reducing Scale, reduces scale of coefficients\n- Re-scaling $x's$ will only affect its coefficient and possible the constant.\n  - Reducing (increasing) Scale will increase (reduce) Scale of coefficient\n- In both cases, Shifting the variable only affects the constant.\n\n:::{.callout-important}\n\nRe-Scaling is an important tool/trick that can be used for interpreting more complex models. \n\n:::\n\n## Beta or Standardized Coefficients\n\n- In some fields (health), making inferences based on default scales can be difficult (the impact of 1microgram ?).\n- To avoid this type of problem researchers may opt to use **Standardized** or **Beta** coefficients. \n  - How a $sd$ change in $X's$ affect the outcome (in $sd$)\n- Getting these coefficient is similar to applying the following transformation to all variables:\n\n$$\\tilde w = \\frac{w-\\bar w}{\\sigma_w} \\rightarrow E(\\tilde w)=0 \\text{ and } Var(\\tilde w) = 1\n$$\n\n```stata{style=\"font-size: 1.3em\"}\nreg y x1 x2 x3, beta\nest sto m1\nesttab m1, beta \n```\n\n- It also helps you make comparison of the relative importance of each covariate explanatory power.\n\n## Functional Forms: Single Dummies\n\n- Dummies are variables that take only two values (preferably 0 and 1). \n- They are used to capture qualitative (binary) characteristics (ie Democrat, Union worker, etc)\n- When used in regression analysis, they represent \"shifts\" in the Intercept:\n$$y = b_0 + b_1 male + b_2 x_1 + b_3 x_2 + e\n$$\n\n  - Here, $b_0$ would be the \"intercept\" for \"women\" (base) while $b_0+b_1$ would be the intercept for men. \n    - Under A4, $b_1$ is the expected outcome difference **men** have over **women**, everything else constant. \n- Unless further restrictions are used, you can't add Dummies for both categories in the model. \n\n```stata{style=\"font-size: 1.3em\"}\n* Stata Code\nreg y x1 x2 d    <-- Possible if d = 0 or 1\nreg y x1 x2 i.d  <-- Better\n```\n\n## Functional Forms: Multiple Dummies\n\n- We can use dummies to represent multiple (nonoverlapping) characteristics like Race, ranking or age group).\n- One needs a \"base\" or comparison group to analyze coefficients (or more).\n- Ordered variables can be used as continuous, but using them as dummies requires creating dummies for each category.\n\n$$\\begin{aligned}\ny &= b_0 + b_1 black + b_2 hispanic + b_3 other + b_4 x + e & || Base = White \\\\\ny &= b_0 + b_1 young + b_2 old + b_3 x + e & || Base = Adult\n\\end{aligned}\n$$\n\n- When using with ordered data,  multiple dummies may create somewhat counterintuitive results\n\n```stata{style=\"font-size: 1.3em\"}\ntab race, gen(race_)  <- creates dummies\nreg y i.race x1 x2 x3 <- generally uses first group as base\nreg y ib2.race x1 x2 x3 <- indicates a particular \"base\"\n```\n\n## Example {.scrollable}\n\n::: {#e969928c .cell execution_count=3}\n``` {.stata .cell-code code-fold=\"false\"}\nfrause beauty, clear\n** Union also a dummy. \n** looks as Continous\nqui:reg lwage exper union educ female looks\nest sto m1\ngen looks_good = looks>=4 if !missing(looks)\nqui:reg lwage exper union educ female looks_good\nest sto m2\nqui:reg lwage exper union educ female i.looks\nest sto m3\nqui:reg lwage exper union educ female ib3.looks\nest sto m4\nesttab m1 m2 m3 m4, se star( * 0.1 ** 0.05 *** 0.01  ) nogaps nomtitle\ndisplay _n \"Exact Change Union : \" %5.3f (exp(_b[union])-1)*100 \"%\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n----------------------------------------------------------------------------\n                      (1)             (2)             (3)             (4)   \n----------------------------------------------------------------------------\nexper              0.0137***       0.0134***       0.0135***       0.0135***\n                (0.00119)       (0.00120)       (0.00120)       (0.00120)   \nunion               0.201***        0.201***        0.196***        0.196***\n                 (0.0305)        (0.0307)        (0.0306)        (0.0306)   \neduc               0.0737***       0.0750***       0.0735***       0.0735***\n                (0.00528)       (0.00528)       (0.00528)       (0.00528)   \nfemale             -0.448***       -0.450***       -0.446***       -0.446***\n                 (0.0293)        (0.0294)        (0.0293)        (0.0293)   \nlooks              0.0555***                                                \n                 (0.0201)                                                   \nlooks_good                         0.0276                                   \n                                 (0.0299)                                   \n1.looks                                                 0          -0.266** \n                                                      (.)         (0.134)   \n2.looks                                             0.146          -0.121***\n                                                  (0.139)        (0.0439)   \n3.looks                                             0.266**             0   \n                                                  (0.134)             (.)   \n4.looks                                             0.264*       -0.00255   \n                                                  (0.136)        (0.0312)   \n5.looks                                             0.422**         0.156   \n                                                  (0.173)         (0.111)   \n_cons               0.408***        0.565***        0.338**         0.604***\n                 (0.0968)        (0.0774)         (0.149)        (0.0781)   \n----------------------------------------------------------------------------\nN                    1260            1260            1260            1260   \n----------------------------------------------------------------------------\nStandard errors in parentheses\n* p<0.1, ** p<0.05, *** p<0.01\n\nExact Change Union : 21.598%\n```\n:::\n:::\n\n\n## Functional Forms: Logarithms\n\n- Using Logarithms can help modeling some nonlinearities in the data.\n- Because it changes the \"shape\" of variables, it also changes the interpretation (Changes vs %changes)\n- Because it reduces dispersion of dep. variable, it often helps fullfilling CLM assumptions. But this is not as important as helping with model interpretation and inference.\n  \nBut:\n- You cannot apply this transformation to all data types (ie Dummies, negatives), or should not (ie shares, years of education)\n- In a log-lin model, while $\\beta$ can be interpreted as a $\\beta \\%$ change on the outcome, it is often better to use the exact percentage change:\n$$\\begin{aligned}\nlog(y) &= b_0 + b_1 x_1 + b_2 x_2 + b_3 D + e \\\\\n\\frac{\\% \\Delta y}{\\Delta D} &= 100 (exp(b_3)-1)\\%\n\\end{aligned}\n$$\nCan be very different when $b_3$ is large (try it on and see)\n\n# Break?!\n\n## Functional Forms: Polynomials ($x^2, x^3, etc$)\n\n- Up to this point, we have only considered linear models ($X's$ enter asis or in logs). This almost always works! (Taylor expansion justification)\n  - Specially if interested in Average Effects\n- Some times, you may be interest in capturing some heterogeneity for $dy/dx$. That can be done just adding \"ANY\" transformation of $X$ in the model ($sin(x), 1/x, \\sqrt x$, etc)\n- For practical, and theoretical purposes, however, we usually concentrate on quadratic terms ($x^2$).\n  - FE: Increasing returns with decreasing marginal returns\n  - We may be interested in \"turning\" points\n- However, we now need to be careful about marginal effects!  \n\n## \n$$\\begin{aligned}\ny &=b_0+b_1 x_1 + b_2 x_1^2 + b_3 x_2 + e \\\\\n\\frac{dy}{dx_1} &= b_1+2b_2 x_1 =0 \\\\\nx_1^* &= - \\frac{b_1}{2b_2} x_1\n\\end{aligned}\n$$\n\n:::{.callout-note}\n\n## To consider \n\n1. Marginal effects are no longer constant. You need an $x_1$ value to obtain them (mean? average?)\n2. With Quadratic models, there is ***ALWAYS*** a turning point (but may not be relevant)\n3. MFX can be positive or negative for ***some*** value of $x_1$ (but may not be relevant)\n4. Unless something else is done, coefficients may not make sense on their own.\n\n:::  \n\n- Why not add further polynomials? \n  - Estimating them is easy (except for numerical precision), and add added complexity for interpretation. Nothing else.\n\n## Example {.scrollable}\n\n::: {#2aaa2823 .cell execution_count=4}\n``` {.stata .cell-code code-fold=\"false\"}\nfrause hprice2, clear\ngen rooms2=rooms*rooms\nqui:reg lprice lnox dist rooms \nest sto m0\nqui:reg lprice lnox dist rooms rooms2\nest sto m1\nqui:reg lprice lnox dist c.rooms c.rooms#c.rooms\nest sto m2\nesttab m0 m1 m2, se varwidth(20) star(* 0.1 ** 0.05 *** 0.01) nogaps\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n--------------------------------------------------------------------\n                              (1)             (2)             (3)   \n                           lprice          lprice          lprice   \n--------------------------------------------------------------------\nlnox                       -0.968***       -0.975***       -0.975***\n                          (0.110)         (0.106)         (0.106)   \ndist                      -0.0291***      -0.0223**       -0.0223** \n                         (0.0102)       (0.00995)       (0.00995)   \nrooms                       0.302***       -0.724***       -0.724***\n                         (0.0189)         (0.171)         (0.171)   \nrooms2                                     0.0794***                \n                                         (0.0131)                   \nc.rooms#c.rooms                                            0.0794***\n                                                         (0.0131)   \n_cons                       9.793***        13.05***        13.05***\n                          (0.271)         (0.599)         (0.599)   \n--------------------------------------------------------------------\nN                             506             506             506   \n--------------------------------------------------------------------\nStandard errors in parentheses\n* p<0.1, ** p<0.05, *** p<0.01\n```\n:::\n:::\n\n\n- Negative coefficient for $rooms$, so is there a problem? \n  - Find \"turnpoint\" and summary Stats\n\nTurn point: 4.55\n\n\n::: {#2a99dbca .cell execution_count=6}\n\n::: {.cell-output .cell-output-stdout}\n```\n\n    Variable |       Min        p1        p5       p10       p25       p50       p75       p90       p99       Max\n-------------+----------------------------------------------------------------------------------------------------\n       rooms |      3.56      4.52       5.3      5.59      5.88      6.21      6.62      7.15      8.34      8.78\n------------------------------------------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n- Does it make a difference how we estimate the model?\n\n::: {#cc345f14 .cell execution_count=7}\n``` {.stata .cell-code code-fold=\"false\"}\nqui:reg lprice lnox dist rooms rooms2\nmargins, dydx(rooms)\nqui:reg lprice lnox dist c.rooms c.rooms#c.rooms\nmargins, dydx(rooms) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nAverage marginal effects                                   Number of obs = 506\nModel VCE: OLS\n\nExpression: Linear prediction, predict()\ndy/dx wrt:  rooms\n\n------------------------------------------------------------------------------\n             |            Delta-method\n             |      dy/dx   std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       rooms |  -.7236433   .1706763    -4.24   0.000    -1.058973   -.3883139\n------------------------------------------------------------------------------\n\nAverage marginal effects                                   Number of obs = 506\nModel VCE: OLS\n\nExpression: Linear prediction, predict()\ndy/dx wrt:  rooms\n\n------------------------------------------------------------------------------\n             |            Delta-method\n             |      dy/dx   std. err.      t    P>|t|     [95% conf. interval]\n-------------+----------------------------------------------------------------\n       rooms |   .2747106   .0188463    14.58   0.000     .2376831    .3117382\n------------------------------------------------------------------------------\n```\n:::\n:::\n\n\n## Functional Forms: Interactions ($d1*d2, x*z, x*d$)\n\n## Functional Forms: Full Interactions\n\n# Break?!\n\n## Dummies as Dep Variable\n\n## Discrete Vriable as Dep Variable\n\n",
    "supporting": [
      "5_FXMRA_files"
    ],
    "filters": [],
    "includes": {}
  }
}