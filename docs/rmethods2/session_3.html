<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.537">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - Research Methods II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class.html"> 
<span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html"> 
<span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rm2_return.html"> 
<span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#measuring-inequality" id="toc-measuring-inequality" class="nav-link active" data-scroll-target="#measuring-inequality">Measuring Inequality</a>
  <ul class="collapse">
  <li><a href="#what-is-inequality" id="toc-what-is-inequality" class="nav-link" data-scroll-target="#what-is-inequality">What is Inequality?</a></li>
  <li><a href="#how-do-you-analyze-measure-inequality" id="toc-how-do-you-analyze-measure-inequality" class="nav-link" data-scroll-target="#how-do-you-analyze-measure-inequality">How do you analyze (measure) inequality?</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#mathematical-preliminaries" id="toc-mathematical-preliminaries" class="nav-link" data-scroll-target="#mathematical-preliminaries">Mathematical Preliminaries</a></li>
  <li><a href="#mathematical-preliminaries-1" id="toc-mathematical-preliminaries-1" class="nav-link" data-scroll-target="#mathematical-preliminaries-1">Mathematical Preliminaries</a></li>
  <li><a href="#visualization-tools" id="toc-visualization-tools" class="nav-link" data-scroll-target="#visualization-tools">Visualization tools</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#inequality-measures" id="toc-inequality-measures" class="nav-link" data-scroll-target="#inequality-measures">Inequality Measures</a></li>
  <li><a href="#inequality-measures-1" id="toc-inequality-measures-1" class="nav-link" data-scroll-target="#inequality-measures-1">Inequality Measures</a></li>
  <li><a href="#inequality-measures-gini-coefficient" id="toc-inequality-measures-gini-coefficient" class="nav-link" data-scroll-target="#inequality-measures-gini-coefficient">Inequality Measures: Gini Coefficient</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#other-inequality-measures" id="toc-other-inequality-measures" class="nav-link" data-scroll-target="#other-inequality-measures">Other Inequality Measures</a></li>
  </ul></li>
  <li><a href="#how-to-compare-inequality" id="toc-how-to-compare-inequality" class="nav-link" data-scroll-target="#how-to-compare-inequality">How to Compare Inequality</a>
  <ul class="collapse">
  <li><a href="#significance-test" id="toc-significance-test" class="nav-link" data-scroll-target="#significance-test">Significance test</a></li>
  <li><a href="#bootstrap" id="toc-bootstrap" class="nav-link" data-scroll-target="#bootstrap">Bootstrap</a></li>
  </ul></li>
  <li><a href="#how-to-decompose-inequality" id="toc-how-to-decompose-inequality" class="nav-link" data-scroll-target="#how-to-decompose-inequality">How to Decompose Inequality</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#decompose-by-sources" id="toc-decompose-by-sources" class="nav-link" data-scroll-target="#decompose-by-sources">Decompose by sources</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a>
  <ul class="collapse">
  <li><a href="#variance-decomposition" id="toc-variance-decomposition" class="nav-link" data-scroll-target="#variance-decomposition">Variance Decomposition</a></li>
  </ul></li>
  <li><a href="#example-stata" id="toc-example-stata" class="nav-link" data-scroll-target="#example-stata">Example <code>Stata</code></a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a>
  <ul class="collapse">
  <li><a href="#gini-decomposition-by-source" id="toc-gini-decomposition-by-source" class="nav-link" data-scroll-target="#gini-decomposition-by-source">Gini Decomposition by source</a></li>
  </ul></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a>
  <ul class="collapse">
  <li><a href="#gini-decomposition-by-source-1" id="toc-gini-decomposition-by-source-1" class="nav-link" data-scroll-target="#gini-decomposition-by-source-1">Gini Decomposition by source</a></li>
  </ul></li>
  <li><a href="#example-stata-1" id="toc-example-stata-1" class="nav-link" data-scroll-target="#example-stata-1">Example <code>Stata</code></a></li>
  <li><a href="#decompose-by-groups" id="toc-decompose-by-groups" class="nav-link" data-scroll-target="#decompose-by-groups">Decompose by groups</a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a>
  <ul class="collapse">
  <li><a href="#gini-decomposition-by-groups" id="toc-gini-decomposition-by-groups" class="nav-link" data-scroll-target="#gini-decomposition-by-groups">GINI Decomposition by groups</a></li>
  </ul></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a>
  <ul class="collapse">
  <li><a href="#overlapping" id="toc-overlapping" class="nav-link" data-scroll-target="#overlapping">Overlapping</a></li>
  </ul></li>
  <li><a href="#example-stata-2" id="toc-example-stata-2" class="nav-link" data-scroll-target="#example-stata-2">Example <code>Stata</code></a></li>
  </ul></li>
  <li><a href="#thats-all-for-today" id="toc-thats-all-for-today" class="nav-link" data-scroll-target="#thats-all-for-today">Thats all for today…</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="session_3.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Methods II</h1>
<p class="subtitle lead">Session 3: Measuring Inequality</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="measuring-inequality" class="level1">
<h1>Measuring Inequality</h1>
<section id="what-is-inequality" class="level2">
<h2 class="anchored" data-anchor-id="what-is-inequality">What is Inequality?</h2>
<ul>
<li><strong>Economic inequality</strong> refers to how economic variables are distributed among individuals in a group, among groups in a population, or among countries.</li>
<li>Inequality of What?
<ul>
<li>inequality of opportunities, for example access to employment or education</li>
<li>inequality of outcomes, for example material dimensions of human well-being, such as the level of income, educational attainment, health status and so on.</li>
</ul></li>
<li>For now we will focus on <strong>income</strong> inequality.</li>
</ul>
</section>
<section id="how-do-you-analyze-measure-inequality" class="level2">
<h2 class="anchored" data-anchor-id="how-do-you-analyze-measure-inequality">How do you analyze (measure) inequality?</h2>
<ul>
<li><p>There are various approaches that have been used for the analysis of Inequality</p>
<ul>
<li>Intuitive approach
<ul>
<li>Unaxiomatic approach used to describe inequality.</li>
</ul></li>
<li>Normative approach-Social welfare
<ul>
<li>Uses explicit concepts of welfare functions to quantify inequality</li>
</ul></li>
<li>Information theory
<ul>
<li>Quantifies inequality treating it as a problem of comparing income distribution probabilities.</li>
</ul></li>
<li>Axiomatic approach
<ul>
<li>Uses a series of axioms to create measures of inequality</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="preliminaries">Preliminaries</h2>
<ul>
<li>Regardless of the approach, there are some basic steps required to measure inequality
<ul>
<li>Define the population of interest</li>
<li>Define the measure of interest</li>
<li>Adjust for prices (if necessary)</li>
<li>Adjust for individual heterogeneity (needs) (if necessary)</li>
</ul></li>
</ul>
</section>
<section id="mathematical-preliminaries" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-preliminaries">Mathematical Preliminaries</h2>
<ul>
<li>Let <span class="math inline">\(y_i\)</span> be the income of individual <span class="math inline">\(i\)</span> in the population. Assume that <span class="math inline">\(y_i&gt;&gt;0\)</span>.</li>
<li>Assume that <span class="math inline">\(y_i\)</span> can be characterized by a probability distribution function <span class="math inline">\(f(y)\)</span>.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
y_i &amp;\sim f(y) \rightarrow \int_{-\infty}^{z} f(y) dy = F(z) \\
F(0)&amp;=0 \ \&amp; \ F(\infty)=1 \\
F(Q_y(p)) &amp;=p \rightarrow Q_y(p) = F^{-1}(p)
\end{aligned}
\]</span></p>
<p>The <span class="math inline">\(p_{th}\)</span> quantile of <span class="math inline">\(y_i\)</span> is the value <span class="math inline">\(Q_y(p)\)</span> such that <span class="math inline">\(p\)</span> percent of the population has income below <span class="math inline">\(Q_y(p)\)</span>.</p>
</section>
<section id="mathematical-preliminaries-1" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-preliminaries-1">Mathematical Preliminaries</h2>
<p>Mean of Standard of Living:</p>
<p><span class="math display">\[\mu_y = E(y) = \int_{-\infty}^{\infty} y f(y) dy=\int_0^1Q(p)dp
\]</span></p>
<p>Finally, the inequality measure can be written as:</p>
<p><span class="math display">\[I(y)=I(\mu_y, f(.)) = I(\mu_y, F(.))
\]</span></p>
</section>
<section id="visualization-tools" class="level2">
<h2 class="anchored" data-anchor-id="visualization-tools">Visualization tools</h2>
<ul>
<li>There are several tools that can be used to visualize income distribution:
<ul>
<li>Density Function/Histogram</li>
<li>Pen_parade/Cumulative Distribution Function</li>
<li>Lorenz Curve</li>
</ul></li>
</ul>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Density/Histogram</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Plots</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li><p>Density functions and histograms are used to visualize the distribution of income in the population.</p></li>
<li><p>They could be used to detect multimodality, skewness, etc</p></li>
<li><p>And could be used to compare distributions across groups.</p></li>
<li><p><code>Stata</code> Commands</p>
<p><code>histogram varname [weight] [if]</code></p>
<p><code>kdensity varname [weight] [if]</code></p></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="8549a756" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">scheme</span> white2</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">linesize</span> 255</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>color_style tableau</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:frause oaxaca, <span class="kw">clear</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> wt, <span class="kw">meanonly</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">int</span> wt2 = <span class="fu">round</span>(wt/<span class="fu">r</span>(<span class="fu">min</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">two</span> <span class="kw">histogram</span> lnwage [fw=wt2] <span class="co">///</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    || <span class="kw">kdensity</span> lnwage [<span class="fu">w</span>=wt2], <span class="co">///</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ysize</span>(5) <span class="bn">xsize</span>(9) <span class="bn">xtitle</span>(<span class="st">"Log Wages"</span>) <span class="co">///</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Histogram"</span> 2 <span class="st">"Kernel Density"</span>) pos(6) col(2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="session_3_files/figure-revealjs/cell-2-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">PenParade/CDF</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">plot</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<ul>
<li>A different approach to visualize the distribution.</li>
<li>The Pen Parade plots the values of the variable of interest in ascending order.
<ul>
<li>y-axis: Q(p); x-axis: p</li>
</ul></li>
<li>The CDF plots the cumulative distribution of the variable of interest.
<ul>
<li>y-axis: p; x-axis: Q(p)</li>
</ul></li>
<li>They give you a sense of the distribution, and easy comparison across high and low values.</li>
</ul>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">pctile</span> qlnwage = lnwage [<span class="fu">w</span>=wt], nq(100)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">gen</span>  qwage = <span class="fu">exp</span>(qlnwage)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">gen</span> <span class="kw">p</span> = <span class="dt">_n</span> <span class="kw">if</span> <span class="dt">_n</span>&lt;100</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">scatter</span> qwage <span class="kw">p</span>, <span class="kw">connect</span>(<span class="ot">l</span>) <span class="bn">name</span>(m1, <span class="kw">replace</span>) <span class="bn">ysize</span>(5) <span class="bn">xsize</span>(8)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">scatter</span> <span class="kw">p</span> qwage, <span class="kw">connect</span>(<span class="ot">l</span>) <span class="bn">name</span>(m2, <span class="kw">replace</span>) <span class="bn">ysize</span>(5) <span class="bn">xsize</span>(8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="e5cf35f7" class="cell quarto-layout-panel" data-execution_count="2" data-layout-ncol="2">
<div class="quarto-layout-row">
<details class="code-fold">
<summary>Code</summary>
</details>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session_3_files/figure-revealjs/cell-3-output-1.png" class="img-fluid figure-img"></p>
<figcaption>Pen-Parade</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session_3_files/figure-revealjs/cell-3-output-2.png" class="img-fluid figure-img"></p>
<figcaption>Cum Distribution Function</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Distribution plots</p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Lorenz Curve</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Plot</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Alternative:</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li><p>Perhaps the most popular tool to visualize income distribution.</p></li>
<li><p>This curve plots the cumulative share of income vs the cumulative share of population.</p>
<ul>
<li>How much of total income is held by the bottom X% of the population ?</li>
</ul></li>
<li><p>“Easy” to read:</p>
<ul>
<li>The closest it is to the 45 degree line, the more equal the distribution.</li>
</ul></li>
<li><p>Not easy to implement with negative and zero incomes.</p></li>
<li><p>Comparison across groups may be ambiguous.</p></li>
<li><p>its always increasing at an increasing rate respect to X%</p></li>
</ul>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Assume data is sorted by income</p>
<div class="columns">
<div class="column" style="width:47%;">
<p>x-axis: Cum share of population</p>
<p><span class="math display">\[P_j = \frac{\sum_{i=1}^j w_i}{\sum_{i=1}^n w_i}\]</span></p>
</div><div class="column" style="width:47%;">
<p>y-axis: Cum share of income</p>
<p><span class="math display">\[LC_j = \frac{\sum_{i=1}^j y_i w_i}{\sum_{i=1}^n y_iw_i}\]</span></p>
</div>
</div>
<div id="46b3f5e1" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage = <span class="fu">exp</span>(lnwage)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> wage wt  <span class="co">// sort by income and weight </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Estimate Totals for non missing data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> twage = <span class="kw">sum</span>(wage * wt) <span class="kw">if</span> wage!=.</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> tpop  = <span class="kw">sum</span>(wt)        <span class="kw">if</span> wage!=.</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">// get cumulative shares</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lc_i = <span class="kw">sum</span>( (wage*wt/twage) )*100 <span class="kw">if</span> wage!=.</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> p_i  = <span class="kw">sum</span>( (wt/tpop) )*100      <span class="kw">if</span> wage!=.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div id="f503d719" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> (<span class="kw">line</span> lc_i p_i) <span class="co">/// Lorenz Curve</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    ( <span class="kw">function</span> x, <span class="kw">range</span>(0 100) ) , <span class="co">/// 45 degree line</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    aspect(1) <span class="bn">ysize</span>(5) <span class="bn">xsize</span>(8) <span class="co">///</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="bn">xtitle</span>(<span class="st">"Cumulative Share of Population"</span>) <span class="co">///</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ytitle</span>(<span class="st">"Cumulative Share of Income"</span>) <span class="co">///</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="kw">off</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="session_3_files/figure-revealjs/cell-5-output-1.png" class="img-fluid figure-img"></p>
<figcaption>Lorenz Curve</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="sourceCode" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install glcurve <span class="co">// installs command for Generalized Lorenz Curve</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>glcurve wage [aw = wt], <span class="co">/// provides variable and weight</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    lorenz <span class="co">// Request ploting the Lorenz Curve</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="inequality-measures" class="level2">
<h2 class="anchored" data-anchor-id="inequality-measures">Inequality Measures</h2>
<p>There are several measures of inequality. The most popular are:</p>
<ul>
<li><p>Interquantile Range (IQR) (or normalizations) <span class="math display">\[IQR(\#1,\#2) = Q(\#2) - Q(\#1)
\]</span></p></li>
<li><p>Interquantile Share Ratio (Palma ratio (10/40)) <span class="math display">\[ISR(\#1,\#2) = \frac{1-LC(\#2)}{LC(\#1)}
\]</span></p></li>
<li><p>Coefficient of Variation (CV) <span class="math display">\[CV = \frac{\sigma_y}{\mu_y}
\]</span></p></li>
</ul>
</section>
<section id="inequality-measures-1" class="level2">
<h2 class="anchored" data-anchor-id="inequality-measures-1">Inequality Measures</h2>
<ul>
<li>Lorenz Curve:</li>
</ul>
<p><span class="math display">\[LC(p) = \frac{\int_0^p Q_y(u)du}{\int_0^1 Q_y(u)du}
= \frac{1}{\mu_y} \int_0^p Q_y(u)du
\]</span></p>
<ul>
<li>Properties</li>
</ul>
<p><span class="math display">\[\frac{\partial LC(p)}{\partial p} = \frac{Q_y(p)}{\mu_y} \geq 0\]</span></p>
<p><span class="math display">\[\frac{\partial^2 LC(p)}{\partial p^2} = \frac{1}{\mu_y f(y)} \geq 0\]</span></p>
</section>
<section id="inequality-measures-gini-coefficient" class="level2">
<h2 class="anchored" data-anchor-id="inequality-measures-gini-coefficient">Inequality Measures: Gini Coefficient</h2>
<ul>
<li>The Gini coefficient is the most popular measure of inequality.</li>
<li>It is defined as (2x) the area between the Lorenz Curve and the 45 degree line.</li>
</ul>
<p><span class="math display">\[Gini(y) = 2 \int_0^1 (p-LC(p)) dp\]</span></p>
<ul>
<li><p>where <span class="math inline">\(p-LC(p)\)</span> is the “loss” of income the Bottom <span class="math inline">\(p\)</span> percent of the population experiences.</p></li>
<li><p>It is bounded between 0 (perfect Equality) and 1 (complete Inequality).</p></li>
<li><p>When Lorenz do not cross, Gini provides unambiguous ranking of inequality.</p></li>
</ul>
<p><span class="math display">\[Gini(y) = \frac{2}{\mu_y} Cov(y_p,p)\]</span></p>
</section>
<section id="implementation" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="implementation">Implementation</h2>
<ul>
<li><code>Stata</code> has plenty of commands that can be used to estimate Gini
<ul>
<li><code>search gini</code> for few examples</li>
</ul></li>
<li>I suggest 3 commands:
<ul>
<li><code>fastgini</code> (<code>ssc install fastgini</code>)</li>
<li><code>ineqdeco</code> (<code>ssc install ineqdeco</code>)</li>
<li><code>sgini</code> (<code>ssc install sgini</code>)</li>
<li><code>rif</code> (<code>ssc install rif</code>)</li>
</ul></li>
</ul>
</section>
<section id="section-3" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="section-3"></h2>
<div id="870aedba" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sgini wage </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Gini coefficient for wage

-----------------------
    Variable |      v=2
-------------+---------
        wage |   0.2460
-----------------------</code></pre>
</div>
</div>
<div id="30c4e8e2" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ineqdeco wage [pw=wt]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
Percentile ratios

----------------------------------------------------------
  All obs |    p90/p10     p90/p50     p10/p50     p75/p25
----------+-----------------------------------------------
          |      3.154       1.694       0.537       1.771
----------------------------------------------------------
  
Generalized Entropy indices GE(a), where a = income difference
 sensitivity parameter, and Gini coefficient

----------------------------------------------------------------------
  All obs |     GE(-1)       GE(0)       GE(1)       GE(2)        Gini
----------+-----------------------------------------------------------
          |    0.23199     0.14240     0.12282     0.13398     0.26273
----------------------------------------------------------------------
   
Atkinson indices, A(e), where e &gt; 0 is the inequality aversion parameter

----------------------------------------------
  All obs |     A(0.5)        A(1)        A(2)
----------+-----------------------------------
          |    0.06292     0.13273     0.31693
----------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="other-inequality-measures" class="level2">
<h2 class="anchored" data-anchor-id="other-inequality-measures">Other Inequality Measures</h2>
<ul>
<li><p>There are other approaches that can be used to measure inequality.</p>
<ul>
<li>Normative approach-Social welfare: Uses explicit concepts of welfare functions to quantify inequality</li>
</ul></li>
</ul>
<p><span class="math display">\[I_A(y,\varepsilon) = 1 - \left( \frac{1}{N} \sum_{i=1}^N \left(\frac{y_i}{\mu_y}\right)^{1-\varepsilon} \right)^\frac{1}{1-\varepsilon}
\]</span></p>
<p>where is a measure of inequality aversion.</p>
<ul>
<li>Information theory: Quantifies inequality treating it as a problem of comparing income distribution probabilities. How far are we from Full Entropy</li>
</ul>
<p><span class="math display">\[I_{GE}(Y,\alpha)=\frac{1}{\alpha(1-\alpha)}\left[\frac{1}{N} \sum \left(\frac{y_i}{\mu_y}\right)^\alpha -1\right]
\]</span></p>
<ul>
<li>Axiomatic approach
<ul>
<li>Uses a series of axioms to create measures of inequality</li>
</ul></li>
</ul>
</section>
</section>
<section id="how-to-compare-inequality" class="level1">
<h1>How to Compare Inequality</h1>
<p>a note</p>
<section id="significance-test" class="level2">
<h2 class="anchored" data-anchor-id="significance-test">Significance test</h2>
<ul>
<li>As discussed in Session 1, we can use a t-test to compare means.
<ul>
<li>This requires estimating the standard error of the mean, use <code>mean</code> command, or <code>regress</code></li>
</ul></li>
<li>Similarly, it may be as important to test whether two distributions (or inequality measures) are different.
<ul>
<li>This requires estimating the standard error of the inequality measure.</li>
<li>This is not as straightforward as the mean.</li>
</ul></li>
<li>Easiest methods:
<ul>
<li><strong>Bootstrap</strong>: requires <em>bootstrap weights</em> for survey data.</li>
<li><strong>Influence function</strong>: requires deriving the influence function of the inequality measure.</li>
</ul></li>
</ul>
</section>
<section id="bootstrap" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="bootstrap">Bootstrap</h2>
<ul>
<li>Bootstrap its a non-parametric method to estimate the standard error of a statistic. Its based on Resampling and re-estimating data.</li>
</ul>
<p><code>bootstrap gini=r(coeff): sgini wage</code></p>
<div id="aae8feab" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code>
warning: sgini does not set e(sample), so no observations will be excluded from the resampling because of missing values or other reasons. To exclude observations, press Break, save the data, drop any observations that are to be excluded, and rerun
         bootstrap.

Bootstrap results                                        Number of obs = 1,647
                                                         Replications  =    50

      Command: sgini wage
         gini: r(coeff)

------------------------------------------------------------------------------
             |   Observed   Bootstrap                         Normal-based
             | coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        gini |   .2460329   .0063639    38.66   0.000     .2335599    .2585059
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<ul>
<li>RIF (Recentered Influence Function) is a method that uses the moment conditions to estimate the standard error of a statistic.</li>
</ul>
<p><code>rifhdreg wage , rif(gini)</code></p>
<div id="5cbdf0a0" class="cell" data-execution_count="8">
<div class="cell-output cell-output-stdout">
<pre><code>
Linear regression                               Number of obs     =      1,434
                                                F(0, 1433)        =       0.00
                                                Prob &gt; F          =          .
                                                R-squared         =     0.0000
                                                Root MSE          =     .24613

------------------------------------------------------------------------------
             |               Robust
        wage | Coefficient  std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       _cons |   .2460329   .0064995    37.85   0.000     .2332833    .2587825
------------------------------------------------------------------------------
Distributional Statistic: gini
Sample Mean    RIF gini :  .24603</code></pre>
</div>
</div>
<ul>
<li>Better yet, because you can use regressions (RIF-regressions), you can use weights, and test for differences in inequality across groups.</li>
</ul>
<p><code>rifhdreg wage ibn.female [pw=wt], rif(gini) over(female) noconstant</code></p>
<div id="5b35d8f2" class="cell" data-execution_count="9">
<div class="cell-output cell-output-stdout">
<pre><code>
Linear regression                               Number of obs     =      1,434
                                                F(2, 1432)        =     640.56
                                                Prob &gt; F          =     0.0000
                                                R-squared         =     0.5056
                                                Root MSE          =     .25631

------------------------------------------------------------------------------
             |               Robust
        wage | Coefficient  std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      female |
          0  |   .2377884   .0084103    28.27   0.000     .2212907    .2542862
          1  |   .2820059   .0128488    21.95   0.000     .2568015    .3072103
------------------------------------------------------------------------------
Distributional Statistic: gini
Sample Mean    RIF gini :  .25805</code></pre>
</div>
</div>
<p><code>rifhdreg wage i.female [pw=wt], rif(gini) over(female)</code></p>
<div id="8789321c" class="cell" data-execution_count="10">
<div class="cell-output cell-output-stdout">
<pre><code>
Linear regression                               Number of obs     =      1,434
                                                F(1, 1432)        =       8.29
                                                Prob &gt; F          =     0.0040
                                                R-squared         =     0.0073
                                                Root MSE          =     .25631

------------------------------------------------------------------------------
             |               Robust
        wage | Coefficient  std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
    1.female |   .0442175   .0153565     2.88   0.004     .0140938    .0743412
       _cons |   .2377884   .0084103    28.27   0.000     .2212907    .2542862
------------------------------------------------------------------------------
Distributional Statistic: gini
Sample Mean    RIF gini :  .25805</code></pre>
</div>
</div>
</section>
</section>
<section id="how-to-decompose-inequality" class="level1">
<h1>How to Decompose Inequality</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<ul>
<li>Some times, we may be interested in determining what factors, and what extent, explain inequality.
<ul>
<li>But what do we mean by “explain”?</li>
</ul></li>
<li>There are several approaches to decompose inequality.
<ul>
<li>by sources: Explain how inequality is related to source of income</li>
<li>by groups: How much of the inequality is explained by inequality within groups, and between groups.</li>
</ul></li>
<li>We could also consider how inequality gaps are related to characteristics or returns to such characteristics.</li>
</ul>
</section>
<section id="decompose-by-sources" class="level2">
<h2 class="anchored" data-anchor-id="decompose-by-sources">Decompose by sources</h2>
<ul>
<li>Some inequality indices are well suited to decompose inequality by sources.
<ul>
<li>Variance Decomposition (Sorrocks 1998)</li>
<li>Gini Decomposition by source (Lerman and Yitzhaki 1985)</li>
</ul></li>
<li>The idea is assess inequality (or concentration) of each source of income, and then combine them to obtain their contribution to overall inequality.</li>
</ul>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<section id="variance-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="variance-decomposition">Variance Decomposition</h3>
<p>Setup: <span class="math display">\[\begin{aligned}
Y &amp;= y_1 + y_2 + \cdots + y_n  \\
I_V(Y) &amp;= V(Y) = Cov(Y,Y) \\
&amp;= Cov(Y,y_1) + Cov(Y,y_2) + \cdots \\
\end{aligned}
\]</span></p>
<p>Covariance, however could be rewritten as: <span class="math inline">\(Cov(Y,y_k)=\rho_k \sigma_Y \sigma_{y_k}\)</span>, thus</p>
<p><span class="math display">\[\begin{aligned}
V(y) = \sigma^2_Y &amp;= \rho_1 \sigma_Y \sigma_{y_1} + \rho_2 \sigma_Y \sigma_{y_2} + \cdots \\
\sigma_Y&amp;=   \rho_1 \sigma_{y_1} + \rho_2 \sigma_{y_2} + \cdots  \\
\end{aligned}
\]</span></p>
<p>Finally, if we divide all by <span class="math inline">\(\mu_y\)</span> and multiply by <span class="math inline">\(\mu_{yk}/\mu_{yk}\)</span>, we get:</p>
<p><span class="math display">\[\begin{aligned}
\frac{\sigma_Y}{\mu_y} = CV(y) &amp;=   \rho_1 \frac{1}{\mu_{y}} \frac{\mu_{y1}}{\mu_{y1}}\sigma_{y_1} + \rho_2 \frac{1}{\mu_{y}} \frac{\mu_{y2}}{\mu_{y2}}  \sigma_{y_2} + \cdots  \\
&amp;= \rho_1 sh_1 CV(y_1) + \rho_2 sh_2 CV(y_2) + \cdots  \\
\end{aligned}
\]</span></p>
</section>
</section>
<section id="example-stata" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-stata">Example <code>Stata</code></h2>
<p><code>ssc install ineqfac</code></p>
<div id="602b33f0" class="cell larger" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>frause limew1972.dta, <span class="kw">clear</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ineqfac basemi inchomewealth incnonhomewealth govtr_n pubcon tx_n valhp [aw=hhwgt]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 
Inequality decomposition by factor components (Shorrocks' method)
-------------------------------------------------------------------------------
Factor              |  100*s_f     S_f   100*m_f/m  rho_f   CV_f CV_f/CV(Total)
--------------------+----------------------------------------------------------
basemi              |   29.115    0.284   44.434   0.711   0.900    0.922
inchomewealth       |    1.872    0.018    4.302   0.318   1.335    1.367
incnonhomewealth    |   43.136    0.421    7.905   0.754   7.065    7.235
govtr_n             |   -0.979   -0.010    5.868  -0.107   1.528    1.565
pubcon              |    2.091    0.020    8.303   0.238   1.035    1.060
tx_n                |   15.629    0.153   11.462   0.754   1.767    1.809
valhp               |    9.136    0.089   17.726   0.502   1.003    1.027
--------------------+----------------------------------------------------------
Total               |  100.000    0.977  100.000   1.000   0.977    1.000
-------------------------------------------------------------------------------
Note: s_f is the proportionate contribution of factor f
 to inequality of Total, where ...
 s_f = rho_f*sd(f)/sd(Total) 
     = rho_f*[m(factor_f)/m(totvar)]*[CV(factor_f)/CV(totvar)].
 S_f = s_f*CV(Total). rho_f = corr(f,Total). 
 m_f = mean(f). sd(f) = std.dev. of f. CV_f = sd(f)/m_f.</code></pre>
</div>
</div>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<section id="gini-decomposition-by-source" class="level3">
<h3 class="anchored" data-anchor-id="gini-decomposition-by-source">Gini Decomposition by source</h3>
<ul>
<li>The Gini index could also be decomposed by source of income.</li>
</ul>
<p><span class="math display">\[\begin{aligned}
Gini(y) &amp;= \frac{2}{\mu_y} Cov(y,F(y)) = \frac{2}{\mu_y} Cov\left(\sum y_k,F(y)\right) =\frac{2}{\mu_y} \sum Cov\left( y_k,F(y)\right)
\end{aligned}
\]</span></p>
<ul>
<li>So Gini is the sum of the covariance of each source of income with <span class="math inline">\(F(y)\)</span></li>
</ul>
<p><span class="math display">\[\begin{aligned}
Gini(y) &amp;= \sum \frac{2}{\mu_y} \times Cov( y_k,F(y)) \times \frac{\mu_{yk}}{\mu_{yk}} \times \frac{Cov( y_k,F(y_k))}{Cov ( y_k,F(y_k))} \\
&amp;=\sum \frac{Cov ( y_k,F(y) )}{Cov ( y_k,F(y_k) )} \times \frac{2Cov( y_k,F(y_k)}{\mu_{yk}} \times \frac{\mu_{yk}}{\mu_y}  \\
&amp;= \sum R_k \times G_k \times sh_k
\end{aligned}
\]</span></p>
</section>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<section id="gini-decomposition-by-source-1" class="level3">
<h3 class="anchored" data-anchor-id="gini-decomposition-by-source-1">Gini Decomposition by source</h3>
<p><span class="math display">\[\begin{aligned}
Gini(y)&amp;= \sum R_k \times G_k \times sh_k
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(R_k\)</span> = Gini Correlation; <span class="math inline">\(G_k\)</span> = Gini of source <span class="math inline">\(k\)</span>; <span class="math inline">\(sh_k\)</span> = share of source <span class="math inline">\(k\)</span> in total income.</li>
<li><span class="math inline">\(R_k\timex G_k\)</span> is the Concentration Index of <span class="math inline">\(Y_k\)</span></li>
</ul>
</section>
</section>
<section id="example-stata-1" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-stata-1">Example <code>Stata</code></h2>
<p>You probably already have it installed</p>
<p><code>ssc install sgini</code></p>
<div id="3847fa52" class="cell larger" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sgini basemi inchomewealth incnonhomewealth govtr_n pubcon tx_n valhp [aw=hhwgt], source</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Gini coefficient for basemi, inchomewealth, incnonhomewealth, govtr_n, pubcon, tx_n, valhp

Note: inchomewealth has 690 negative observations (used in calculations).
Note: incnonhomewealth has 10359 negative observations (used in calculations).
-----------------------
    Variable |      v=2
-------------+---------
      basemi |   0.4787
inchomewea~h |   0.6161
incnonhome~h |   0.9503
     govtr_n |   0.7099
      pubcon |   0.4913
        tx_n |   0.6036
       valhp |   0.5021
-----------------------

Decomposition by source:
  TOTAL =  basemi +  inchomewealth +  incnonhomewealth +  govtr_n +  pubcon +  tx_n +  valhp


Parameter: v=2
--------------------------------------------------------------------------------
             |    Share   Coeff.    Corr.    Conc.  Contri.  %Contri. Elasticity
    Variable |        s        g        r    c=g*r    s*g*r   s*g*r/G  s*g*r/G-s
-------------+------------------------------------------------------------------
      basemi |   0.4443   0.4787   0.8870   0.4246   0.1887   0.4868    0.0425
inchomewea~h |   0.0430   0.6161   0.4617   0.2845   0.0122   0.0316   -0.0114
incnonhome~h |   0.0790   0.9503   0.7724   0.7340   0.0580   0.1497    0.0707
     govtr_n |   0.0587   0.7099  -0.2298  -0.1631  -0.0096  -0.0247   -0.0834
      pubcon |   0.0830   0.4913   0.4593   0.2257   0.0187   0.0483   -0.0347
        tx_n |   0.1146   0.6036   0.8776   0.5297   0.0607   0.1567    0.0420
       valhp |   0.1773   0.5021   0.6601   0.3314   0.0587   0.1516   -0.0257
-------------+------------------------------------------------------------------
       TOTAL |   1.0000   0.3876   1.0000   0.3876   0.3876   1.0000    0.0000
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="decompose-by-groups" class="level2">
<h2 class="anchored" data-anchor-id="decompose-by-groups">Decompose by groups</h2>
<ul>
<li>There is a second type of decomposition one may be interested in.
<ul>
<li>How much of the inequality is explained by inequality within groups, and between groups.</li>
</ul></li>
<li>For example, consider two cases:
<ul>
<li>Two (eq size) groups that have access to the same level of income, but within each group, all resources are held by one individual.</li>
<li>Two (eq size) groups, one has 80% of the income, and the other 20%, but within groups income is equally distributed.</li>
</ul></li>
<li>It is possible to understand the source of inequality by decomposing it by groups.
<ul>
<li>Entropy Indices (and Atkinson) are well suited for this type of decomposition. (see help ineqdeco)</li>
<li>GINI is not as straight forward but possible.</li>
</ul></li>
</ul>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7"></h2>
<section id="gini-decomposition-by-groups" class="level3">
<h3 class="anchored" data-anchor-id="gini-decomposition-by-groups">GINI Decomposition by groups</h3>
<ul>
<li><p>Decomposition of the GINI coefficient by groups Milanovic and Yitzhaki (2002)</p></li>
<li><p>The method: To decompose the GINI by groups, one can use the following:</p></li>
</ul>
<p><span class="math display">\[\begin{aligned}
Gini(y) &amp;= \sum_{k=1}^K s_k O_k Gini(y_k) + Gini_{bw}
\end{aligned}
\]</span></p>
<ul>
<li>where <span class="math inline">\(s_i\)</span> is the share of group <span class="math inline">\(i\)</span> in total income, <span class="math inline">\(Gini(y_k)\)</span> is the Gini of group <span class="math inline">\(k\)</span>, <span class="math inline">\(O_k\)</span> is a measure of overlapping across groups, and <span class="math inline">\(Gini_{bw}\)</span> is the Gini between groups.</li>
</ul>
<p><span class="math display">\[Gini_{bw} = \frac{2}{\mu_y} Cov(\mu_i,\bar F_i)\]</span></p>
</section>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<section id="overlapping" class="level3">
<h3 class="anchored" data-anchor-id="overlapping">Overlapping</h3>
<ul>
<li><p>Overlapping <span class="math inline">\(O_k\)</span> measures to what extend the distribution of income in group <span class="math inline">\(k\)</span> overlaps with the distribution of income in other groups.</p></li>
<li><p>If there is no overlapping, then <span class="math inline">\(O_k=p_i\)</span> (the population share of group k).</p></li>
<li><p>Otherwise, this adjustment factors ensures that the sum of the Gini of each group is equal to the Gini of the total population + Between Gini.</p></li>
</ul>
</section>
</section>
<section id="example-stata-2" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-stata-2">Example <code>Stata</code></h2>
<p><code>ssc install anogi</code> (Tom Masterson is one of the authors) <code>ssc install moremata</code> (needed for <code>anogi</code>)</p>
<div id="0b68df52" class="cell larger" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>anogi limew [aw= hhwgt ], <span class="kw">by</span>(educl) <span class="kw">detail</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Analysis of Gini

--------------------------------------------------
                          |      Coef.          %
--------------------------+-----------------------
Overall Gini              |   .3875623     100.00
                          |
G_wo = sum s_i*G_i*O_i    |   .3405469      87.87
G_b                       |   .0470154      12.13
                          |
IG   = sum s_i*G_i        |   .3657639      94.38
IGO  = sum s_i*G_i(O_i-1) |   -.025217      -6.51
BGp  = G_bp               |   .1317698      34.00
BGO  = G_b - G_bp         |  -.0847544     -21.87
--------------------------+-----------------------
Mean of limew             |    20403.6
N. of obs                 |      44872
N. of subgroups           |          4
--------------------------------------------------


Detailed statistics for subgroups

-------------------------------------------------------------------------------------------
             |         N          p       mean          s          G          O          F 
-------------+-----------------------------------------------------------------------------
           1 |  18244.58   .4065916   15466.07   .3081992   .3844549   .9986868   .3963075 
           2 |  14552.19   .3243045   21019.76   .3340981    .338758   .9239628   .5363091 
           3 |  5609.305   .1250068   22705.72   .1391112   .3640736   .9435821   .5546081 
           4 |  6465.924   .1440971   30951.73   .2185916   .3817625   .8370495   .6634934 
-------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
</section>
<section id="thats-all-for-today" class="level1">
<h1>Thats all for today…</h1>
<p>Until next week!-&gt; HW1</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>