<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - Research Methods II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class/index.html"> 
<span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html"> 
<span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods2/index.html"> 
<span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#simulation-methods-in-economics" id="toc-simulation-methods-in-economics" class="nav-link active" data-scroll-target="#simulation-methods-in-economics">Simulation Methods in Economics</a>
  <ul class="collapse">
  <li><a href="#what-is-monte-carlo-simulation" id="toc-what-is-monte-carlo-simulation" class="nav-link" data-scroll-target="#what-is-monte-carlo-simulation">What is Monte Carlo Simulation?</a></li>
  <li><a href="#example-mean-vs-median" id="toc-example-mean-vs-median" class="nav-link" data-scroll-target="#example-mean-vs-median">Example: Mean vs Median</a>
  <ul class="collapse">
  <li><a href="#change-assumptions-from-n-to-t-distribution" id="toc-change-assumptions-from-n-to-t-distribution" class="nav-link" data-scroll-target="#change-assumptions-from-n-to-t-distribution">Change assumptions, from N to t-distribution</a></li>
  </ul></li>
  <li><a href="#properties-of-estimators" id="toc-properties-of-estimators" class="nav-link" data-scroll-target="#properties-of-estimators">Properties of estimators</a>
  <ul class="collapse">
  <li><a href="#correcting-for-heteroskedasticity" id="toc-correcting-for-heteroskedasticity" class="nav-link" data-scroll-target="#correcting-for-heteroskedasticity">Correcting for heteroskedasticity</a></li>
  </ul></li>
  <li><a href="#more-on-monte-carlo-simulations" id="toc-more-on-monte-carlo-simulations" class="nav-link" data-scroll-target="#more-on-monte-carlo-simulations">More on Monte Carlo Simulations</a></li>
  <li><a href="#what-are-micro-simulations" id="toc-what-are-micro-simulations" class="nav-link" data-scroll-target="#what-are-micro-simulations">What are micro-simulations?</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#so-what-do-we-need" id="toc-so-what-do-we-need" class="nav-link" data-scroll-target="#so-what-do-we-need">So what do we need?</a></li>
  </ul></li>
  <li><a href="#how-do-we-do-it" id="toc-how-do-we-do-it" class="nav-link" data-scroll-target="#how-do-we-do-it">How do we do it?</a></li>
  <li><a href="#example-the-case-of-higher-education" id="toc-example-the-case-of-higher-education" class="nav-link" data-scroll-target="#example-the-case-of-higher-education">Example: The case of higher education</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a>
  <ul class="collapse">
  <li><a href="#imputing-wages" id="toc-imputing-wages" class="nav-link" data-scroll-target="#imputing-wages">Imputing wages:</a></li>
  <li><a href="#what-else-can-we-do" id="toc-what-else-can-we-do" class="nav-link" data-scroll-target="#what-else-can-we-do">What else can we do?</a></li>
  </ul></li>
  <li><a href="#st-micro-simulation" id="toc-st-micro-simulation" class="nav-link" data-scroll-target="#st-micro-simulation">1st Micro-simulation</a>
  <ul class="collapse">
  <li><a href="#a-review" id="toc-a-review" class="nav-link" data-scroll-target="#a-review">a Review</a></li>
  </ul></li>
  <li><a href="#not-the-only-way-to-do-it" id="toc-not-the-only-way-to-do-it" class="nav-link" data-scroll-target="#not-the-only-way-to-do-it">Not the only way to do it</a></li>
  <li><a href="#tax-reform-on-households-welfare" id="toc-tax-reform-on-households-welfare" class="nav-link" data-scroll-target="#tax-reform-on-households-welfare">Tax Reform on Households Welfare</a></li>
  </ul></li>
  <li><a href="#levy-institute-microsimulation-model-limm" id="toc-levy-institute-microsimulation-model-limm" class="nav-link" data-scroll-target="#levy-institute-microsimulation-model-limm">Levy Institute Microsimulation Model (LIMM)</a>
  <ul class="collapse">
  <li><a href="#intro" id="toc-intro" class="nav-link" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#limm-step-i" id="toc-limm-step-i" class="nav-link" data-scroll-target="#limm-step-i">LIMM: Step I</a>
  <ul class="collapse">
  <li><a href="#job-creation" id="toc-job-creation" class="nav-link" data-scroll-target="#job-creation">Job Creation</a></li>
  </ul></li>
  <li><a href="#limm-step-ii" id="toc-limm-step-ii" class="nav-link" data-scroll-target="#limm-step-ii">LIMM: Step II</a>
  <ul class="collapse">
  <li><a href="#job-assigment" id="toc-job-assigment" class="nav-link" data-scroll-target="#job-assigment">Job Assigment</a></li>
  </ul></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a>
  <ul class="collapse">
  <li><a href="#job-assigment-ii" id="toc-job-assigment-ii" class="nav-link" data-scroll-target="#job-assigment-ii">Job Assigment II</a></li>
  </ul></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a>
  <ul class="collapse">
  <li><a href="#job-assigment-iii" id="toc-job-assigment-iii" class="nav-link" data-scroll-target="#job-assigment-iii">Job Assigment III</a></li>
  </ul></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a>
  <ul class="collapse">
  <li><a href="#earning-contributions" id="toc-earning-contributions" class="nav-link" data-scroll-target="#earning-contributions">Earning contributions</a></li>
  </ul></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a>
  <ul class="collapse">
  <li><a href="#job-assigment-iv-wages-and-hours" id="toc-job-assigment-iv-wages-and-hours" class="nav-link" data-scroll-target="#job-assigment-iv-wages-and-hours">Job Assigment IV: Wages and Hours</a></li>
  </ul></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a>
  <ul class="collapse">
  <li><a href="#hours-of-hp-re-assigment" id="toc-hours-of-hp-re-assigment" class="nav-link" data-scroll-target="#hours-of-hp-re-assigment">Hours of HP re-assigment</a></li>
  <li><a href="#other-considerations" id="toc-other-considerations" class="nav-link" data-scroll-target="#other-considerations">Other considerations</a></li>
  </ul></li>
  <li><a href="#assessing-the-quality-of-the-simulation" id="toc-assessing-the-quality-of-the-simulation" class="nav-link" data-scroll-target="#assessing-the-quality-of-the-simulation">Assessing the quality of the simulation</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul></li>
  <li><a href="#thats-all-folks" id="toc-thats-all-folks" class="nav-link" data-scroll-target="#thats-all-folks">Thats All Folks!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="session_7.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Methods II</h1>
<p class="subtitle lead">Session 7: Micro-Simulations, and Monte Carlo Methods</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="simulation-methods-in-economics" class="level1">
<h1>Simulation Methods in Economics</h1>
<section id="what-is-monte-carlo-simulation" class="level2">
<h2 class="anchored" data-anchor-id="what-is-monte-carlo-simulation">What is Monte Carlo Simulation?</h2>
<ul>
<li><p>Monte Carlo simulation are a generic name given to methods that use random numbers to simulate a process.</p></li>
<li><p>In econometrics, Monte Carlo methods are used to study the properties of estimators, and to evaluate the performance of statistical tests.</p></li>
<li><p>This can be a useful tool to understand some of the properties of estimators, or even problems related to violations of assumptions.</p></li>
<li><p>It can also be used to evaluate the performance of estimators in finite samples, and to compare different estimators.</p></li>
</ul>
</section>
<section id="example-mean-vs-median" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-mean-vs-median">Example: Mean vs Median</h2>
<ul>
<li>Which of this estimators is more robust and efficient, when samples are small ?</li>
<li>Lets setup a program that would simulate this:</li>
</ul>
<div id="92a264ef" class="cell larger" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define a program</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mean_vs_median</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mean_vs_median, <span class="kw">eclass</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">syntax</span>, [nobs(<span class="kw">int</span> 100)]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">clear</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  ** Set  # <span class="kw">of</span> <span class="kw">obs</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`nobs'</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  ** Generate a random <span class="kw">variable</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> x = rnormal(0,1)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  ** Calculate <span class="kw">mean</span> and <span class="kw">median</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">sum</span> x,<span class="kw">d</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  ** Store results</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> b = <span class="fu">r</span>(<span class="kw">mean</span>), <span class="fu">r</span>(p50)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  ** <span class="kw">post</span> results</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> colname b = <span class="st">"mean"</span> <span class="st">"median"</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>mean_vs_median</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">ereturn</span> <span class="kw">display</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Number of observations (_N) was 0, now 100.
------------------------------------------------------------------------------
             | Coefficient
-------------+----------------------------------------------------------------
        mean |  -.1445693
      median |  -.1970271
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Now that the program is SET, lets run it 1000 times:</p>
<div id="fd633be3" class="cell larger" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 101</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000): mean_vs_median, nobs(500)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Command: mean_vs_median, nobs(500)

Simulations (1,000)
----+--- 1 ---+--- 2 ---+--- 3 ---+--- 4 ---+--- 5 
..................................................    50
..................................................   100
..................................................   150
..................................................   200
..................................................   250
..................................................   300
..................................................   350
..................................................   400
..................................................   450
..................................................   500
..................................................   550
..................................................   600
..................................................   650
..................................................   700
..................................................   750
..................................................   800
..................................................   850
..................................................   900
..................................................   950
.................................................. 1,000

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _b_mean |      1,000     .001419     .043875  -.1660358   .1525889
   _b_median |      1,000    .0000899    .0544004  -.1851489   .1853068</code></pre>
</div>
</div>
<p>Conclusion, when N=100, and the distribution is normal, the mean is more efficient than the median.</p>
<section id="change-assumptions-from-n-to-t-distribution" class="level3">
<h3 class="anchored" data-anchor-id="change-assumptions-from-n-to-t-distribution">Change assumptions, from N to t-distribution</h3>
<div id="db8e2f12" class="cell larger" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define a program</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> mean_vs_median</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> mean_vs_median, <span class="kw">eclass</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">syntax</span>, [nobs(<span class="kw">int</span> 100) rt(<span class="kw">int</span> 5)]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">clear</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`nobs'</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> x = rt(<span class="ot">`rt'</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">sum</span> x,<span class="kw">d</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> b = <span class="fu">r</span>(<span class="kw">mean</span>), <span class="fu">r</span>(p50)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> colname b = <span class="st">"mean"</span> <span class="st">"median"</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="kw">set</span> <span class="dv">seed</span> 101</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: mean_vs_median, nobs(500) rt(2)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: mean_vs_median, nobs(500) rt(4)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: mean_vs_median, nobs(500) rt(6)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

      Command: mean_vs_median, nobs(500) rt(2)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _b_mean |      1,000   -.0199475    .2203307  -4.369244   .6070946
   _b_median |      1,000    .0002406    .0640181  -.1970648   .1889922

      Command: mean_vs_median, nobs(500) rt(4)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _b_mean |      1,000    .0007863    .0647392  -.2136446   .2056455
   _b_median |      1,000    .0024002    .0602134  -.1902502   .2014696

      Command: mean_vs_median, nobs(500) rt(6)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     _b_mean |      1,000    .0007195    .0531958  -.1984012   .2054568
   _b_median |      1,000    .0008841    .0580835  -.1863388   .2035508</code></pre>
</div>
</div>
</section>
</section>
<section id="properties-of-estimators" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="properties-of-estimators">Properties of estimators</h2>
<ul>
<li>Monte Carlo methods can also be used to study the properties of estimators.</li>
<li>Consider the following example:
<ul>
<li>We want to study the properties of the OLS estimator when the error term is heteroskedastic.</li>
</ul></li>
</ul>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i + u_i*exp(\gamma x_i)\]</span></p>
<ul>
<li><p>What are the consequences of heteroskedasticity in the OLS estimator?</p></li>
<li><p>lets set up a simulation to study this.</p></li>
</ul>
<div id="037fa497" class="cell larger" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define a program</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> ols_hetero</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> ols_hetero, <span class="kw">eclass</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">syntax</span>, [nobs(<span class="kw">int</span> 100) b0(<span class="fu">real</span> 1) b1(<span class="fu">real</span> 1) <span class="kw">gamma</span>(<span class="fu">real</span> 1)]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">clear</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`nobs'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> x = rnormal(0,1)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> u = rnormal(0,1)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="fu">y</span> = <span class="ot">`b0'</span> + <span class="ot">`b1'</span> * x + u*<span class="fu">exp</span>(<span class="ot">`gamma'</span>*x)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// run regression (under homoskedasticity)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">reg</span> <span class="fu">y</span> x</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// store results</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> b = _b[<span class="dt">_cons</span>], _se[<span class="dt">_cons</span>], _b[x], _se[x]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> colname b = <span class="st">"b0"</span> <span class="st">"se0"</span> <span class="st">"b1"</span> <span class="st">"se1"</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: ols_hetero, nobs(500) b0(1) b1(1) <span class="kw">gamma</span>(1)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

      Command: ols_hetero, nobs(500) b0(1) b1(1) gamma(1)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       _b_b0 |      1,000    .9979773    .1210228   .6013685   1.434932
      _b_se0 |      1,000    .1196379    .0220658   .0737395   .2717805
       _b_b1 |      1,000    .9864205    .2661498   .0342865     1.8922
      _b_se1 |      1,000    .1195836    .0210792   .0808713   .2756631</code></pre>
</div>
</div>
<section id="correcting-for-heteroskedasticity" class="level3">
<h3 class="anchored" data-anchor-id="correcting-for-heteroskedasticity">Correcting for heteroskedasticity</h3>
<p>We can correct for heteroskedasticity using robust standard errors.</p>
<div id="bcb13e3f" class="cell larger" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define a program</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> ols_hetero</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> ols_hetero, <span class="kw">eclass</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">syntax</span>, [nobs(<span class="kw">int</span> 100) b0(<span class="fu">real</span> 1) b1(<span class="fu">real</span> 1) <span class="kw">gamma</span>(<span class="fu">real</span> 1)]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">clear</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`nobs'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> x = rnormal(0,1)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> u = rnormal(0,1)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="fu">y</span> = <span class="ot">`b0'</span> + <span class="ot">`b1'</span> * x + u*<span class="fu">exp</span>(<span class="ot">`gamma'</span>*x)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// run regression (under homoskedasticity)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">reg</span> <span class="fu">y</span> x, <span class="kw">robust</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// store results</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> b = _b[<span class="dt">_cons</span>], _se[<span class="dt">_cons</span>], _b[x], _se[x]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> colname b = <span class="st">"b0"</span> <span class="st">"se0"</span> <span class="st">"b1"</span> <span class="st">"se1"</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: ols_hetero, nobs(500) b0(1) b1(1) <span class="kw">gamma</span>(1)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

      Command: ols_hetero, nobs(500) b0(1) b1(1) gamma(1)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       _b_b0 |      1,000     1.00342    .1180407   .6255065     1.3921
      _b_se0 |      1,000    .1171892    .0219696   .0807092   .3564852
       _b_b1 |      1,000     1.00355    .2589393  -.2493259   1.956252
      _b_se1 |      1,000    .2407364    .0913925   .1092693   1.174903</code></pre>
</div>
</div>
<p>or using weighted least squares.</p>
<div id="2296f9a7" class="cell larger" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// define a program</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> ols_hetero</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> ols_hetero, <span class="kw">eclass</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">syntax</span>, [nobs(<span class="kw">int</span> 100) b0(<span class="fu">real</span> 1) b1(<span class="fu">real</span> 1) <span class="kw">gamma</span>(<span class="fu">real</span> 1)]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">clear</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span> <span class="kw">obs</span> <span class="ot">`nobs'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> x = rnormal(0,1)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> u = rnormal(0,1)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="fu">y</span> = <span class="ot">`b0'</span> + <span class="ot">`b1'</span> * x + u*<span class="fu">exp</span>(<span class="ot">`gamma'</span>*x)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// run regression (under homoskedasticity)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">reg</span> <span class="fu">y</span> x, </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">predict</span> uhat, <span class="kw">resid</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> lnuhat2 = <span class="fu">ln</span>(uhat^2)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">reg</span> lnuhat2 x</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">predict</span> lnhx</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> hx=<span class="fu">exp</span>(lnhx)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// store results</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">reg</span> <span class="fu">y</span> x [<span class="fu">w</span>=1/hx], </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> b = _b[<span class="dt">_cons</span>], _se[<span class="dt">_cons</span>], _b[x], _se[x]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span> colname b = <span class="st">"b0"</span> <span class="st">"se0"</span> <span class="st">"b1"</span> <span class="st">"se1"</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000) <span class="kw">nodots</span>: ols_hetero, nobs(500) b0(1) b1(1) <span class="kw">gamma</span>(1)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

      Command: ols_hetero, nobs(500) b0(1) b1(1) gamma(1)


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       _b_b0 |      1,000    1.001033    .0465683   .8545606   1.252005
      _b_se0 |      1,000    .0478398    .0084316   .0288236   .1462429
       _b_b1 |      1,000    1.001063    .0277128   .8875045   1.301835
      _b_se1 |      1,000    .0270911    .0091106   .0088032   .1357872</code></pre>
</div>
</div>
</section>
</section>
<section id="more-on-monte-carlo-simulations" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="more-on-monte-carlo-simulations">More on Monte Carlo Simulations</h2>
<ul>
<li><p>You can use Monte Carlo simulations to study the properties of new estimators as well. (most often)</p></li>
<li><p>The structure of the simulation, however, will depend on the estimator you want to study, and may not be fully generalizable.</p>
<ul>
<li>Notice that in the previous example, we assumed that all data needed to be simulated.</li>
<li>But, we could just as well simulate only “parts” of the data, and use observed data for the rest.</li>
</ul></li>
</ul>
<div id="c51e2d9a" class="cell larger" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">probit</span> lfp female educ age agesq married divorced</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> lfp_xb, <span class="kw">xb</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> b=<span class="fu">e</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)

Iteration 0:   log likelihood = -634.26553  
Iteration 1:   log likelihood = -453.80541  
Iteration 2:   log likelihood = -429.25759  
Iteration 3:   log likelihood = -428.40991  
Iteration 4:   log likelihood = -428.40986  
Iteration 5:   log likelihood = -428.40986  

Probit regression                                       Number of obs =  1,647
                                                        LR chi2(6)    = 411.71
                                                        Prob &gt; chi2   = 0.0000
Log likelihood = -428.40986                             Pseudo R2     = 0.3246

------------------------------------------------------------------------------
         lfp | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
      female |  -1.644408   .1498206   -10.98   0.000    -1.938051   -1.350765
        educ |   .1051167   .0251728     4.18   0.000     .0557789    .1544544
         age |   .1045008   .0385916     2.71   0.007     .0288627    .1801389
       agesq |  -.0012596   .0004463    -2.82   0.005    -.0021344   -.0003848
     married |  -1.692076   .1887409    -8.97   0.000    -2.062001    -1.32215
    divorced |    -.68518   .2319883    -2.95   0.003    -1.139869   -.2304912
       _cons |   .4413072   .7648821     0.58   0.564    -1.057834    1.940448
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="47c2fb6b" class="cell larger" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>* Latent <span class="kw">model</span> LFP =1(lfp_xb + <span class="fu">e</span>&gt;0)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> probit_sim</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span>  probit_sim, <span class="kw">eclass</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">capture</span> <span class="kw">drop</span> lfp_hat</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> lfp_hat=(lfp_xb + rnormal(0,1))&gt;0</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">probit</span> lfp_hat female educ age agesq married divorced, from(b, copy)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span> _b _se, reps(500) <span class="kw">nodots</span>: probit_sim</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> lfp_hat* *</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> ,sep(7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

      Command: probit_sim


    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   _b_female |        500    -1.67208    .1594671  -2.262682  -1.280128
     _b_educ |        500     .108218    .0251913   .0453378   .1974491
      _b_age |        500    .1022977     .038849   -.004108   .2443264
    _b_agesq |        500   -.0012359    .0004483  -.0029406  -.0000835
  _b_married |        500   -1.720405    .1903062  -2.425838  -1.247641
 _b_divorced |        500   -.7046396    .2310935  -1.387282   .1018858
     _b_cons |        500    .5167748    .7899037  -1.920398   2.650355
-------------+---------------------------------------------------------
  _se_female |        500    .1548574    .0187049   .1234346   .2547092
    _se_educ |        500    .0255194    .0012991   .0223761    .029805
     _se_age |        500    .0389973    .0017384   .0336116   .0466778
   _se_agesq |        500    .0004507    .0000184   .0003941   .0005336
 _se_married |        500    .1987176    .0234131   .1538517   .3142596
_se_divorced |        500    .2410041    .0207673    .199707   .3420741
    _se_cons |        500    .7709869    .0397739   .6426999   .9831291</code></pre>
</div>
</div>
<ul>
<li>To some extent, this is similar to the imputation methods we have seen before.</li>
<li>More complex versions of this can be used to elaborate micro-simulations.</li>
</ul>
</section>
<section id="what-are-micro-simulations" class="level2">
<h2 class="anchored" data-anchor-id="what-are-micro-simulations">What are micro-simulations?</h2>
<ul>
<li><p>Micro-simulation is a <strong>technique</strong> that is used to make micro units act and interact in a way that it is possible to aggregate to the level of interest.</p></li>
<li><p>A micro simulation model can be seen as a set of rules, which operates on a sample of micro units (individuals, households, firms, etc.) to produce a set of outcomes.</p></li>
<li><p>The goal is to produce synthetic datasets that can be used to estimate the effects of policy changes.</p></li>
<li><p>Because micro-simulations are based on micro-data, they have the potential to capture the heterogeneity of the population. (decisions, preferences, etc.)</p></li>
</ul>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<ul>
<li>We can also think about micro-simulations as a way to <strong>simulate/predict/impute</strong> the behavior of a population of interest.
<ul>
<li>Thus a lot of what you learned in terms of Modeling, imputations, and matching can be applied here.</li>
</ul></li>
</ul>
<section id="so-what-do-we-need" class="level3">
<h3 class="anchored" data-anchor-id="so-what-do-we-need">So what do we need?</h3>
<ul>
<li><p>We need a <strong>population</strong> of micro units (individuals, households, firms, etc.) that is representative of the population of interest. (survey data)</p></li>
<li><p>Details on a policy change that we want to simulate. (policy parameters)</p></li>
<li><p>A set of rules that describe how the micro units interact with each other and with the policy change. (model for behavior)</p></li>
<li><p>An outcome of interest that we want to study. (outcome variable)</p></li>
</ul>
</section>
</section>
<section id="how-do-we-do-it" class="level2">
<h2 class="anchored" data-anchor-id="how-do-we-do-it">How do we do it?</h2>
<ul>
<li><p>Depending on the type of analysis we want to do, the structure of a micro-simulation can be very simple or very complex.</p></li>
<li><p>Consider the following example:</p>
<ul>
<li>We want to study the effect of a policy that aims to increase the minimum wage in the labor market. What effects would this have?
<ul>
<li>Higher wages ?</li>
<li>increase/decrease in employment?<br>
</li>
<li>Changes in the distribution of wages?</li>
<li>Changes in the Economic structure?</li>
</ul></li>
</ul></li>
<li><p>More complex models require more sophisticated interactions between the micro/and macro units and the policy change.</p></li>
<li><p>However, simpler models can be useful at least to study first order/statistical effects of a policy change.</p></li>
</ul>
</section>
<section id="example-the-case-of-higher-education" class="level2">
<h2 class="anchored" data-anchor-id="example-the-case-of-higher-education">Example: The case of higher education</h2>
<ul>
<li><p>Consider the following. The government wants to increase educational attainment in the population.</p></li>
<li><p>To do so, they want to evaluate the impact that a 2 additional years for people with less than 12 years of education would have on the population.</p></li>
<li><p>How do we do this?</p></li>
<li><p>For simplicilty , lets use the <code>oaxaca</code> dataset</p></li>
</ul>
</section>
<section id="section-1" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="section-1"></h2>
<p>We can start by modeling the effect of education on wages.</p>
<p><span class="math display">\[log(wage)= \beta X + \beta_e educ + u\]</span></p>
<div id="600dddc8" class="cell larger" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> lnwage educ exper tenure female age, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span>  res, res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)

      Source |       SS           df       MS      Number of obs   =     1,434
-------------+----------------------------------   F(5, 1428)      =    101.03
       Model |   105.60186         5   21.120372   Prob &gt; F        =    0.0000
    Residual |  298.517944     1,428  .209046179   R-squared       =    0.2613
-------------+----------------------------------   Adj R-squared   =    0.2587
       Total |  404.119804     1,433  .282009633   Root MSE        =    .45722

------------------------------------------------------------------------------
      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        educ |   .0743986   .0052612    14.14   0.000     .0640782    .0847191
       exper |   .0022628   .0018958     1.19   0.233    -.0014562    .0059817
      tenure |   .0021805   .0019783     1.10   0.271    -.0017001    .0060611
      female |  -.1321951   .0254327    -5.20   0.000    -.1820846   -.0823056
         age |   .0136344   .0017751     7.68   0.000     .0101523    .0171165
       _cons |   1.985785   .0732567    27.11   0.000     1.842083    2.129488
------------------------------------------------------------------------------
(213 missing values generated)</code></pre>
</div>
</div>
<p>ID the policy change</p>
<div id="4c980d91" class="cell larger" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clonevar</span> educ2=educ</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> educ=educ+2 <span class="kw">if</span> educ&lt;12</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> yhat2, <span class="kw">xb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1,099 real changes made)
(213 missing values generated)</code></pre>
</div>
</div>
<p>So what is the effect on wages? (if there is no selection bias)</p>
<div id="34051cf0" class="cell larger" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage = <span class="fu">exp</span>(lnwage)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage2 = <span class="fu">exp</span>(yhat2+res)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage_diff = wage2-wage</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> wage_diff</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> educ = educ2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(213 missing values generated)
(213 missing values generated)
(213 missing values generated)

    Variable |      Mean
-------------+----------
   wage_diff |  2.947924
------------------------
(1,099 real changes made)</code></pre>
</div>
</div>
<p>Wage has increased in 2.95.</p>
<p>But is this the only effect??</p>
</section>
<section id="section-2" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="section-2"></h2>
<ul>
<li><p>What about the effect on employment?</p></li>
<li><p>This is a more complex model, and we need further assumptions</p>
<ul>
<li>Assume anyone who wants to work, will find a job.</li>
<li>Those employed remain employed</li>
<li>Those non-employed will transition to employment marginally</li>
</ul></li>
</ul>
<p><span class="math display">\[P(lfp=1|X,educ)= \beta X + \beta_e educ + u
\]</span></p>
<p>First model the probability of employment</p>
<div id="3a774d6f" class="cell larger" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">probit</span> lfp educ female age single married kids6 kids714</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> lfp_xb, <span class="kw">xb</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> pr_org, pr</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> lfp_xb = lfp_xb + _b[educ] * 2 <span class="kw">if</span> educ&lt;12</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> plfp = <span class="fu">normal</span>(lfp_xb)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>** Before and after the policy change</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> plfp pr_org </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Excerpt from the Swiss Labor Market Survey 1998)
(1,099 real changes made)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        plfp |      1,647    .8995986    .1614962   .0777393   .9999999
      pr_org |      1,647    .8707874    .1925782   .0604887   .9999999</code></pre>
</div>
</div>
<p>So now we have the original probability of employment and the probability of employment after the policy change.</p>
<p>How do we know who will transition from not working to working?</p>
<ul>
<li>Option 1. Assign new workers based on the relative change in the probability of employment.</li>
</ul>
<div id="790275c9" class="cell larger" data-execution_count="13">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> dprob = (plfp-pr_org)/pr_org</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clonevar</span> lfp_post1 = lfp</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> lfp_post1 =1 <span class="kw">if</span> lfp==0 &amp; dprob&gt;runiform()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span>  lfp_post1 lfp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(35 real changes made)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
   lfp_post1 |      1,647    .8919247    .3105698          0          1
         lfp |      1,647     .870674    .3356624          0          1</code></pre>
</div>
</div>
<ul>
<li>Option 2. Simulate employment status based on the original and post-policy probability of employment.</li>
</ul>
<div id="79cfaaa2" class="cell larger" data-execution_count="14">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>** Option 2</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>drop2 unf lfp_org lfp_post</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> unf = runiform()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lfp_org  = pr_org&gt;unf</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lfp_post = plfp  &gt;unf</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> lfp_post  lfp_org</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variable unf not found
variable lfp_org not found
variable lfp_post not found

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    lfp_post |      1,647    .9046752    .2937523          0          1
     lfp_org |      1,647    .8737098    .3322771          0          1</code></pre>
</div>
</div>
<ul>
<li>Both options are valid, but
<ul>
<li>First one requires to impute wages for the new workers only.</li>
<li>Second one requires to impute wages for the entire population.</li>
</ul></li>
</ul>
</section>
<section id="section-3" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="section-3"></h2>
<section id="imputing-wages" class="level3">
<h3 class="anchored" data-anchor-id="imputing-wages">Imputing wages:</h3>
<ul>
<li>We could assume no selection bias.</li>
<li>We may need to use only data available for everyone, or use imputed data (exper tenure) (perhaps at 0?)</li>
</ul>
<div id="4796cca9" class="cell larger" data-execution_count="15">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> lnwage educ female age single married kids6 kids714, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span>  res, res</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> lnwage_hat, <span class="kw">xb</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>** Simulating Known wages component</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> lnwage_hat = lnwage_hat + _b[educ] * 2 <span class="kw">if</span> educ&lt;12</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>** Simulating random component</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>** For those already working:</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> lnwage_hat = lnwage_hat + res <span class="kw">if</span> lfp==1</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>** Simulate unobserved</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">sum</span> res, </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> lnwage_hat = lnwage_hat + rnormal(0,<span class="fu">r</span>(<span class="fu">sd</span>)) <span class="kw">if</span> lfp_post1==1 &amp; lfp==0</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage_post = <span class="fu">exp</span>(lnwage_hat) <span class="kw">if</span> lfp_post1==1 | lfp==1</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> wage = <span class="fu">exp</span>(lnwage)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> wage wage_post</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>sgini wage wage_post</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Source |       SS           df       MS      Number of obs   =     1,434
-------------+----------------------------------   F(7, 1426)      =     79.23
       Model |  113.158257         7  16.1654653   Prob &gt; F        =    0.0000
    Residual |  290.961547     1,426  .204040355   R-squared       =    0.2800
-------------+----------------------------------   Adj R-squared   =    0.2765
       Total |  404.119804     1,433  .282009633   Root MSE        =    .45171

------------------------------------------------------------------------------
      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        educ |   .0709179   .0050262    14.11   0.000     .0610584    .0807774
      female |  -.1427501   .0244736    -5.83   0.000    -.1907583   -.0947419
         age |    .016475   .0014033    11.74   0.000     .0137222    .0192277
      single |  -.0711724   .0443651    -1.60   0.109    -.1582002    .0158554
     married |  -.0977016   .0379654    -2.57   0.010    -.1721755   -.0232276
       kids6 |   .1085073   .0239699     4.53   0.000     .0614873    .1555272
     kids714 |   .0656187    .019681     3.33   0.001      .027012    .1042254
       _cons |   1.999222   .0902563    22.15   0.000     1.822173    2.176272
------------------------------------------------------------------------------
(213 missing values generated)
(1,099 real changes made)
(1,434 real changes made)
(35 real changes made)
(178 missing values generated)
(213 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        wage |      1,434    32.39167    16.12498   1.661434   192.3077
   wage_post |      1,469    35.19396    16.94609   1.873127   221.6129

Gini coefficient for wage, wage_post

-----------------------
    Variable |      v=2
-------------+---------
        wage |   0.2460
   wage_post |   0.2356
-----------------------</code></pre>
</div>
</div>
<p>This is equivalent to running a single imputation round. However, we could repeat the process M times to get a measure for the precission of our estimates.</p>
</section>
<section id="what-else-can-we-do" class="level3">
<h3 class="anchored" data-anchor-id="what-else-can-we-do">What else can we do?</h3>
<ul>
<li>We could go further and also simulate where would people work, and how would the economy change.</li>
<li>We could also account for selection problems</li>
<li>or make a more explicit model for distributional analysis.</li>
</ul>
</section>
</section>
<section id="st-micro-simulation" class="level2">
<h2 class="anchored" data-anchor-id="st-micro-simulation">1st Micro-simulation</h2>
<section id="a-review" class="level3">
<h3 class="anchored" data-anchor-id="a-review">a Review</h3>
<ul>
<li><p>We have just use a simple micro-simulation to study the effect of a policy change (education) on wages and employment.</p></li>
<li><p>This simulation had many assumptions, and we could have done it in many different ways.</p></li>
<li><p>Among others, we assume no selection bias, with an instantaneous change in education, and no again of the population.</p></li>
<li><p>We also made important assumptions regarding the transition from non-employment to employment, and the imputation of wages.</p></li>
</ul>
</section>
</section>
<section id="not-the-only-way-to-do-it" class="level2">
<h2 class="anchored" data-anchor-id="not-the-only-way-to-do-it">Not the only way to do it</h2>
<ul>
<li><p>While many micro-simulations are based on stochastic simultions, there are other ways to do it.</p></li>
<li><p>In Hotckiss et al.&nbsp;(forthcoming), we use a deterministic micro-simulation to study the effect of tax-reforms on welfare changes and its distribution for the - first</p></li>
<li><p>How did we do it?</p></li>
</ul>
</section>
<section id="tax-reform-on-households-welfare" class="level2">
<h2 class="anchored" data-anchor-id="tax-reform-on-households-welfare">Tax Reform on Households Welfare</h2>
<ul>
<li>We concentrated mostly on couple households with young children (0-18 years old).</li>
<li>Using a heckman selection model, we impute wages for the non-working people (based on PMM).</li>
<li>Using observed and imputed wages, we impute the tax liability for each household before and after the reform. (TAX-SIM), and estimate after-tax wages.</li>
<li>Estimate Household Labor Supply based on HH utility and Non-linear Tobit model</li>
<li>Use HLS models, we make predictions for Labor Supply changes and utility changes given the Reform.
<ul>
<li>The Outcome was how much better/worse off would households be after the reform.</li>
</ul></li>
</ul>
</section>
</section>
<section id="levy-institute-microsimulation-model-limm" class="level1">
<h1>Levy Institute Microsimulation Model (LIMM)</h1>
<section id="intro" class="level2">
<h2 class="anchored" data-anchor-id="intro">Intro</h2>
<ul>
<li>At Levy, we have also constructed a micro-simulation model to study employment simulations.</li>
<li>Method first developed for estimating the impact of the American Recovery and Reinvestment Act of 2009
<ul>
<li>Convert spending into jobs by industry and occupation (I/O matrix)</li>
<li>Assign potential workers to jobs</li>
<li>Predict earnings and hours</li>
</ul></li>
<li>For the work with LIMEW and LIMTIP, this has also been used for distributional analysis of employment assigment and services use.</li>
</ul>
</section>
<section id="limm-step-i" class="level2">
<h2 class="anchored" data-anchor-id="limm-step-i">LIMM: Step I</h2>
<section id="job-creation" class="level3">
<h3 class="anchored" data-anchor-id="job-creation">Job Creation</h3>
<ul>
<li>Consider a policy: Road construction, Services provision, etc.
<ul>
<li>Calculate changes in final demand for each industry the policy creates</li>
<li>Using I-O tables estimate change in total output for each industry</li>
<li>Use that change in output to estimate change demand for labor inputs
<ul>
<li>Transform the changes from labor imputs to generated jobs (consider wages)</li>
</ul></li>
<li>Distribute changes across occupations (within industry)
<ul>
<li>Using, for example, shares of employment by occupation within industry</li>
</ul></li>
</ul></li>
<li>With this we have a total number of jobs created by industry and occupation.</li>
</ul>
</section>
</section>
<section id="limm-step-ii" class="level2">
<h2 class="anchored" data-anchor-id="limm-step-ii">LIMM: Step II</h2>
<section id="job-assigment" class="level3">
<h3 class="anchored" data-anchor-id="job-assigment">Job Assigment</h3>
<ul>
<li>Given the Total change in Jobs, we need to assign workers to those jobs.
<ul>
<li>Who are the potential workers?
<ul>
<li>Not in LF: Potential, but not looking for work (may depend on characteristics). Avoid retired, disabled and students</li>
<li>Unemployed: Most likely to take a job (pool may not be large enough)</li>
<li>Underemployed: Working part-time, but willing to work full-time, or people aiming for better jobs. (May create job openings)</li>
<li>and Employed: May be willing to change jobs (may create job openings)</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<section id="job-assigment-ii" class="level3">
<h3 class="anchored" data-anchor-id="job-assigment-ii">Job Assigment II</h3>
<ul>
<li><p>Two Steps, modeling job creation and job assigment</p></li>
<li><p>A probit/logit model would be estimated to predict the likelihood of working, and this will be used to assign jobs.</p>
<ul>
<li><p>Job assignment is done using a multinomial model (<code>mprobit</code>) to predict likelihoods of working on a given occupation &amp; industry.</p></li>
<li><p>Ideally, you would like to do both at the same time, but that is a very complex model to estimate. Instead, each one is estimated separately.</p></li>
</ul></li>
</ul>
<p><span class="math display">\[\begin{aligned}
I^*(ind = 1 ) &amp;= \beta_1 X + e_1 \\
I^*(ind = 2 ) &amp;= \beta_2 X + e_2 \\
&amp;\vdots \\
I^*(ind = k ) &amp;= \beta_k X + e_k
\end{aligned}
\]</span></p>
<p>Where <span class="math inline">\(I^*(ind = k )\)</span> is the latent likelihood of working on industry <span class="math inline">\(k\)</span> given characteristics. Mprobit or Mlogit depends on the distribution of <span class="math inline">\(e_k\)</span>.</p>
<p>You choose Industry <span class="math inline">\(k\)</span> if <span class="math inline">\(I^*(ind = k )\)</span> is the highest among all industries.</p>
</section>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<section id="job-assigment-iii" class="level3">
<h3 class="anchored" data-anchor-id="job-assigment-iii">Job Assigment III</h3>
<ul>
<li><p>Job Assigment is done as follows:</p>
<ul>
<li><p>For each potential worker, Calculate Prob of working. Those with the highest probability are assigned jobs first.</p></li>
<li><p>For Worker, <span class="math inline">\(i\)</span>, the individual is assigned to the industry with the highest likelihood of working. (until all jobs are assigned)</p>
<ul>
<li>Can be done followed by doing similar assigment for occupation within industry.</li>
<li>Or combine both industry and occupation (p_o * p_i)</li>
</ul></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Job allocation must consider jobs available and likehood of working on a given Occupation/Industry.</li>
<li>May want to avoid deterministic assignment.</li>
<li>could assigned based on random draws from the distribution of likelihoods.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<section id="earning-contributions" class="level3">
<h3 class="anchored" data-anchor-id="earning-contributions">Earning contributions</h3>
<ul>
<li><p>Because some of the newly created jobs go to people who are employed in Family businesses (Farm and non farm income), one has to account for the “loss” of income from those jobs.</p></li>
<li><p>This is done by estimating the contribution of each member to the family business, and imputing the loss of income from the now “formally employed” member.</p>
<ul>
<li>For example, modeling farm income, predicting that income without the family member, and imputing the difference as the loss of income.</li>
</ul></li>
</ul>
</section>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7"></h2>
<section id="job-assigment-iv-wages-and-hours" class="level3">
<h3 class="anchored" data-anchor-id="job-assigment-iv-wages-and-hours">Job Assigment IV: Wages and Hours</h3>
<ul>
<li>Hours and Wages are imputed using a heckman model, and multiple stage process</li>
</ul>
<ol type="1">
<li>Use a probit model to predict the likelihood of working.</li>
<li>Given the model obtain the inverse mills ratios. <span class="math inline">\(imr = \phi(\alpha'x)/\Phi(\alpha'x)\)</span></li>
<li>Model wages and hours using IMR as a regressor. (Heckit model) (This includes info on imputed occupations/industry)</li>
<li>Use Imputed wages and hours to Match data to “donor” individuals. (PMM)</li>
<li>For people “potentially” leaving family business, compare new wages to family business contributions</li>
</ol>
</section>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<section id="hours-of-hp-re-assigment" class="level3">
<h3 class="anchored" data-anchor-id="hours-of-hp-re-assigment">Hours of HP re-assigment</h3>
<ul>
<li>People taking jobs may have to change their contributions to household production. (less time for HP)</li>
<li>But the rest of the family may also have to adjust their contributions to HP. (more time for HP?)
<ul>
<li>This is done via matching, where the “donor” are working individuals with similar family characteristics.</li>
<li>Or All working individuals</li>
<li>Currently, “recipients” are all individuals in the household, with atleast one new worker.
<ul>
<li>May be more sensible to impute hours</li>
<li>One may argue those not working may have to increase hours of HP. Or do nothing</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="other-considerations" class="level3">
<h3 class="anchored" data-anchor-id="other-considerations">Other considerations</h3>
<ul>
<li>Assigment of Child Care services</li>
</ul>
</section>
</section>
<section id="assessing-the-quality-of-the-simulation" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-quality-of-the-simulation">Assessing the quality of the simulation</h2>
<ul>
<li>In principle, there is no way to know if the simulation is correct.
<ul>
<li>There is no “true” value to compare to.</li>
<li>However, one may want to at least ensure the simulation replicates the data.</li>
<li>One can potetially use the simulation to predict changes of a past policy, and compare to the actual changes.</li>
</ul></li>
<li>We do want to make “sanity” checks
<ul>
<li>Are results consistent and plausible?</li>
<li>Are distributions of post-assigment outcomes consistent with the data?</li>
</ul></li>
</ul>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<ul>
<li>Since we use existing data, we make the implicit assumption “no behavioral changes” in other aspects
<ul>
<li>Things change as far as we can model them.</li>
</ul></li>
<li>Results are typically point estimates, and do not account for uncertainty.
<ul>
<li>We can use multiple imputation, monte carlo simulations, or bootstrapping to account for uncertainty.</li>
</ul></li>
<li>The results are only as good as the data we use and the assumptions we make.
<ul>
<li>We can use sensitivity analysis to test the robustness of the results to changes in assumptions.</li>
</ul></li>
</ul>
</section>
</section>
<section id="thats-all-folks" class="level1">
<h1>Thats All Folks!</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>