<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - Instrumental Variables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class.html" rel="" target="">
 <span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html" rel="" target="">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rm2_return.html" rel="" target="">
 <span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#recap-pos-and-rcts" id="toc-recap-pos-and-rcts" class="nav-link active" data-scroll-target="#recap-pos-and-rcts">Recap: PO’s and RCT’s</a></li>
  <li><a href="#instrumental-variables" id="toc-instrumental-variables" class="nav-link" data-scroll-target="#instrumental-variables">Instrumental Variables</a></li>
  <li><a href="#cannonical-iv" id="toc-cannonical-iv" class="nav-link" data-scroll-target="#cannonical-iv">Cannonical IV</a></li>
  <li><a href="#cannonical-iv-1" id="toc-cannonical-iv-1" class="nav-link" data-scroll-target="#cannonical-iv-1">Cannonical IV</a></li>
  <li><a href="#properties" id="toc-properties" class="nav-link" data-scroll-target="#properties">Properties</a></li>
  <li><a href="#how-does-it-work" id="toc-how-does-it-work" class="nav-link" data-scroll-target="#how-does-it-work">How does it work</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#some-commnents" id="toc-some-commnents" class="nav-link" data-scroll-target="#some-commnents">Some commnents</a></li>
  <li><a href="#more-comments" id="toc-more-comments" class="nav-link" data-scroll-target="#more-comments">More Comments</a></li>
  <li><a href="#who-are-affected-and-who-are-not" id="toc-who-are-affected-and-who-are-not" class="nav-link" data-scroll-target="#who-are-affected-and-who-are-not">Who Are Affected and who are not?</a></li>
  <li><a href="#extension-1-continuous-instrument" id="toc-extension-1-continuous-instrument" class="nav-link" data-scroll-target="#extension-1-continuous-instrument">Extension 1: Continuous Instrument</a></li>
  <li><a href="#extension-2-controls" id="toc-extension-2-controls" class="nav-link" data-scroll-target="#extension-2-controls">Extension 2: Controls</a></li>
  <li><a href="#extension-2-controls-1" id="toc-extension-2-controls-1" class="nav-link" data-scroll-target="#extension-2-controls-1">Extension 2: Controls</a></li>
  <li><a href="#extension-3-multiple-endogenous-variables" id="toc-extension-3-multiple-endogenous-variables" class="nav-link" data-scroll-target="#extension-3-multiple-endogenous-variables">Extension 3: Multiple Endogenous Variables</a></li>
  <li><a href="#instrument-validity" id="toc-instrument-validity" class="nav-link" data-scroll-target="#instrument-validity">Instrument Validity</a></li>
  <li><a href="#iv-validity-exogeneity" id="toc-iv-validity-exogeneity" class="nav-link" data-scroll-target="#iv-validity-exogeneity">IV Validity: Exogeneity</a></li>
  <li><a href="#iv-validity-strength" id="toc-iv-validity-strength" class="nav-link" data-scroll-target="#iv-validity-strength">IV Validity: Strength</a></li>
  <li><a href="#iv-strength" id="toc-iv-strength" class="nav-link" data-scroll-target="#iv-strength">IV Strength</a></li>
  <li><a href="#iv-strength-bias-distribution" id="toc-iv-strength-bias-distribution" class="nav-link" data-scroll-target="#iv-strength-bias-distribution">IV Strength: Bias distribution</a></li>
  <li><a href="#iv-strength-solution-weakiv" id="toc-iv-strength-solution-weakiv" class="nav-link" data-scroll-target="#iv-strength-solution-weakiv">IV Strength Solution: <code>weakiv</code></a></li>
  <li><a href="#late-local-average-treatement-effect" id="toc-late-local-average-treatement-effect" class="nav-link" data-scroll-target="#late-local-average-treatement-effect">LATE: Local Average Treatement Effect</a></li>
  <li><a href="#simulation-example" id="toc-simulation-example" class="nav-link" data-scroll-target="#simulation-example">Simulation Example:</a></li>
  <li><a href="#popular-iv-designs" id="toc-popular-iv-designs" class="nav-link" data-scroll-target="#popular-iv-designs">Popular IV Designs</a>
  <ul class="collapse">
  <li><a href="#canonical-designs" id="toc-canonical-designs" class="nav-link" data-scroll-target="#canonical-designs">Canonical Designs</a></li>
  <li><a href="#cd-lotteries" id="toc-cd-lotteries" class="nav-link" data-scroll-target="#cd-lotteries">CD: Lotteries</a></li>
  <li><a href="#cd-judge-fixed-effects" id="toc-cd-judge-fixed-effects" class="nav-link" data-scroll-target="#cd-judge-fixed-effects">CD: Judge Fixed Effects</a></li>
  <li><a href="#cd-shift-share-bartik-instrument" id="toc-cd-shift-share-bartik-instrument" class="nav-link" data-scroll-target="#cd-shift-share-bartik-instrument">CD: Shift-Share Bartik Instrument</a></li>
  </ul></li>
  <li><a href="#til-next-time-matching-and-reweithing" id="toc-til-next-time-matching-and-reweithing" class="nav-link" data-scroll-target="#til-next-time-matching-and-reweithing">Til Next time: Matching and Reweithing</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="09iv.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Instrumental Variables</h1>
<p class="subtitle lead">Many are called, only few answer</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="recap-pos-and-rcts" class="level2">
<h2 class="anchored" data-anchor-id="recap-pos-and-rcts">Recap: PO’s and RCT’s</h2>
<ul>
<li><p>Quick Recap. The goal of the methodologies we are covering is to identify treatment effects.</p></li>
<li><p>In the PO framework, that is done by simply comparing a group with itself, in two different States (treated vs untreated)</p></li>
<li><p>Since this is <strong>impossible</strong>, the next best solution is using RCT. Individuals are randomized, and <em>assuming</em> every body follows directions, we can identify treatment effects of the experiments.</p></li>
<li><p>But only if the RCT is well executed! Sometimes even that may fail</p></li>
</ul>
</section>
<section id="instrumental-variables" class="level2">
<h2 class="anchored" data-anchor-id="instrumental-variables">Instrumental Variables</h2>
<ul>
<li><p>While here discussed 3rd, the second best approach to identify Treatment effects is by using Instrumental variables.</p></li>
<li><p>In fact with a <strong>Good-Enough</strong> instrument, one should be able to identify <strong>ANY</strong> causal effect. Assuming such IV exists.</p></li>
</ul>
<p>but how?</p>
<ul>
<li><p>If the instrument is good, it may create an exogenous variation, which will allow us to identify Treatment effects by looking ONLY at those affected by the treatment!</p></li>
<li><p>Using the external variation, we can Estimate TE comparing two groups who are identical in every aspect, except being expose to the Instrument, because they were exposed to the instrument. The randomization comes Because of the IV!</p></li>
</ul>
</section>
<section id="cannonical-iv" class="level2">
<h2 class="anchored" data-anchor-id="cannonical-iv">Cannonical IV</h2>
<p>As we have mentioned, the estimation of TE require that we identify two groups of individuals with mostly similar (if not identical) characteristics. This include unobserved characteristics.</p>
<p>If the latter is not true, we have a problem of confunders or Endogeneity. But why?</p>
<p>Consider the following diagram</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>Here the effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span> is direct, because there is nothing else that would get people confuse why treatment affects outcome</p>
</div>
<div class="cell quarto-layout-cell" data-fig-width="8.5" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  e(error) --&gt; Y(Outcome)  
  D(Treatment) --&gt; Y(Outcome)  
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>Here the effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span> is not as clear, because there is an additional factor <span class="math inline">\(v\)</span> that affects <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span> (is in the way)</p>
</div>
<div class="cell quarto-layout-cell" data-fig-responsive="false" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  e( error ) --&gt; Y(Outcome)  
  D( Treatment ) --&gt; Y(Outcome)
  v(unobserved) -.-&gt; D(Treatment)  
  v(unobserved) -.-&gt; Y(Outcome)  
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="cannonical-iv-1" class="level2">
<h2 class="anchored" data-anchor-id="cannonical-iv-1">Cannonical IV</h2>
<p>Here is where a good instrument comes into play.</p>
<ul>
<li>Not everything in <span class="math inline">\(D\)</span> is affected by <span class="math inline">\(v\)</span>. Some may, but some may be trully exogenous. What if we have an instrument that helps you ID this:</li>
</ul>
<div class="cell" data-fig-responsive="false">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
e( error ) --&gt; Y(Outcome)  
  subgraph Treatment
    D1(Exog) 
    D2(Endog)
  end
  
  D1( Exog ) --&gt; Y(Outcome)
  D2( Endog ) --&gt; Y(Outcome)
  Z(Instrument) --&gt; D1  
  v(unobserved) -.-&gt; D2
  
  v(unobserved) -.-&gt; Y(Outcome)  
</pre>
</div>
</div>
</div>
</div>
<ul>
<li>By Isolating those affected by the Instrument Alone, we do not need to worry about endogeneity anymore.</li>
</ul>
</section>
<section id="properties" class="level2">
<h2 class="anchored" data-anchor-id="properties">Properties</h2>
<p>Instrumental variables should have at the very list 2 Properties</p>
<ol type="1">
<li>The instrumental variable <span class="math inline">\(Z\)</span> should not be correlated with the model error (Validity).</li>
<li>But, it should explain the treatment Itself <span class="math inline">\(D\)</span> (Relevance).</li>
</ol>
<p>Failure of (1) may reintroduce problems of endogeneity. Faiture of (2) will make the instrument Irrelevant.</p>
</section>
<section id="how-does-it-work" class="level2">
<h2 class="anchored" data-anchor-id="how-does-it-work">How does it work</h2>
<p>Consider the following.</p>
<ul>
<li>People who study more, tend to earn higher wages</li>
<li>People with high ability tend to study more.</li>
<li>People with high ability, also earn higher wages.</li>
</ul>
<p>Does Studying more generate higher wages?</p>
<p><strong>Instrument</strong>. We create a lottery that provides some people resources to pay for their education. This gives them a chance to study more (regardless of ability). <span class="math display">\[Z \rightarrow D\]</span></p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>So, we know the instrument was <strong>Random</strong>. We can analyze how much outcome increases among those benefited by the Lottery.</p>
<p><span class="math display">\[E(W|Z=1)-E(W|Z=0)\]</span></p>
<ul>
<li><p>This is often called the <strong>reduced form</strong> effect.</p></li>
<li><p>In principle, <span class="math inline">\(Z\)</span> only affects wages because of education. So looking at this differences should be similar to a treatment effect of Lotteries.</p></li>
<li><p>These are also known as Intention to treatment effect. Which will bias towards zero, because not everyone will effectively make use of the opporunities</p></li>
</ul>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<p>In othe words, not everyone will Study more…So we can see if the lotery had that effect.</p>
<p><span class="math display">\[E(S|Z=1)-E(S|Z=0)\]</span></p>
<p>This is the equivalent to the first stage. Where we measure the impact of the “instrument/lottery” on Education (to see, say, relevance)</p>
<p>Finally, the TE is given by the Ratio of thes two</p>
<p><span class="math display">\[TE=\frac{E(W|Z=1)-E(W|Z=0)}{E(S|Z=1)-E(S|Z=0)}
\]</span></p>
<p>This is also known as the Wald Estimator. How much of the changes in wages is due to changes in the “# treated”</p>
</section>
<section id="some-commnents" class="level2">
<h2 class="anchored" data-anchor-id="some-commnents">Some commnents</h2>
<ul>
<li>This was an example of a binary instrument, which was assigned at random.</li>
<li>In fact, this particular scenario is typical byproduct of “failed” RCTs!
<ul>
<li>Partially failed RCTs: Not every body selected WAS treated</li>
</ul></li>
</ul>
<p>Consider the following:</p>
<ul>
<li>We make the RCT above giving bouchers to People so they Study more.</li>
<li>But, not everybody uses the bouchers:
<ul>
<li>Some use them and study more.</li>
<li>Some decide to not use them.</li>
</ul></li>
</ul>
<p>Comparing Wages among those who receive will only provide you the “intention to treat” effect. (<strong>Reduced form</strong>)</p>
<p>Because of imperfect compliance we need to “readjust/inflate” our TE estimate.</p>
</section>
<section id="more-comments" class="level2">
<h2 class="anchored" data-anchor-id="more-comments">More Comments</h2>
<ul>
<li><p>In this scenario the Reduced form and second stage can be estimated by just comparing means, because the treatment was randonmized.</p>
<ul>
<li>In other words, something you really want is an instrument that is as good as random.</li>
</ul></li>
<li><p>The effect we capture is a LOCAL treatment effect (LATE).</p></li>
<li></li>
<li><p>However, it could be an ATE if:</p>
<ul>
<li>The effect is homogenous for everyone.</li>
<li>The people affected by the treatment is a representative of the population</li>
</ul></li>
<li><p>It all boils down to identifying who is or might be affected by the treatment.</p></li>
<li><p>For now, lets assume effects are Homogenous (So we get ATEs)</p></li>
</ul>
</section>
<section id="who-are-affected-and-who-are-not" class="level2">
<h2 class="anchored" data-anchor-id="who-are-affected-and-who-are-not">Who Are Affected and who are not?</h2>
<p>Even if we are able to identify ATEs, its important to understand who can be affected by the instrument, because the population is generally selected in 3 groups</p>
<ul>
<li><strong>never takers</strong> &amp; <strong>always takers</strong>: These are the individuals who would have never done anything different than their normal.
<ul>
<li>Perhaps their likelihood was already too low (or high) to be affected.</li>
</ul></li>
<li><strong>Compliers</strong>: These are the ones who, given they receive “instrument”, they comply and follow up. We use their variation for analysis.</li>
<li><strong>Defiers</strong>: These are the ones who, given Z, will do the oposite. We cannot differentiate them from Compliers, so they will affect how treatment is estimated.</li>
</ul>
<p>We do not want to have defiers!</p>
</section>
<section id="extension-1-continuous-instrument" class="level2">
<h2 class="anchored" data-anchor-id="extension-1-continuous-instrument">Extension 1: Continuous Instrument</h2>
<p>The Wald estimator is for the simplest case of binary treatment. However, if the treatment is continuous, one could modify the IV estimator as follows:</p>
<p><span class="math display">\[
\delta_{IV} = \frac{cov(y,z)}{cov(d,z)}
\]</span></p>
<p>The logic remains. We are trying to see how variation in the outcome related to Z reates to changes in treatment because of Z.</p>
<p>The <em>treatment</em> here is very small (Small changes in d). The intuition is that we are averaging the variation in the outcome across all Zs to estimate the effect.</p>
</section>
<section id="extension-2-controls" class="level2">
<h2 class="anchored" data-anchor-id="extension-2-controls">Extension 2: Controls</h2>
<p>Adding controls to the model is also straight forward, and you have quite a few options for it</p>
<ol type="1">
<li>Adding exogenous controls may help improving model precision, even if instrument was randomized. The easiest way to do this is by applying the 2sls procedure (among others)</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
1st: d = z\gamma_z + x\gamma_x + e_1  \\
2nd: y = x\beta_x + \delta \hat d+ e_2
\end{aligned}
\]</span></p>
<ul>
<li><p>The 1st stage “randomizes” instrument to measure the effect on treatment.</p></li>
<li><p>The 2nd stage uses predicted values of the first to see what the impact on the outcome will be.</p></li>
<li><p>This works because <span class="math inline">\(\hat d\)</span> is exogenous, “carrying over” exogenous changes in the treatment.</p></li>
</ul>
</section>
<section id="extension-2-controls-1" class="level2">
<h2 class="anchored" data-anchor-id="extension-2-controls-1">Extension 2: Controls</h2>
<p>One can also think of the approach as a pseudo Wald Estimator, with continuous variables:</p>
<p><span class="math display">\[
\begin{aligned}
1st: d &amp;= \gamma_z * z + x\gamma_x + e_1  \\
rd:  y &amp;= \beta_z  * z+ x\beta_x + e_2 \\
ATE &amp;=\frac{\beta_z}{\gamma_z}=\frac{cov(y,\tilde z)}{cov(d,\tilde z)}
\end{aligned}
\]</span></p>
<p>This compares average changes in the outcome to average changes in the treatment.</p>
</section>
<section id="extension-3-multiple-endogenous-variables" class="level2">
<h2 class="anchored" data-anchor-id="extension-3-multiple-endogenous-variables">Extension 3: Multiple Endogenous Variables</h2>
<p>Although less common in Causal Analysis perspective, in other frameworks one may to consider more than 1 instrument or using instrument interactions. In these cases one still has two alternatives</p>
<ol type="1">
<li><strong>2SLS</strong>: One can model more than one endogenous variable at the same time, simply substituting the predicted values in the main regression. When using interactions, or polynomials, each will need its own first stage regression.</li>
<li><strong>Control function approach</strong>. In contrast with the “prediction subtstitution” approach, this method suggests using a “residual inclusion approach”. This controls for endogeneity directly. If there is only one endogenous variable (with interactions of polynomials) only one model is needed.</li>
</ol>
<p>In the first case, you need at least 1 instrument per regression. Even if its just a transformation of the original variable</p>
<p>In the second case, you need at least 1 instrument per endogenous variable.</p>
</section>
<section id="instrument-validity" class="level2">
<h2 class="anchored" data-anchor-id="instrument-validity">Instrument Validity</h2>
<p>As mentioned earlier, Instruments require to fullfill two conditions:</p>
<ul>
<li><strong>Relevant</strong>. They need to be Strongly related to the endogenous variable</li>
<li><strong>Exogenous</strong>. instruments should not and cannot be endogenous. In fact, you want instruments that are as good as random, thus not defined by the “system” in anyway.</li>
</ul>
</section>
<section id="iv-validity-exogeneity" class="level2">
<h2 class="anchored" data-anchor-id="iv-validity-exogeneity">IV Validity: Exogeneity</h2>
<p>Unfortunately, for most cases, this assumption is not testable, because we do not observe the model unobservables, thus dont know if <span class="math inline">\(z\)</span> is related to those unobserved components.</p>
<p>While most efforts for these are done through model design, or argumentation, there are at least 2 options to verify the exogeneity</p>
<ol type="1">
<li><p>If truly exogenous, the instrument should be as good as random. Thus controls shouldnt be affected by the instrument. (Balance test)</p></li>
<li><p>Otherwise, one could test for exogeneity only by comparing Estimates across different IV’s. Different results may suggest instruments are invalid.</p>
<ul>
<li>Run a regression of Residuals from the main model against all exogenous variables plus other instruments.</li>
</ul></li>
</ol>
<p>Note: Unless the instrument was randomized, assumed is going to be slighly endogenous.</p>
</section>
<section id="iv-validity-strength" class="level2">
<h2 class="anchored" data-anchor-id="iv-validity-strength">IV Validity: Strength</h2>
<p>The only thing we could probably do is try to analyze model strength. How much does the instrument affect treatment take up? is the effect marginal? or a large effect?</p>
<p>Weaker instruments may create larger problems on the analysis because:</p>
<ol type="1">
<li>With weaker instruments, the precision of the estimator drops substantially.</li>
<li>With weaker instruments, any “endogeneity” problem (even due to randomness) will generate a bias</li>
</ol>
<ul>
<li>Stock and Yogo (2005) suggest and F~13.9 (or higher) for a 5% bias</li>
<li>Lee, et al (2020) suggest you need even higher F’s if you want to avoid problems with CI</li>
</ul>
<ol start="3" type="1">
<li>With weak instruments, distribution of beta coefficients will no longer be normal!</li>
</ol>
</section>
<section id="iv-strength" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="iv-strength">IV Strength</h2>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> simx</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> simx, <span class="kw">eclass</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">clear</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> <span class="kw">obs</span> 500</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> z=rnormal()&gt;0</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> u1=rnormal()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> u2=rnormal()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> u3=rnormal()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">gen</span> d<span class="ot">`i'</span> = ((-0.5+z) + (u1 + u2)*0.5*<span class="ot">`i'</span>)&gt;0</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">gen</span> y<span class="ot">`i'</span> = 1 + d<span class="ot">`i'</span>+u3+u2</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">reg</span> d<span class="ot">`i'</span> z</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> b<span class="ot">`i'</span> =(_b[z]/_se[z])^2</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        ivregress  2sls y<span class="ot">`i'</span> (d<span class="ot">`i'</span>=z)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> b<span class="ot">`i'</span> = b<span class="ot">`i'</span>,_b[d<span class="ot">`i'</span>],_se[d<span class="ot">`i'</span>],_b[d<span class="ot">`i'</span>]/_se[d<span class="ot">`i'</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> colname b<span class="ot">`i'</span>=f_stat beta beta_se beta_t</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> <span class="ot">coleq</span> b<span class="ot">`i'</span>=md<span class="ot">`i'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> b=b1</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">forvalues</span> i = 2/5 {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> b=b,b<span class="ot">`i'</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    Variable |        Obs        Mean    Std. <span class="kw">dev</span>.       Min        Max</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>md1_b_f_stat |        494    189.9262    38.63693   101.8865   337.4117</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  md1_b_beta |        494    .9912474    .2289997   .1758122    1.64053</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>md1_b_beta~<span class="fu">e</span> |        494    .2440663    .0235266   .1867024   .3293121</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>md2_b_f_stat |        494    43.33591    13.76347   12.07967   101.6624</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  md2_b_beta |        494    .9717824    .4421832  -.8390987   2.327243</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>md2_b_beta~<span class="fu">e</span> |        494    .4711093    .0945389   .3032212   .9873207</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>md3_b_f_stat |        494    19.25043     8.81203   2.051613   61.55846</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  md3_b_beta |        494    .9354647    .6820819  -1.964163   2.996998</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>md3_b_beta~<span class="fu">e</span> |        494    .7430147    .2493365    .383426    2.16554</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>md4_b_f_stat |        494    11.19082    6.428525   .0483399   38.44057</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  md4_b_beta |        494    .8711808    .9987467  -4.383311   5.634943</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>md4_b_beta~<span class="fu">e</span> |        494    1.135114    1.244907   .4609722   25.16503</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>md5_b_f_stat |        494    7.522731    5.144063   .0544148   28.23535</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  md5_b_beta |        494    .7696057    1.443986  -6.293723   8.951643</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>md5_b_beta~<span class="fu">e</span> |        494     1.69479    1.866909    .530196    18.3837</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="iv-strength-bias-distribution" class="level2">
<h2 class="anchored" data-anchor-id="iv-strength-bias-distribution">IV Strength: Bias distribution</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> resources/simiv.dta, <span class="kw">clear</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span>:<span class="kw">sum</span> md<span class="ot">`i'</span>_b_beta</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> new<span class="ot">`i'</span>=(md<span class="ot">`i'</span>_b_beta-1)/<span class="fu">r</span>(<span class="fu">sd</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">scheme</span> white2</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>color_style tableau</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="kw">function</span> <span class="fu">y</span>=<span class="fu">normalden</span>(x), <span class="kw">range</span>(-5 5) lwidth(1) pstyle(p2) || <span class="kw">histogram</span> new1, <span class="bn">name</span>(m1, <span class="kw">replace</span>) , <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="kw">function</span> <span class="fu">y</span>=<span class="fu">normalden</span>(x), <span class="kw">range</span>(-5 5) lwidth(1) pstyle(p2) || <span class="kw">histogram</span> new2, <span class="bn">name</span>(m2, <span class="kw">replace</span>) , <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="kw">function</span> <span class="fu">y</span>=<span class="fu">normalden</span>(x), <span class="kw">range</span>(-5 5) lwidth(1) pstyle(p2) || <span class="kw">histogram</span> new3, <span class="bn">name</span>(m3, <span class="kw">replace</span>) , <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="kw">function</span> <span class="fu">y</span>=<span class="fu">normalden</span>(x), <span class="kw">range</span>(-5 5) lwidth(1) pstyle(p2) || <span class="kw">histogram</span> new4, <span class="bn">name</span>(m4, <span class="kw">replace</span>) , <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="kw">function</span> <span class="fu">y</span>=<span class="fu">normalden</span>(x), <span class="kw">range</span>(-5 5) lwidth(1) pstyle(p2) || <span class="kw">histogram</span> new5, <span class="bn">name</span>(m5, <span class="kw">replace</span>) , <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="bn">combine</span> m1 m2 m3 m4 m5, col(3) <span class="bn">xcommon</span> <span class="bn">ycommon</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="kw">export</span> resources/cmb.png, <span class="kw">width</span>(1500)  <span class="kw">replace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="resources/cmb.png" class="img-fluid"></p>
</section>
<section id="iv-strength-solution-weakiv" class="level2">
<h2 class="anchored" data-anchor-id="iv-strength-solution-weakiv">IV Strength Solution: <code>weakiv</code></h2>
<ul>
<li><p>Weak IV’s are a problem in the sense that it may induce bias on the estimated coefficients, but also that it may affect how Standard Errors are estimated.</p>
<ul>
<li>The distribution of the Statistic is no longer normal</li>
</ul></li>
<li><p>One solution, in this case, is at least adjusting SE and CI So they better reflect the problem.</p></li>
<li><p>In Stata, this can be done with <code>weakiv</code> (ssc install weakiv)</p></li>
<li><p>At the end, however, if you weak instruments, you may be able to correct of potential biases, but you may need to get more data, or better instruments</p></li>
</ul>
</section>
<section id="late-local-average-treatement-effect" class="level2">
<h2 class="anchored" data-anchor-id="late-local-average-treatement-effect">LATE: Local Average Treatement Effect</h2>
<p>Up to this point, we imposed the assumption that TE were homogenous. Thus, IV could identify Treatment effects for everyone. (Average Treatment effect)</p>
<p>However, not everyone may be affected by the instrument, only by the compliers.</p>
<p>Two ways of thinking about it:</p>
<ol type="1">
<li>Not everybody is affected by the instrument. (you have the always and never takers)</li>
<li>the instrument was never suppoused to affect certain groups!</li>
</ol>
<p>So, IV will identify TE for the compliers only.</p>
<p>Because of this, using different instruments may actually identify different effects, based on which population was affected.</p>
<p>Overid tests may fail in this case.</p>
</section>
<section id="simulation-example" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="simulation-example">Simulation Example:</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10000</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> sex = rnormal()&gt;0</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z1 = rnormal()&gt;0</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z2 = rnormal()&gt;0</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> e_1 =rnormal()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> e_2 =rnormal()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> e_3 =rnormal()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> D =(z1*(sex==0) + z2*(sex==1) + (e_1 + e_2)*.5)&gt;0</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Ds =(  (e_1 + e_2)*.5)&gt;0</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = 1 + D*(sex==0) +2*D*(sex==1)+e_3+e_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of observations (_N) was 0, now 10,000.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>%%echo</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ivregress 2sls <span class="fu">y</span> (D=z1)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ivregress 2sls <span class="fu">y</span> (D=z2)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ivregress 2sls <span class="fu">y</span> (D=z1 z2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
. ivregress 2sls y (D=z1)

Instrumental variables 2SLS regression            Number of obs   =     10,000
                                                  Wald chi2(1)    =      68.61
                                                  Prob &gt; chi2     =     0.0000
                                                  R-squared       =     0.2706
                                                  Root MSE        =     1.5526

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           D |   1.170842   .1413543     8.28   0.000     .8937923    1.447891
       _cons |   1.233464   .1015275    12.15   0.000     1.034474    1.432455
------------------------------------------------------------------------------
Endogenous: D
Exogenous:  z1

. ivregress 2sls y (D=z2)

Instrumental variables 2SLS regression            Number of obs   =     10,000
                                                  Wald chi2(1)    =     211.38
                                                  Prob &gt; chi2     =     0.0000
                                                  R-squared       =     0.3558
                                                  Root MSE        =     1.4591

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           D |   1.948051   .1339876    14.54   0.000      1.68544    2.210662
       _cons |   .6818014   .0962172     7.09   0.000     .4932192    .8703836
------------------------------------------------------------------------------
Endogenous: D
Exogenous:  z2

. ivregress 2sls y (D=z1 z2)

Instrumental variables 2SLS regression            Number of obs   =     10,000
                                                  Wald chi2(1)    =     257.90
                                                  Prob &gt; chi2     =     0.0000
                                                  R-squared       =     0.3223
                                                  Root MSE        =     1.4966

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           D |   1.556085   .0968958    16.06   0.000     1.366172    1.745997
       _cons |   .9600188   .0703862    13.64   0.000     .8220643    1.097973
------------------------------------------------------------------------------
Endogenous: D
Exogenous:  z1 z2

. </code></pre>
</div>
</div>
</section>
<section id="popular-iv-designs" class="level1">
<h1>Popular IV Designs</h1>
<section id="canonical-designs" class="level2">
<h2 class="anchored" data-anchor-id="canonical-designs">Canonical Designs</h2>
<ul>
<li><p>The general message about using IV’s is, and has always been, that they are hard to come by.</p></li>
<li><p>Applied research spends a quite good amount of time explaining why a particular instrument <strong>IS</strong> valid. (exogenous and relevant)</p></li>
<li><p>Relevance is generally easy to test, but exogeneity is difficult. Little can be done other than relying in other papers, and circumstances.</p></li>
<li><p>There are also those “clever” IVs, that tend to be case specific</p>
<ul>
<li>Scott Cunningham talks about Instruments being “weird”, because you wouldnt expect them to be in the context of the research</li>
</ul></li>
<li><p>There are, however, some designs that are used quite often, because they apply to different circumstances.</p></li>
</ul>
</section>
<section id="cd-lotteries" class="level2">
<h2 class="anchored" data-anchor-id="cd-lotteries">CD: Lotteries</h2>
<ul>
<li><p>In RCT, Lotteries are commonly used to decide who gets or doesnt get treatment among participants. Once treatment is assigned, however, not everyone will effectively taking up the treatment.</p>
<ul>
<li>Furthermore, some people may still end up being effectively treated because of other factors.</li>
</ul></li>
<li><p>This is a case of imperfect compliance.</p></li>
<li><p>In cases like this, the lottery itself (which is randomized) can be used as instrument to identify the effect of being effectively treated.</p></li>
</ul>
<p>Examples:</p>
<ul>
<li>Vietnam Draft Lottery</li>
<li>Oregon Medicaid Expansion Lottery</li>
</ul>
</section>
<section id="cd-judge-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="cd-judge-fixed-effects">CD: Judge Fixed Effects</h2>
<p>This design is also partially based on a kind of randomized assigment.</p>
<ol type="1">
<li>Individuals are “allocated” to work, or be judge, under different officers “judges”, at random.</li>
<li>Judges are consistent among each other, with only difference being the severity of the judgment.</li>
<li>Then Judge fixed effect can be used as an instrument on the judgment (treatment), and the final impact on the outcome of interest.</li>
</ol>
<p>The idea here is that “judgment-severity” varies by judge. This difference in taste creates exogenous variation on some treatment, which is analyzed on some treatment.</p>
<p>Example:</p>
<ul>
<li>Teachers Grading? Driving test officers? Performance tests?</li>
</ul>
</section>
<section id="cd-shift-share-bartik-instrument" class="level2">
<h2 class="anchored" data-anchor-id="cd-shift-share-bartik-instrument">CD: Shift-Share Bartik Instrument</h2>
<p>Originally used in a study of regional labor market effects, this kind of instruments have also been used widely in other areas, such as imigration and trade.</p>
<p>The instrument was developed to analyze how changes in economic growth would affect market outcomes. (reverse Causality)</p>
<p>To do this, Bartik (1991) suggests, that it could be possible to create an instrument, making use of only exogenous variations, to first predict Potential local growth.</p>
<ol type="1">
<li>Estimate <strong>industry</strong> shares by local region, based on some Ex ante information.</li>
<li>Estimate national growth by industry (which should be exogenous to local growth)</li>
<li>Estimate Potential Local growth using Shares x growth</li>
</ol>
<p>This last one should represent the instrument to be used on actual local growth</p>
<p>This instrument depends strongly on the assumption that <strong>Shares</strong> are exogenous, and states are small compare to the national experience.</p>
</section>
</section>
<section id="til-next-time-matching-and-reweithing" class="level1">
<h1>Til Next time: Matching and Reweithing</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>