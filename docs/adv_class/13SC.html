<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - Synthetic Control</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class.html" rel="" target="">
 <span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html" rel="" target="">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rm2_return.html" rel="" target="">
 <span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#synthetic-control-special-case" id="toc-synthetic-control-special-case" class="nav-link" data-scroll-target="#synthetic-control-special-case">Synthetic Control: Special case</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#this-is-a-very-popular-method" id="toc-this-is-a-very-popular-method" class="nav-link" data-scroll-target="#this-is-a-very-popular-method">This is a very popular method</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions:</a></li>
  <li><a href="#how-does-it-work." id="toc-how-does-it-work." class="nav-link" data-scroll-target="#how-does-it-work.">How does it work.</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a></li>
  <li><a href="#small-example" id="toc-small-example" class="nav-link" data-scroll-target="#small-example">Small Example</a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a></li>
  <li><a href="#allowing-for-covariates" id="toc-allowing-for-covariates" class="nav-link" data-scroll-target="#allowing-for-covariates">Allowing for Covariates:</a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a></li>
  <li><a href="#what-else-to-keep-in-mind" id="toc-what-else-to-keep-in-mind" class="nav-link" data-scroll-target="#what-else-to-keep-in-mind">What else to keep in mind</a></li>
  <li><a href="#is-it-noise-or-causal" id="toc-is-it-noise-or-causal" class="nav-link" data-scroll-target="#is-it-noise-or-causal">Is it noise? or Causal?</a></li>
  <li><a href="#randomization" id="toc-randomization" class="nav-link" data-scroll-target="#randomization">Randomization</a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"></a></li>
  <li><a href="#lets-continue-the-example" id="toc-lets-continue-the-example" class="nav-link" data-scroll-target="#lets-continue-the-example">Lets continue the example:</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"></a></li>
  <li><a href="#rmse-ratio" id="toc-rmse-ratio" class="nav-link" data-scroll-target="#rmse-ratio">RMSE Ratio</a></li>
  <li><a href="#p-values" id="toc-p-values" class="nav-link" data-scroll-target="#p-values">p-values</a></li>
  <li><a href="#other-falsification-tests" id="toc-other-falsification-tests" class="nav-link" data-scroll-target="#other-falsification-tests">Other Falsification Tests</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"></a></li>
  <li><a href="#next-week" id="toc-next-week" class="nav-link" data-scroll-target="#next-week">Next week:</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="13SC.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="13SC.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Synthetic Control</h1>
<p class="subtitle lead">Frankensteining a Clone</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<ul>
<li>One more last time. What is the Goal of Causal Analysis?</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>The goal of Causal Analysis is to identify how a treatment affects the outcome by itself, once all other factors are kept constant or controlled for.</strong></p>
</div>
</div>
<p>From a theoretical point of view, that is very easy. You simply compare two Potential outcomes:</p>
<p><span class="math display">\[
TE_i = y_i(1)- y_i(0)
\]</span></p>
<p>and aggregate those outcomes as needed:</p>
<p><span class="math display">\[
ATT=E(TE_i|D=1);ATU=E(TE_i|D=0);ATE=E(TE_i);ATX=E(TE_i|X)
\]</span></p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p>Unfortunately, we only observe one outcome. You are either treated or untreated…So how do we fix this?</p>
<p>You need to find counterfactuals so both observed (<span class="math inline">\(X\)</span>) and unobserved (<span class="math inline">\(e\)</span>) are the same (or close) between treated and contro group.</p>
<ol type="1">
<li><p><strong>RCT</strong>: Gold Standard, You randomize treatment and compare means. If correctly done, <span class="math inline">\(X's\)</span> and <span class="math inline">\(e's\)</span> will be comparable across groups, and ATE’s can be identified.</p></li>
<li><p><strong>Reg + FE</strong>: For other cases, we just work with observational data. First method, Regression (OLS?). Adding covariates controls for their presence, working as a pseudo balancing approach.</p>
<p>You could also add <em>fixed effects</em>, to control for factors that are fixed (across time), but you do not observe. (requires Panel data).</p>
<p>It works if Treatment occurs at the same time for everyone treated. and if Unobserved are “fixed”</p></li>
</ol>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<ol start="3" type="1">
<li><p><strong>Instrumental variables</strong>: 2nd Best to RCT. It uses IV to generate a small randomization process that can be used for estimating ATT. Technically it compares the effect among those potentially affected by the random instrument. Requires Randome instrument, and no-defiers. Its a Local ATE</p></li>
<li><p><strong>Matching and Reweigthing</strong>. Similar to Regression, but better to balance characteristics. The goal is to find units with similar characteristics for all treated units. You can estimate ATE, ATT or ATU. Depends on how well Matching is done</p></li>
<li><p><strong>RDD</strong>. If you have data where treatment depends on a single variable and a threshold, you can use this to identify TE for those “Near” the threshold. They Key assumption, treatment assigment is as good at random at the threshold.</p></li>
</ol>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<ol start="6" type="1">
<li><p><strong>DD</strong>. Differences in differences uses variation across time and across individual to identify treatment effects. Under PTA, and SUTVA</p>
<p>Dif. within individuals eliminates common time trends, Dif across time, eliminates individual fixed effects. DD provide you with ATT’s for the treated, after treatment.</p>
<p><span class="math display">\[ATT=(Y_{g=1,t=1}-Y_{g=1,t=0}) - [(Y_{g=0,t=1}-Y_{g=0,t=0})]\]</span></p>
<p>Can be generalized to Many periods and many groups, but requires stronger assumptions (no anticipation and no change in treatment status), and further aggregation.</p>
<p>Or combined with Matching for even better results.</p></li>
</ol>
</section>
<section id="synthetic-control-special-case" class="level2">
<h2 class="anchored" data-anchor-id="synthetic-control-special-case">Synthetic Control: Special case</h2>
<p>As previous Cases, Synthetic control aims to identify treatment constructing appropriate “counterfactuals”.</p>
<p>It is said that Synthethic controls may be even MORE credible methodology, because the treated group is by construction Exogenous…but how?</p>
<blockquote class="blockquote">
<p>The treated group is a Case Study.</p>
<p>An isolated event or unit that is affected by a treatment, and should not affect other units !</p>
</blockquote>
<p>In this sense, the treatment is exogenous, because it affected a single unit.</p>
<p>But what about the counterfactual?</p>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3"></h2>
<ul>
<li><p>In other methods (in particular Matching), our “conterfactual” mean to look for observations that had the same characteristics as the treated observation.</p></li>
<li><p>Some times, we needed to settle to use a single “bad” control, because we couldnt find one better. (people are very different).</p>
<ul>
<li>Using Stricter criteria would make it unfeasible.</li>
<li>More relax and we have lots of biases.</li>
</ul></li>
<li><p><strong>SC</strong> is different. You have <strong>MANY</strong> controls, so why settle with only one?</p></li>
<li><p><strong>SC</strong> is like Dr Frankenstein, where you “build” a single comparison group by averaging information of all controls.</p></li>
<li><p>You build the synthetic control getting “weighted averages”.</p></li>
<li><p>But…we assume you can see all units across time (panel data)</p></li>
</ul>
</section>
<section id="this-is-a-very-popular-method" class="level2">
<h2 class="anchored" data-anchor-id="this-is-a-very-popular-method">This is a very popular method</h2>
<p>Where has this method been used:</p>
<ul>
<li>effects of right-to-carry laws (Donohue et al., 2019),</li>
<li>legalized prostitution (Cunningham and Shah, 2018),</li>
<li>immigration policy (Bohn et al., 2014),</li>
<li>corporate political connections (Acemoglu et al., 2016),</li>
<li>taxation (Kleven et al., 2013),</li>
<li>organized crime (Pinotti, 2015)</li>
</ul>
<p>Just to name a few.</p>
</section>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions:</h2>
<ol type="1">
<li><p>The Donor Pool should be a good match for the treated unit. Thus, the synthethic control should be Zero before treatment.</p>
<ul>
<li>This is similar to PTA, but stronger. Before treatment, there should be no difference between Treated and synthetic control</li>
</ul></li>
<li><p>SUTVA. Only the treated group is affected by treatment. The control group should be unaffected (no spill over effects).</p></li>
<li><p>There should be NO other “event” in the period of analysis. (Thus we only capture treatment impact)</p></li>
</ol>
</section>
<section id="how-does-it-work." class="level2">
<h2 class="anchored" data-anchor-id="how-does-it-work.">How does it work.</h2>
<p>Recall, we want to estimate TE for the single untreated unit:</p>
<p><span class="math display">\[ATT_{1t} = Y_{1t}- Y(0)_{1t}
\]</span></p>
<p>but we do not observe <span class="math inline">\(Y(0)_{1t}\)</span>. We only know that before treatment</p>
<p><span class="math display">\[ATT_{1t} = Y_{1t}- Y(0)_{1t}=0\]</span></p>
<p>We could construct a synthetic control:</p>
<p><span class="math display">\[\hat Y_{1t}(0) = \sum_{i = 2}^N w_i Y_{it}
\]</span></p>
<p>At the very least, the weights <span class="math inline">\(w\)</span> should be such that before treatment (<span class="math inline">\(G\)</span>):</p>
<p><span class="math display">\[Y_{1t} = \sum_{i \neq 1} w_i Y_{it} \ \forall \ t&lt;G \]</span></p>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<p>At the very least, the weights <span class="math inline">\(w\)</span> should be such that before treatment (<span class="math inline">\(G\)</span>):</p>
<p><span class="math display">\[Y_{1t} = \sum_{i \neq 1} w_i Y_{it} \ \forall \ t&lt;G \]</span></p>
<p>Havent we seen seen something like this Before? OLS:</p>
<p><span class="math display">\[y = x\beta + e\]</span> <span class="math display">\[y^t_{1} = \color{red}{a_0} +  y_i^t w + e\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
y^1_1 \\ y^1_2 \\ ... \\ y^1_{G-1} \\
\end{bmatrix} = \color{red}{a_0} +
\begin{bmatrix}
y^2_1 &amp; y^3_1 &amp; ... &amp; y^k_1  \\
y^2_2 &amp; y^3_2 &amp; ... &amp; y^k_2 \\
...  &amp; ... &amp; ... &amp; ...\\
y^2_{G-1} &amp; y^3_{G-1} &amp; ... &amp; y^k_{G-1}\\
\end{bmatrix}
\begin{bmatrix}
w_2 \\ w_3 \\ ... \\ w_k
\end{bmatrix}
+ e
\]</span></p>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<p><span class="math display">\[y^t_{1} = \color{red}{a_0} +  y_i^t w + e\]</span></p>
<ul>
<li>In this Specification, each row (observation) is a “pre-treatment” period of observed data.</li>
<li>and each control unit (from the many controls) will be a variable.</li>
</ul>
<p>OLS can help you find the weights, which can then be used for obtaining the “Synthetic” control</p>
</section>
<section id="small-example" class="level2">
<h2 class="anchored" data-anchor-id="small-example">Small Example</h2>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:frause smoking, <span class="kw">clear</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>color_style tableau</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> <span class="fu">year</span>:<span class="kw">egen</span> mean_cig=<span class="kw">mean</span>(cigsale) <span class="kw">if</span> state!=3</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> (<span class="kw">line</span> cigsale <span class="fu">year</span> <span class="kw">if</span> state ==3) (<span class="kw">line</span> mean_cig <span class="fu">year</span> <span class="kw">if</span> state==1), <span class="co">///</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"Avg Other States"</span>) pos(6) col(2)) <span class="bn">xline</span>(1988)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(31 missing values generated)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-2-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> mean_cig</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">reshape</span> <span class="kw">wide</span> cigsale lnincome beer age15to24 retprice , i(<span class="fu">year</span>) j(state)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> cigsale1 mcigsale</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Now we have…38 variables, (other States but California)</li>
<li>And 31 periods (only 19 Before treatment)</li>
<li>Can we estimate the weights using OLS?</li>
</ul>
<p>…</p>
<ul>
<li>Nop. N&lt;K !</li>
</ul>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7"></h2>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">reg</span> mcigsale cigsale* <span class="kw">if</span> <span class="fu">year</span>&lt;=1988, <span class="kw">nocons</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> mcigh1</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: lasso linear  mcigsale cig* <span class="kw">if</span> <span class="fu">year</span>&lt;=1988, <span class="kw">nocons</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> mcigh2</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">two</span> (<span class="kw">line</span> mcigsale <span class="fu">year</span>, lw(0.5)  ) <span class="co">///</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">line</span> mcigh1 mcigh2   <span class="fu">year</span>, lw(0.5)  ) , <span class="co">///</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"OLS Synthetic"</span> 3 <span class="st">"LASSO Synthetic"</span>)) <span class="bn">xline</span>(1988)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(option xb assumed; fitted values)
(options xb penalized assumed; linear prediction with penalized coefficients)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>OLS Not appropriate (specially if N&lt;K)</li>
<li>Lasso Better, because of regularization, but not great.</li>
<li>We are not controlling for other factors either (controls)</li>
<li>Other Details we cover next</li>
</ul>
</section>
<section id="allowing-for-covariates" class="level2">
<h2 class="anchored" data-anchor-id="allowing-for-covariates">Allowing for Covariates:</h2>
<ul>
<li>As with other methodologies, one should also considered controlling for covariates.</li>
<li>Specifically, more covariates can be allowed by Stacking them:</li>
</ul>
<p><span class="math display">\[\begin{bmatrix} y^t_{1} \\ x^t_{1} \\ z^t_{1} \end{bmatrix}
= \color{red}{(a_0=0)} +
\begin{bmatrix} y^t_{2} &amp; y^t_{3} ... &amp; y^t_{k} \\
                x^t_{2} &amp; x^t_{3} ... &amp; x^t_{k} \\
                z^t_{2} &amp; z^t_{3} ... &amp; z^t_{k} \end{bmatrix}
\begin{bmatrix} w_2 \\ w_3 \\ ... \\ w_k \end{bmatrix}
+ e
\]</span></p>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:frause smoking, <span class="kw">clear</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> (cigsale lnincome beer age15to24 retprice) <span class="co">///</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      (var1    var2     var3 var4      var5)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">reshape</span> <span class="kw">long</span> <span class="kw">var</span>, i(state <span class="fu">year</span>)    j(<span class="kw">new</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">reshape</span> <span class="kw">wide</span> <span class="kw">var</span>, i(<span class="fu">year</span> <span class="kw">new</span>)  j(state)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> <span class="kw">new</span> 1 <span class="st">"cigsale"</span> <span class="co">///</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                 2 <span class="st">"lnincome"</span> <span class="co">///</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                 3 <span class="st">"beer"</span> <span class="co">///</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                 4 <span class="st">"age15to24"</span> <span class="co">/// </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                 5 <span class="st">"retprice"</span>, modify</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">values</span> <span class="kw">new</span> <span class="kw">new</span>    </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> var3 cal_out</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">reg</span> cal_out <span class="kw">var</span>* <span class="kw">if</span> <span class="fu">year</span>&lt;=1988, <span class="kw">nocons</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> mcigh1</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: lasso linear   cal_out <span class="kw">var</span>* <span class="kw">if</span> <span class="fu">year</span>&lt;=1988, <span class="kw">nocons</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> mcigh2</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a> <span class="kw">two</span> (<span class="kw">line</span> cal_out <span class="fu">year</span> <span class="kw">if</span> <span class="kw">new</span>==1, lw(0.5)  ) <span class="co">///</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">line</span> mcigh1 mcigh2   <span class="fu">year</span> <span class="kw">if</span> <span class="kw">new</span>==1, lw(0.5)  ) , <span class="co">///</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"California"</span> 2 <span class="st">"OLS Synthetic"</span> 3 <span class="st">"LASSO Synthetic"</span>)) <span class="bn">xline</span>(1988)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(option xb assumed; fitted values)
(32 missing values generated)
(options xb penalized assumed; linear prediction with penalized coefficients)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-5-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="what-else-to-keep-in-mind" class="level2">
<h2 class="anchored" data-anchor-id="what-else-to-keep-in-mind">What else to keep in mind</h2>
<ul>
<li>With More Variables, the goal is still to be able to choose <span class="math inline">\(w's\)</span> that best explain the observed outcomes (and characteristics) of the “treated unit”.</li>
</ul>
<p><span class="math display">\[w = \min_w \sum_{m=1}^K \left[ v_m \left( X_{1t}-\sum_{j=2}^J w_j X_{jt}  \right)^2 \right]
\]</span></p>
<p>However, we also need to impose restrictions on Weights:</p>
<ol type="1">
<li><span class="math inline">\(w_j \geq 0\)</span> Weights cannot be negative.</li>
<li><span class="math inline">\(\sum w_j =1\)</span> They should sum up to 1.</li>
<li><span class="math inline">\(v_m\)</span> can be used to increase, or reduce the relative importance of factors in the model. (lower bound at 0) The constant is zero.</li>
</ol>
<p>This is a maximization problem with constrains. Restrictions ensure the prediction is based on a “convex” set, avoiding extrapolation.</p>
</section>
<section id="is-it-noise-or-causal" class="level2">
<h2 class="anchored" data-anchor-id="is-it-noise-or-causal">Is it noise? or Causal?</h2>
<ul>
<li><p>When using <strong>SC</strong>, you essentially have a sample <span class="math inline">\(n=1\)</span> to estimate an effect. How do you know that effect is significant? and not just noise?</p>
<ul>
<li>You can do a randomization experiment! and answer:</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>“how unusual is this estimate under the null hypothesis of no policy effect?”.</p>
</blockquote>
<ul>
<li>How does this work?</li>
</ul>
</section>
<section id="randomization" class="level2">
<h2 class="anchored" data-anchor-id="randomization">Randomization</h2>
<ol type="1">
<li><p>Excluding the treated unit, estimate the pseudo effect of every other unit in the dataset. These are placebos, and you should expect the effect to be zero for them…but you may see some positive and negative effects.</p>
<ul>
<li>This may be consider the sampling distribution of the estimated effect.</li>
</ul></li>
<li><p>Calculate the pre- and post- treament <em>Root mean squared prediction error</em> for all units (treated and placebos).</p>
<ul>
<li>Pre-RMSPE provides a statistic of how well the model fits before treatment.</li>
<li>Post-RMSPE provides a statistic of how unusual is the outcome after the “treatment date”. The largest it is, the more unpredictable (or stronger treatment effect) it would be.</li>
</ul></li>
</ol>
</section>
<section id="section-9" class="level2">
<h2 class="anchored" data-anchor-id="section-9"></h2>
<p><span class="math display">\[
  \begin{aligned}
  RMSPE_i^{pre} &amp;= \sqrt{ \frac{1}{g-1}\sum_{t=1}^{g-1}(y_{i,t}-\sum_{j\neq i}w_j^i y_{j,t})^2 } \\
  RMSPE_i^{post} &amp;= \sqrt{ \frac{1}{T-g+1}\sum_{t=g}^{T}(y_{i,t}-\sum_{j\neq i}w_j^i y_{j,t})^2 }
  \end{aligned}
  \]</span></p>
<ol start="3" type="1">
<li><p>Estimate the ratio between Pre and Post RMSPE, and rank them. <span class="math display">\[Ratio_i = \frac{RMSPE_i^{post}}{RMSPE_i^{pre}}
\]</span></p></li>
<li><p>The p-value for the treatment is proportional to the Rank:</p>
<p><span class="math display">\[pvalue_i = \frac{rank(i)}{Tot}\]</span></p></li>
</ol>
</section>
<section id="lets-continue-the-example" class="level2">
<h2 class="anchored" data-anchor-id="lets-continue-the-example">Lets continue the example:</h2>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:frause smoking, <span class="kw">clear</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>xtset state <span class="fu">year</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> sc3</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>** For California</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>synth cigsale cigsale(1970) cigsale(1975) cigsale(1980) cigsale(1985) cigsale(1988), trunit(3) trperiod(1989) <span class="kw">keep</span>(<span class="ot">`sc3'</span>) <span class="kw">replace</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>** Same Specification <span class="kw">for</span> All other States excluding California</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i =1/39{</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`i'</span>!=3 {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> pool</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> j <span class="kw">of</span> <span class="kw">local</span> stl {</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="ot">`j'</span>!=3 &amp; <span class="ot">`j'</span>!=<span class="ot">`i'</span> <span class="kw">local</span> pool <span class="ot">`pool'</span> <span class="ot">`j'</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">tempfile</span> sc<span class="ot">`i'</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        synth cigsale cigsale(1970) cigsale(1975) cigsale(1980) cigsale(1985) cigsale(1988), <span class="co">///</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        trunit(<span class="ot">`i'</span>) trperiod(1989) <span class="kw">keep</span>(<span class="ot">`sc`i'</span>') <span class="kw">replace</span> counit(<span class="ot">`pool'</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>** Some <span class="kw">data</span> cleaning and prepration</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i =1/39{</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="ot">`sc`i'</span>' , <span class="kw">clear</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> tef<span class="ot">`i'</span> = _Y_treated - _Y_synthetic</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> sef<span class="ot">`i'</span>a =<span class="kw">mean</span>( (_Y_treated - _Y_synthetic)^2) <span class="kw">if</span> _time&lt;=1988</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">egen</span> sef<span class="ot">`i'</span>b =<span class="kw">mean</span>( (_Y_treated - _Y_synthetic)^2) <span class="kw">if</span> _time&gt;1988</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">replace</span> sef<span class="ot">`i'</span>a=<span class="fu">sqrt</span>(sef<span class="ot">`i'</span>a[1])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> sef<span class="ot">`i'</span>b=<span class="fu">sqrt</span>(sef<span class="ot">`i'</span>b[_N])</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="kw">if</span> _time==.</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">keep</span> tef<span class="ot">`i'</span> sef<span class="ot">`i'</span>* _time</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">save</span> <span class="ot">`sc`i'</span>', <span class="kw">replace</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>**</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>** Merging <span class="ot">all</span> together, and getting ready to plot</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>** </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="ot">`sc1'</span>, <span class="kw">clear</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 2/39 {</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">merge</span> 1:1 _time <span class="kw">using</span> <span class="ot">`sc`i'</span>', nogen</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> toplot</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> toplot2</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/39 {</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> toplot <span class="ot">$toplot</span> (<span class="kw">line</span> tef<span class="ot">`i'</span> _time, <span class="kw">color</span>(gs11) )</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> (sef<span class="ot">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> toplot2 <span class="ot">$toplot2</span> (<span class="kw">line</span> tef<span class="ot">`i'</span> _time, <span class="kw">color</span>(gs11) )</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>All Cases</strong></p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="ot">$toplot</span> (<span class="kw">line</span> tef3 _time, lw(1) <span class="kw">color</span>(<span class="bn">navy</span>*.8)), <span class="bn">xline</span>(1989) <span class="bn">legend</span>(<span class="kw">off</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="section-10" class="level2">
<h2 class="anchored" data-anchor-id="section-10"></h2>
<p><strong>Good Cases</strong> Restricts to States with Good RMSEP (less than 2 California)</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="ot">$toplot2</span> (<span class="kw">line</span> tef3 _time, lw(1) <span class="kw">color</span>(<span class="bn">navy</span>*.8)), <span class="bn">xline</span>(1989) <span class="bn">legend</span>(<span class="kw">off</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="rmse-ratio" class="level2">
<h2 class="anchored" data-anchor-id="rmse-ratio">RMSE Ratio</h2>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/39 {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> (sef<span class="ot">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span> rt=<span class="fu">nullmat</span>(rt)\[<span class="ot">`i'</span>,sef<span class="ot">`i'</span>b[1]/sef<span class="ot">`i'</span>a[1]]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">svmat</span> rt</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> rnk=<span class="fu">rank</span>(rt2)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="bn">bar</span> rt2 rnk || <span class="bn">bar</span> rt2 rnk <span class="kw">if</span> rt1==3 , <span class="co">///</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a> <span class="bn">legend</span>(<span class="kw">order</span>( 2 <span class="st">"California"</span>)) <span class="co">///</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="bn">ytitle</span>(RMSE <span class="kw">ratio</span>)  <span class="bn">xtitle</span>(RMSE <span class="fu">rank</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>number of observations will be reset to 32
Press any key to continue, or Break to abort
Number of observations (_N) was 31, now 32.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="p-values" class="level2">
<h2 class="anchored" data-anchor-id="p-values">p-values</h2>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">gen</span> rnk2=0</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 1/39 {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span>   (sef<span class="ot">`i'</span>a[1])&lt;(2*sef3a[1]) {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> t = <span class="ot">`t'</span>+1</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> rnk2=rnk2+(tef<span class="ot">`i'</span>&lt;=tef3)    </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> pv=rnk2*100/<span class="ot">`t'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> <span class="bn">bar</span> pv _time <span class="kw">if</span> _time&gt;1988 &amp; rnk2&lt;32, <span class="kw">ylabel</span>(0(2)15) <span class="kw">xlabel</span>(1989/2000)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(10 real changes made)
(6 real changes made)
(32 real changes made)
(5 real changes made)
(9 real changes made)
(3 real changes made)
(5 real changes made)
(4 real changes made)
(6 real changes made)
(4 real changes made)
(4 real changes made)
(8 real changes made)
(5 real changes made)
(4 real changes made)
(8 real changes made)
(3 real changes made)
(5 real changes made)
(8 real changes made)
(5 real changes made)
(5 real changes made)
(7 real changes made)
(2 real changes made)
(4 real changes made)
(4 real changes made)
(2 real changes made)
(6 real changes made)
(3 real changes made)
(6 real changes made)
(8 real changes made)
(5 real changes made)
(4 real changes made)
(6 real changes made)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="13SC_files/figure-revealjs/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="other-falsification-tests" class="level2">
<h2 class="anchored" data-anchor-id="other-falsification-tests">Other Falsification Tests</h2>
<ul>
<li>Change of treatment Year.
<ul>
<li>In the manual implementation you may want to change the treatment year (to an earler point). One should see no effect between <em>false</em> treatment date and the true to be zero.</li>
<li>Using <code>synth</code> (Stata) you may want to drop some of the controls, so only “pre-false” treatment data is used.
<ul>
<li>Look also into <code>synth_runner</code></li>
</ul></li>
</ul></li>
<li>Change of Outcome.
<ul>
<li>One can estimate the effect on alternative outcomes. No effect should be estimated.</li>
</ul></li>
</ul>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<ul>
<li><p>The basic methodology presented here differs from other strategies because one uses a single treated unit, with pletora of treated groups.</p></li>
<li><p>Instead of comparing single units with the treated group, it aims to compare a weighted average “synthetic control” to do so.</p></li>
<li><p>It will work better than matching because you are focusing on getting the best “weighted” group for a single unit.</p></li>
<li><p>But this methodology is still under development, with extensions toward using dissagregated data, or a combination with DD approaches.</p></li>
<li><p>This may change how much more one can do with the method</p></li>
</ul>
</section>
<section id="section-11" class="level1">
<h1></h1>
<p><img src="https://wallpapercave.com/dwp1x/wp8641362.jpg" class="img-fluid"></p>
</section>
<section id="next-week" class="level1">
<h1>Next week:</h1>
<p>Your papers! And Goodluck Friday</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>