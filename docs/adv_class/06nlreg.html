<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - NLS, IRLS, and MLE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class.html" rel="" target="">
 <span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html" rel="" target="">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rm2_return.html" rel="" target="">
 <span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sowhat-is-non-linear" id="toc-sowhat-is-non-linear" class="nav-link active" data-scroll-target="#sowhat-is-non-linear">So‚Ä¶what is non-linear?</a></li>
  <li><a href="#how-do-you-do-nl" id="toc-how-do-you-do-nl" class="nav-link" data-scroll-target="#how-do-you-do-nl">How do you do, NL?</a></li>
  <li><a href="#some-assumptions" id="toc-some-assumptions" class="nav-link" data-scroll-target="#some-assumptions">Some Assumptions</a></li>
  <li><a href="#but-how" id="toc-but-how" class="nav-link" data-scroll-target="#but-how">But How?</a></li>
  <li><a href="#foc-again.." id="toc-foc-again.." class="nav-link" data-scroll-target="#foc-again..">FOC again..</a></li>
  <li><a href="#small-example" id="toc-small-example" class="nav-link" data-scroll-target="#small-example">Small Example</a></li>
  <li><a href="#why-so-many-solutions" id="toc-why-so-many-solutions" class="nav-link" data-scroll-target="#why-so-many-solutions">Why So many Solutions?</a></li>
  <li><a href="#nls" id="toc-nls" class="nav-link" data-scroll-target="#nls">NLS</a></li>
  <li><a href="#nls-in-stata-long-example" id="toc-nls-in-stata-long-example" class="nav-link" data-scroll-target="#nls-in-stata-long-example">NLS in Stata: Long Example</a></li>
  <li><a href="#nls-in-stata-short-example-nl-function" id="toc-nls-in-stata-short-example-nl-function" class="nav-link" data-scroll-target="#nls-in-stata-short-example-nl-function">NLS in Stata: Short Example: NL function</a></li>
  <li><a href="#nls-for-logit" id="toc-nls-for-logit" class="nav-link" data-scroll-target="#nls-for-logit">NLS for logit</a></li>
  <li><a href="#glm-and-interative-reweighted-ls-irls" id="toc-glm-and-interative-reweighted-ls-irls" class="nav-link" data-scroll-target="#glm-and-interative-reweighted-ls-irls">GLM and Interative Reweighted LS (IRLS)</a></li>
  <li><a href="#how-does-this-change-estimation-nls" id="toc-how-does-this-change-estimation-nls" class="nav-link" data-scroll-target="#how-does-this-change-estimation-nls">How does this change Estimation? NLS??</a></li>
  <li><a href="#how-does-this-change-estimation-nls-1" id="toc-how-does-this-change-estimation-nls-1" class="nav-link" data-scroll-target="#how-does-this-change-estimation-nls-1">How does this change Estimation? NLS??</a></li>
  <li><a href="#how-does-this-change-estimation-nls-2" id="toc-how-does-this-change-estimation-nls-2" class="nav-link" data-scroll-target="#how-does-this-change-estimation-nls-2">How does this change Estimation? NLS??</a></li>
  <li><a href="#glm-in-stata" id="toc-glm-in-stata" class="nav-link" data-scroll-target="#glm-in-stata">GLM in <code>Stata</code></a></li>
  <li><a href="#going-full-ml" id="toc-going-full-ml" class="nav-link" data-scroll-target="#going-full-ml">Going full ML</a>
  <ul class="collapse">
  <li><a href="#what-is-mle" id="toc-what-is-mle" class="nav-link" data-scroll-target="#what-is-mle">What is MLE</a></li>
  <li><a href="#poisson-regression-via-mle" id="toc-poisson-regression-via-mle" class="nav-link" data-scroll-target="#poisson-regression-via-mle">Poisson Regression via MLE</a></li>
  <li><a href="#the-likelihood-of-lambda" id="toc-the-likelihood-of-lambda" class="nav-link" data-scroll-target="#the-likelihood-of-lambda">The Likelihood of <span class="math inline">\(\lambda\)</span></a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#the-likelihood-of-lambda-1" id="toc-the-likelihood-of-lambda-1" class="nav-link" data-scroll-target="#the-likelihood-of-lambda-1">The Likelihood of <span class="math inline">\(\lambda\)</span></a></li>
  <li><a href="#what-mle-does" id="toc-what-mle-does" class="nav-link" data-scroll-target="#what-mle-does">What MLE does</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#how-to-solve-this" id="toc-how-to-solve-this" class="nav-link" data-scroll-target="#how-to-solve-this">How to solve this?</a></li>
  <li><a href="#why-do-we-like-mle" id="toc-why-do-we-like-mle" class="nav-link" data-scroll-target="#why-do-we-like-mle">Why do we like MLE?</a></li>
  <li><a href="#regularity-conditions-and-mle" id="toc-regularity-conditions-and-mle" class="nav-link" data-scroll-target="#regularity-conditions-and-mle">Regularity Conditions and MLE ‚ö†Ô∏è</a></li>
  <li><a href="#regularity-conditions" id="toc-regularity-conditions" class="nav-link" data-scroll-target="#regularity-conditions">Regularity Conditions ‚ö†Ô∏è</a></li>
  <li><a href="#lr-as-mle" id="toc-lr-as-mle" class="nav-link" data-scroll-target="#lr-as-mle">LR as MLE</a></li>
  <li><a href="#lr-as-mle-pii" id="toc-lr-as-mle-pii" class="nav-link" data-scroll-target="#lr-as-mle-pii">LR as MLE PII</a></li>
  <li><a href="#soc" id="toc-soc" class="nav-link" data-scroll-target="#soc">SOC</a></li>
  <li><a href="#other-considerations" id="toc-other-considerations" class="nav-link" data-scroll-target="#other-considerations">Other considerations</a></li>
  <li><a href="#mle-in-stata" id="toc-mle-in-stata" class="nav-link" data-scroll-target="#mle-in-stata">MLE in <code>Stata</code></a></li>
  <li><a href="#this-is-the-way" id="toc-this-is-the-way" class="nav-link" data-scroll-target="#this-is-the-way">This is the way</a></li>
  <li><a href="#programming-mle" id="toc-programming-mle" class="nav-link" data-scroll-target="#programming-mle">Programming MLE</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#programming-mle-pi" id="toc-programming-mle-pi" class="nav-link" data-scroll-target="#programming-mle-pi">Programming MLE PI</a></li>
  <li><a href="#other-considerations-1" id="toc-other-considerations-1" class="nav-link" data-scroll-target="#other-considerations-1">Other Considerations</a></li>
  <li><a href="#margins-in-action" id="toc-margins-in-action" class="nav-link" data-scroll-target="#margins-in-action">Margins in action</a></li>
  <li><a href="#going-beyond" id="toc-going-beyond" class="nav-link" data-scroll-target="#going-beyond">Going Beyond?</a></li>
  </ul></li>
  <li><a href="#done" id="toc-done" class="nav-link" data-scroll-target="#done">Done!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="06nlreg.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="06nlreg.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NLS, IRLS, and MLE</h1>
<p class="subtitle lead">Going nonlinear!</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="sowhat-is-non-linear" class="level2">
<h2 class="anchored" data-anchor-id="sowhat-is-non-linear">So‚Ä¶what is non-linear?</h2>
<p>Options:</p>
<p><span class="math display">\[
\begin{aligned}
y = b_0 + b_1 x^{b_2}+e \\
y = exp(b_0+b_1 x)+e \\
y = exp(b_0+b_1 x+e) \\
y = h(x\beta)+e \\
y = h(x\beta+e)
\end{aligned}
\]</span></p>
<p>All of them are Nonlinear, but some of them are linearizable.</p>
<blockquote class="blockquote">
<p>A Linearizable model is one you can apply a transformation and make it linear.</p>
</blockquote>
<p>For models #2 and #4, you could apply (logs) or <span class="math inline">\(h^{-1}()\)</span> (if functions), and use OLS. For the others you need other methods.</p>
</section>
<section id="how-do-you-do-nl" class="level2">
<h2 class="anchored" data-anchor-id="how-do-you-do-nl">How do you do, NL?</h2>
<p>Nonlinear models are tricky. In contrast with our good old OLS, there no ‚Äúclose form‚Äù solution we can plug in:</p>
<p><span class="math display">\[
\beta = (X'X)^{-1}X'y
\]</span></p>
<p>We already saw this! For Quantile regressions, we never did it <strong><em>by-hand</em></strong> (requires linear programming). Because, Qregressions are also nolinear.</p>
<p>In this section, we will cover some of the few methodologies that are available for the estimation of Nonlinear models. We start with the first, an extension to OLS, we will call NLS.</p>
<p><span class="math display">\[
y = h(x,\beta) + e
\]</span></p>
<p>What makes this model NLS, is that the error adds to the outcome (or CEF)! However, the CEF is modeled as a nolinear function of <span class="math inline">\(X's\)</span> and <span class="math inline">\(\beta's\)</span>. (but we still aim to MIN SSR)</p>
</section>
<section id="some-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="some-assumptions">Some Assumptions</h2>
<p>For identification and estimation <strong>NLS</strong> requires similar assumptions as <strong>OLS:</strong></p>
<ol type="1">
<li>Functional form: <span class="math inline">\(E(y|X)\)</span> is given by <span class="math inline">\(h(x,\beta)\)</span>, which is continuous and differentiable.</li>
<li>There is a unique solution! (like no-multicolinearity). if <span class="math inline">\(\beta\)</span> Minimizes the errors, then there is no other <span class="math inline">\(\beta_0\)</span> that will give the same solution.</li>
<li>The expected value of the error is zero <span class="math inline">\(E(e)=0\)</span>, and <span class="math inline">\(E(e|h(x,\beta))=0\)</span> . Similar to No endogeneity, but constrained by functional form.</li>
<li>Data is well behaved. (no extreme distributions, so that mean and variance exists)</li>
</ol>
<p>Under this assumptions, its possible to Estimate the coefficients of interest.</p>
</section>
<section id="but-how" class="level2">
<h2 class="anchored" data-anchor-id="but-how">But How?</h2>
<p>NLS aims to choose <span class="math inline">\(\beta's\)</span> to minimize the sum of squared residuals:</p>
<p><span class="math display">\[
SSR(\beta) = \sum(y-h(x,\beta))^2 = [y-h(x,\beta)]'[y-h(x,\beta)]
\]</span></p>
<p>The FOC of this model are a non-linear system of equations.</p>
<p><span class="math display">\[
\frac{\partial SSR(\beta)}{\partial \beta}=-2 \Bigg[\frac{\partial h(x,\beta)}{\partial \beta}\Bigg]' [y-h(x,\beta)] =-2\color{red}{\tilde X'} e
\]</span></p>
<p>So how? Lets Start with a 2nd Order Taylor Expansion:</p>
<p><span class="math display">\[
\begin{aligned}
SSR(\beta) &amp;\simeq  SSR(\beta_0) + g(\beta_0)' (\beta-\beta_0)+\frac{1}{2}(\beta-\beta_0)'H(\beta_0)(\beta-\beta_0) \\
g(\beta) &amp;=-2 \tilde X'e ;H(\beta)=2 \tilde X'\tilde X ; \tilde X=
\Bigg[\frac{\partial h(x,\beta)}{\partial \beta}\Bigg]
\end{aligned}
\]</span></p>
</section>
<section id="foc-again.." class="level2">
<h2 class="anchored" data-anchor-id="foc-again..">FOC again..</h2>
<p><span class="math display">\[
\begin{aligned}
g(\beta_0)+H(\beta_0)(\beta-\beta_0)&amp;=0 \\
\beta-\beta_0 &amp;= -H(\beta_0)^{-1}g(\beta_0) \\
\beta_t &amp;=\beta_{t-1}-H(\beta_{t-1})^{-1}g(\beta_{t-1})
\end{aligned}
\]</span></p>
<p>This simply says, In order to solve the system, you need to use a recursive system, so that <span class="math inline">\(\beta's\)</span> are updated until there is no longer a change.</p>
<p>This Iterative process is also known as a Newton Raphson method to solve nonlinear equations (if a solution exists).</p>
<p>Why does this work?</p>
<ol type="1">
<li>You change <span class="math inline">\(\beta\)</span> in the direction that should minimize SSR. (that direction is <span class="math inline">\(g(.,.)\)</span>.</li>
<li>That get to that change the ‚Äúfastest‚Äù way possible using the Hessian</li>
</ol>
<p>This is the most basic numerical optimization method.</p>
</section>
<section id="small-example" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="small-example">Small Example</h2>
<p>Consider the function <span class="math inline">\(y = x^4 -18 x^2 + 15x\)</span> , find the Minimum.</p>
<p>S1. Gradient: <span class="math inline">\(\frac{\partial y}{\partial x}=4x^3-36*x+15\)</span></p>
<p>S2. Hessian: <span class="math inline">\(\frac{\partial y ^2}{\partial^2 x}=12*x^2-36\)</span></p>
<p>Solution:</p>
<p><span class="math display">\[x_t = x_{t-1} - \frac{dy/dx}{dy^2/d^2x}\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>:</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>     <span class="co">// function to obtain the Value, the gradient and Hessian </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">real</span> <span class="fu">matrix</span>  fgh_x(<span class="fu">real</span> <span class="fu">matrix</span> x, <span class="fu">real</span> <span class="fu">scalar</span> g){</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">real</span> <span class="fu">matrix</span> <span class="fu">y</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> (g==0)      <span class="fu">y</span> =    -x:^4 :- 18*x:^2 :+ 15*x</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="kw">if</span> (g==1) <span class="fu">y</span> =  -4*x:^3 :- 36*x    :+ 15</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="kw">if</span> (g==2) <span class="fu">y</span> = -12*x:^2 :- 36   </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">y</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Some initial values</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     x = -2 , 2 ,0 </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>     xt = x,fgh_x(x,0),fgh_x(x,1)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span>(i=1;i&lt;8;i++) {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         x = x :- fgh_x(x,1):/fgh_x(x,2)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         xt = xt \ x,fgh_x(x,0),fgh_x(x,1)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    xt[,(1,4,7)] </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    xt[,(2,5,8)] </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    xt[,(3,6,9)] </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        +----------------------------------------------+</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      1 |            -2            -86             55  |</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      2 |  -6.583333333    999.5046779   -889.2939815  |</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      3 |  -4.746265374    30.78669521   -241.8115913  |</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      4 |  -3.714313214   -113.7119057   -56.25720696  |</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      5 |  -3.280073929   -127.1074326   -8.077091068  |</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      6 |  -3.193322943   -127.4662895   -.2936080906  |</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      7 |  -3.189923432   -127.4667891   -.0004426933  |</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      8 |  -3.189918291   -127.4667891   -1.01177e-09  |</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        +----------------------------------------------+</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                      1              2              3</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        +----------------------------------------------+</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      1 |             2            -26            -25  |</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      2 |   4.083333333    39.13430748    140.3356481  |</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      3 |    3.22806275   -30.56155349    33.34042084  |</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      4 |   2.853639205   -37.46140286    5.220655055  |</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      5 |   2.769051829    -37.6890608    .2425933896  |</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      6 |   2.764720715   -37.68958705    .0006229957  |</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      7 |   2.764709535   -37.68958705    4.14680e-09  |</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      8 |   2.764709535   -37.68958705    1.42109e-14  |</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        +----------------------------------------------+</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                     1             2             3</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        +-------------------------------------------+</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      1 |            0             0            15  |</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      2 |  .4166666667   3.155140818   .2893518519  |</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      3 |  .4251979252   3.156376126   .0003663956  |</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      4 |  .4252087555   3.156376128   5.98494e-10  |</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>      5 |  .4252087556   3.156376128   1.77636e-15  |</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      6 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>      7 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      8 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        +-------------------------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-so-many-solutions" class="level2">
<h2 class="anchored" data-anchor-id="why-so-many-solutions">Why So many Solutions?</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/image-2044638616.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Stata</figcaption>
</figure>
</div>
</section>
<section id="nls" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="nls">NLS</h2>
<p>The same principle (as above) can be used for Regression:</p>
<p><span class="math display">\[
y = b_0 + b_1 x ^{b_2} + e = h(x,b) + e
\]</span></p>
<p>Pseudo Regressors and gradients</p>
<p><span class="math display">\[
\begin{aligned}
\tilde X(b) = \frac{\partial h(x,b)}{\partial b_0},
\frac{\partial h(x,b)}{\partial b_1},
\frac{\partial h(x,b)}{\partial b_2} \\
\tilde X(b) = 1, x^{b_2},{b_1} x^{b_2}\ log\ b_2 \\
\beta_t =\beta_{t-1}-(\tilde X ' \tilde X) ^{-1} \tilde X' \hat e \\
\hat e=y-h(x,b_{t-1})
\end{aligned}
\]</span></p>
<p>It turns out that:</p>
<p><span class="math display">\[
\begin{aligned}
b^* \sim N(b, (\tilde X' \tilde X)^{-1}\tilde X' \Omega \tilde X (\tilde X' \tilde X)^{-1} )\\
\Omega = f(\hat e)
\end{aligned}
\]</span></p>
<p>So‚Ä¶you can ü•™ just like with regular OLS!</p>
</section>
<section id="nls-in-stata-long-example" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="nls-in-stata-long-example">NLS in Stata: Long Example</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 101</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 100</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>** Generating fake <span class="kw">data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x = runiform()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = 1+0.5*x^0.5+rnormal()*.1</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>*** Load <span class="kw">data</span> <span class="kw">in</span> Mata...to make things quick</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>x=st_data(.,<span class="st">"x"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">y</span>=st_data(.,<span class="st">"y"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Initial data</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>b=1\1\1</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>b0=999\999\999</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>bb=b'</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">// and a loop to see when data converges</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> (<span class="kw">sum</span>(<span class="fu">abs</span>(b0:-b))&gt; 0.000001 ) { </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    b0=b    </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// residuals</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">e</span>=<span class="fu">y</span>:-(b[1]:+b[2]*x:^b[3])</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// pseudo regressors</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    sx=<span class="fu">J</span>(100,1,1),x:^b[3],b[2]*x:^b[3]:*<span class="fu">ln</span>(x)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// gradient and Hessian</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    g=-<span class="kw">cross</span>(sx,<span class="fu">e</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    H=<span class="kw">cross</span>(sx,sx)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// updating B</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    b=b-<span class="fu">invsym</span>(H)*g</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Storing results</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    bb=bb\b'</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">/// Now STD ERR (for fun üòÉ )</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>vcv = e'e / (100-3) * <span class="fu">invsym</span>(H)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>b , diagonal(vcv):^0.5</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>: b , diagonal(vcv):^0.5</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                 1             2</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    +-----------------------------+</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  1 |   1.06407084   .0527603468  |</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  2 |  .4228891942   .0477125017  |</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  3 |  .5788053878    .159931095  |</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    +-----------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="nls-in-stata-short-example-nl-function" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="nls-in-stata-short-example-nl-function">NLS in Stata: Short Example: NL function</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>** Stata has the <span class="kw">function</span> -<span class="kw">nl</span>- (nonlinear)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>** it can <span class="kw">be</span> used to estimate <span class="kw">this</span> types <span class="kw">of</span> models</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>** see <span class="kw">help</span> <span class="kw">nl</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>** Be careful about Initial <span class="kw">values</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">nl</span> ( <span class="fu">y</span> = {b0=1} + {b1=1} * x ^ {b2=1})</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>Iteration 0:  residual SS =   .854919</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>Iteration 1:  residual SS =  .7742535</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>Iteration 2:  residual SS =   .766106</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>Iteration 3:  residual SS =  .7660948</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>Iteration 4:  residual SS =  .7660947</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>Iteration 5:  residual SS =  .7660947</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>Iteration 6:  residual SS =  .7660947</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      Source |      SS            df       MS</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------    Number <span class="kw">of</span> <span class="kw">obs</span> =        100</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>       Model |  1.2706842          2  .635342093    R-squared     =     0.6239</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    Residual |  .76609469         97  .007897883    Adj R-squared =     0.6161</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------    Root MSE      =     .08887</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>       Total |  2.0367789         99  .020573524    Res. <span class="kw">dev</span>.     =  -203.3743</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">y</span> | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>         /b0 |   1.064071   .0527608    20.17   0.000     .9593554    1.168786</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>         /b1 |   .4228891   .0477129     8.86   0.000     .3281923     .517586</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>         /b2 |   .5788057   .1599306     3.62   0.000     .2613878    .8962236</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>Note: Parameter b0 is used <span class="kw">as</span> a constant term during estimation.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So, you could now estimate many nonlinear models! (logits, probits, poissons, etc) or can you?</p>
</section>
<section id="nls-for-logit" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="nls-for-logit">NLS for logit</h2>
<p>The model (as NLS)</p>
<p><span class="math display">\[
P(y=1|x) = \frac{exp(x\beta)}{1+exp(x\beta)}+e
\]</span></p>
<p>This guaranties the predicted value is between 0 and 1. But, still assumes errors are homoskedastic!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">nl</span> (lfp = <span class="kw">logistic</span>({b0}+{b1:female age educ}))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      Source |      SS            df       MS</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------    Number <span class="kw">of</span> <span class="kw">obs</span> =      1,647</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>       Model |  1272.8283          4  318.207079    R-squared     =     0.8876</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    Residual |  161.17168       1643  .098095973    Adj R-squared =     0.8873</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------    Root MSE      =   .3132028</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>       Total |       1434       1647  .870673953    Res. <span class="kw">dev</span>.     =   845.9593</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>         lfp | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>         /b0 |   3.432866   .9601508     3.58   0.000     1.549617    5.316114</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  /b1_female |  -3.056149   .8625563    -3.54   0.000    -4.747975   -1.364324</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>     /b1_age |  -.0205121   .0054815    -3.74   0.000    -.0312635   -.0097607</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    /b1_educ |   .1522987   .0329513     4.62   0.000     .0876679    .2169296</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> lfp female age educ</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>Logistic regression                                     Number <span class="kw">of</span> <span class="kw">obs</span> =  1,647</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                                                        LR <span class="fu">chi2</span>(3)    = 251.69</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                                                        Prob &gt; <span class="fu">chi2</span>   = 0.0000</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>Log likelihood = -508.42172                             Pseudo R2     = 0.1984</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>         lfp | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      female |   -3.21864    .365329    -8.81   0.000    -3.934672   -2.502609</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>         age |  -.0233149   .0072746    -3.20   0.001    -.0375729   -.0090569</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        educ |   .1719904   .0411498     4.18   0.000     .0913383    .2526425</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   3.507185   .6550208     5.35   0.000     2.223367    4.791002</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="glm-and-interative-reweighted-ls-irls" class="level2">
<h2 class="anchored" data-anchor-id="glm-and-interative-reweighted-ls-irls">GLM and Interative Reweighted LS (IRLS)</h2>
<p><strong>G</strong>eneralized <strong>L</strong>inear <strong>M</strong>odel are a natural extension to LR models. It changes how LR models are estimated.</p>
<ol type="1">
<li>Puts more emphasis in modeling the CEF (conditional mean) of the distribution</li>
<li>Allows for different transformations that relate the index <span class="math inline">\(xb\)</span> to <span class="math inline">\(E(y|x)\)</span> (<strong><em>links</em></strong>)</li>
<li>Considers data can come from different distributions. ( <strong><em>family</em></strong> )</li>
</ol>
<p><span class="math display">\[
E(y|X) = \eta ^{-1}(x\beta) ; Var(E(y|X)) = \sigma^2(x)
\]</span></p>
<p>For example:</p>
<p>Logit model: Family <span class="math inline">\(\rightarrow\)</span> binomial, Link function logistic function is logistic <span class="math inline">\(p(y|x) = \frac {e^{x\beta} }{1+e^{x\beta}} \rightarrow x\beta=log \left( \frac{p}{1-p} \right)\)</span></p>
<p>Family: Binomial, so variance is given by <span class="math inline">\(Var(y|X) = p(y|x)(1-p(y|x))\)</span></p>
</section>
<section id="how-does-this-change-estimation-nls" class="level2">
<h2 class="anchored" data-anchor-id="how-does-this-change-estimation-nls">How does this change Estimation? NLS??</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://static.wikia.nocookie.net/dragonball/images/6/60/FusionDanceFinaleGotenTrunksBuuSaga.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Fusion</figcaption>
</figure>
</div>
</section>
<section id="how-does-this-change-estimation-nls-1" class="level2">
<h2 class="anchored" data-anchor-id="how-does-this-change-estimation-nls-1">How does this change Estimation? NLS??</h2>
<p>Recall GLS?</p>
<ul>
<li><p>Heteroskedasticity was addressed by either using ‚Äúweights‚Äù to estimate the model, or by transforming the data!</p></li>
<li><p>Here, when we choose a <strong>family</strong>, we are also choosing a particular source of heteroskedasticy. (Logit, probit, poisson, have very specific heteroskedastic errors)</p></li>
<li><p>Thus, you just need to apply NLS to transformed data!</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
SSR(\beta) = \sum \left( \frac{y-h(x,\beta)}{\sigma(x,\beta)} \right)^2 \\\
\tilde X = \frac{1}{\sigma(x,\beta)} \frac{\partial h(x,\beta)}{\partial \beta} ; \tilde y = \frac{y}{\sigma(x,\beta)} ; \tilde e=\frac{1}{\sigma(x,\beta)}(y-h(x,\beta))
\end{aligned}
\]</span></p>
</section>
<section id="how-does-this-change-estimation-nls-2" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="how-does-this-change-estimation-nls-2">How does this change Estimation? NLS??</h2>
<p>Then, just apply the iterative process we saw before, until it converges!</p>
<p><span class="math display">\[
\beta_t =\beta_{t-1}-(\tilde X'\tilde X)^{-1} (\tilde X' \tilde e)
\]</span></p>
<p>Then simply derive Standard errors from here.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">nl</span> (lfp = <span class="kw">logistic</span>({b0}+{b1:female age educ}))   </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> lfp female age educ</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>** IRSL</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> one =1</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">y</span> = st_data(.,<span class="st">"lfp"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>x = st_data(.,<span class="st">"female age educ one"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>b = 0\0\0\0</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a> <span class="kw">end</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">mata</span>:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>b0=999\999\999\999</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>bb=b'</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> (<span class="kw">sum</span>(<span class="fu">abs</span>(b0:-b))&gt; 0.000001 )  {</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    b0=b    </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">yh</span> = <span class="kw">logistic</span>(x*b)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    err = <span class="fu">y</span>:-<span class="fu">yh</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    se = <span class="fu">sqrt</span>(<span class="fu">yh</span>:*(1:-<span class="fu">yh</span>))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    wsx =  <span class="fu">yh</span>:*(1:-<span class="fu">yh</span>):*x:/se</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    werr=  err:/se</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    g = -<span class="kw">cross</span>(wsx,werr)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">h</span> = <span class="kw">cross</span>(wsx,wsx)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    b = b:-<span class="fu">invsym</span>(<span class="kw">h</span>)*g;b'</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>b,diagonal(<span class="kw">cross</span>(werr,werr)/1643*<span class="fu">invsym</span>(<span class="kw">h</span>)):^.5</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    +-------------------------------+</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  1 |  -3.218640936    .3458501096  |</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  2 |  -.0233149268    .0068867539  |</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  3 |   .1719904055    .0389557282  |</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  4 |   3.507185231    .6200958697  |</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  +-------------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="glm-in-stata" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="glm-in-stata">GLM in <code>Stata</code></h2>
<p>This one is easy as ü•ß</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">help</span> <span class="kw">glm</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>* see <span class="kw">for</span> advanced options <span class="kw">if</span> interested</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>* <span class="kw">syntax</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">glm</span> <span class="fu">y</span> x1 <span class="kw">x2</span> x3 , <span class="kw">family</span>( <span class="kw">family</span> ) <span class="kw">link</span>(<span class="kw">function</span>) method</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>frause oaxaca</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">probit</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">identity</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">logit</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>Generalized linear models                         Number <span class="kw">of</span> <span class="kw">obs</span>   =      1,647</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>Optimization     : ML                             Residual df     =      1,643</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                                  Scale parameter =          1</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>Deviance         =   1016.84343                   (1/df) Deviance =   .6188944</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>Pearson          =  1472.464769                   (1/df) Pearson  =    .896205</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>Variance <span class="kw">function</span>: <span class="kw">V</span>(u) = u*(1-u)                 [Bernoulli]</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>Link <span class="kw">function</span>    : g(u) = <span class="fu">ln</span>(u/(1-u))             [Logit]</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                                                  AIC             =   .6222486</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>Log likelihood   = -508.4217152                   BIC             =  -11152.38</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>             |                 OIM</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>         lfp | Coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      female |  -3.218641    .365329    -8.81   0.000    -3.934672   -2.502609</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>         age |  -.0233149   .0072746    -3.20   0.001    -.0375729   -.0090569</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        educ |   .1719904   .0411498     4.18   0.000     .0913383    .2526425</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   3.507185   .6550209     5.35   0.000     2.223368    4.791002</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-full-ml" class="level1">
<h1>Going full ML</h1>
<p>(Maximum Likelihood not Machine Learning!)</p>
<section id="what-is-mle" class="level2">
<h2 class="anchored" data-anchor-id="what-is-mle">What is MLE</h2>
<p><strong><em>MLE</em></strong> is an estimation method that allows you to find asymptotically efficient estimators of the parameters of interest <span class="math inline">\(\beta's\)</span>.</p>
<p>How?</p>
<blockquote class="blockquote">
<p>Under the assumption that you know something about the data conditional distribution, <strong><em>MLE</em></strong> will find the set of parameters that <em>maximizes the probability</em> (likelihood)that data ‚Äúcomes‚Äù from the chosen distribution.</p>
</blockquote>
<p>ok‚Ä¶.but <strong>HOW</strong>???</p>
<p>Lets do this by example</p>
</section>
<section id="poisson-regression-via-mle" class="level2">
<h2 class="anchored" data-anchor-id="poisson-regression-via-mle">Poisson Regression via MLE</h2>
<p>Consider variable <span class="math inline">\(y={1,1,2,2,3,3,3,3,4,5}\)</span></p>
<p>And say, we assume it comes from a poisson distribution:</p>
<p><span class="math display">\[
p(y|\lambda) = \frac{e^{-\lambda} \lambda ^y}{y!}
\]</span></p>
<p>This function depends on the value of <span class="math inline">\(\lambda\)</span> .</p>
<ul>
<li><p>When <span class="math inline">\(\lambda\)</span> is known, this is the probability <span class="math inline">\(y=\#\)</span>, assuming a poisson distribution.</p></li>
<li><p>When <span class="math inline">\(\lambda\)</span> is unknown, this function (now <span class="math inline">\(f(y|\lambda)\)</span> gives the likelihood that we observe <span class="math inline">\(y=\#\)</span> , for any given <span class="math inline">\(\lambda\)</span>.</p></li>
</ul>
</section>
<section id="the-likelihood-of-lambda" class="level2">
<h2 class="anchored" data-anchor-id="the-likelihood-of-lambda">The Likelihood of <span class="math inline">\(\lambda\)</span></h2>
<p><img src="resources/image-166804846.png" class="img-fluid"></p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<ul>
<li><p>Previous figure only considers the <em>likelihood function</em> of a single observation. And every curve suggests its own parameter. (care to guess?)</p></li>
<li><p>What if we want one that Maximizes the likelihood of ALL observations at once!. For this we need to impose an additional assumption: <strong>Independent</strong> distribution.</p></li>
<li><p>This means that <strong>JOINT</strong> density is defined as:</p></li>
</ul>
<p><span class="math display">\[
L(\lambda|y_1,y_2,...,y_{10})=\prod f(y_i|\lambda)  
\]</span></p>
</section>
<section id="the-likelihood-of-lambda-1" class="level2">
<h2 class="anchored" data-anchor-id="the-likelihood-of-lambda-1">The Likelihood of <span class="math inline">\(\lambda\)</span></h2>
<p><img src="resources/image-1678463398.png" class="img-fluid"></p>
</section>
<section id="what-mle-does" class="level2">
<h2 class="anchored" data-anchor-id="what-mle-does">What MLE does</h2>
<p>What MLE does, then, is to find the parameter <span class="math inline">\(\lambda\)</span> that maximizes the Joint probability of observing the dataset <span class="math inline">\(Y\)</span>. Simple as that‚Ä¶.</p>
<p>With one more difference. Because products are Hard, MLE aims to maximize the Log-Likelihood of observing the data:</p>
<p><span class="math display">\[
\begin{aligned}
LnL(\lambda|y_1,y_2,...,y_{10}) &amp;=\sum ln f(y_i|\lambda) \\\
&amp;= \sum (-\lambda + y_i ln(\lambda) - ln(y_i!))
\end{aligned}
\]</span></p>
<p>And just two more changes.</p>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<ol type="1">
<li>When you have <span class="math inline">\(X's\)</span>, you can further modify this model, to allow for covariates. For example:</li>
</ol>
<p><span class="math display">\[
\lambda = e^{x\beta}
\]</span>Which guaranties the mean, or more specifically conditional mean <span class="math inline">\(\lambda = E(y|X)\)</span> , is positive.</p>
<ol start="2" type="1">
<li>We divide LnL by <span class="math inline">\(N\)</span>. (Number of observations)</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\beta = \min_\beta LnL(\beta|Y,X) \\
\beta = \min_\beta \frac{1}{N}\sum -e^{x'\beta}+y_i  x_i'\beta - ln(y_i!)
\end{aligned}
\]</span></p>
<p>Which arrives to the Same solution</p>
</section>
<section id="how-to-solve-this" class="level2">
<h2 class="anchored" data-anchor-id="how-to-solve-this">How to solve this?</h2>
<p>We actually already covered this‚Ä¶We use Iterative methods!</p>
<p><span class="math display">\[
\begin{aligned}
LL &amp;=  \sum ln \ f(y|x,\beta) \\
FOC&amp;: \\
\frac{\partial LL}{\partial \beta}&amp;= \sum \frac{\partial ln \ f(y|x,\beta)}{\partial \beta} = \sum g_i=n E[g_i] =0 \\
SOC&amp;: \\
\frac{\partial^2 LL}{\partial \beta \partial \beta'}&amp;=
\sum\frac{\partial^2 ln f(y|x,\beta)}{\partial \beta \partial \beta'} =\sum H_i = n E(H_i)
\end{aligned}
\]</span></p>
<p>Thus, <span class="math inline">\(\beta's\)</span> can be estimated using the iterative process (or other more efficient process)</p>
<p><span class="math display">\[
\beta_t = \beta_{t-1} - E(H)^{-1} E(g_i)
\]</span></p>
</section>
<section id="why-do-we-like-mle" class="level2">
<h2 class="anchored" data-anchor-id="why-do-we-like-mle">Why do we like MLE?</h2>
<p>Properties of MLE:</p>
<ul>
<li><p>The estimates are consistent <span class="math inline">\(plim \ \hat \theta = \theta\)</span></p></li>
<li><p>Its MLE estimates are asymptically normal <span class="math inline">\(\hat \theta\sim N(\theta,\sigma^2_\theta)\)</span></p></li>
<li><p>And asymptotically efficient (smallest variance)</p></li>
</ul>
<p>Wait‚Ä¶What about Variances? How do you estimate them!</p>
</section>
<section id="regularity-conditions-and-mle" class="level2">
<h2 class="anchored" data-anchor-id="regularity-conditions-and-mle">Regularity Conditions and MLE ‚ö†Ô∏è</h2>
<p>The variance of estimated coefficients has three estimators for its variance:</p>
<ol type="1">
<li>We can ü•™(Sandwich) the variance:</li>
</ol>
<p><span class="math display">\[
Var\left(N^{-1/2}(\hat\beta - \beta) \right) = H^{-1}g'gH^{-1} = A^{-1}BA^{-1}
\]</span></p>
<ol start="2" type="1">
<li>Or you can use of of the following: <span class="math display">\[
\begin{aligned}
Var\left(N^{-1/2}(\hat\beta - \beta) \right) = -H^{-1} \\
Var\left(N^{-1/2}(\hat\beta - \beta) \right) = \left(\frac{1}{N}\sum g_i g_i'\right)^{-1}
\end{aligned}
\]</span></li>
</ol>
<p>But if all is well (Regularity conditions), They are all equivalent. Otherwise Opt1 is similar to HC1, and Option 2a is closer to non-robust Standard Errors</p>
</section>
<section id="regularity-conditions" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="regularity-conditions">Regularity Conditions ‚ö†Ô∏è</h2>
<ol type="1">
<li>The LogLikelihood function is build on a well behaved distribution function. Which implies FOC:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\int f(y|\theta) dy =1 \\
\int \frac{\partial f(y|\theta)}{\partial \theta}dy=\int  \frac{\partial ln f(y|\theta)}{\partial \theta} f(y|\theta)=0 \\
E(g_i)=0
\end{aligned}
\]</span></p>
<ol start="2" type="1">
<li>Order of Diff and Integration is interchangeable. We obtain SOC: <span class="math display">\[
\int \left( \frac{\partial^2 ln f(y|\theta)}{\partial \theta \partial \theta'}f(y|\theta) +
\frac{\partial ln f(y|\theta)}{\partial \theta} \frac{\partial ln f(y|\theta)}{\partial \theta'} \right)dy = 0 \\
E(H_i) = -E(g_ig_i')
\]</span></li>
</ol>
</section>
<section id="lr-as-mle" class="level2">
<h2 class="anchored" data-anchor-id="lr-as-mle">LR as MLE</h2>
<p>Under the assumption of normality, LR can be estimated using ML:</p>
<p><span class="math display">\[y_i = x_i'\beta + e_i \ | \ e_i\sim N(0,\sigma^2) \rightarrow y|x \sim N(x'\beta, \sigma^2)
\]</span></p>
<p>How does the MLE look? <span class="math display">\[
\begin{aligned}
L_i = f(y_i|x_i,\beta,\sigma^2) = \frac{1}{ \sqrt{2\pi \sigma^2 }} e^{-\frac{1}{2} \frac{ (y_i-x_i'\beta)^2}{\sigma^2} } \\
LL_i = -\frac{1}{2}\frac{(y_i-x_i'\beta)^2}{\sigma^2} - \frac{1}{2}ln(2\pi)-\frac{1}{2}ln(\sigma^2)
\end{aligned}
\]</span></p>
<p>Total LL?</p>
<p><span class="math display">\[
LL = -\frac{1}{2\sigma^2} \sum (y_i-x_i'\beta)^2-\frac{N ln(2\pi)}{2}-\frac{N}{2} ln(\sigma^2)
\]</span></p>
</section>
<section id="lr-as-mle-pii" class="level2">
<h2 class="anchored" data-anchor-id="lr-as-mle-pii">LR as MLE PII</h2>
<p>FOC:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial LL}{\partial \beta} = -\frac{1}{\sigma^2}\sum x'(y_i-x'\beta)=0 \rightarrow \hat\beta=(X'X)^{-1}X'y \\
\frac{\partial LL}{\partial \sigma^2} = \frac{\sum e^2}{2\sigma^4}-\frac{N}{2\sigma^2}=0 \rightarrow \hat \sigma^2 = \frac{\sum e^2}{N}
\end{aligned}
\]</span></p>
<p>SOC:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial^2 LL}{\partial \beta \partial \beta'} = - \frac{X'X}{\sigma^2} ;
\frac{\partial^2 LL}{\partial \beta \partial \sigma} = - \frac{X'y-X'X\beta }{\sigma^2} \\
\frac{\partial^2 LL}{\partial \sigma \partial \beta'}=0;
\frac{\partial^2 LL}{\partial \sigma ^2}=-\frac{\sum e^2}{\sigma^6}+\frac{N}{2\sigma^4}=-\frac{N}{2\sigma^4}
\end{aligned}
\]</span></p>
</section>
<section id="soc" class="level2">
<h2 class="anchored" data-anchor-id="soc">SOC</h2>
<p><span class="math display">\[
\begin{aligned}
H = \Bigg[\begin{matrix} -\frac{X'X}{\sigma^2}&amp; 0 \\
0 &amp; -\frac{N}{2\sigma^4}
\end{matrix} \Bigg] \\
&amp; \rightarrow Var(\beta,\sigma^2)=-H^{-1}=
\Bigg[\begin{matrix}
\sigma^2 (X'X)^{-1} &amp; 0 \\
0 &amp; \frac{2\sigma^4}{N}
\end{matrix} \Bigg]
\end{aligned}
\]</span></p>
</section>
<section id="other-considerations" class="level2">
<h2 class="anchored" data-anchor-id="other-considerations">Other considerations</h2>
<p>MLE is consistent if the model is correctly Specified.</p>
<p>This means that one correctly specifies the conditional distribution of <span class="math inline">\(y\)</span>.</p>
<ul>
<li>Often, its possible to especify the CEF, but specify the variance correctly, may be difficult</li>
</ul>
<p>Usually, this would be grounds of inconsistency. However if the distribution function is part of the exponential family (normal, bernulli, poisson, etc), one only needs to correctly specify the CEF correctly!</p>
<blockquote class="blockquote">
<p>In this case, the model is no longer estimated using MLE but QMLE</p>
</blockquote>
<p>In this cases, use Robust!</p>
</section>
<section id="mle-in-stata" class="level2">
<h2 class="anchored" data-anchor-id="mle-in-stata">MLE in <code>Stata</code></h2>
<p>Many <em>native commands</em> in <code>Stata</code> actually estimate models using MLE on the background.</p>
<ul>
<li>logit; probit; poisson; ologit; mlogit, etc</li>
</ul>
<p>Some multiple equation models as well.</p>
<ul>
<li><code>movestay</code> , <code>craggit</code> , <code>ky_fit</code></li>
</ul>
<p>Are just a few user written commands that also rely on MLE.</p>
<p>So how do you estimate this models?</p>
<p>you do it by hand!</p>
</section>
<section id="this-is-the-way" class="level2">
<h2 class="anchored" data-anchor-id="this-is-the-way">This is the way</h2>
<p><img src="resources/image-336726222.png" class="img-fluid"></p>
</section>
<section id="programming-mle" class="level2">
<h2 class="anchored" data-anchor-id="programming-mle">Programming MLE</h2>
<p><code>Stata</code> has one feature that would allow you to estimate almost any model via MLE. the -<strong><code>ml</code></strong>- suit.</p>
<p>This has many levels of programming (lf, d0, d1, d2, etc), but we will concentrate on the easiest one : lf (linear function)</p>
<ul>
<li>This only requires you to provide the individual level likelihood function!</li>
</ul>
<p>But how do we start?</p>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<p>You need three pieces of information:</p>
<ol type="1">
<li>Identify distribution or objective function to maximize.</li>
<li>Identify the parameters that the distribution depends on, and how will they be affected by characteristics</li>
<li>If more than one equation exists, Identify possible connections across variables</li>
<li>Wrap it all in a program</li>
</ol>
<p>For details on a few examples see <a href="https://www.stata-journal.com/article.html?article=st0520">Rios-Avila &amp; Canavire-Bacarreza 2018</a></p>
</section>
<section id="programming-mle-pi" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="programming-mle-pi">Programming MLE PI</h2>
<p>OLS via MLE:</p>
<blockquote class="blockquote">
<p><span class="math inline">\(y\)</span> distributes as normal distribution, which depends on the mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>. We assume that only the mean depends on <span class="math inline">\(X\)</span>.</p>
</blockquote>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>** Define Program</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> my_ols</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> <span class="kw">define</span> my_ols</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">args</span> lnf <span class="co">///   &lt;- Stores the LL for obs i</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">xb</span>  <span class="co">///   &lt;- Captures the Linear combination of X's</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>       lnsigma <span class="co">// &lt;- captures the Log standard error</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  ** Start creating <span class="ot">all</span> aux variables and lnf     </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> sigma <span class="co">// Temporary variable</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="kw">double</span> <span class="ot">`sigma'</span> = <span class="fu">exp</span>(<span class="ot">`lnsigma'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> <span class="fu">y</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="fu">y</span> <span class="ot">$ML_y1</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> <span class="ot">`lnf'</span>      = <span class="fu">log</span>( <span class="fu">normalden</span>(<span class="ot">`y'</span>,<span class="ot">`xb'</span>,<span class="ot">`sigma'</span> ) )</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  }     </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now Just Call on the program</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>* <span class="kw">load</span> some <span class="kw">data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> <span class="kw">model</span> lf   <span class="co">/// Ask to use -ml- to estimate a model with method -lf-</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   my_ols     <span class="co">/// your ML program</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   (<span class="kw">xb</span>: lnwage = age educ female  ) <span class="co">/// 1st Eq (only one in this case)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>   (lnsig: = female ) <span class="co">// Empty, (no other Y, but could add X's)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">// I could haave added weights, or IF conditions</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> check     <span class="co">// checks if the code is correct</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> <span class="kw">maximize</span>  <span class="co">// maximizes</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> <span class="kw">display</span>   <span class="co">// shows results</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>* Short <span class="kw">version</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> <span class="kw">model</span> lf  my_ols <span class="co">/// Model and method</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>   (<span class="kw">xb</span>: lnwage = age educ female) (lnsig: = female ) <span class="co">/// model Parms</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>   , <span class="kw">robust</span> <span class="kw">maximize</span> <span class="co">// Other SE options, and maximize</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ml</span> <span class="kw">display</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                                                        Number <span class="kw">of</span> <span class="kw">obs</span> =  1,434</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                                                        Wald <span class="fu">chi2</span>(3)  = 393.05</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>Log pseudolikelihood = -870.41117                       Prob &gt; <span class="fu">chi2</span>   = 0.0000</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>             |               Robust</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      lnwage | Coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="kw">xb</span>           |</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>         age |   .0177272   .0012221    14.51   0.000      .015332    .0201224</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        educ |   .0685501   .0056712    12.09   0.000     .0574347    .0796655</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      female |  -.1487184   .0247333    -6.01   0.000    -.1971948   -.1002421</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   1.949072   .0888074    21.95   0.000     1.775012    2.123131</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>lnsig        |</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      female |   .3440266   .0691673     4.97   0.000     .2084611     .479592</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |  -.9758137   .0488944   -19.96   0.000    -1.071645   -.8799825</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>. <span class="kw">reg</span>  lnwage age educ female</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>      Source |       SS           df       MS      Number <span class="kw">of</span> <span class="kw">obs</span>   =     1,434</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------   <span class="fu">F</span>(3, 1430)      =    167.12</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>       Model |  104.907056         3  34.9690188   Prob &gt; <span class="fu">F</span>        =    0.0000</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    Residual |  299.212747     1,430  .209239683   R-squared       =    0.2596</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------   Adj R-squared   =    0.2580</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>       Total |  404.119804     1,433  .282009633   Root MSE        =    .45743</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>         age |   .0161424   .0010978    14.70   0.000      .013989    .0182959</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        educ |   .0719322   .0050365    14.28   0.000     .0620524     .081812</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>      female |  -.1453936   .0243888    -5.96   0.000    -.1932352    -.097552</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   1.970021   .0725757    27.14   0.000     1.827654    2.112387</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="other-considerations-1" class="level2">
<h2 class="anchored" data-anchor-id="other-considerations-1">Other Considerations</h2>
<p>With MLE, as with logit probit tobit, etc, you cannot interpret the models directly!</p>
<p>Then what?</p>
<ol type="1">
<li><p>Identify what is the Statistic of interest (most of the time its the expected value, conditional mean, or predicted mean). But others may be something related to other parameters (we care about <span class="math inline">\(\sigma\)</span> not <span class="math inline">\(ln \ \sigma\)</span>).</p>
<p>See <code>margins</code>, and option <code>expression</code></p></li>
<li><p>Identify if you are interested in Average effects, or effects at the average.</p></li>
<li><p>Some times, you may need to use your own predictions!</p></li>
</ol>
<p>see <a href="https://friosavila.github.io/playingwithstata/main_mlprobit.html">example for probit</a></p>
</section>
<section id="margins-in-action" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="margins-in-action">Margins in action</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>**Estimate Logit <span class="kw">model</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> lfp educ female age married divorced</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>** <span class="kw">use</span> margins to estimate predicted probability</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>margins</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>** <span class="kw">or</span> <span class="kw">use</span> expression</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>margins, expression(<span class="fu">exp</span>(<span class="kw">xb</span>())/(1+<span class="fu">exp</span>(<span class="kw">xb</span>())))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>             |            Delta-method</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>             |     Margin   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |    .870674   .0071023   122.59   0.000     .8567537    .8845942</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>** marginal <span class="kw">effects</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>margins, <span class="kw">dydx</span>(educ) </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>             |            Delta-method</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>             |      dy/dx   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        educ |   .0161004   .0037127     4.34   0.000     .0088236    .0233772</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>** Marginal effect <span class="kw">of</span> the marginal effect?</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>margins, expression( <span class="kw">logistic</span>(<span class="kw">xb</span>())*(1-<span class="kw">logistic</span>(<span class="kw">xb</span>()))*_b[educ] )</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>             |            Delta-method</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>             |     Margin   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   .0161004   .0037127     4.34   0.000     .0088236    .0233772</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>margins, <span class="kw">dydx</span>(*) expression( <span class="kw">logistic</span>(<span class="kw">xb</span>())*(1-<span class="kw">logistic</span>(<span class="kw">xb</span>()))*_b[educ] )</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>             |            Delta-method</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>             |      dy/dx   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        educ |  -.0010759   .0004973    -2.16   0.031    -.0020507   -.0001012</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    1.female |   .0246023   .0054734     4.49   0.000     .0138747    .0353299</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>         age |   5.41e-06   .0000502     0.11   0.914     -.000093    .0001039</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>   1.married |    .021062    .004861     4.33   0.000     .0115346    .0305893</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  1.divorced |   .0037604   .0013899     2.71   0.007     .0010362    .0064846</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-beyond" class="level2">
<h2 class="anchored" data-anchor-id="going-beyond">Going Beyond?</h2>
<p>MLE can also be used in more Advanced models.</p>
<ol type="1">
<li><p>Multi equation model that may or may not depend on each other.</p>
<p>For example, Oaxaca-Blinder Decomposition, requires using Multiple Equations</p>
<p>IV - CF, or IV TSLS are also multi equation models but which depend on each other.</p></li>
<li><p>One could also estimate nonlinear versions of Standard models. For example Nonlinear Tobit model (See Ransom 1987)</p></li>
<li><p>Estimation of latent groups of finite mixture models . This combine models that are otherwise unobserved (See Kapteyn and Ypma 2007)</p></li>
</ol>
<p>Basically, if you can figure out <span class="math inline">\(f(.)\)</span>‚Äôs and how are they connected, you can estimate any model via MLE (with few exceptions)</p>
</section>
</section>
<section id="done" class="level1">
<h1>Done!</h1>
<p>Next, we start with Causal effects Strategies. First the gold Standard RCT</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>