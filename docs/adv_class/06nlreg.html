<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.33">

  <meta name="author" content="Fernando Rios-Avila">
  <title>Econometrics MSC Levy – NLS, IRLS, and MLE</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-27a844e7d43f0d31b27642e48490372a.css">
  <link rel="stylesheet" href="styles.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">NLS, IRLS, and MLE</h1>
  <p class="subtitle">Going nonlinear!</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Fernando Rios-Avila 
</div>
</div>
</div>

</section>
<section id="sowhat-is-non-linear" class="slide level2">
<h2>So…what is non-linear?</h2>
<p>Options:</p>
<p><span class="math display">\[
\begin{aligned}
y = b_0 + b_1 x^{b_2}+e \\
y = exp(b_0+b_1 x)+e \\
y = exp(b_0+b_1 x+e) \\
y = h(x\beta)+e \\
y = h(x\beta+e)
\end{aligned}
\]</span></p>
<p>All of them are Nonlinear, but some of them are linearizable.</p>
<blockquote>
<p>A Linearizable model is one you can apply a transformation and make it linear.</p>
</blockquote>
<p>For models #2 and #4, you could apply (logs) or <span class="math inline">\(h^{-1}()\)</span> (if functions), and use OLS. For the others you need other methods.</p>
</section>
<section id="how-do-you-do-nl" class="slide level2">
<h2>How do you do, NL?</h2>
<p>Nonlinear models are tricky. In contrast with our good old OLS, there no “close form” solution we can plug in:</p>
<p><span class="math display">\[
\beta = (X'X)^{-1}X'y
\]</span></p>
<p>We already saw this! For Quantile regressions, we never did it <strong><em>by-hand</em></strong> (requires linear programming). Because, Qregressions are also nolinear.</p>
<p>In this section, we will cover some of the few methodologies that are available for the estimation of Nonlinear models. We start with the first, an extension to OLS, we will call NLS.</p>
<p><span class="math display">\[
y = h(x,\beta) + e
\]</span></p>
<p>What makes this model NLS, is that the error adds to the outcome (or CEF)! However, the CEF is modeled as a nolinear function of <span class="math inline">\(X's\)</span> and <span class="math inline">\(\beta's\)</span>. (but we still aim to MIN SSR)</p>
</section>
<section id="some-assumptions" class="slide level2">
<h2>Some Assumptions</h2>
<p>For identification and estimation <strong>NLS</strong> requires similar assumptions as <strong>OLS:</strong></p>
<ol type="1">
<li>Functional form: <span class="math inline">\(E(y|X)\)</span> is given by <span class="math inline">\(h(x,\beta)\)</span>, which is continuous and differentiable.</li>
<li>There is a unique solution! (like no-multicolinearity). if <span class="math inline">\(\beta\)</span> Minimizes the errors, then there is no other <span class="math inline">\(\beta_0\)</span> that will give the same solution.</li>
<li>The expected value of the error is zero <span class="math inline">\(E(e)=0\)</span>, and <span class="math inline">\(E(e|h(x,\beta))=0\)</span> . Similar to No endogeneity, but constrained by functional form.</li>
<li>Data is well behaved. (no extreme distributions, so that mean and variance exists)</li>
</ol>
<p>Under this assumptions, its possible to Estimate the coefficients of interest.</p>
</section>
<section id="but-how" class="slide level2">
<h2>But How?</h2>
<p>NLS aims to choose <span class="math inline">\(\beta's\)</span> to minimize the sum of squared residuals:</p>
<p><span class="math display">\[
SSR(\beta) = \sum(y-h(x,\beta))^2 = [y-h(x,\beta)]'[y-h(x,\beta)]
\]</span></p>
<p>The FOC of this model are a non-linear system of equations.</p>
<p><span class="math display">\[
\frac{\partial SSR(\beta)}{\partial \beta}=-2 \Bigg[\frac{\partial h(x,\beta)}{\partial \beta}\Bigg]' [y-h(x,\beta)] =-2\color{red}{\tilde X'} e
\]</span></p>
<p>So how? Lets Start with a 2nd Order Taylor Expansion:</p>
<p><span class="math display">\[
\begin{aligned}
SSR(\beta) &amp;\simeq  SSR(\beta_0) + g(\beta_0)' (\beta-\beta_0)+\frac{1}{2}(\beta-\beta_0)'H(\beta_0)(\beta-\beta_0) \\
g(\beta) &amp;=-2 \tilde X'e ;H(\beta)=2 \tilde X'\tilde X ; \tilde X=
\Bigg[\frac{\partial h(x,\beta)}{\partial \beta}\Bigg]
\end{aligned}
\]</span></p>
</section>
<section id="foc-again.." class="slide level2">
<h2>FOC again..</h2>
<p><span class="math display">\[
\begin{aligned}
g(\beta_0)+H(\beta_0)(\beta-\beta_0)&amp;=0 \\
\beta-\beta_0 &amp;= -H(\beta_0)^{-1}g(\beta_0) \\
\beta_t &amp;=\beta_{t-1}-H(\beta_{t-1})^{-1}g(\beta_{t-1})
\end{aligned}
\]</span></p>
<p>This simply says, In order to solve the system, you need to use a recursive system, so that <span class="math inline">\(\beta's\)</span> are updated until there is no longer a change.</p>
<p>This Iterative process is also known as a Newton Raphson method to solve nonlinear equations (if a solution exists).</p>
<p>Why does this work?</p>
<ol type="1">
<li>You change <span class="math inline">\(\beta\)</span> in the direction that should minimize SSR. (that direction is <span class="math inline">\(g(.,.)\)</span>.</li>
<li>That get to that change the “fastest” way possible using the Hessian</li>
</ol>
<p>This is the most basic numerical optimization method.</p>
</section>
<section id="small-example" class="slide level2 scrollable">
<h2>Small Example</h2>
<p>Consider the function <span class="math inline">\(y = x^4 -18 x^2 + 15x\)</span> , find the Minimum.</p>
<p>S1. Gradient: <span class="math inline">\(\frac{\partial y}{\partial x}=4x^3-36*x+15\)</span></p>
<p>S2. Hessian: <span class="math inline">\(\frac{\partial y ^2}{\partial^2 x}=12*x^2-36\)</span></p>
<p>Solution:</p>
<p><span class="math display">\[x_t = x_{t-1} - \frac{dy/dx}{dy^2/d^2x}\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a></a><span class="kw">mata</span>:</span>
<span id="cb1-2"><a></a>     <span class="co">// function to obtain the Value, the gradient and Hessian </span></span>
<span id="cb1-3"><a></a>     <span class="fu">real</span> <span class="fu">matrix</span>  fgh_x(<span class="fu">real</span> <span class="fu">matrix</span> x, <span class="fu">real</span> <span class="fu">scalar</span> g){</span>
<span id="cb1-4"><a></a>        <span class="fu">real</span> <span class="fu">matrix</span> <span class="fu">y</span></span>
<span id="cb1-5"><a></a>        <span class="kw">if</span> (g==0)      <span class="fu">y</span> =    -x:^4 :- 18*x:^2 :+ 15*x</span>
<span id="cb1-6"><a></a>        <span class="kw">else</span> <span class="kw">if</span> (g==1) <span class="fu">y</span> =  -4*x:^3 :- 36*x    :+ 15</span>
<span id="cb1-7"><a></a>        <span class="kw">else</span> <span class="kw">if</span> (g==2) <span class="fu">y</span> = -12*x:^2 :- 36   </span>
<span id="cb1-8"><a></a>        <span class="fu">return</span>(<span class="fu">y</span>)</span>
<span id="cb1-9"><a></a>     }</span>
<span id="cb1-10"><a></a>    <span class="co">// Some initial values</span></span>
<span id="cb1-11"><a></a>     x = -2 , 2 ,0 </span>
<span id="cb1-12"><a></a>     xt = x,fgh_x(x,0),fgh_x(x,1)</span>
<span id="cb1-13"><a></a>    <span class="kw">for</span>(i=1;i&lt;8;i++) {</span>
<span id="cb1-14"><a></a>         x = x :- fgh_x(x,1):/fgh_x(x,2)</span>
<span id="cb1-15"><a></a>         xt = xt \ x,fgh_x(x,0),fgh_x(x,1)</span>
<span id="cb1-16"><a></a>    }</span>
<span id="cb1-17"><a></a>    xt[,(1,4,7)] </span>
<span id="cb1-18"><a></a>    xt[,(2,5,8)] </span>
<span id="cb1-19"><a></a>    xt[,(3,6,9)] </span>
<span id="cb1-20"><a></a>    <span class="kw">end</span></span>
<span id="cb1-21"><a></a></span>
<span id="cb1-22"><a></a>        +----------------------------------------------+</span>
<span id="cb1-23"><a></a>      1 |            -2            -86             55  |</span>
<span id="cb1-24"><a></a>      2 |  -6.583333333    999.5046779   -889.2939815  |</span>
<span id="cb1-25"><a></a>      3 |  -4.746265374    30.78669521   -241.8115913  |</span>
<span id="cb1-26"><a></a>      4 |  -3.714313214   -113.7119057   -56.25720696  |</span>
<span id="cb1-27"><a></a>      5 |  -3.280073929   -127.1074326   -8.077091068  |</span>
<span id="cb1-28"><a></a>      6 |  -3.193322943   -127.4662895   -.2936080906  |</span>
<span id="cb1-29"><a></a>      7 |  -3.189923432   -127.4667891   -.0004426933  |</span>
<span id="cb1-30"><a></a>      8 |  -3.189918291   -127.4667891   -1.01177e-09  |</span>
<span id="cb1-31"><a></a>        +----------------------------------------------+</span>
<span id="cb1-32"><a></a>                      1              2              3</span>
<span id="cb1-33"><a></a>        +----------------------------------------------+</span>
<span id="cb1-34"><a></a>      1 |             2            -26            -25  |</span>
<span id="cb1-35"><a></a>      2 |   4.083333333    39.13430748    140.3356481  |</span>
<span id="cb1-36"><a></a>      3 |    3.22806275   -30.56155349    33.34042084  |</span>
<span id="cb1-37"><a></a>      4 |   2.853639205   -37.46140286    5.220655055  |</span>
<span id="cb1-38"><a></a>      5 |   2.769051829    -37.6890608    .2425933896  |</span>
<span id="cb1-39"><a></a>      6 |   2.764720715   -37.68958705    .0006229957  |</span>
<span id="cb1-40"><a></a>      7 |   2.764709535   -37.68958705    4.14680e-09  |</span>
<span id="cb1-41"><a></a>      8 |   2.764709535   -37.68958705    1.42109e-14  |</span>
<span id="cb1-42"><a></a>        +----------------------------------------------+</span>
<span id="cb1-43"><a></a>                     1             2             3</span>
<span id="cb1-44"><a></a>        +-------------------------------------------+</span>
<span id="cb1-45"><a></a>      1 |            0             0            15  |</span>
<span id="cb1-46"><a></a>      2 |  .4166666667   3.155140818   .2893518519  |</span>
<span id="cb1-47"><a></a>      3 |  .4251979252   3.156376126   .0003663956  |</span>
<span id="cb1-48"><a></a>      4 |  .4252087555   3.156376128   5.98494e-10  |</span>
<span id="cb1-49"><a></a>      5 |  .4252087556   3.156376128   1.77636e-15  |</span>
<span id="cb1-50"><a></a>      6 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-51"><a></a>      7 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-52"><a></a>      8 |  .4252087556   3.156376128             0  |</span>
<span id="cb1-53"><a></a>        +-------------------------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-so-many-solutions" class="slide level2">
<h2>Why So many Solutions?</h2>

<img data-src="resources/image-2044638616.png" class="r-stretch quarto-figure-center"><p class="caption">Stata</p></section>
<section id="nls" class="slide level2 scrollable">
<h2>NLS</h2>
<p>The same principle (as above) can be used for Regression:</p>
<p><span class="math display">\[
y = b_0 + b_1 x ^{b_2} + e = h(x,b) + e
\]</span></p>
<p>Pseudo Regressors and gradients</p>
<p><span class="math display">\[
\begin{aligned}
\tilde X(b) &amp;= \frac{\partial h(x,b)}{\partial b_0},
\frac{\partial h(x,b)}{\partial b_1},
\frac{\partial h(x,b)}{\partial b_2} \\
\tilde X(b) &amp;= 1, x^{b_2},{b_1} x^{b_2}\ log\ b_2 \\
\beta_t &amp;=\beta_{t-1}-(\tilde X ' \tilde X) ^{-1} \tilde X' \hat e \\
\hat e&amp;=y-h(x,b_{t-1})
\end{aligned}
\]</span></p>
<p>It turns out that:</p>
<p><span class="math display">\[
\begin{aligned}
b^* \sim N(b, (\tilde X' \tilde X)^{-1}\tilde X' \Omega \tilde X (\tilde X' \tilde X)^{-1} )\\
\Omega = f(\hat e)
\end{aligned}
\]</span></p>
<p>So…you can 🥪 just like with regular OLS!</p>
</section>
<section id="nls-in-stata-long-example" class="slide level2 scrollable">
<h2>NLS in Stata: Long Example</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a></a><span class="kw">clear</span></span>
<span id="cb2-2"><a></a><span class="kw">set</span> <span class="dv">seed</span> 101</span>
<span id="cb2-3"><a></a><span class="kw">set</span> <span class="kw">obs</span> 100</span>
<span id="cb2-4"><a></a>** Generating fake <span class="kw">data</span></span>
<span id="cb2-5"><a></a><span class="kw">gen</span> x = runiform()</span>
<span id="cb2-6"><a></a><span class="kw">gen</span> <span class="fu">y</span> = 1+0.5*x^0.5+rnormal()*.1</span>
<span id="cb2-7"><a></a>*** Load <span class="kw">data</span> <span class="kw">in</span> Mata...to make things quick</span>
<span id="cb2-8"><a></a><span class="kw">mata</span></span>
<span id="cb2-9"><a></a>x=st_data(.,<span class="st">"x"</span>)</span>
<span id="cb2-10"><a></a><span class="fu">y</span>=st_data(.,<span class="st">"y"</span>)</span>
<span id="cb2-11"><a></a><span class="kw">end</span></span>
<span id="cb2-12"><a></a></span>
<span id="cb2-13"><a></a><span class="kw">mata</span></span>
<span id="cb2-14"><a></a><span class="co">// Initial data</span></span>
<span id="cb2-15"><a></a>b=1\1\1</span>
<span id="cb2-16"><a></a>b0=999\999\999</span>
<span id="cb2-17"><a></a>bb=b'</span>
<span id="cb2-18"><a></a><span class="co">// and a loop to see when data converges</span></span>
<span id="cb2-19"><a></a><span class="kw">while</span> (<span class="kw">sum</span>(<span class="fu">abs</span>(b0:-b))&gt; 0.000001 ) { </span>
<span id="cb2-20"><a></a>    b0=b    </span>
<span id="cb2-21"><a></a>    <span class="co">// residuals</span></span>
<span id="cb2-22"><a></a>    <span class="fu">e</span>=<span class="fu">y</span>:-(b[1]:+b[2]*x:^b[3])</span>
<span id="cb2-23"><a></a>    <span class="co">// pseudo regressors</span></span>
<span id="cb2-24"><a></a>    sx=<span class="fu">J</span>(100,1,1),x:^b[3],b[2]*x:^b[3]:*<span class="fu">ln</span>(x)</span>
<span id="cb2-25"><a></a>    <span class="co">// gradient and Hessian</span></span>
<span id="cb2-26"><a></a>    g=-<span class="kw">cross</span>(sx,<span class="fu">e</span>)</span>
<span id="cb2-27"><a></a>    H=<span class="kw">cross</span>(sx,sx)</span>
<span id="cb2-28"><a></a>    <span class="co">// updating B</span></span>
<span id="cb2-29"><a></a>    b=b-<span class="fu">invsym</span>(H)*g</span>
<span id="cb2-30"><a></a>    <span class="co">// Storing results</span></span>
<span id="cb2-31"><a></a>    bb=bb\b'</span>
<span id="cb2-32"><a></a>}</span>
<span id="cb2-33"><a></a><span class="co">/// Now STD ERR (for fun 😃 )</span></span>
<span id="cb2-34"><a></a>vcv = e'e / (100-3) * <span class="fu">invsym</span>(H)</span>
<span id="cb2-35"><a></a>b , diagonal(vcv):^0.5</span>
<span id="cb2-36"><a></a></span>
<span id="cb2-37"><a></a><span class="kw">end</span></span>
<span id="cb2-38"><a></a>: b , diagonal(vcv):^0.5</span>
<span id="cb2-39"><a></a>                 1             2</span>
<span id="cb2-40"><a></a>    +-----------------------------+</span>
<span id="cb2-41"><a></a>  1 |   1.06407084   .0527603468  |</span>
<span id="cb2-42"><a></a>  2 |  .4228891942   .0477125017  |</span>
<span id="cb2-43"><a></a>  3 |  .5788053878    .159931095  |</span>
<span id="cb2-44"><a></a>    +-----------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="nls-in-stata-short-example-nl-function" class="slide level2 scrollable">
<h2>NLS in Stata: Short Example: NL function</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a></a>** Stata has the <span class="kw">function</span> -<span class="kw">nl</span>- (nonlinear)</span>
<span id="cb3-2"><a></a>** it can <span class="kw">be</span> used to estimate <span class="kw">this</span> types <span class="kw">of</span> models</span>
<span id="cb3-3"><a></a>** see <span class="kw">help</span> <span class="kw">nl</span></span>
<span id="cb3-4"><a></a>** Be careful about Initial <span class="kw">values</span></span>
<span id="cb3-5"><a></a><span class="kw">nl</span> ( <span class="fu">y</span> = {b0=1} + {b1=1} * x ^ {b2=1})</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a>Iteration 0:  residual SS =   .854919</span>
<span id="cb3-8"><a></a>Iteration 1:  residual SS =  .7742535</span>
<span id="cb3-9"><a></a>Iteration 2:  residual SS =   .766106</span>
<span id="cb3-10"><a></a>Iteration 3:  residual SS =  .7660948</span>
<span id="cb3-11"><a></a>Iteration 4:  residual SS =  .7660947</span>
<span id="cb3-12"><a></a>Iteration 5:  residual SS =  .7660947</span>
<span id="cb3-13"><a></a>Iteration 6:  residual SS =  .7660947</span>
<span id="cb3-14"><a></a></span>
<span id="cb3-15"><a></a></span>
<span id="cb3-16"><a></a>      Source |      SS            df       MS</span>
<span id="cb3-17"><a></a>-------------+----------------------------------    Number <span class="kw">of</span> <span class="kw">obs</span> =        100</span>
<span id="cb3-18"><a></a>       Model |  1.2706842          2  .635342093    R-squared     =     0.6239</span>
<span id="cb3-19"><a></a>    Residual |  .76609469         97  .007897883    Adj R-squared =     0.6161</span>
<span id="cb3-20"><a></a>-------------+----------------------------------    Root MSE      =     .08887</span>
<span id="cb3-21"><a></a>       Total |  2.0367789         99  .020573524    Res. <span class="kw">dev</span>.     =  -203.3743</span>
<span id="cb3-22"><a></a></span>
<span id="cb3-23"><a></a>------------------------------------------------------------------------------</span>
<span id="cb3-24"><a></a>           <span class="fu">y</span> | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb3-25"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb3-26"><a></a>         /b0 |   1.064071   .0527608    20.17   0.000     .9593554    1.168786</span>
<span id="cb3-27"><a></a>         /b1 |   .4228891   .0477129     8.86   0.000     .3281923     .517586</span>
<span id="cb3-28"><a></a>         /b2 |   .5788057   .1599306     3.62   0.000     .2613878    .8962236</span>
<span id="cb3-29"><a></a>------------------------------------------------------------------------------</span>
<span id="cb3-30"><a></a>Note: Parameter b0 is used <span class="kw">as</span> a constant term during estimation.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So, you could now estimate many nonlinear models! (logits, probits, poissons, etc) or can you?</p>
</section>
<section id="nls-for-logit" class="slide level2 scrollable">
<h2>NLS for logit</h2>
<p>The model (as NLS)</p>
<p><span class="math display">\[
P(y=1|x) = \frac{exp(x\beta)}{1+exp(x\beta)}+e
\]</span></p>
<p>This guaranties the predicted value is between 0 and 1. But, still assumes errors are homoskedastic!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb4-2"><a></a><span class="kw">nl</span> (lfp = <span class="kw">logistic</span>({b0}+{b1:female age educ}))</span>
<span id="cb4-3"><a></a></span>
<span id="cb4-4"><a></a>      Source |      SS            df       MS</span>
<span id="cb4-5"><a></a>-------------+----------------------------------    Number <span class="kw">of</span> <span class="kw">obs</span> =      1,647</span>
<span id="cb4-6"><a></a>       Model |  1272.8283          4  318.207079    R-squared     =     0.8876</span>
<span id="cb4-7"><a></a>    Residual |  161.17168       1643  .098095973    Adj R-squared =     0.8873</span>
<span id="cb4-8"><a></a>-------------+----------------------------------    Root MSE      =   .3132028</span>
<span id="cb4-9"><a></a>       Total |       1434       1647  .870673953    Res. <span class="kw">dev</span>.     =   845.9593</span>
<span id="cb4-10"><a></a></span>
<span id="cb4-11"><a></a>------------------------------------------------------------------------------</span>
<span id="cb4-12"><a></a>         lfp | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb4-13"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb4-14"><a></a>         /b0 |   3.432866   .9601508     3.58   0.000     1.549617    5.316114</span>
<span id="cb4-15"><a></a>  /b1_female |  -3.056149   .8625563    -3.54   0.000    -4.747975   -1.364324</span>
<span id="cb4-16"><a></a>     /b1_age |  -.0205121   .0054815    -3.74   0.000    -.0312635   -.0097607</span>
<span id="cb4-17"><a></a>    /b1_educ |   .1522987   .0329513     4.62   0.000     .0876679    .2169296</span>
<span id="cb4-18"><a></a>------------------------------------------------------------------------------</span>
<span id="cb4-19"><a></a><span class="kw">logit</span> lfp female age educ</span>
<span id="cb4-20"><a></a></span>
<span id="cb4-21"><a></a></span>
<span id="cb4-22"><a></a>Logistic regression                                     Number <span class="kw">of</span> <span class="kw">obs</span> =  1,647</span>
<span id="cb4-23"><a></a>                                                        LR <span class="fu">chi2</span>(3)    = 251.69</span>
<span id="cb4-24"><a></a>                                                        Prob &gt; <span class="fu">chi2</span>   = 0.0000</span>
<span id="cb4-25"><a></a>Log likelihood = -508.42172                             Pseudo R2     = 0.1984</span>
<span id="cb4-26"><a></a></span>
<span id="cb4-27"><a></a>------------------------------------------------------------------------------</span>
<span id="cb4-28"><a></a>         lfp | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb4-29"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb4-30"><a></a>      female |   -3.21864    .365329    -8.81   0.000    -3.934672   -2.502609</span>
<span id="cb4-31"><a></a>         age |  -.0233149   .0072746    -3.20   0.001    -.0375729   -.0090569</span>
<span id="cb4-32"><a></a>        educ |   .1719904   .0411498     4.18   0.000     .0913383    .2526425</span>
<span id="cb4-33"><a></a>       <span class="dt">_cons</span> |   3.507185   .6550208     5.35   0.000     2.223367    4.791002</span>
<span id="cb4-34"><a></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="glm-and-interative-reweighted-ls-irls" class="slide level2">
<h2>GLM and Interative Reweighted LS (IRLS)</h2>
<p><strong>G</strong>eneralized <strong>L</strong>inear <strong>M</strong>odel are a natural extension to LR models. It changes how LR models are estimated.</p>
<ol type="1">
<li>Puts more emphasis in modeling the CEF (conditional mean) of the distribution</li>
<li>Allows for different transformations that relate the index <span class="math inline">\(xb\)</span> to <span class="math inline">\(E(y|x)\)</span> (<strong><em>links</em></strong>)</li>
<li>Considers data can come from different distributions. ( <strong><em>family</em></strong> )</li>
</ol>
<p><span class="math display">\[
E(y|X) = \eta ^{-1}(x\beta) ; Var(E(y|X)) = \sigma^2(x)
\]</span></p>
<p>For example:</p>
<p>Logit model: Family <span class="math inline">\(\rightarrow\)</span> binomial, Link function logistic function is logistic <span class="math inline">\(p(y|x) = \frac {e^{x\beta} }{1+e^{x\beta}} \rightarrow x\beta=log \left( \frac{p}{1-p} \right)\)</span></p>
<p>Family: Binomial, so variance is given by <span class="math inline">\(Var(y|X) = p(y|x)(1-p(y|x))\)</span></p>
</section>
<section id="how-does-this-change-estimation-nls" class="slide level2">
<h2>How does this change Estimation? NLS??</h2>

<img data-src="https://static.wikia.nocookie.net/dragonball/images/6/60/FusionDanceFinaleGotenTrunksBuuSaga.png" class="r-stretch quarto-figure-center"><p class="caption">Fusion</p></section>
<section id="how-does-this-change-estimation-nls-1" class="slide level2">
<h2>How does this change Estimation? NLS??</h2>
<p>Recall GLS?</p>
<ul>
<li><p>Heteroskedasticity was addressed by either using “weights” to estimate the model, or by transforming the data!</p></li>
<li><p>Here, when we choose a <strong>family</strong>, we are also choosing a particular source of heteroskedasticy. (Logit, probit, poisson, have very specific heteroskedastic errors)</p></li>
<li><p>Thus, you just need to apply NLS to transformed data!</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
SSR(\beta) = \sum \left( \frac{y-h(x,\beta)}{\sigma(x,\beta)} \right)^2 \\\
\tilde X = \frac{1}{\sigma(x,\beta)} \frac{\partial h(x,\beta)}{\partial \beta} ; \tilde y = \frac{y}{\sigma(x,\beta)} ; \tilde e=\frac{1}{\sigma(x,\beta)}(y-h(x,\beta))
\end{aligned}
\]</span></p>
</section>
<section id="how-does-this-change-estimation-nls-2" class="slide level2 scrollable">
<h2>How does this change Estimation? NLS??</h2>
<p>Then, just apply the iterative process we saw before, until it converges!</p>
<p><span class="math display">\[
\beta_t =\beta_{t-1}-(\tilde X'\tilde X)^{-1} (\tilde X' \tilde e)
\]</span></p>
<p>Then simply derive Standard errors from here.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb5-2"><a></a><span class="kw">nl</span> (lfp = <span class="kw">logistic</span>({b0}+{b1:female age educ}))   </span>
<span id="cb5-3"><a></a><span class="kw">logit</span> lfp female age educ</span>
<span id="cb5-4"><a></a></span>
<span id="cb5-5"><a></a>** IRSL</span>
<span id="cb5-6"><a></a><span class="kw">gen</span> one =1</span>
<span id="cb5-7"><a></a><span class="kw">mata</span></span>
<span id="cb5-8"><a></a><span class="fu">y</span> = st_data(.,<span class="st">"lfp"</span>)</span>
<span id="cb5-9"><a></a>x = st_data(.,<span class="st">"female age educ one"</span>)</span>
<span id="cb5-10"><a></a>b = 0\0\0\0</span>
<span id="cb5-11"><a></a> <span class="kw">end</span></span>
<span id="cb5-12"><a></a></span>
<span id="cb5-13"><a></a></span>
<span id="cb5-14"><a></a><span class="kw">mata</span>:</span>
<span id="cb5-15"><a></a>b0=999\999\999\999</span>
<span id="cb5-16"><a></a>bb=b'</span>
<span id="cb5-17"><a></a><span class="kw">while</span> (<span class="kw">sum</span>(<span class="fu">abs</span>(b0:-b))&gt; 0.000001 )  {</span>
<span id="cb5-18"><a></a>    b0=b    </span>
<span id="cb5-19"><a></a>    <span class="fu">yh</span> = <span class="kw">logistic</span>(x*b)</span>
<span id="cb5-20"><a></a>    err = <span class="fu">y</span>:-<span class="fu">yh</span></span>
<span id="cb5-21"><a></a>    se = <span class="fu">sqrt</span>(<span class="fu">yh</span>:*(1:-<span class="fu">yh</span>))</span>
<span id="cb5-22"><a></a>    wsx =  <span class="fu">yh</span>:*(1:-<span class="fu">yh</span>):*x:/se</span>
<span id="cb5-23"><a></a>    werr=  err:/se</span>
<span id="cb5-24"><a></a>    g = -<span class="kw">cross</span>(wsx,werr)</span>
<span id="cb5-25"><a></a>    <span class="kw">h</span> = <span class="kw">cross</span>(wsx,wsx)</span>
<span id="cb5-26"><a></a>    b = b:-<span class="fu">invsym</span>(<span class="kw">h</span>)*g;b'</span>
<span id="cb5-27"><a></a>    }</span>
<span id="cb5-28"><a></a>b,diagonal(<span class="kw">cross</span>(werr,werr)/1643*<span class="fu">invsym</span>(<span class="kw">h</span>)):^.5</span>
<span id="cb5-29"><a></a><span class="kw">end</span></span>
<span id="cb5-30"><a></a>    +-------------------------------+</span>
<span id="cb5-31"><a></a>  1 |  -3.218640936    .3458501096  |</span>
<span id="cb5-32"><a></a>  2 |  -.0233149268    .0068867539  |</span>
<span id="cb5-33"><a></a>  3 |   .1719904055    .0389557282  |</span>
<span id="cb5-34"><a></a>  4 |   3.507185231    .6200958697  |</span>
<span id="cb5-35"><a></a>  +-------------------------------+</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="glm-in-stata" class="slide level2 scrollable">
<h2>GLM in <code>Stata</code></h2>
<p>This one is easy as 🥧</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a></a><span class="kw">help</span> <span class="kw">glm</span></span>
<span id="cb6-2"><a></a>* see <span class="kw">for</span> advanced options <span class="kw">if</span> interested</span>
<span id="cb6-3"><a></a>* <span class="kw">syntax</span></span>
<span id="cb6-4"><a></a><span class="kw">glm</span> <span class="fu">y</span> x1 <span class="kw">x2</span> x3 , <span class="kw">family</span>( <span class="kw">family</span> ) <span class="kw">link</span>(<span class="kw">function</span>) method</span>
<span id="cb6-5"><a></a>frause oaxaca</span>
<span id="cb6-6"><a></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">probit</span>)</span>
<span id="cb6-7"><a></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">identity</span>)</span>
<span id="cb6-8"><a></a><span class="kw">glm</span> lfp female age educ, <span class="kw">family</span>(binomial)  <span class="kw">link</span>(<span class="kw">logit</span>)</span>
<span id="cb6-9"><a></a></span>
<span id="cb6-10"><a></a></span>
<span id="cb6-11"><a></a>Generalized linear models                         Number <span class="kw">of</span> <span class="kw">obs</span>   =      1,647</span>
<span id="cb6-12"><a></a>Optimization     : ML                             Residual df     =      1,643</span>
<span id="cb6-13"><a></a>                                                  Scale parameter =          1</span>
<span id="cb6-14"><a></a>Deviance         =   1016.84343                   (1/df) Deviance =   .6188944</span>
<span id="cb6-15"><a></a>Pearson          =  1472.464769                   (1/df) Pearson  =    .896205</span>
<span id="cb6-16"><a></a></span>
<span id="cb6-17"><a></a>Variance <span class="kw">function</span>: <span class="kw">V</span>(u) = u*(1-u)                 [Bernoulli]</span>
<span id="cb6-18"><a></a>Link <span class="kw">function</span>    : g(u) = <span class="fu">ln</span>(u/(1-u))             [Logit]</span>
<span id="cb6-19"><a></a></span>
<span id="cb6-20"><a></a>                                                  AIC             =   .6222486</span>
<span id="cb6-21"><a></a>Log likelihood   = -508.4217152                   BIC             =  -11152.38</span>
<span id="cb6-22"><a></a></span>
<span id="cb6-23"><a></a>------------------------------------------------------------------------------</span>
<span id="cb6-24"><a></a>             |                 OIM</span>
<span id="cb6-25"><a></a>         lfp | Coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb6-26"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb6-27"><a></a>      female |  -3.218641    .365329    -8.81   0.000    -3.934672   -2.502609</span>
<span id="cb6-28"><a></a>         age |  -.0233149   .0072746    -3.20   0.001    -.0375729   -.0090569</span>
<span id="cb6-29"><a></a>        educ |   .1719904   .0411498     4.18   0.000     .0913383    .2526425</span>
<span id="cb6-30"><a></a>       <span class="dt">_cons</span> |   3.507185   .6550209     5.35   0.000     2.223368    4.791002</span>
<span id="cb6-31"><a></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section>
<section id="going-full-ml" class="title-slide slide level1 center">
<h1>Going full ML</h1>
<p>(Maximum Likelihood not Machine Learning!)</p>
</section>
<section id="what-is-mle" class="slide level2">
<h2>What is MLE</h2>
<p><strong><em>MLE</em></strong> is an estimation method that allows you to find asymptotically efficient estimators of the parameters of interest <span class="math inline">\(\beta's\)</span>.</p>
<p>How?</p>
<blockquote>
<p>Under the assumption that you know something about the data conditional distribution, <strong><em>MLE</em></strong> will find the set of parameters that <em>maximizes the probability</em> (likelihood)that data “comes” from the chosen distribution.</p>
</blockquote>
<p>ok….but <strong>HOW</strong>???</p>
<p>Lets do this by example</p>
</section>
<section id="poisson-regression-via-mle" class="slide level2">
<h2>Poisson Regression via MLE</h2>
<p>Consider variable <span class="math inline">\(y={1,1,2,2,3,3,3,3,4,5}\)</span></p>
<p>And say, we assume it comes from a poisson distribution:</p>
<p><span class="math display">\[
p(y|\lambda) = \frac{e^{-\lambda} \lambda ^y}{y!}
\]</span></p>
<p>This function depends on the value of <span class="math inline">\(\lambda\)</span> .</p>
<ul>
<li><p>When <span class="math inline">\(\lambda\)</span> is known, this is the probability <span class="math inline">\(y=\#\)</span>, assuming a poisson distribution.</p></li>
<li><p>When <span class="math inline">\(\lambda\)</span> is unknown, this function (now <span class="math inline">\(f(y|\lambda)\)</span> gives the likelihood that we observe <span class="math inline">\(y=\#\)</span> , for any given <span class="math inline">\(\lambda\)</span>.</p></li>
</ul>
</section>
<section id="the-likelihood-of-lambda" class="slide level2">
<h2>The Likelihood of <span class="math inline">\(\lambda\)</span></h2>

<img data-src="resources/image-166804846.png" class="r-stretch"></section>
<section id="section" class="slide level2">
<h2></h2>
<ul>
<li><p>Previous figure only considers the <em>likelihood function</em> of a single observation. And every curve suggests its own parameter. (care to guess?)</p></li>
<li><p>What if we want one that Maximizes the likelihood of ALL observations at once!. For this we need to impose an additional assumption: <strong>Independent</strong> distribution.</p></li>
<li><p>This means that <strong>JOINT</strong> density is defined as:</p></li>
</ul>
<p><span class="math display">\[
L(\lambda|y_1,y_2,...,y_{10})=\prod f(y_i|\lambda)  
\]</span></p>
</section>
<section id="the-likelihood-of-lambda-1" class="slide level2">
<h2>The Likelihood of <span class="math inline">\(\lambda\)</span></h2>

<img data-src="resources/image-1678463398.png" class="r-stretch"></section>
<section id="what-mle-does" class="slide level2">
<h2>What MLE does</h2>
<p>What MLE does, then, is to find the parameter <span class="math inline">\(\lambda\)</span> that maximizes the Joint probability of observing the dataset <span class="math inline">\(Y\)</span>. Simple as that….</p>
<p>With one more difference. Because products are Hard, MLE aims to maximize the Log-Likelihood of observing the data:</p>
<p><span class="math display">\[
\begin{aligned}
LnL(\lambda|y_1,y_2,...,y_{10}) &amp;=\sum ln f(y_i|\lambda) \\\
&amp;= \sum (-\lambda + y_i ln(\lambda) - ln(y_i!))
\end{aligned}
\]</span></p>
<p>And just two more changes.</p>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<ol type="1">
<li>When you have <span class="math inline">\(X's\)</span>, you can further modify this model, to allow for covariates. For example:</li>
</ol>
<p><span class="math display">\[\lambda = e^{x\beta}
\]</span></p>
<p>Which guaranties the mean, or more specifically conditional mean <span class="math inline">\(\lambda = E(y|X)\)</span> , is positive.</p>
<ol start="2" type="1">
<li>We divide LnL by <span class="math inline">\(N\)</span>. (Number of observations)</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\beta = \min_\beta LnL(\beta|Y,X) \\
\beta = \min_\beta \frac{1}{N}\sum -e^{x'\beta}+y_i  x_i'\beta - ln(y_i!)
\end{aligned}
\]</span></p>
<p>Which arrives to the Same solution</p>
</section>
<section id="how-to-solve-this" class="slide level2">
<h2>How to solve this?</h2>
<p>We actually already covered this…We use Iterative methods!</p>
<p><span class="math display">\[
\begin{aligned}
LL &amp;=  \sum ln \ f(y|x,\beta) \\
FOC&amp;: \\
\frac{\partial LL}{\partial \beta}&amp;= \sum \frac{\partial ln \ f(y|x,\beta)}{\partial \beta} = \sum g_i=n E[g_i] =0 \\
SOC&amp;: \\
\frac{\partial^2 LL}{\partial \beta \partial \beta'}&amp;=
\sum\frac{\partial^2 ln f(y|x,\beta)}{\partial \beta \partial \beta'} =\sum H_i = n E(H_i)
\end{aligned}
\]</span></p>
<p>Thus, <span class="math inline">\(\beta's\)</span> can be estimated using the iterative process (or other more efficient process)</p>
<p><span class="math display">\[
\beta_t = \beta_{t-1} - E(H)^{-1} E(g_i)
\]</span></p>
</section>
<section id="why-do-we-like-mle" class="slide level2">
<h2>Why do we like MLE?</h2>
<p>Properties of MLE:</p>
<ul>
<li><p>The estimates are consistent <span class="math inline">\(plim \ \hat \theta = \theta\)</span></p></li>
<li><p>Its MLE estimates are asymptically normal <span class="math inline">\(\hat \theta\sim N(\theta,\sigma^2_\theta)\)</span></p></li>
<li><p>And asymptotically efficient (smallest variance)</p></li>
</ul>
<p>Wait…What about Variances? How do you estimate them!</p>
</section>
<section id="regularity-conditions-and-mle" class="slide level2">
<h2>Regularity Conditions and MLE ⚠️</h2>
<p>The variance of estimated coefficients has three estimators for its variance:</p>
<ol type="1">
<li>We can 🥪(Sandwich) the variance:</li>
</ol>
<p><span class="math display">\[
Var\left(N^{-1/2}(\hat\beta - \beta) \right) = H^{-1}g'gH^{-1} = A^{-1}BA^{-1}
\]</span></p>
<ol start="2" type="1">
<li>Or you can use one of the following: <span class="math display">\[
\begin{aligned}
Var\left(N^{-1/2}(\hat\beta - \beta) \right) &amp;= -H^{-1} \\
Var\left(N^{-1/2}(\hat\beta - \beta) \right) &amp;= \left(\frac{1}{N}\sum g_i g_i'\right)^{-1}
\end{aligned}
\]</span></li>
</ol>
<p>But if all is well (Regularity conditions), They are all equivalent. Otherwise Opt1 is similar to HC1, and Option 2a is closer to non-robust Standard Errors</p>
</section>
<section id="regularity-conditions" class="slide level2 scrollable">
<h2>Regularity Conditions ⚠️</h2>
<ol type="1">
<li>The LogLikelihood function is build on a well behaved distribution function. Which implies FOC:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\int f(y|\theta) dy &amp;=1 \\
\int \frac{\partial f(y|\theta)}{\partial \theta}dy&amp;=\int  \frac{\partial ln f(y|\theta)}{\partial \theta} f(y|\theta)=E(g_i)=0
\end{aligned}
\]</span></p>
<ol start="2" type="1">
<li>Order of Diff and Integration is interchangeable. We obtain SOC: <span class="math display">\[\begin{aligned}
\int \left( \frac{\partial^2 ln f(y|\theta)}{\partial \theta \partial \theta'}f(y|\theta) +
\frac{\partial ln f(y|\theta)}{\partial \theta} \frac{\partial ln f(y|\theta)}{\partial \theta'} f(y|\theta) \right)dy &amp;= 0 \\
E(H_i) = -E(g_ig_i')
\end{aligned}
\]</span></li>
</ol>
</section>
<section id="lr-as-mle" class="slide level2">
<h2>LR as MLE</h2>
<p>Under the assumption of normality, LR can be estimated using ML:</p>
<p><span class="math display">\[y_i = x_i'\beta + e_i \ | \ e_i\sim N(0,\sigma^2) \rightarrow y|x \sim N(x'\beta, \sigma^2)
\]</span></p>
<p>How does the MLE look? <span class="math display">\[
\begin{aligned}
L_i = f(y_i|x_i,\beta,\sigma^2) = \frac{1}{ \sqrt{2\pi \sigma^2 }} e^{-\frac{1}{2} \frac{ (y_i-x_i'\beta)^2}{\sigma^2} } \\
LL_i = -\frac{1}{2}\frac{(y_i-x_i'\beta)^2}{\sigma^2} - \frac{1}{2}ln(2\pi)-\frac{1}{2}ln(\sigma^2)
\end{aligned}
\]</span></p>
<p>Total LL?</p>
<p><span class="math display">\[
LL = -\frac{1}{2\sigma^2} \sum (y_i-x_i'\beta)^2-\frac{N ln(2\pi)}{2}-\frac{N}{2} ln(\sigma^2)
\]</span></p>
</section>
<section id="lr-as-mle-pii" class="slide level2">
<h2>LR as MLE PII</h2>
<p>FOC:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial LL}{\partial \beta} = -\frac{1}{\sigma^2}\sum x'(y_i-x'\beta)=0 \rightarrow \hat\beta=(X'X)^{-1}X'y \\
\frac{\partial LL}{\partial \sigma^2} = \frac{\sum e^2}{2\sigma^4}-\frac{N}{2\sigma^2}=0 \rightarrow \hat \sigma^2 = \frac{\sum e^2}{N}
\end{aligned}
\]</span></p>
<p>SOC:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial^2 LL}{\partial \beta \partial \beta'} = - \frac{X'X}{\sigma^2} ;
\frac{\partial^2 LL}{\partial \beta \partial \sigma} = - \frac{X'y-X'X\beta }{\sigma^2} \\
\frac{\partial^2 LL}{\partial \sigma \partial \beta'}=0;
\frac{\partial^2 LL}{\partial \sigma ^2}=-\frac{\sum e^2}{\sigma^6}+\frac{N}{2\sigma^4}=-\frac{N}{2\sigma^4}
\end{aligned}
\]</span></p>
</section>
<section id="soc" class="slide level2">
<h2>SOC</h2>
<p><span class="math display">\[
\begin{aligned}
H = \Bigg[\begin{matrix} -\frac{X'X}{\sigma^2}&amp; 0 \\
0 &amp; -\frac{N}{2\sigma^4}
\end{matrix} \Bigg] \\
&amp; \rightarrow Var(\beta,\sigma^2)=-H^{-1}=
\Bigg[\begin{matrix}
\sigma^2 (X'X)^{-1} &amp; 0 \\
0 &amp; \frac{2\sigma^4}{N}
\end{matrix} \Bigg]
\end{aligned}
\]</span></p>
</section>
<section id="other-considerations" class="slide level2">
<h2>Other considerations</h2>
<p>MLE is consistent if the model is correctly Specified.</p>
<p>This means that one correctly specifies the conditional distribution of <span class="math inline">\(y\)</span>.</p>
<ul>
<li>Often, its possible to especify the CEF, but specify the variance correctly, may be difficult</li>
</ul>
<p>Usually, this would be grounds of inconsistency. However if the distribution function is part of the exponential family (normal, bernulli, poisson, etc), one only needs to correctly specify the CEF correctly!</p>
<blockquote>
<p>In this case, the model is no longer estimated using MLE but QMLE</p>
</blockquote>
<p>In this cases, use Robust!</p>
</section>
<section id="mle-in-stata" class="slide level2">
<h2>MLE in <code>Stata</code></h2>
<p>Many <em>native commands</em> in <code>Stata</code> actually estimate models using MLE on the background.</p>
<ul>
<li>logit; probit; poisson; ologit; mlogit, etc</li>
</ul>
<p>Some multiple equation models as well.</p>
<ul>
<li><code>movestay</code> , <code>craggit</code> , <code>ky_fit</code></li>
</ul>
<p>Are just a few user written commands that also rely on MLE.</p>
<p>So how do you estimate this models?</p>
<p>you do it by hand!</p>
</section>
<section id="this-is-the-way" class="slide level2">
<h2>This is the way</h2>

<img data-src="resources/image-336726222.png" class="r-stretch"></section>
<section id="programming-mle" class="slide level2">
<h2>Programming MLE</h2>
<p><code>Stata</code> has one feature that would allow you to estimate almost any model via MLE. the -<strong><code>ml</code></strong>- suit.</p>
<p>This has many levels of programming (lf, d0, d1, d2, etc), but we will concentrate on the easiest one : lf (linear function)</p>
<ul>
<li>This only requires you to provide the individual level likelihood function!</li>
</ul>
<p>But how do we start?</p>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<p>You need three pieces of information:</p>
<ol type="1">
<li>Identify distribution or objective function to maximize.</li>
<li>Identify the parameters that the distribution depends on, and how will they be affected by characteristics</li>
<li>If more than one equation exists, Identify possible connections across variables</li>
<li>Wrap it all in a program</li>
</ol>
<p>For details on a few examples see <a href="https://www.stata-journal.com/article.html?article=st0520">Rios-Avila &amp; Canavire-Bacarreza 2018</a></p>
</section>
<section id="programming-mle-pi" class="slide level2 scrollable">
<h2>Programming MLE PI</h2>
<p>OLS via MLE:</p>
<blockquote>
<p><span class="math inline">\(y\)</span> distributes as normal distribution, which depends on the mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>. We assume that only the mean depends on <span class="math inline">\(X\)</span>.</p>
</blockquote>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a></a>** Define Program</span>
<span id="cb7-2"><a></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> my_ols</span>
<span id="cb7-3"><a></a><span class="kw">program</span> <span class="kw">define</span> my_ols</span>
<span id="cb7-4"><a></a>  <span class="kw">args</span> lnf <span class="co">///   &lt;- Stores the LL for obs i</span></span>
<span id="cb7-5"><a></a>       <span class="kw">xb</span>  <span class="co">///   &lt;- Captures the Linear combination of X's</span></span>
<span id="cb7-6"><a></a>       lnsigma <span class="co">// &lt;- captures the Log standard error</span></span>
<span id="cb7-7"><a></a>  ** Start creating <span class="ot">all</span> aux variables and lnf     </span>
<span id="cb7-8"><a></a>  <span class="kw">qui</span> {</span>
<span id="cb7-9"><a></a>    <span class="kw">tempvar</span> sigma <span class="co">// Temporary variable</span></span>
<span id="cb7-10"><a></a>    <span class="kw">gen</span> <span class="kw">double</span> <span class="ot">`sigma'</span> = <span class="fu">exp</span>(<span class="ot">`lnsigma'</span>)</span>
<span id="cb7-11"><a></a>    <span class="kw">tempvar</span> <span class="fu">y</span></span>
<span id="cb7-12"><a></a>    <span class="kw">local</span> <span class="fu">y</span> <span class="ot">$ML_y1</span></span>
<span id="cb7-13"><a></a>    <span class="kw">replace</span> <span class="ot">`lnf'</span>      = <span class="fu">log</span>( <span class="fu">normalden</span>(<span class="ot">`y'</span>,<span class="ot">`xb'</span>,<span class="ot">`sigma'</span> ) )</span>
<span id="cb7-14"><a></a>  }     </span>
<span id="cb7-15"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now Just Call on the program</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a></a>* <span class="kw">load</span> some <span class="kw">data</span></span>
<span id="cb8-2"><a></a>frause oaxaca, <span class="kw">clear</span></span>
<span id="cb8-3"><a></a><span class="kw">ml</span> <span class="kw">model</span> lf   <span class="co">/// Ask to use -ml- to estimate a model with method -lf-</span></span>
<span id="cb8-4"><a></a>   my_ols     <span class="co">/// your ML program</span></span>
<span id="cb8-5"><a></a>   (<span class="kw">xb</span>: lnwage = age educ female  ) <span class="co">/// 1st Eq (only one in this case)</span></span>
<span id="cb8-6"><a></a>   (lnsig: = female ) <span class="co">// Empty, (no other Y, but could add X's)</span></span>
<span id="cb8-7"><a></a>   <span class="co">// I could haave added weights, or IF conditions</span></span>
<span id="cb8-8"><a></a><span class="kw">ml</span> check     <span class="co">// checks if the code is correct</span></span>
<span id="cb8-9"><a></a><span class="kw">ml</span> <span class="kw">maximize</span>  <span class="co">// maximizes</span></span>
<span id="cb8-10"><a></a><span class="kw">ml</span> <span class="kw">display</span>   <span class="co">// shows results</span></span>
<span id="cb8-11"><a></a></span>
<span id="cb8-12"><a></a>* Short <span class="kw">version</span> </span>
<span id="cb8-13"><a></a><span class="kw">ml</span> <span class="kw">model</span> lf  my_ols <span class="co">/// Model and method</span></span>
<span id="cb8-14"><a></a>   (<span class="kw">xb</span>: lnwage = age educ female) (lnsig: = female ) <span class="co">/// model Parms</span></span>
<span id="cb8-15"><a></a>   , <span class="kw">robust</span> <span class="kw">maximize</span> <span class="co">// Other SE options, and maximize</span></span>
<span id="cb8-16"><a></a>   </span>
<span id="cb8-17"><a></a></span>
<span id="cb8-18"><a></a><span class="kw">ml</span> <span class="kw">display</span></span>
<span id="cb8-19"><a></a></span>
<span id="cb8-20"><a></a>                                                        Number <span class="kw">of</span> <span class="kw">obs</span> =  1,434</span>
<span id="cb8-21"><a></a>                                                        Wald <span class="fu">chi2</span>(3)  = 393.05</span>
<span id="cb8-22"><a></a>Log pseudolikelihood = -870.41117                       Prob &gt; <span class="fu">chi2</span>   = 0.0000</span>
<span id="cb8-23"><a></a></span>
<span id="cb8-24"><a></a>------------------------------------------------------------------------------</span>
<span id="cb8-25"><a></a>             |               Robust</span>
<span id="cb8-26"><a></a>      lnwage | Coefficient  <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb8-27"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-28"><a></a><span class="kw">xb</span>           |</span>
<span id="cb8-29"><a></a>         age |   .0177272   .0012221    14.51   0.000      .015332    .0201224</span>
<span id="cb8-30"><a></a>        educ |   .0685501   .0056712    12.09   0.000     .0574347    .0796655</span>
<span id="cb8-31"><a></a>      female |  -.1487184   .0247333    -6.01   0.000    -.1971948   -.1002421</span>
<span id="cb8-32"><a></a>       <span class="dt">_cons</span> |   1.949072   .0888074    21.95   0.000     1.775012    2.123131</span>
<span id="cb8-33"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-34"><a></a>lnsig        |</span>
<span id="cb8-35"><a></a>      female |   .3440266   .0691673     4.97   0.000     .2084611     .479592</span>
<span id="cb8-36"><a></a>       <span class="dt">_cons</span> |  -.9758137   .0488944   -19.96   0.000    -1.071645   -.8799825</span>
<span id="cb8-37"><a></a>------------------------------------------------------------------------------</span>
<span id="cb8-38"><a></a></span>
<span id="cb8-39"><a></a>. <span class="kw">reg</span>  lnwage age educ female</span>
<span id="cb8-40"><a></a></span>
<span id="cb8-41"><a></a>      Source |       SS           df       MS      Number <span class="kw">of</span> <span class="kw">obs</span>   =     1,434</span>
<span id="cb8-42"><a></a>-------------+----------------------------------   <span class="fu">F</span>(3, 1430)      =    167.12</span>
<span id="cb8-43"><a></a>       Model |  104.907056         3  34.9690188   Prob &gt; <span class="fu">F</span>        =    0.0000</span>
<span id="cb8-44"><a></a>    Residual |  299.212747     1,430  .209239683   R-squared       =    0.2596</span>
<span id="cb8-45"><a></a>-------------+----------------------------------   Adj R-squared   =    0.2580</span>
<span id="cb8-46"><a></a>       Total |  404.119804     1,433  .282009633   Root MSE        =    .45743</span>
<span id="cb8-47"><a></a></span>
<span id="cb8-48"><a></a>------------------------------------------------------------------------------</span>
<span id="cb8-49"><a></a>      lnwage | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]</span>
<span id="cb8-50"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb8-51"><a></a>         age |   .0161424   .0010978    14.70   0.000      .013989    .0182959</span>
<span id="cb8-52"><a></a>        educ |   .0719322   .0050365    14.28   0.000     .0620524     .081812</span>
<span id="cb8-53"><a></a>      female |  -.1453936   .0243888    -5.96   0.000    -.1932352    -.097552</span>
<span id="cb8-54"><a></a>       <span class="dt">_cons</span> |   1.970021   .0725757    27.14   0.000     1.827654    2.112387</span>
<span id="cb8-55"><a></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="other-considerations-1" class="slide level2">
<h2>Other Considerations</h2>
<p>With MLE, as with logit probit tobit, etc, you cannot interpret the models directly!</p>
<p>Then what?</p>
<ol type="1">
<li><p>Identify what is the Statistic of interest (most of the time its the expected value, conditional mean, or predicted mean). But others may be something related to other parameters (we care about <span class="math inline">\(\sigma\)</span> not <span class="math inline">\(ln \ \sigma\)</span>).</p>
<p>See <code>margins</code>, and option <code>expression</code></p></li>
<li><p>Identify if you are interested in Average effects, or effects at the average.</p></li>
<li><p>Some times, you may need to use your own predictions!</p></li>
</ol>
<p>see <a href="https://friosavila.github.io/playingwithstata/main_mlprobit.html">example for probit</a></p>
</section>
<section id="margins-in-action" class="slide level2 scrollable">
<h2>Margins in action</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a></a>**Estimate Logit <span class="kw">model</span></span>
<span id="cb9-2"><a></a><span class="kw">logit</span> lfp educ female age married divorced</span>
<span id="cb9-3"><a></a>** <span class="kw">use</span> margins to estimate predicted probability</span>
<span id="cb9-4"><a></a>margins</span>
<span id="cb9-5"><a></a>** <span class="kw">or</span> <span class="kw">use</span> expression</span>
<span id="cb9-6"><a></a>margins, expression(<span class="fu">exp</span>(<span class="kw">xb</span>())/(1+<span class="fu">exp</span>(<span class="kw">xb</span>())))</span>
<span id="cb9-7"><a></a></span>
<span id="cb9-8"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-9"><a></a>             |            Delta-method</span>
<span id="cb9-10"><a></a>             |     Margin   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-11"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-12"><a></a>       <span class="dt">_cons</span> |    .870674   .0071023   122.59   0.000     .8567537    .8845942</span>
<span id="cb9-13"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-14"><a></a></span>
<span id="cb9-15"><a></a>** marginal <span class="kw">effects</span></span>
<span id="cb9-16"><a></a>margins, <span class="kw">dydx</span>(educ) </span>
<span id="cb9-17"><a></a></span>
<span id="cb9-18"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-19"><a></a>             |            Delta-method</span>
<span id="cb9-20"><a></a>             |      dy/dx   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-21"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-22"><a></a>        educ |   .0161004   .0037127     4.34   0.000     .0088236    .0233772</span>
<span id="cb9-23"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-24"><a></a></span>
<span id="cb9-25"><a></a></span>
<span id="cb9-26"><a></a>** Marginal effect <span class="kw">of</span> the marginal effect?</span>
<span id="cb9-27"><a></a>margins, expression( <span class="kw">logistic</span>(<span class="kw">xb</span>())*(1-<span class="kw">logistic</span>(<span class="kw">xb</span>()))*_b[educ] )</span>
<span id="cb9-28"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-29"><a></a>             |            Delta-method</span>
<span id="cb9-30"><a></a>             |     Margin   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-31"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-32"><a></a>       <span class="dt">_cons</span> |   .0161004   .0037127     4.34   0.000     .0088236    .0233772</span>
<span id="cb9-33"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-34"><a></a>margins, <span class="kw">dydx</span>(*) expression( <span class="kw">logistic</span>(<span class="kw">xb</span>())*(1-<span class="kw">logistic</span>(<span class="kw">xb</span>()))*_b[educ] )</span>
<span id="cb9-35"><a></a></span>
<span id="cb9-36"><a></a>------------------------------------------------------------------------------</span>
<span id="cb9-37"><a></a>             |            Delta-method</span>
<span id="cb9-38"><a></a>             |      dy/dx   <span class="fu">std</span>. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb9-39"><a></a></span>
<span id="cb9-40"><a></a>-------------+----------------------------------------------------------------</span>
<span id="cb9-41"><a></a>        educ |  -.0010759   .0004973    -2.16   0.031    -.0020507   -.0001012</span>
<span id="cb9-42"><a></a>    1.female |   .0246023   .0054734     4.49   0.000     .0138747    .0353299</span>
<span id="cb9-43"><a></a>         age |   5.41e-06   .0000502     0.11   0.914     -.000093    .0001039</span>
<span id="cb9-44"><a></a>   1.married |    .021062    .004861     4.33   0.000     .0115346    .0305893</span>
<span id="cb9-45"><a></a>  1.divorced |   .0037604   .0013899     2.71   0.007     .0010362    .0064846</span>
<span id="cb9-46"><a></a>------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="going-beyond" class="slide level2">
<h2>Going Beyond?</h2>
<p>MLE can also be used in more Advanced models.</p>
<ol type="1">
<li><p>Multi equation model that may or may not depend on each other.</p>
<p>For example, Oaxaca-Blinder Decomposition, requires using Multiple Equations</p>
<p>IV - CF, or IV TSLS are also multi equation models but which depend on each other.</p></li>
<li><p>One could also estimate nonlinear versions of Standard models. For example Nonlinear Tobit model (See Ransom 1987)</p></li>
<li><p>Estimation of latent groups of finite mixture models . This combine models that are otherwise unobserved (See Kapteyn and Ypma 2007)</p></li>
</ol>
<p>Basically, if you can figure out <span class="math inline">\(f(.)\)</span>’s and how are they connected, you can estimate any model via MLE (with few exceptions)</p>
</section></section>
<section id="done" class="title-slide slide level1 center">
<h1>Done!</h1>
<p>Next, we start with Causal effects Strategies. First the gold Standard RCT</p>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>