<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">

<title>Econometrics MSC Levy - Unconditional Quantile Regressions (and RIF’s)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../adv_class.html" rel="" target="">
 <span class="menu-text">Adv Methods and Causal Effects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rmethods/index.html" rel="" target="">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../rm2_return.html" rel="" target="">
 <span class="menu-text">Research Methods II: Applied Methods</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-math-refresher" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Math Refresher</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-math-refresher">    
        <li>
    <a class="dropdown-item" href="../mathref/math_1.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Calculus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_2.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Linear Algebra</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../mathref/math_3.html" rel="" target="">
 <span class="dropdown-text">Math Refresher: Basic Statistics and Probability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#eqyx-is-not-qy" id="toc-eqyx-is-not-qy" class="nav-link" data-scroll-target="#eqyx-is-not-qy">E(q(y|X)) is not Q(y)</a></li>
  <li><a href="#waitwhat-do-we-mean-unconditional" id="toc-waitwhat-do-we-mean-unconditional" class="nav-link" data-scroll-target="#waitwhat-do-we-mean-unconditional">⌚Wait…What do we mean unconditional?</a></li>
  <li><a href="#from-condition-on-individuals" id="toc-from-condition-on-individuals" class="nav-link" data-scroll-target="#from-condition-on-individuals">From Condition on Individuals,</a>
  <ul class="collapse">
  <li><a href="#to-conditioning-on-distributions" id="toc-to-conditioning-on-distributions" class="nav-link" data-scroll-target="#to-conditioning-on-distributions">to conditioning on Distributions</a></li>
  </ul></li>
  <li><a href="#how-are-unconditional-effects-estimated" id="toc-how-are-unconditional-effects-estimated" class="nav-link" data-scroll-target="#how-are-unconditional-effects-estimated">How are Unconditional effects Estimated?</a></li>
  <li><a href="#introducing-controls" id="toc-introducing-controls" class="nav-link" data-scroll-target="#introducing-controls">Introducing controls</a></li>
  <li><a href="#or-a-bit-more-general" id="toc-or-a-bit-more-general" class="nav-link" data-scroll-target="#or-a-bit-more-general">Or a bit more General</a></li>
  <li><a href="#againhow-are-unconditional-effects-estimated" id="toc-againhow-are-unconditional-effects-estimated" class="nav-link" data-scroll-target="#againhow-are-unconditional-effects-estimated">Again…How are Unconditional effects Estimated?</a></li>
  <li><a href="#op1-re-weighting" id="toc-op1-re-weighting" class="nav-link" data-scroll-target="#op1-re-weighting">Op1: Re-weighting</a></li>
  <li><a href="#op1-re-weighting-1" id="toc-op1-re-weighting-1" class="nav-link" data-scroll-target="#op1-re-weighting-1">Op1: Re-weighting</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#op2-model-conditional-distribution" id="toc-op2-model-conditional-distribution" class="nav-link" data-scroll-target="#op2-model-conditional-distribution">Op2: Model Conditional Distribution</a></li>
  <li><a href="#example-1-hetregress" id="toc-example-1-hetregress" class="nav-link" data-scroll-target="#example-1-hetregress">Example #1: Hetregress</a></li>
  <li><a href="#example-2-qregress" id="toc-example-2-qregress" class="nav-link" data-scroll-target="#example-2-qregress">Example #2: Qregress</a></li>
  <li><a href="#opt-1-and-2-comments" id="toc-opt-1-and-2-comments" class="nav-link" data-scroll-target="#opt-1-and-2-comments">Opt 1 and 2: Comments</a></li>
  <li><a href="#opt-3.-local-approximation-rif-regression" id="toc-opt-3.-local-approximation-rif-regression" class="nav-link" data-scroll-target="#opt-3.-local-approximation-rif-regression">Opt 3. Local Approximation: RIF regression</a></li>
  <li><a href="#opt-3.-from-ground-up" id="toc-opt-3.-from-ground-up" class="nav-link" data-scroll-target="#opt-3.-from-ground-up">Opt 3. From ground up</a></li>
  <li><a href="#opt-3.-one-more-thing" id="toc-opt-3.-one-more-thing" class="nav-link" data-scroll-target="#opt-3.-one-more-thing">Opt 3. One more thing</a></li>
  <li><a href="#opt-3.-rif-regression" id="toc-opt-3.-rif-regression" class="nav-link" data-scroll-target="#opt-3.-rif-regression">Opt 3. RIF Regression</a></li>
  <li><a href="#why-it-works-and-why-it-may-not" id="toc-why-it-works-and-why-it-may-not" class="nav-link" data-scroll-target="#why-it-works-and-why-it-may-not">Why it works, and why it may not</a></li>
  <li><a href="#rif-reg-and-dummies" id="toc-rif-reg-and-dummies" class="nav-link" data-scroll-target="#rif-reg-and-dummies">RIF-Reg and dummies</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a></li>
  <li><a href="#how-do-they-compare" id="toc-how-do-they-compare" class="nav-link" data-scroll-target="#how-do-they-compare">How Do they Compare</a></li>
  <li><a href="#other-considerations" id="toc-other-considerations" class="nav-link" data-scroll-target="#other-considerations">Other Considerations</a></li>
  <li><a href="#final-words-on-rif" id="toc-final-words-on-rif" class="nav-link" data-scroll-target="#final-words-on-rif">Final words on RIF</a></li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">NEXT</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="05uqreg.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="05uqreg.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Unconditional Quantile Regressions (and RIF’s)</h1>
<p class="subtitle lead">When we care about everyone</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fernando Rios-Avila </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>As we saw last class, conditional quantile regressions have only one purpose:</p>
<ul>
<li>Analyze relationships between conditional distributions.</li>
</ul>
<p>This is a very useful tool!. As it allows you to move beyond Average relationships.</p>
<ul>
<li>How do people (who are not all average) would be affected by changes in <span class="math inline">\(Xs\)</span></li>
</ul>
<p>There is a limitation, however. The effects you may estimate, will depend strongly on model specification.</p>
<ul>
<li>This is similar to OVB. Changing covariates could drastically change the conditional distributions and associated coefficients</li>
</ul>
<p>What if, you are interested in distributional effects across the whole population! Not only a subsample?</p>
</section>
<section id="eqyx-is-not-qy" class="level2">
<h2 class="anchored" data-anchor-id="eqyx-is-not-qy">E(q(y|X)) is not Q(y)</h2>
<p>One common mistake one makes when analyzing QRegressions is to make interpretations as if the average effects on the <span class="math inline">\(qth\)</span> conditional quantiles would be the same as the effect on the “overall” <span class="math inline">\(qth\)</span> quantile.</p>
<p>Except for few cases (when Quantile regressions are not relevant), CQ effects do not translate <strong><em>directly</em></strong> into Changes into the unconditional quantile.</p>
<p>However, as a policy maker, this would be the most relevant estimand you may be interested in :</p>
<ul>
<li><p>How does improving education affect inequality?</p></li>
<li><p>Would eliminating Unionization would increase wage inequality?</p></li>
<li><p>Is there heterogeneity in consumption expenditure?</p></li>
</ul>
<p>However, going from Conditional to unconditional statistics (not only Q) is not always straight forward.</p>
</section>
<section id="waitwhat-do-we-mean-unconditional" class="level2">
<h2 class="anchored" data-anchor-id="waitwhat-do-we-mean-unconditional">⌚Wait…What do we mean unconditional?</h2>
<p>One of the questions I read a lot regarding UQR is what do we mean unconditional?</p>
<ul>
<li><p>This is perhaps a someone poor choice of words.</p></li>
<li><p>Anytime we estimate <strong>ANY</strong> statistic, we condition on something.</p>
<ul>
<li><p>We condition on all individual characteristics (including errors)</p></li>
<li><p>We condition on groups characteristics (CQREG and CEF)</p></li>
<li><p>or, We condition on all characteristics (distributions). We happen to call this, unconditional statistics.</p></li>
</ul></li>
<li><p>This, however, <strong><em>does</em></strong> make a big difference in interpretation.</p></li>
</ul>
</section>
<section id="from-condition-on-individuals" class="level2">
<h2 class="anchored" data-anchor-id="from-condition-on-individuals">From Condition on Individuals,</h2>
<section id="to-conditioning-on-distributions" class="level3">
<h3 class="anchored" data-anchor-id="to-conditioning-on-distributions">to conditioning on Distributions</h3>
<p><span class="math display">\[\begin{aligned}
y_i &amp;= b_0 + b_1 x_i + e_i + x_i e_i \\
\frac{dy_i}{dx_i}&amp;=b_1 + e_i \\
E(y_i|x_i=x) &amp;= b_0 + b_1 x  \\
\frac{dE(y_i|x)}{dx}&amp;=b_1 \\
E(E(y_i|x_i=x))=E(y_i) &amp;= b_0 + b_1 E(x_i)    \\
\frac{dE(y_i)}{dE(x_i)}&amp;=b_1
\end{aligned}
\]</span></p>
<p>Same effects, but different interpretations (specially last one)</p>
</section>
</section>
<section id="how-are-unconditional-effects-estimated" class="level2">
<h2 class="anchored" data-anchor-id="how-are-unconditional-effects-estimated">How are Unconditional effects Estimated?</h2>
<p>Consider any distributional statistic <span class="math inline">\(v\)</span>, which takes as arguments, all observations, density distributions <span class="math inline">\(f()\)</span>, or cumulative distributions <span class="math inline">\(F()\)</span>.</p>
<p><span class="math display">\[
v = v(F_y) \ or \ v(f_y) \ or \ v(y_1, y_2, ...,y_n)
\]</span></p>
<p>And to simplify notation, lets say this function is defined as follows:</p>
<p><span class="math display">\[
v(f_y) = \int_{-\infty}^\infty h(y,\theta) f(y)dy
\]</span></p>
<p>This simply considers distributional statistics <span class="math inline">\(v\)</span> that can be estimated by simply integrating a transformation of <span class="math inline">\(h(y,\theta)\)</span> given a set of parameters <span class="math inline">\(\theta\)</span>.</p>
<p>But for now, lets consider only the Identify function <span class="math inline">\(h(y,\theta)=y\)</span></p>
<p>but…What about Controls??</p>
</section>
<section id="introducing-controls" class="level2">
<h2 class="anchored" data-anchor-id="introducing-controls">Introducing controls</h2>
<p>Assume there is a joint distribution of function <span class="math inline">\(f(y,x)\)</span>, then</p>
<p><span class="math display">\[
\begin{aligned}
f(y,x)&amp;=f(y|x)f(x) \\
f(y) &amp;= \int f(y|x) f(x) dx
\end{aligned}
\]</span></p>
<p>And all together:</p>
<p><span class="math display">\[
\begin{aligned}
v(f_y) &amp;= \int y \int f(y|x) f(x) dx \ dy \\
v(f_y) &amp;= \iint y f(y|x) dy \ f(x) dx  \\
v(f_y) &amp;= \int  E(y|X) f(x) dx  \\
\end{aligned}
\]</span></p>
</section>
<section id="or-a-bit-more-general" class="level2">
<h2 class="anchored" data-anchor-id="or-a-bit-more-general">Or a bit more General</h2>
<p><span class="math display">\[
v(f_y) = \iint h(y,\theta) f(y|x)f(x)dxdy
\]</span></p>
<p>So, the statistic <span class="math inline">\(v\)</span> will change if:</p>
<p>- We change the function <span class="math inline">\(h\)</span> or its parameters <span class="math inline">\(\theta\)</span>.</p>
<p>- Assume some shocks that change the conditional <span class="math inline">\(f(y|x)\)</span></p>
<p>- or the distribution of characteristics change!</p>
<p>Note: <span class="math display">\[f(y|x) \sim \beta \text{ and }
f(x) \sim x
\]</span></p>
</section>
<section id="againhow-are-unconditional-effects-estimated" class="level2">
<h2 class="anchored" data-anchor-id="againhow-are-unconditional-effects-estimated">Again…How are Unconditional effects Estimated?</h2>
<p>In an ideal scenario, you simple get the data under to regimes (before and after changes in <span class="math inline">\(x\)</span>), and do the following:</p>
<p><span class="math display">\[\Delta v = v(f'_y)-v(f_y)
\]</span></p>
<p>That is, just estimate the statistic in two scenarios (<span class="math inline">\(f'\)</span> and <span class="math inline">\(f\)</span>), and calculate the difference. (impossible!)</p>
<p>But there are (at least) three alternatives:</p>
<ol type="1">
<li>Using Reweighting approaches to “reshape” the data: <span class="math inline">\(f(x)\)</span> (non-parametric)</li>
<li>Identify <span class="math inline">\(f(y|x)\)</span> so one can simulate how <span class="math inline">\(\Delta X\)</span> affect y</li>
<li>Focus on the statistic <span class="math inline">\(v\)</span> and indirectly identify the effects of interest. (RIF!)</li>
</ol>
</section>
<section id="op1-re-weighting" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="op1-re-weighting">Op1: Re-weighting</h2>
<p>Consider the following. there is a policy such that you plan to improve education in a country. Every single person will have at least 7 years of education, and will have free access to two additional years of education if they want to.</p>
<p>In other words, characteristics change from <span class="math inline">\(f(x) \rightarrow g(x)\)</span> . But you do not see this! <span class="math display">\[ v(g_y) = \iint h(y,\theta) f(y|x) \color{red}{g(x)}dxdy \]</span></p>
<p>but perhaps, we could see this:</p>
<p><span class="math display">\[\hat v(g_y) = \iint h(y,\theta) f(y|x) \color{red}{\hat w(x)}f(x) dxdy
\]</span></p>
<p>if we can come up with a set of weights <span class="math inline">\(\color{red}{\hat w(x)}\)</span> such that <span class="math inline">\(f(x)\hat w(x)=g(x)\)</span></p>
<p><span class="math display">\[
\hat w(x) = \frac{\hat g(x)}{\hat f(x)}
\]</span></p>
</section>
<section id="op1-re-weighting-1" class="level2">
<h2 class="anchored" data-anchor-id="op1-re-weighting-1">Op1: Re-weighting</h2>
<p>Simple, yet hard. Estimation of multivariate densities can be a difficult task. So assume the following</p>
<p><span class="math display">\[
f(x) = h(x|s=0) ; g(x) = h(x|s=1)
\]</span></p>
<p>This makes things “easier”.</p>
<ol type="1">
<li>Bayes: <span class="math display">\[
\begin{aligned}
h(x|s=k) &amp;= \frac{h(x)p(s=k|x)}{p(s=k)} \\
\hat w(x)  
     &amp;= \frac{h(x)p(s=1|x)}{h(x)p(s=0|x)}\frac{p(s=0)}{p(s=1)} \\
     &amp;=\frac{p(s|x)}{1-p(s|x)} \frac{1-p(s)}{p(s)}
\end{aligned}
\]</span></li>
</ol>
<p>Easier to estimate conditional probabilities, (logit probit or other) than Densities</p>
</section>
<section id="example" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example">Example</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>. *** UQR</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>. *** Reweighting</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>. <span class="kw">webuse</span> dui, <span class="kw">clear</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>(Fictional <span class="kw">data</span> <span class="kw">on</span> <span class="fu">monthly</span> drunk driving citations)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>. ** Create Fake Sample</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>. <span class="kw">gen</span> id = <span class="dt">_n</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>. expand 2</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>(500 observations created)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>. <span class="kw">bysort</span> id:<span class="kw">gen</span> smp = <span class="dt">_n</span> ==2</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>. ** Now you have <span class="kw">two</span> <span class="kw">of</span> ever person. So lets <span class="kw">do</span> some Policy</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>. ** Fines increase <span class="fu">lower</span> fines <span class="kw">more</span> than higher ones, up to 12</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>. <span class="kw">replace</span> fines = 0.1*(12-fines)+fines <span class="kw">if</span> smp==1</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>(498 <span class="fu">real</span> changes made)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>. ** Estimate <span class="kw">logit</span> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>. <span class="kw">logit</span> smp c.fines##c.fines taxes i.csize college</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>Iteration 0:   <span class="fu">log</span> likelihood = -693.14718  </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>Iteration 1:   <span class="fu">log</span> likelihood = -680.74735  </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>Iteration 2:   <span class="fu">log</span> likelihood = -680.68931  </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>Iteration 3:   <span class="fu">log</span> likelihood = -680.68931  </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>Logistic regression                                     Number <span class="kw">of</span> <span class="kw">obs</span> =  1,000</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                                                        LR <span class="fu">chi2</span>(6)    =  24.92</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                                                        Prob &gt; <span class="fu">chi2</span>   = 0.0004</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>Log likelihood = -680.68931                             Pseudo R2     = 0.0180</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>---------------------------------------------------------------------------------</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            smp | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>----------------+----------------------------------------------------------------</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>          fines |   4.231032   1.762476     2.40   0.016     .7766421    7.685422</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                |</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>c.fines#c.fines |  -.1923691   .0877831    -2.19   0.028    -.3644209   -.0203173</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                |</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>          taxes |     .00044   .1407545     0.00   0.998    -.2754338    .2763139</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                |</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>          csize |</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        Medium  |   .0549913    .161242     0.34   0.733    -.2610373    .3710198</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>         Large  |   .0399068   .1526637     0.26   0.794    -.2593086    .3391222</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                |</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        college |  -.0218305   .1488361    -0.15   0.883    -.3135439    .2698829</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>          <span class="dt">_cons</span> |  -22.99551   8.826624    -2.61   0.009    -40.29537   -5.695646</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>---------------------------------------------------------------------------------</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>. <span class="kw">predict</span> pr_smp</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>(option pr assumed; Pr(smp))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>. <span class="kw">gen</span> wgt = pr_smp / (1-pr_smp) </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>. <span class="kw">replace</span> wgt = 1 <span class="kw">if</span> smp==0</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>(500 <span class="fu">real</span> changes made)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>.  <span class="kw">xi</span>:<span class="kw">tabstat</span> fines i.csize college  taxes [<span class="fu">w</span>=wgt],  <span class="kw">by</span>(smp)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>i.csize           _Icsize_1-3         (naturally coded; _Icsize_1 omitted)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>(analytic weights assumed)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>Summary <span class="kw">statistics</span>: Mean</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>Group <span class="kw">variable</span>: smp </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>     smp |     fines  _Icsiz~2  _Icsiz~3   college     taxes</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>---------+--------------------------------------------------</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>       0 |    9.8952       .29      .358      .248      .704</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>       1 |  10.24873  .2926133  .3584506  .2474627  .7045357</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>---------+--------------------------------------------------</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>   Total |  10.07894  .2913582  .3582342  .2477208  .7042784</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> (<span class="kw">kdensity</span> citations <span class="kw">if</span> smp==0 ) <span class="co">///</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">kdensity</span> citations <span class="kw">if</span> smp==1 [<span class="fu">w</span>=wgt]) <span class="co">/// </span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    , <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Before Policy"</span> 2 <span class="st">"After Policy"</span>))</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> citations [<span class="fu">w</span>=wgt], <span class="kw">by</span>(smp) <span class="kw">stats</span>(p10 p25 p50 <span class="kw">mean</span> p75 p90  )</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>(analytic weights assumed)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>Summary <span class="kw">for</span> variables: citations</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>Group <span class="kw">variable</span>: smp </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>     smp |       p10       p25       p50      Mean       p75       p90</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>---------+------------------------------------------------------------</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>       0 |      11.5        15        20    22.018        27      34.5</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>       1 |        11        15        19  20.69419        26        32</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>---------+------------------------------------------------------------</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>   Total |        11        15        20  21.32998        27        33</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------------</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Increasing fines, may reduce citations in about 1.3., but have almost no effect at the bottom of the distribution.</p>
<p>What about Standard errors? Bootstrap! (logit and estimation, probably clustering at individual level)</p>
<p>Easy to extend to other Statistics, but, can only provide results “within” support.</p>
</section>
<section id="op2-model-conditional-distribution" class="level2">
<h2 class="anchored" data-anchor-id="op2-model-conditional-distribution">Op2: Model Conditional Distribution</h2>
<p>Say that you are interested in the same Policy, but do not trust re-weighting. Instead you want to model the Outcome, using some parametric or nonparametric analysis</p>
<ol type="1">
<li>Define your model. Should be feasible enough to accommodate changes in the conditional distribution. (one “model” for each <span class="math inline">\(X's\)</span> combination?)</li>
<li>Use the model to make predictions of your outcome (quite a few times). and summarize all results.</li>
</ol>
<p>Options for flexible mode?</p>
<ul>
<li><p>You can use Heteroskedastic OLS <span class="math inline">\(y\sim N(x\beta,x\gamma)\)</span> and predict from here</p></li>
<li><p>You can use CQregressions to simulate the results.</p></li>
</ul>
<p>One of this is similar to what we do in simulation analysis, and imputation. The other is similar to the work of <a href="https://onlinelibrary.wiley.com/doi/10.1002/jae.788">Machado Mata (2005)</a> and <a href="https://www.sciencedirect.com/science/article/pii/S0927537105000382">Melly(2005)</a>. Where you invert the whole distribution “globally”</p>
</section>
<section id="example-1-hetregress" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-1-hetregress">Example #1: Hetregress</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>** Example <span class="kw">for</span> OPT2</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> dui, <span class="kw">clear</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>** Modeling OLS with heteroskedastic errors</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    hetregress citations fines i.csize college taxes ,  het(fines i.csize college taxes )</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>   citations | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>citations    |</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>       fines |   -6.18443   .3018298   -20.49   0.000    -6.776006   -5.592855</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>       csize |</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>     Medium  |   4.683941   .5028377     9.32   0.000     3.698397    5.669484</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      Large  |   9.655742   .5261904    18.35   0.000     8.624428    10.68706</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>     college |   4.495635   .5283579     8.51   0.000     3.460072    5.531197</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>       taxes |  -3.640864   .4938209    -7.37   0.000    -4.608735   -2.672993</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   79.48011   3.118008    25.49   0.000     73.36892    85.59129</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>-------------+----------------------------------------------------------------</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>lnsigma2     |</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>       fines |  -.5261208    .082495    -6.38   0.000     -.687808   -.3644337</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>       csize |</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>     Medium  |    .331204   .1681709     1.97   0.049     .0015952    .6608129</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>      Large  |   .5578834   .1662309     3.36   0.001     .2320768    .8836899</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>             |</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>     college |   .3186815   .1539424     2.07   0.038     .0169599    .6204032</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>       taxes |  -.3988692   .1437708    -2.77   0.006    -.6806548   -.1170836</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>       <span class="dt">_cons</span> |   8.257714   .8201063    10.07   0.000     6.650335    9.865093</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------------</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>LR <span class="kw">test</span> <span class="kw">of</span> lnsigma2=0: <span class="fu">chi2</span>(5) = 75.42                    Prob &gt; <span class="fu">chi2</span> = 0.0000</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>**  make Policy</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="kw">clonevar</span> fines_copy = fines</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> fines = 0.1*(12-fines)+fines </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> <span class="kw">xb</span>, <span class="kw">xb</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> xbs, sigma</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>** Simulate results</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> sim1</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> sim1, <span class="kw">eclass</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">capture</span> <span class="kw">drop</span> cit_hat </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> cit_hat = rnormal(<span class="kw">xb</span>,xbs)   </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">sum</span> citations, <span class="kw">d</span> </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lp10 = <span class="fu">r</span>(p10)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lp25 = <span class="fu">r</span>(p25)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lp50 = <span class="fu">r</span>(p50) </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lpmn = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lp75 = <span class="fu">r</span>(p75)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lp90 = <span class="fu">r</span>(p90)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">sum</span> cit_hat, <span class="kw">d</span> </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> b = <span class="fu">r</span>(p10)-<span class="ot">`lp10'</span>,<span class="fu">r</span>(p25)-<span class="ot">`lp25'</span>, <span class="fu">r</span>(p50)-<span class="ot">`lp50'</span> , <span class="fu">r</span>(<span class="kw">mean</span>) -<span class="ot">`lpmn'</span>,<span class="fu">r</span>(p75)-<span class="ot">`lp75'</span>,<span class="fu">r</span>(p90)-<span class="ot">`lp90'</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> colname b = p10 p25 p50 <span class="kw">mean</span> p75 p90</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ereturn</span> <span class="kw">post</span> b</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="kw">simulate</span>, reps(1000): sim1</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>      _b_p10 |      1,000    -1.08147    .3913698   -2.31713   .1689796</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>      _b_p25 |      1,000   -.3262908    .3230118  -1.817808   .6465259</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>      _b_p50 |      1,000   -.2085465     .316455   -1.09237   .7785921</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>     _b_mean |      1,000   -1.675626    .2234377  -2.400322   -1.03909</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      _b_p75 |      1,000   -1.541725    .4210822  -2.857586  -.2505198</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>-------------+---------------------------------------------------------</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>      _b_p90 |      1,000   -3.543298    .6079578  -5.464802  -1.682991</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Effects larger than Reweigthing. Statistical inference here may be flawed. (first stage error not carried over)</p>
</section>
<section id="example-2-qregress" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-2-qregress">Example #2: Qregress</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> dui, <span class="kw">clear</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> id = <span class="dt">_n</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>** Expand to 99 quantiles</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>expand 99 </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>bysor id:<span class="kw">gen</span> <span class="fu">q</span>=<span class="dt">_n</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>** make policy</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> fines_policy=0.1*(12-fines)+fines </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> fines_copy  =fines </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>** Estimate 99 quantiles (<span class="kw">in</span> theory one should <span class="kw">do</span> <span class="kw">more</span>..but choose <span class="fu">at</span> random)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install qrprocess <span class="co">// Faster than qreg</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>** Save Cit hat (prediction)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>** cit policy (with policy)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> cit_hat=.</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> cit_pol=.</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span>  i = 1 / 99 {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="ot">`i'</span>==1   <span class="kw">_dots</span> 0 0</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">_dots</span> <span class="ot">`i'</span> 0</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span> {</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">local</span> i100=<span class="ot">`i'</span>/100</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">capture</span> <span class="kw">drop</span> aux</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        qrprocess citations c.fines##c.fines  (i.csize college taxes) <span class="kw">if</span> <span class="fu">q</span>==1, <span class="fu">q</span>(<span class="ot">`i100'</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        ** predicts the <span class="kw">values</span> <span class="kw">as</span> <span class="kw">if</span> they were <span class="kw">in</span> q100</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> aux</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> cit_hat=aux <span class="kw">if</span> <span class="fu">q</span>==<span class="ot">`i'</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">drop</span> aux</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> fines = fines_policy</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> aux</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> cit_pol=aux <span class="kw">if</span> <span class="fu">q</span>==<span class="ot">`i'</span>   </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> fines = fines_copy </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    }   </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a> <span class="kw">tabstat</span> citations cit_hat cit_pol, <span class="kw">stats</span>(p10 p25 p50 <span class="kw">mean</span> p75 p90)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>   Stats |  citati~<span class="fu">s</span>   cit_hat   cit_pol</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>---------+------------------------------</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>     p10 |      11.5  10.70744  9.911633</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>     p25 |        15  15.42857  14.27302</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>     p50 |        20  21.15557  19.68303</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    Mean |    22.018   22.0002  20.31824</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>     p75 |        27  27.65936  25.56173</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>     p90 |      34.5  34.03413  31.39192</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>----------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Very demanding (computationally) and may only capture effects to the extend that we have good coverage of the distribution.</p>
<p>Standard Errors…Bootstrapping. Perhaps use random quantile assignment, and may have problems near boundaries.</p>
</section>
<section id="opt-1-and-2-comments" class="level2">
<h2 class="anchored" data-anchor-id="opt-1-and-2-comments">Opt 1 and 2: Comments</h2>
<p>The first two options allow you to estimate effects of changes in <span class="math inline">\(f(x)\)</span> on the unconditional distribution of <span class="math inline">\(y\)</span>, and in consequence, the distributional statistics of interest.</p>
<p>They have limitations:</p>
<ol type="1">
<li>They both are limited to a single experiment. A different policy requires a change in the setup.</li>
<li>Reweighing is simple to apply, but has limitation on the type of policies. They all need to be within the support of <span class="math inline">\(X\)</span></li>
<li>Modeling the conditional distribution is a more direct approach, but more computationally intensive, specially for obtaining Stand errors.</li>
</ol>
</section>
<section id="opt-3.-local-approximation-rif-regression" class="level2">
<h2 class="anchored" data-anchor-id="opt-3.-local-approximation-rif-regression">Opt 3. Local Approximation: RIF regression</h2>
<p>The third approach was first introduced by <a href="https://www.jstor.org/stable/40263848">Firpo, Fortin and Lemieux 2009</a>, as a computationally simple way to analyze how changes in <span class="math inline">\(X's\)</span> affect the unconditional quantiles of <span class="math inline">\(y\)</span>.</p>
<p>This strategy was later extended to analyze the effects on a myriad of distributional statistics and rank dependent indices. as well as an approach to estimate distributional treatment effects. See <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X20909690">Rios-Avila (2020)</a>.</p>
<p>In contrast with other approaches, it can be used to analyze multiple types of policies without re-estimating the model. However the identification and interpretation needs particular attention.</p>
<p>It also allows you to easily make Statistical inference. (except for quantiles…)</p>
</section>
<section id="opt-3.-from-ground-up" class="level2">
<h2 class="anchored" data-anchor-id="opt-3.-from-ground-up">Opt 3. From ground up</h2>
<p>Reconsider the Original question. How do you capture the effect of changes of distribution of <span class="math inline">\(x\)</span> on the distribution of <span class="math inline">\(y\)</span>.</p>
<p><span class="math display">\[
\Delta v=v(G_y) - v(F_y)
\]</span></p>
<p>Now, assume that <span class="math inline">\(G_y\)</span> is just marginally different from <span class="math inline">\(F_y\)</span> (different in a very particular way)</p>
<p><span class="math display">\[
G_y(y_i) = (1-\epsilon)F_y+ \epsilon 1(y&gt;y_i)
\]</span></p>
<p>This function puts just a bit more weight on observation <span class="math inline">\(y_i\)</span>. Think of it as “dropping” a new person in the pool.</p>
<p>If this is the case, the <span class="math inline">\(\Delta v(y_i)\)</span> Captures how would the Statistic <span class="math inline">\(v\)</span> changes if the distribution puts just a bit extra weight on 1 observation. (this would be very small)</p>
</section>
<section id="opt-3.-one-more-thing" class="level2">
<h2 class="anchored" data-anchor-id="opt-3.-one-more-thing">Opt 3. One more thing</h2>
<p>Lets Rescale it:</p>
<p><span class="math display">\[
IF(v,F_y,y_i) =lim_{\epsilon \rightarrow 0} \frac{v(G_y(y_i))-v(F_y)}{\epsilon}
\]</span></p>
<p>The <strong>influence function</strong> is a measure of direction of change, we should expect the statistic <span class="math inline">\(v\)</span> will have as we change <span class="math inline">\(F_y \rightarrow G_y\)</span> .</p>
<p>From here the RIF is just <span class="math inline">\(RIF(v,F_y,y_i) = v + IF(v,F_y,y_i)\)</span></p>
<p>Which has some properties:</p>
<p><span class="math display">\[
\begin{aligned}
\int IF(v,F_y,y_i)f_ydy=0 &amp;;
\int RIF(v,F_y,y_i)f_y dy=v \\
v(F_y) \sim N \left(v(F_y),\frac{\sigma^2_{IF}}{N} \right) &amp;;
\int IF^2f_ydy =\sigma^2_{IF}
\end{aligned}
\]</span></p>
</section>
<section id="opt-3.-rif-regression" class="level2">
<h2 class="anchored" data-anchor-id="opt-3.-rif-regression">Opt 3. RIF Regression</h2>
<p>First:</p>
<p><span class="math display">\[
v(F_y) = \iint RIF(v,F_Y,y_i) f(y|x)f(x)dy = \int E(RIF(.)|x) f(x)
\]</span></p>
<p>From here is similar to Opt 3. Use <strong><em>some</em></strong> econometric model to estimate <span class="math inline">\(E(RIF(.)|X)\)</span>, and use that to make predictions on how <span class="math inline">\(v(F_y)\)</span> would change, when there is a <strong>distributional change</strong> in <span class="math inline">\(X\)</span>.</p>
<p>RIF-OLS: Unconditional effect!</p>
<p><span class="math display">\[
RIF(v,F_y,y_i) = X\beta+e  \ \rightarrow\
E(RIF) = v(F_y) = \bar X \beta \\
\frac{dv(F_y)}{d\bar X}=\beta
\]</span></p>
<p>Logic. When <span class="math inline">\(F_x\)</span> changes, it will change the distribution of <span class="math inline">\(F_y\)</span>, which will affect how the statistic <span class="math inline">\(v\)</span> will change. But, we can only consider changes in means! (and Var)</p>
</section>
<section id="why-it-works-and-why-it-may-not" class="level2">
<h2 class="anchored" data-anchor-id="why-it-works-and-why-it-may-not">Why it works, and why it may not</h2>
<p>RIF regressions works by using a linear approximation of the statistic <span class="math inline">\(v\)</span> with the changes in <span class="math inline">\(F_y\)</span> which are caused by changes in <span class="math inline">\(F_x\)</span>, proxied by changes in <span class="math inline">\(\bar X\)</span>.</p>
<ul>
<li>Changes at the individual <span class="math inline">\(x_i\)</span> are not interesting (in a population of 1million, what happens to person 99 may not be large enough to matter)</li>
</ul>
<p>Depending on the model specification, however, we may only be able to identify changes in first and second moments of the distribution of <span class="math inline">\(x\)</span>. (Mean and variance).</p>
<p>-</p>
<p>However, as any linear approximation to a non-linear function, the approximations are BAD when the changes in <span class="math inline">\(F_x\)</span> are too large. The most relevant example…Dummies and treatment!</p>
</section>
<section id="rif-reg-and-dummies" class="level2">
<h2 class="anchored" data-anchor-id="rif-reg-and-dummies">RIF-Reg and dummies</h2>
<p>Dummies are a challenge. At individual or conditional level, we usually consider changes from 0 to 1 (off or on).</p>
<ul>
<li><p>For unconditional effects this is not correct (too large of a change) (No-one treated vs All treated). Thus you need to change the question…Not on and off changes, but Changes in proportion of treated!</p>
<ul>
<li>Very important. a 1% increase in pop treated is different if current treatment is 10% or 90%.</li>
</ul></li>
<li><p>However, its possible to restructure RIF regressions to be partially conditional (Rios-Avila and Maroto 2023) (Combines CQREG with UQREG)</p></li>
<li><p>Similar problems are experienced if the change in continuous variables is large!</p>
<ul>
<li>Minor point. How do you construct RIFs? (analytically and Empirically)</li>
</ul></li>
</ul>
</section>
<section id="example-1" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="example-1">Example</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> dui, <span class="kw">clear</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>**  Consider the policy change</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> change_fines= 0.1*(12-fines)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>**  consider average change <span class="kw">in</span> fines.Since we are only considering <span class="kw">this</span> effect</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> change_fines</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize college taxes, rif(<span class="fu">q</span>(10)) </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m1</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize college taxes, rif(<span class="fu">q</span>(50)) </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m2</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize college taxes, rif(<span class="fu">q</span>(90)) </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m3</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>** This are Rescaled to show true effect</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize college taxes, rif(<span class="fu">q</span>(10)) <span class="kw">scale</span>(.21048)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m4</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize college taxes, rif(<span class="fu">q</span>(50)) <span class="kw">scale</span>(.21048)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m5</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>rifhdreg citations fines i.csize collegetaxes, rif(<span class="fu">q</span>(90)) <span class="kw">scale</span>(.21048)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> sto m6</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>. esttab m1 m2 m3 m4 m5 m6, se mtitle(q10 q50 q90 <span class="fu">r</span>-q10 <span class="fu">r</span>-q50 <span class="fu">r</span>-q90) <span class="kw">compress</span> nogaps</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------------------------------</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                 (1)          (2)          (3)          (4)          (5)          (6)   </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                 q10          q50          q90        <span class="fu">r</span>-q10        <span class="fu">r</span>-q50        <span class="fu">r</span>-q90   </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------------------------------</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>fines         -4.476***    -6.700***    -9.887***    -0.942***    -1.410***    -2.081***</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>             (0.491)      (0.493)      (0.978)      (0.103)      (0.104)      (0.206)   </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>1.csize            0            0            0            0            0            0   </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                 (.)          (.)          (.)          (.)          (.)          (.)   </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>2.csize        4.603***     7.325***     6.370***     0.969***     1.542***     1.341***</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>             (0.963)      (0.966)      (1.917)      (0.203)      (0.203)      (0.404)   </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>3.csize        6.504***     13.54***     12.97***     1.369***     2.851***     2.729***</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>             (0.914)      (0.917)      (1.820)      (0.192)      (0.193)      (0.383)   </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>college        2.922**      5.948***     9.973***     0.615**      1.252***     2.099***</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>             (0.890)      (0.892)      (1.771)      (0.187)      (0.188)      (0.373)   </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>taxes         -3.279***    -3.303***    -8.319***    -0.690***    -0.695***    -1.751***</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>             (0.842)      (0.844)      (1.676)      (0.177)      (0.178)      (0.353)   </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="dt">_cons</span>          53.71***     81.04***     129.2***     11.30***     17.06***     27.20***</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>             (4.964)      (4.977)      (9.880)      (1.045)      (1.048)      (2.080)   </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------------------------------</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="kw">N</span>                500          500          500          500          500          500   </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>----------------------------------------------------------------------------------------</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Consider the basic change. Fines increases in 1 unit, Cntys with taxes, increase 10%, etc</p>
<p>Or consider rescaled effects</p>
</section>
<section id="how-do-they-compare" class="level2">
<h2 class="anchored" data-anchor-id="how-do-they-compare">How Do they Compare</h2>
<p><img src="resources/image-1421892762.png" class="img-fluid"></p>
</section>
<section id="other-considerations" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="other-considerations">Other Considerations</h2>
<p>RIF Regressions are useful, but again, one must use them with care.</p>
<ul>
<li>Only Small changes! Larger changes may be meaningless</li>
</ul>
<p>Except for <code>Stata</code> (see rif and rifhdreg), the applications of RIF regressions outside Mean, Variance and Quantiles are non-existent. (paper?)</p>
<ul>
<li>For most Common Statistics, RIF’s automatically provide correct Standard errors (which can be Robustized!). In fact, a simple <strong>LR</strong> can be considered as a special case of <strong>RIF’s</strong></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
RIF(mean,y_i,F_y) &amp;= y_i \\
RIF(variance,y_i,F_y) &amp;= (y_i-\bar y)^2 \\
RIF(Q,y_i,F_Y) &amp;= Q_y(\tau) + \frac{\tau-1(y_i \leq Q_y(\tau))}{f_Y(y_i)}
\end{aligned}
\]</span></p>
<p>Except for quantile related functions! (<span class="math inline">\(f_y\)</span> also needs estimation, thus errors!)</p>
<ul>
<li>Accounting for “local” unconditional effects beyond means require Center Polynomials:</li>
</ul>
<p><span class="math display">\[
RIF(.,y) = b_0 + b_1 x + b_2 (x-\bar x)^2+\varepsilon
\]</span></p>
<ul>
<li>Quantile treatment effects (on and off) are possible using PC-RIF (When you condition the distribution on just 1 variable)</li>
</ul>
<p><span class="math display">\[
RIF(.,F_{Y|D},y) = b_0 + b_1 D+b_2 x + b_3 (x-\bar x)^2+\varepsilon
\]</span></p>
</section>
<section id="final-words-on-rif" class="level2">
<h2 class="anchored" data-anchor-id="final-words-on-rif">Final words on RIF</h2>
<p>Because this implementation uses LR, you can add Multiple Fixed effects as well. (with limitations)</p>
<p>And you can skip LR all together, and model RIF using Other approaches! (which may be even better than OLS).</p>
</section>
<section id="next" class="level1">
<h1>NEXT</h1>
<p>Truly going nonlinear. When <span class="math inline">\(\beta\)</span> is no longer linear in <span class="math inline">\(y\)</span> (nor is the error)</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>