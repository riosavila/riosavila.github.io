<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">
<meta name="dcterms.date" content="2024-10-10">

<title>Modeling Probabilities – Econometrics MSC Levy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Modeling Probabilities</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Courses</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../adv_class/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advance Econometrics: Causal Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rm-data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods I: Data Analysis for Economics and Policy</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Math Refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-we-will-see-today" id="toc-what-we-will-see-today" class="nav-link active" data-scroll-target="#what-we-will-see-today">What we will see today</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#binary-events" id="toc-binary-events" class="nav-link" data-scroll-target="#binary-events">Binary events</a></li>
  <li><a href="#modelling-events-lpm" id="toc-modelling-events-lpm" class="nav-link" data-scroll-target="#modelling-events-lpm">Modelling events: LPM</a>
  <ul class="collapse">
  <li><a href="#lpm-linear-probability-model" id="toc-lpm-linear-probability-model" class="nav-link" data-scroll-target="#lpm-linear-probability-model">LPM: Linear probability model</a></li>
  <li><a href="#lpm-interpretation" id="toc-lpm-interpretation" class="nav-link" data-scroll-target="#lpm-interpretation">LPM: Interpretation</a></li>
  <li><a href="#lpm-modelling" id="toc-lpm-modelling" class="nav-link" data-scroll-target="#lpm-modelling">LPM: Modelling</a></li>
  <li><a href="#lpm-prediction" id="toc-lpm-prediction" class="nav-link" data-scroll-target="#lpm-prediction">LPM: Prediction</a></li>
  <li><a href="#lpm-prediction-1" id="toc-lpm-prediction-1" class="nav-link" data-scroll-target="#lpm-prediction-1">LPM: Prediction</a></li>
  <li><a href="#cs-does-smoking-pose-a-health-risk" id="toc-cs-does-smoking-pose-a-health-risk" class="nav-link" data-scroll-target="#cs-does-smoking-pose-a-health-risk">CS: Does smoking pose a health risk?</a></li>
  <li><a href="#cs-does-smoking-during-pregnancy-affect-birth-weight" id="toc-cs-does-smoking-during-pregnancy-affect-birth-weight" class="nav-link" data-scroll-target="#cs-does-smoking-during-pregnancy-affect-birth-weight">CS: Does smoking during pregnancy affect birth weight?</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#lpm-in-stata" id="toc-lpm-in-stata" class="nav-link" data-scroll-target="#lpm-in-stata">LPM: in Stata</a></li>
  <li><a href="#lpm-interpretation-1" id="toc-lpm-interpretation-1" class="nav-link" data-scroll-target="#lpm-interpretation-1">LPM: Interpretation</a></li>
  <li><a href="#lpm-with-many-regressors-i" id="toc-lpm-with-many-regressors-i" class="nav-link" data-scroll-target="#lpm-with-many-regressors-i">LPM: with many regressors I</a></li>
  <li><a href="#lpm-with-many-regressors-ii" id="toc-lpm-with-many-regressors-ii" class="nav-link" data-scroll-target="#lpm-with-many-regressors-ii">LPM with many regressors II</a></li>
  <li><a href="#lpm-with-many-regressors-iii" id="toc-lpm-with-many-regressors-iii" class="nav-link" data-scroll-target="#lpm-with-many-regressors-iii">LPM with many regressors III</a></li>
  <li><a href="#detour-regression-tables" id="toc-detour-regression-tables" class="nav-link" data-scroll-target="#detour-regression-tables">Detour: Regression Tables</a></li>
  <li><a href="#does-smoking-pose-a-health-risk-for-the-baby" id="toc-does-smoking-pose-a-health-risk-for-the-baby" class="nav-link" data-scroll-target="#does-smoking-pose-a-health-risk-for-the-baby">Does smoking pose a health risk for the baby?</a></li>
  <li><a href="#lpms-predicted-probabilities" id="toc-lpms-predicted-probabilities" class="nav-link" data-scroll-target="#lpms-predicted-probabilities">LPM’s predicted probabilities</a></li>
  <li><a href="#analysis-of-lpms-predicted-probabilities" id="toc-analysis-of-lpms-predicted-probabilities" class="nav-link" data-scroll-target="#analysis-of-lpms-predicted-probabilities">Analysis of LPM’s predicted probabilities</a></li>
  </ul></li>
  <li><a href="#modelling-events-logprobit" id="toc-modelling-events-logprobit" class="nav-link" data-scroll-target="#modelling-events-logprobit">Modelling events: <br> [log/prob]it</a>
  <ul class="collapse">
  <li><a href="#probability-models-logit-and-probit" id="toc-probability-models-logit-and-probit" class="nav-link" data-scroll-target="#probability-models-logit-and-probit">Probability models: logit and probit</a></li>
  <li><a href="#link-functions-i." id="toc-link-functions-i." class="nav-link" data-scroll-target="#link-functions-i.">Link functions I.</a></li>
  <li><a href="#link-functions-ii." id="toc-link-functions-ii." class="nav-link" data-scroll-target="#link-functions-ii.">Link functions II.</a></li>
  <li><a href="#logit-and-probit-interpretation" id="toc-logit-and-probit-interpretation" class="nav-link" data-scroll-target="#logit-and-probit-interpretation">Logit and probit interpretation</a></li>
  <li><a href="#marginal-differences-marginal-effects" id="toc-marginal-differences-marginal-effects" class="nav-link" data-scroll-target="#marginal-differences-marginal-effects">Marginal differences (marginal effects)</a></li>
  <li><a href="#marginal-differences-discrete-x" id="toc-marginal-differences-discrete-x" class="nav-link" data-scroll-target="#marginal-differences-discrete-x">Marginal differences: Discrete <span class="math inline">\(x\)</span></a></li>
  <li><a href="#marginal-differences-continous-x" id="toc-marginal-differences-continous-x" class="nav-link" data-scroll-target="#marginal-differences-continous-x">Marginal differences: continous <span class="math inline">\(x\)</span></a></li>
  <li><a href="#how-to-estimate-this-models" id="toc-how-to-estimate-this-models" class="nav-link" data-scroll-target="#how-to-estimate-this-models">How to estimate this models?</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-estimation" id="toc-maximum-likelihood-estimation" class="nav-link" data-scroll-target="#maximum-likelihood-estimation">Maximum likelihood estimation!</a></li>
  </ul></li>
  <li><a href="#predictions-for-lmp-logit-and-probit-i." id="toc-predictions-for-lmp-logit-and-probit-i." class="nav-link" data-scroll-target="#predictions-for-lmp-logit-and-probit-i.">Predictions for LMP, Logit and Probit I.</a></li>
  <li><a href="#coefficient-results-for-logit-and-probit" id="toc-coefficient-results-for-logit-and-probit" class="nav-link" data-scroll-target="#coefficient-results-for-logit-and-probit">Coefficient results for logit and probit</a></li>
  <li><a href="#does-smoking-pose-a-health-risk-logit-and-probit" id="toc-does-smoking-pose-a-health-risk-logit-and-probit" class="nav-link" data-scroll-target="#does-smoking-pose-a-health-risk-logit-and-probit">Does smoking pose a health risk?– logit and probit</a></li>
  </ul></li>
  <li><a href="#goodness-of-fit-measures" id="toc-goodness-of-fit-measures" class="nav-link" data-scroll-target="#goodness-of-fit-measures">Goodness of fit measures</a>
  <ul class="collapse">
  <li><a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit">Goodness of fit</a></li>
  <li><a href="#goodness-of-fit-r-squared" id="toc-goodness-of-fit-r-squared" class="nav-link" data-scroll-target="#goodness-of-fit-r-squared">Goodness of fit: R-squared</a></li>
  <li><a href="#brier-score" id="toc-brier-score" class="nav-link" data-scroll-target="#brier-score">Brier score</a></li>
  <li><a href="#pseudo-r2" id="toc-pseudo-r2" class="nav-link" data-scroll-target="#pseudo-r2">Pseudo R2</a></li>
  <li><a href="#log-loss" id="toc-log-loss" class="nav-link" data-scroll-target="#log-loss">Log-loss</a></li>
  <li><a href="#practical-use" id="toc-practical-use" class="nav-link" data-scroll-target="#practical-use">Practical use</a></li>
  <li><a href="#bias-of-the-predictions" id="toc-bias-of-the-predictions" class="nav-link" data-scroll-target="#bias-of-the-predictions">Bias of the predictions</a></li>
  <li><a href="#calibration" id="toc-calibration" class="nav-link" data-scroll-target="#calibration">Calibration</a></li>
  <li><a href="#calibration-curve" id="toc-calibration-curve" class="nav-link" data-scroll-target="#calibration-curve">Calibration curve</a></li>
  <li><a href="#calibration-curve-1" id="toc-calibration-curve-1" class="nav-link" data-scroll-target="#calibration-curve-1">Calibration curve</a></li>
  <li><a href="#probability-models-summary" id="toc-probability-models-summary" class="nav-link" data-scroll-target="#probability-models-summary">Probability models summary</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week08.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling Probabilities</h1>
<p class="subtitle lead">to be or not to be</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Fernando Rios-Avila </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Levy Economics Institute
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="what-we-will-see-today" class="level2">
<h2 class="anchored" data-anchor-id="what-we-will-see-today">What we will see today</h2>
<ul>
<li>Linear Probability Model - LPM</li>
<li>Logit &amp; probit</li>
<li>Goodness of fit</li>
<li>Diagnostics</li>
<li>Summary</li>
</ul>
</section>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<ul>
<li>What are the health benefits of not smoking? Considering the 50+ population, we can investigate if differences in smoking habits are correlated with differences in health status.
<ul>
<li>good health vs bad health</li>
</ul></li>
</ul>
</section>
<section id="binary-events" class="level2">
<h2 class="anchored" data-anchor-id="binary-events">Binary events</h2>
<ul>
<li>Some outcomes are things that either happen or don’t happen, which can be captured by binary variables
<ul>
<li>e.g.&nbsp;a person is healthy or not, a person is employed or not, a person is a smoker or not. We dont see a person that is half healthy, half employed, or half a smoker.</li>
</ul></li>
<li>How can we model these events?
<ul>
<li>We have seen this before. Instead of modeling the value itself, we model the probability of the event happening.</li>
</ul></li>
</ul>
<p><span class="math display">\[E[y] = P[y = 1]\]</span></p>
<ul>
<li>In fact, the average of a 0–1 event is the probability of that event happening. Which can also be estimated as conditional probabilities:</li>
</ul>
<p><span class="math display">\[E[y|x_1, x_2, ...] = P[y = 1|x_1, x_2, ...]\]</span></p>
<ul>
<li>Good news, we can use the same tools we have been using to model these probabilities.</li>
</ul>
</section>
<section id="modelling-events-lpm" class="level1">
<h1>Modelling events: LPM</h1>
<section id="lpm-linear-probability-model" class="level2">
<h2 class="anchored" data-anchor-id="lpm-linear-probability-model">LPM: Linear probability model</h2>
<ul>
<li>Linear Probability Model (LPM) is a <strong>linear regression</strong> with a binary dependent variable
<ul>
<li>It has the goal of modeling the probability of an event happening</li>
</ul></li>
<li>A linear regressions with binary dependent variables shows:
<ul>
<li>differences in expected <span class="math inline">\(y\)</span> by <span class="math inline">\(x\)</span>, represent diferences in probability of <span class="math inline">\(y = 1\)</span> by <span class="math inline">\(x\)</span>.</li>
</ul></li>
<li>Introduce notation for probability: <span class="math inline">\(y^P = P[y = 1|x_1, x_2, . . .]\)</span></li>
<li>Linear probability model (LPM) regression is <span class="math inline">\(y^P = \beta_0 + \beta_1 x_1 + \beta_2 x_2\)</span></li>
</ul>
</section>
<section id="lpm-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="lpm-interpretation">LPM: Interpretation</h2>
<p><span class="math display">\[y^P = \beta_0 + \beta_1 x_1 + \beta_2 x_2\]</span></p>
<ul>
<li>So far nothing changes in terms of modelling or estimation. However, the interpretation of the coefficients changes.
<ul>
<li><span class="math inline">\(y^P\)</span> denotes the probability that the dependent variable is one, conditional on the right-hand-side variables of the model.</li>
<li><span class="math inline">\(\beta_0\)</span> shows the <em>predicted</em> probability of <span class="math inline">\(y\)</span> if all <span class="math inline">\(x\)</span> are zero.</li>
<li><span class="math inline">\(\beta_1\)</span> shows the difference in the probability that <span class="math inline">\(y = 1\)</span> for observations that are different in <span class="math inline">\(x_1\)</span> but are the same in terms of <span class="math inline">\(x_2\)</span>. (ceteris paribus)</li>
</ul></li>
</ul>
</section>
<section id="lpm-modelling" class="level2">
<h2 class="anchored" data-anchor-id="lpm-modelling">LPM: Modelling</h2>
<ul>
<li>Linear probability model (<strong>LPM</strong>) can be estimated using OLS. (just like linear regression)</li>
<li>We can use all transformations in <span class="math inline">\(x\)</span>, that we used before:
<ul>
<li>Log, Polinomials, Splines, dummies, interactions, etc. They all work.</li>
</ul></li>
<li>All formulae and interpretations for standard errors, confidence intervals, hypotheses and p-values of tests are the same.</li>
<li><span class="red"><strong>IMPORTANT</strong></span> Heteroskedasticity robust error are essential in this case!
<ul>
<li>By construction LPMs are heteroskedastic!</li>
<li>And ignoring this fact will lead to biased standard errors and confidence intervals.</li>
</ul></li>
</ul>
</section>
<section id="lpm-prediction" class="level2">
<h2 class="anchored" data-anchor-id="lpm-prediction">LPM: Prediction</h2>
<ul>
<li>Predicted values - <span class="math inline">\(\hat{y}_P\)</span> - may be problematic. Although they are calculated the same way, they need to be interpreted as <strong>probabilities</strong>.</li>
</ul>
<p><span class="math display">\[\hat{y}^P = \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2\]</span></p>
<ul>
<li>Predicted values <strong>need to be</strong> between 0 and 1 because they are probabilities</li>
<li>But in LPM, predictions may be below 0 and above 1. No formal bounds in the model.
<ul>
<li>more likely than certain, less likely than impossible</li>
</ul></li>
</ul>
</section>
<section id="lpm-prediction-1" class="level2">
<h2 class="anchored" data-anchor-id="lpm-prediction-1">LPM: Prediction</h2>
<ul>
<li>When to get worried?:
<ul>
<li>With continuous variables that can take any value (GDP, Population, sales, etc), this could be a serious issue (extrapolation)
<ul>
<li>We need to check if predictions are within the 0-1 range at least “in-sample”. But, this is not a guarantee that it will be the case “out-of-sample”.</li>
</ul></li>
<li>With binary variables, no problem (‘saturated models’) (interpolation)
<ul>
<li>Not problem because “simple” means will always be between 0 and 1.</li>
</ul></li>
</ul></li>
<li>So, a problem if goal is prediction!</li>
<li>Not a big issue for inference → uncover patterns of association.
<ul>
<li>But it may give biased estimates…(in <strong>theory</strong>)</li>
</ul></li>
</ul>
</section>
<section id="cs-does-smoking-pose-a-health-risk" class="level2">
<h2 class="anchored" data-anchor-id="cs-does-smoking-pose-a-health-risk">CS: Does smoking pose a health risk?</h2>
<blockquote class="blockquote">
<p>This is on of the few datasets from the book that is not directly available from their website. If interested, you need to go over the repository, and follow the instructions to access the data.</p>
</blockquote>
<p>Thus, we will use a different dataset to illustrate the concepts.</p>
</section>
<section id="cs-does-smoking-during-pregnancy-affect-birth-weight" class="level2">
<h2 class="anchored" data-anchor-id="cs-does-smoking-during-pregnancy-affect-birth-weight">CS: Does smoking during pregnancy affect birth weight?</h2>
<ul>
<li>The question is whether, and by how much, smoking during pregnancy affects the likelihood that a baby is born with low birth weight.</li>
<li>We will use “lbw” dataset from Stata’s example datasets.</li>
<li>The dataset contains information on 189 observations of mothers and their newborns.
<ul>
<li><code>low</code> is a binary variable indicating whether the baby was born with low birth weight (&lt;2500gr &lt;5.5lbs).</li>
<li><code>smoke</code> is a binary variable indicating whether the mother smoked during pregnancy.</li>
</ul></li>
</ul>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<ul>
<li><span class="math inline">\(low = 1\)</span> if baby was born with low birth weight</li>
<li><span class="math inline">\(low = 0\)</span> if baby was born with normal weight -Some demographic information on all individual</li>
<li>We exclude women &lt;15 years old and &gt;40 years old<br>
</li>
<li>Also exclude women with Weight &gt; 200lbs (before pregnancy)</li>
</ul>
</section>
<section id="lpm-in-stata" class="level2">
<h2 class="anchored" data-anchor-id="lpm-in-stata">LPM: in Stata</h2>
<ul>
<li>Start with a simple univariate model: <span class="math inline">\(P[low|smoke] = \alpha + \beta[smoke]\)</span></li>
</ul>
<div id="92d6978f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">webuse</span> lbw, <span class="kw">clear</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> age &lt; 15 | age &gt; 40 | lwt &gt; 200</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> low smoke, <span class="kw">robust</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Hosmer &amp; Lemeshow data)
(10 observations deleted)

Linear regression                               Number of obs     =        179
                                                F(1, 177)         =       4.70
                                                Prob &gt; F          =     0.0316
                                                R-squared         =     0.0272
                                                Root MSE          =     .46208

------------------------------------------------------------------------------
             |               Robust
         low | Coefficient  std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       smoke |    .157405   .0726412     2.17   0.032     .0140507    .3007593
       _cons |   .2568807   .0420845     6.10   0.000     .1738289    .3399326
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="lpm-interpretation-1" class="level2">
<h2 class="anchored" data-anchor-id="lpm-interpretation-1">LPM: Interpretation</h2>
<p>Interpretation:</p>
<ul>
<li>The coefficient on <code>smoker</code> shows the difference in the probability of a baby.</li>
<li>Babies are <strong>15.7</strong> percentage points more likely to be born with low birth weight if the mother smoked during pregnancy.
<ul>
<li>Are you comparing Apples to apples?</li>
<li>Lets add additional controls to capture other factors</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-i" class="level2">
<h2 class="anchored" data-anchor-id="lpm-with-many-regressors-i">LPM: with many regressors I</h2>
<ul>
<li>Multiple regression – closer to causality</li>
<li>Compare women who are very similar in many respects but are different in smoking habits</li>
<li>Smokers / non-smokers – different in many other behaviors and conditions:
<ul>
<li>personal traits (age, race)</li>
<li>behavior pre-pregnancy (Pre-pregnancy weight)</li>
<li>Medical history (History of Hypertension)</li>
<li>background for pregnancy (Number of prenatal visits, Previous premature labor)</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-ii" class="level2">
<h2 class="anchored" data-anchor-id="lpm-with-many-regressors-ii">LPM with many regressors II</h2>
<ul>
<li>May also consider functional form selection or interactions</li>
<li>Trial and error, or theory-based</li>
<li>Useful to check bivariate relationships (scatter plots, Lpoly, correlations)
<ul>
<li>For now, assume linear relationships</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-iii" class="level2">
<h2 class="anchored" data-anchor-id="lpm-with-many-regressors-iii">LPM with many regressors III</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> any_premature = ptl &gt;0</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> ftv no_of_visits_1tr</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> ht hist_hyper</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ren</span> lwt wgt_bef_preg</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> low smoke age i.race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg, <span class="kw">robust</span> nohead</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> lpm_results</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>esttab lpm_results,   se  <span class="kw">wide</span> nonumber <span class="co">///</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>collabel(b se) md <span class="kw">drop</span>(1.race) nomtitle b(3) <span class="kw">nonotes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">b</th>
<th style="text-align: center;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>smoke</td>
<td style="text-align: center;">0.151<sup>*</sup></td>
<td style="text-align: center;">(0.075)</td>
</tr>
<tr class="even">
<td>age</td>
<td style="text-align: center;">-0.005</td>
<td style="text-align: center;">(0.007)</td>
</tr>
<tr class="odd">
<td>2.race</td>
<td style="text-align: center;">0.210</td>
<td style="text-align: center;">(0.112)</td>
</tr>
<tr class="even">
<td>3.race</td>
<td style="text-align: center;">0.126</td>
<td style="text-align: center;">(0.079)</td>
</tr>
<tr class="odd">
<td>any_premature</td>
<td style="text-align: center;">0.275<sup>**</sup></td>
<td style="text-align: center;">(0.097)</td>
</tr>
<tr class="even">
<td>hist_hyper</td>
<td style="text-align: center;">0.396<sup>**</sup></td>
<td style="text-align: center;">(0.143)</td>
</tr>
<tr class="odd">
<td>no_of_visits_1tr</td>
<td style="text-align: center;">-0.005</td>
<td style="text-align: center;">(0.034)</td>
</tr>
<tr class="even">
<td>wgt_bef_preg</td>
<td style="text-align: center;">-0.002</td>
<td style="text-align: center;">(0.002)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td style="text-align: center;">0.464</td>
<td style="text-align: center;">(0.252)</td>
</tr>
<tr class="even">
<td><em>N</em></td>
<td style="text-align: center;">179</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p><span class="table-note">Robust standard errors in parentheses</span> <span class="table-note"><sup>*</sup> <em>p</em> &lt; 0.05, <sup>**</sup> <em>p</em> &lt; 0.01, <sup>***</sup> <em>p</em> &lt; 0.001</span></p>
</section>
<section id="detour-regression-tables" class="level2">
<h2 class="anchored" data-anchor-id="detour-regression-tables">Detour: Regression Tables</h2>
<ul>
<li>If need to show many explanatory variables</li>
<li>Do not show table 12*2 rows, people will not see it.
<ul>
<li>Avoid copy pasting from your document! Those tables are unwieldy.</li>
</ul></li>
<li>Either only show selected variables (smoke + 2-3 others)</li>
<li>Or may need to create two columns. (a bit more work)
<ul>
<li>In my case, Wide format did the trick.</li>
</ul></li>
<li>Make site you have title, N of observations, footnote on SE, stars.</li>
<li>SE, stars: many different notations. Check carefully.
<ul>
<li><code>esttab</code> default is <span class="math inline">\(p^{***}= p&lt;0.001\)</span>, <span class="math inline">\(0.01\)</span> and <span class="math inline">\(0.05\)</span></li>
<li>In papers there is <span class="math inline">\(p^{***}=p&lt;0.01\)</span>, <span class="math inline">\(0.05\)</span> and <span class="math inline">\(0.1\)</span>.</li>
</ul></li>
</ul>
</section>
<section id="does-smoking-pose-a-health-risk-for-the-baby" class="level2">
<h2 class="anchored" data-anchor-id="does-smoking-pose-a-health-risk-for-the-baby">Does smoking pose a health risk for the baby?</h2>
<ul>
<li>Coefficient on smoking during pregnancy is <strong>-.151</strong>.
<ul>
<li>Women who smoked during pregnancy are <strong>15.1</strong> percentage points more likely to have a baby with low birth weight.</li>
</ul></li>
<li>The 95% confidence interval is relatively wide <span class="math inline">\([0.002, 0.300]\)</span>, but it does not contain zero</li>
<li>Age, Race?, Nr of Visits and Pre-pregnancy weight do not seem to be factors</li>
<li>Hypertension and previous premature labor are significant factors, increasing the probability of low birth weight by 40pp and 27.5pp, respectively.</li>
</ul>
</section>
<section id="lpms-predicted-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="lpms-predicted-probabilities">LPM’s predicted probabilities</h2>
<div id="dd249d47" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">reg</span> low smoke age i.race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg, <span class="kw">robust</span> nohead</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">predict</span> low_hat</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>:<span class="kw">histogram</span> low_hat</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> low_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     low_hat |        179    .3184358    .1878437  -.0346098   .9483117</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week08_files/figure-revealjs/cell-4-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analysis-of-lpms-predicted-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-lpms-predicted-probabilities">Analysis of LPM’s predicted probabilities</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">What to do</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">What we find</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li>Drill down in distribution:
<ul>
<li>Looking at the composition of people: top vs bottom part of probability distribution</li>
<li>Look at average values of covariates for top and bottom X% of predicted probabilities!</li>
</ul></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="74bb6707" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> low_hat</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">linesize</span> 255</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">gen</span> flag = 1 <span class="kw">if</span> <span class="dt">_n</span>&lt;=5</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">replace</span>  flag = 2 <span class="kw">if</span> <span class="dt">_n</span>&gt;=_N-4</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> low_hat smoke age race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg   <span class="kw">if</span> flag==1</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> low_hat smoke age race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg   <span class="kw">if</span> flag==2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     +---------------------------------------------------------------------------------+
     |   low_hat       smoke   age    race   any_pr~e   hist_h~r   no_of_~r   wgt_be~g |
     |---------------------------------------------------------------------------------|
  1. | -.0346098   Nonsmoker    32   White          0          0          2        186 |
  2. | -.0280454   Nonsmoker    36   White          0          0          0        175 |
  3. |  .0019138   Nonsmoker    32   White          0          0          0        170 |
  4. |  .0158307   Nonsmoker    23   White          0          0          0        190 |
  5. |  .0284496   Nonsmoker    28   White          0          0          0        167 |
     +---------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------+
     |  low_hat       smoke   age    race   any_pr~e   hist_h~r   no_of_~r   wgt_be~g |
     |--------------------------------------------------------------------------------|
175. | .7197446      Smoker    34   Black          0          1          0        187 |
176. | .7369648   Nonsmoker    17   Black          0          1          0        142 |
177. | .8160616      Smoker    18   Black          1          0          0        110 |
178. | .8545191   Nonsmoker    26   Other          1          1          1        154 |
179. | .9483117   Nonsmoker    25   Other          1          1          0        105 |
     +--------------------------------------------------------------------------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="modelling-events-logprobit" class="level1">
<h1>Modelling events: <br> [log/prob]it</h1>
<section id="probability-models-logit-and-probit" class="level2">
<h2 class="anchored" data-anchor-id="probability-models-logit-and-probit">Probability models: logit and probit</h2>
<ul>
<li><strong>Prediction:</strong> predicted probability need to be between 0 and 1
<ul>
<li>Thus, for prediction, we <strong>must</strong> use non-linear models</li>
<li>Actually, its a quasi-linear model.</li>
</ul></li>
<li>The model, itself, is linear in the parameters</li>
<li>but need to relate this to the probability of the <span class="math inline">\(y = 1\)</span> event, using a nonlinear function that maps the linear index into a 0-1 range: <strong>‘Link function’</strong></li>
</ul>
<p><span class="math display">\[\begin{aligned}
XB &amp;= \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... \\
y^P &amp;= F(XB) \rightarrow y^P \in (0,1)
\end{aligned}
\]</span></p>
<ul>
<li>Two options: Logit and probit – different link function</li>
</ul>
</section>
<section id="link-functions-i." class="level2">
<h2 class="anchored" data-anchor-id="link-functions-i.">Link functions I.</h2>
<p>Call <span class="math inline">\(XB = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ...\)</span></p>
<ul>
<li><p>The Logit:<br>
<span class="math inline">\(y^P = \Lambda(XB) = \frac{\exp(XB)}{1 + \exp(XB)}\)</span></p></li>
<li><p>The probit:<br>
<span class="math inline">\(y^P = \Phi(XB) \rightarrow \Phi(z) = \int_{-\infty}^z \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{z^2}{2}\right) dz\)</span></p></li>
</ul>
<p>where <span class="math inline">\(\Lambda()\)</span> is called logistic function, and <span class="math inline">\(\Phi()\)</span> is the cumulative distribution function (CDF) of the standard normal distribution.</p>
</section>
<section id="link-functions-ii." class="level2">
<h2 class="anchored" data-anchor-id="link-functions-ii.">Link functions II.</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>Both link functions are S-shaped curves bounded between 0 and 1.</li>
<li>There is but a small difference between the two.</li>
<li>but estimated coefficients will be different.</li>
</ul>
</div><div class="column" style="width:60%;">
<div id="874d63fc" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">range</span> <span class="kw">p</span> 0 1 202</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="kw">p</span>==0 | <span class="kw">p</span>==1 </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x = <span class="fu">invnormal</span>(<span class="kw">p</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = (x+rnormal())&gt;0</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span>  <span class="fu">y</span> x</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> y_1</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">logit</span> <span class="fu">y</span> x</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> y_2</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">probit</span> <span class="fu">y</span> x</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">predict</span> y_3</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="fu">abs</span>(x)&gt;2</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> (<span class="kw">line</span> y_1 x ) (<span class="kw">line</span> y_2 x) (<span class="kw">line</span> y_3 x), <span class="co">///</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"LPM"</span> 2 <span class="st">"Logit"</span> 3 <span class="st">"Probit"</span>) pos(3) <span class="bn">ring</span>(0) col(1)) </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week08_files/figure-revealjs/cell-6-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="logit-and-probit-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="logit-and-probit-interpretation">Logit and probit interpretation</h2>
<ul>
<li>Both the probit and the logit transform the <span class="math inline">\(\beta_0 + \beta_1 x_1 + ...\)</span> linear combination using a link function that shows an S-shaped curve.</li>
<li>The slope of this curve keeps changing as we change whatever is inside, but it’s steepest when <span class="math inline">\(y^P = 0.5\)</span> (inflection point)</li>
<li>The difference in <span class="math inline">\(y^P\)</span> corresponds to changes in probabilities, between any two values of <span class="math inline">\(x\)</span>.</li>
<li>To find how much is related to a particular <span class="math inline">\(x\)</span>, You need to take the partial derivatives.</li>
<li><strong>Important consequence</strong>: no direct interpretation of the raw coefficient values!
<ul>
<li>Thus, always know if you are interpreting the raw coefficients or the marginal differences.</li>
</ul></li>
</ul>
</section>
<section id="marginal-differences-marginal-effects" class="level2">
<h2 class="anchored" data-anchor-id="marginal-differences-marginal-effects">Marginal differences (marginal effects)</h2>
<blockquote class="blockquote">
<p><strong>NOTE</strong> As before, the word “effect” should be used with caution. In the book, they use “marginal differences” instead. as a more neutral term.</p>
</blockquote>
<ul>
<li><p>Link functions makes associates <span class="math inline">\(\Delta x\)</span> into <span class="math inline">\(\Delta y_P\)</span>. we do not interpret raw coefficients! (except for direction)</p></li>
<li><p>Instead, transform them into ‘marginal differences’ for interpretation purposes</p></li>
<li><p>They are also called ‘marginal effects’ or ‘average marginal effects (AME)’ or ‘average partial effects’.</p></li>
<li><p>Average marginal difference has the same interpretation as the coefficient of linear probability models, but with caveats.</p></li>
</ul>
</section>
<section id="marginal-differences-discrete-x" class="level2">
<h2 class="anchored" data-anchor-id="marginal-differences-discrete-x">Marginal differences: Discrete <span class="math inline">\(x\)</span></h2>
<ul>
<li>if <span class="math inline">\(x\)</span> is a categorical (0-1), the marginal difference is the difference in the predicted probability of <span class="math inline">\(y = 1\)</span>, that corresponds to a change from <span class="math inline">\(x = 0\)</span> to <span class="math inline">\(x = 1\)</span>.</li>
</ul>
<p><span class="math display">\[\Delta y^P = y^P(x = 1) - y^P(x = 0)\]</span></p>
<ul>
<li>Then we simply “average” this difference across all observations.</li>
</ul>
</section>
<section id="marginal-differences-continous-x" class="level2">
<h2 class="anchored" data-anchor-id="marginal-differences-continous-x">Marginal differences: continous <span class="math inline">\(x\)</span></h2>
<ul>
<li>If <span class="math inline">\(x\)</span> is continuous, the marginal difference is calculated as the derivative (for a small change in <span class="math inline">\(x\)</span>).</li>
</ul>
<p><span class="math display">\[\frac{\partial y^P}{\partial x_1} = \beta_1 \cdot f(XB)\]</span></p>
<ul>
<li><p>Which is then averaged across all observations to report a single number.</p></li>
<li><p>In practice, we interpret this as the change in the probability of <span class="math inline">\(y = 1\)</span> for a one-unit change in <span class="math inline">\(x_1\)</span>.</p></li>
</ul>
</section>
<section id="how-to-estimate-this-models" class="level2">
<h2 class="anchored" data-anchor-id="how-to-estimate-this-models">How to estimate this models?</h2>
<section id="maximum-likelihood-estimation" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-estimation">Maximum likelihood estimation!</h3>
<ul>
<li>When estimating a logit or probit model, we use ‘maximum likelihood’ estimation.
<ul>
<li>See 11.U2 for details.</li>
</ul></li>
<li>Idea for maximum likelihood is another way to get coefficient estimates.
<ul>
<li><strong>1st</strong> You specify a (conditional) distribution, that you will use during the estimation.
<ul>
<li>This is logistic for logit and normal for probit model.</li>
</ul></li>
<li><strong>2nd</strong> You maximize this function w.r.t. your <span class="math inline">\(\beta\)</span> parameters → gives the maximum likelihood for this model.</li>
</ul></li>
<li>Different from OLS: No closed form solution → need to use search algorithms.
<ul>
<li>Thus… more computationally intensive.</li>
</ul></li>
</ul>
</section>
</section>
<section id="predictions-for-lmp-logit-and-probit-i." class="level2">
<h2 class="anchored" data-anchor-id="predictions-for-lmp-logit-and-probit-i.">Predictions for LMP, Logit and Probit I.</h2>
<div id="023916e9" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">webuse</span> lbw, <span class="kw">clear</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">drop</span> <span class="kw">if</span> age &lt; 15 | age &gt; 40 | lwt &gt; 200</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> any_premature = ptl &gt;0</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ren</span> ftv no_of_visits_1tr</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ren</span> ht hist_hyper</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ren</span> lwt wgt_bef_preg</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> <span class="bn">black</span> = 2.race</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">gen</span> other = 3.race</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">reg</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">predict</span> low_hat_ols</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> sto lpm_results</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">logit</span> low smoke age <span class="bn">black</span> other any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">predict</span> low_hat_logit</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">probit</span> low smoke age <span class="bn">black</span> other any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">predict</span> low_hat_probit</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>   <span class="kw">two</span> (<span class="kw">scatter</span>  low_hat_logit low_hat_probit low_hat_ols) <span class="co">///</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">line</span> low_hat_ols low_hat_ols, <span class="kw">sort</span>), <span class="co">///</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Logit"</span> 2 <span class="st">"Probit"</span> 3 <span class="st">"LPM"</span>) pos(3) <span class="bn">ring</span>(0) col(1))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week08_files/figure-revealjs/cell-7-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="coefficient-results-for-logit-and-probit" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="coefficient-results-for-logit-and-probit">Coefficient results for logit and probit</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">logit</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> sto logit_results</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  margins, <span class="kw">dydx</span>(*) <span class="kw">post</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> sto logit_mfx</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">probit</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> sto probit_results</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  margins, <span class="kw">dydx</span>(*) <span class="kw">post</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">est</span> sto probit_mfx</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>esttab lpm_results logit_results  logit_mfx probit_results probit_mfx, se  nonumber <span class="kw">drop</span>(0.*) <span class="co">///</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>mtitle(LPM Logit Logit_MFX Probit Probit_MFX) collabel(<span class="kw">none</span>) md <span class="co">///</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">star</span>(* 0.10 ** 0.05 *** 0.01) <span class="kw">nonotes</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">LPM</th>
<th style="text-align: center;">Logit</th>
<th style="text-align: center;">Logit_MFX</th>
<th style="text-align: center;">Probit</th>
<th style="text-align: center;">Probit_MFX</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>main</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>smoke</td>
<td style="text-align: center;">0.166**</td>
<td style="text-align: center;">0.925**</td>
<td style="text-align: center;">0.169**</td>
<td style="text-align: center;">0.549**</td>
<td style="text-align: center;">0.169**</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0739)</td>
<td style="text-align: center;">(0.397)</td>
<td style="text-align: center;">(0.0695)</td>
<td style="text-align: center;">(0.235)</td>
<td style="text-align: center;">(0.0697)</td>
</tr>
<tr class="even">
<td>age</td>
<td style="text-align: center;">-0.00703</td>
<td style="text-align: center;">-0.0447</td>
<td style="text-align: center;">-0.00818</td>
<td style="text-align: center;">-0.0271</td>
<td style="text-align: center;">-0.00835</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.00669)</td>
<td style="text-align: center;">(0.0377)</td>
<td style="text-align: center;">(0.00688)</td>
<td style="text-align: center;">(0.0221)</td>
<td style="text-align: center;">(0.00679)</td>
</tr>
<tr class="even">
<td>1.black</td>
<td style="text-align: center;">0.192*</td>
<td style="text-align: center;">1.012*</td>
<td style="text-align: center;">0.202*</td>
<td style="text-align: center;">0.607*</td>
<td style="text-align: center;">0.202*</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.111)</td>
<td style="text-align: center;">(0.526)</td>
<td style="text-align: center;">(0.109)</td>
<td style="text-align: center;">(0.314)</td>
<td style="text-align: center;">(0.108)</td>
</tr>
<tr class="even">
<td>1.other</td>
<td style="text-align: center;">0.150*</td>
<td style="text-align: center;">0.884**</td>
<td style="text-align: center;">0.164**</td>
<td style="text-align: center;">0.524**</td>
<td style="text-align: center;">0.163**</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0770)</td>
<td style="text-align: center;">(0.435)</td>
<td style="text-align: center;">(0.0787)</td>
<td style="text-align: center;">(0.254)</td>
<td style="text-align: center;">(0.0779)</td>
</tr>
<tr class="even">
<td>1.any_premature</td>
<td style="text-align: center;">0.284***</td>
<td style="text-align: center;">1.330***</td>
<td style="text-align: center;">0.279***</td>
<td style="text-align: center;">0.810***</td>
<td style="text-align: center;">0.280***</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0972)</td>
<td style="text-align: center;">(0.441)</td>
<td style="text-align: center;">(0.0944)</td>
<td style="text-align: center;">(0.270)</td>
<td style="text-align: center;">(0.0956)</td>
</tr>
<tr class="even">
<td>hist_hyper</td>
<td style="text-align: center;">0.370***</td>
<td style="text-align: center;">1.720**</td>
<td style="text-align: center;">0.315***</td>
<td style="text-align: center;">1.063**</td>
<td style="text-align: center;">0.327***</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.137)</td>
<td style="text-align: center;">(0.674)</td>
<td style="text-align: center;">(0.117)</td>
<td style="text-align: center;">(0.415)</td>
<td style="text-align: center;">(0.122)</td>
</tr>
<tr class="even">
<td>_cons</td>
<td style="text-align: center;">0.270</td>
<td style="text-align: center;">-0.971</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">-0.576</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.183)</td>
<td style="text-align: center;">(0.983)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.577)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td><em>N</em></td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
</tr>
</tbody>
</table>
<p><span class="table-note">Standard errors in parentheses</span> <span class="table-note"><sup>*</sup> <em>p</em> &lt; 0.1, <sup>**</sup> <em>p</em> &lt; 0.04, <sup>***</sup> <em>p</em> &lt; 0.01</span></p>
</section>
<section id="does-smoking-pose-a-health-risk-logit-and-probit" class="level2">
<h2 class="anchored" data-anchor-id="does-smoking-pose-a-health-risk-logit-and-probit">Does smoking pose a health risk?– logit and probit</h2>
<ul>
<li>LPM – interpret the coefficients as usual.</li>
<li>Logit, probit - Interpret the marginal differences. Basically the same.
<ul>
<li>Marginal differences are essentially the same across the logit and the probit.</li>
<li><strong>Essentially</strong> the same as the corresponding LPM coefficients.</li>
</ul></li>
<li>Happens often:
<ul>
<li>Often LPM is good enough for interpretation.</li>
<li>Check if logit/probit very different.
<ul>
<li>if so, Investigate functional forms if yes.</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="goodness-of-fit-measures" class="level1">
<h1>Goodness of fit measures</h1>
<section id="goodness-of-fit" class="level2">
<h2 class="anchored" data-anchor-id="goodness-of-fit">Goodness of fit</h2>
<ul>
<li>There is no generally accepted goodness of fit measure
<ul>
<li>This is because we do not observe probabilities only 1 and 0, so we cannot FIT those probabilities.</li>
</ul></li>
<li>There are, however, other options to evaluate the quality of the model.
<ul>
<li>R-squared</li>
<li>Brier score</li>
<li>Pseudo R-squared</li>
<li>log-loss</li>
</ul></li>
</ul>
</section>
<section id="goodness-of-fit-r-squared" class="level2">
<h2 class="anchored" data-anchor-id="goodness-of-fit-r-squared">Goodness of fit: R-squared</h2>
<p><span class="math display">\[R^2 = 1 - \frac{\sum_{i=1}^n (\hat{y}_P^i - y_i)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</span></p>
<ul>
<li>R-squared is not useful for binary outcomes
<ul>
<li>It can be calculated, but it lacks the interpretation we had for linear models, because we are fitting the probabilities, not the outcomes.</li>
</ul></li>
</ul>
</section>
<section id="brier-score" class="level2">
<h2 class="anchored" data-anchor-id="brier-score">Brier score</h2>
<p><span class="math display">\[\text{Brier} = \frac{1}{n}\sum_{i=1}^n (\hat{y}_P^i - y_i)^2\]</span></p>
<ul>
<li>The Brier score is the average distance (mean squared difference) between predicted probabilities and the actual value of <span class="math inline">\(y\)</span>.</li>
<li>Smaller the Brier score, the better.</li>
<li>When comparing two predictions, the one with the smaller Brier score is the better prediction because it produces less (squared) error on average.</li>
<li>Related to a main concept in prediction: mean squared error (MSE)</li>
</ul>
</section>
<section id="pseudo-r2" class="level2">
<h2 class="anchored" data-anchor-id="pseudo-r2">Pseudo R2</h2>
<p><span class="math display">\[pR^2 = 1 - \frac{\text{Log-likelihood}_{\text{model}}}{\text{Log-likelihood}_{\text{intercept only}}}\]</span></p>
<ul>
<li><p>It is similar to the R-squared, as it measures the goodness of fit, tailored to nonlinear models and binary outcomes.</p>
<ul>
<li>Most widely used: McFadden’s R-squared (<code>Stata</code> uses this)</li>
</ul></li>
<li><p>Computes the ratio of log-likelihood of the model vs <strong>intercept only</strong>.</p></li>
<li><p>Can be computed for the logit and the probit but not for the linear probability model. (unless you re-define the Log-likelihood)</p></li>
</ul>
</section>
<section id="log-loss" class="level2">
<h2 class="anchored" data-anchor-id="log-loss">Log-loss</h2>
<p><span class="math display">\[\text{Log-loss} = \frac{1}{n}\sum_{i=1}^n \left[y_i \log(\hat{y}_P^i) + (1-y_i) \log(1-\hat{y}_P^i) \right]\]</span></p>
<ul>
<li><p>The log-loss is a measured derived from the log-likelihood function. It measures how much observed data dissagrees with the predicted probabilities.</p></li>
<li><p>The smaller (close to zero) the log-loss, the better the model.</p></li>
</ul>
</section>
<section id="practical-use" class="level2">
<h2 class="anchored" data-anchor-id="practical-use">Practical use</h2>
<ul>
<li>There are several measured of model fit, but they often give the same ranking of models.</li>
<li>Do not use R-squared. Even for LPM, it has no interpretation.</li>
<li>If using probit vs logit: pseudo R-squared may be used to rank logit and probit models.</li>
<li>Use, especially for prediction: Brier score is a metric that can be computed for all models and is used in prediction.</li>
</ul>
</section>
<section id="bias-of-the-predictions" class="level2">
<h2 class="anchored" data-anchor-id="bias-of-the-predictions">Bias of the predictions</h2>
<ul>
<li>Post-prediction: we may be interested to study some features of our model</li>
<li>One specific goal: evaluating the bias of the prediction.
<ul>
<li>Probability predictions are unbiased if they are right on average = the average of predicted probabilities is equal to the actual probability of the outcome.</li>
<li>If the prediction is unbiased, the bias is zero.</li>
</ul></li>
<li>Unless the model is really bad, unconditional bias is not a big issue.
<ul>
<li>Only Probit will be biased.</li>
</ul></li>
</ul>
</section>
<section id="calibration" class="level2">
<h2 class="anchored" data-anchor-id="calibration">Calibration</h2>
<ul>
<li><p>Unbiasedness refers to the whole distribution of probability predictions.</p></li>
<li><p>A finer and stricter concept is calibration</p></li>
<li><p>A prediction is well calibrated if the actual probability of the outcome is equal to the predicted probability for each and every value of the predicted probability. <span class="math display">\[E(y|y^P) = y^P\]</span></p></li>
<li><p>‘Calibration curve’ is used to show this.</p></li>
<li><p>A model may be unbiased (right on average) but not well calibrated</p>
<ul>
<li>underestimate high probability events and overestimate low probability ones</li>
</ul></li>
</ul>
</section>
<section id="calibration-curve" class="level2">
<h2 class="anchored" data-anchor-id="calibration-curve">Calibration curve</h2>
<ul>
<li>Horizontal axis shows the values of all predicted probabilities (<span class="math inline">\(\hat{y}_P\)</span>).</li>
<li>Vertical axis shows the fraction of <span class="math inline">\(y = 1\)</span> observations for all observations with the corresponding predicted probability.</li>
<li>The closer the curve is to the 45-degree line, the better the calibration.</li>
</ul>
<p>In practice:</p>
<ul>
<li>Create bins for predicted probabilities and make comparisons of the actual event’s probability.</li>
<li>Or use non-parametric methods to estimate the calibration curve.</li>
</ul>
</section>
<section id="calibration-curve-1" class="level2">
<h2 class="anchored" data-anchor-id="calibration-curve-1">Calibration curve</h2>
<div id="1b07866b" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">two</span> (lpoly low low_hat_ols) (lpoly low low_hat_logit) <span class="co">///</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>(lpoly low low_hat_probit) (<span class="kw">function</span> <span class="fu">y</span> = x, <span class="kw">range</span>(0 1) lcolor(<span class="bn">black</span>%50)), <span class="co">///</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"LPM"</span> 2 <span class="st">"Logit"</span> 3 <span class="st">"Probit"</span>) ) <span class="kw">scale</span>(1.5) <span class="co">///</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bn">xtitle</span>(<span class="st">"Predicted probability"</span>) <span class="bn">ytitle</span>(<span class="st">"Avg outcome"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week08_files/figure-revealjs/cell-9-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="probability-models-summary" class="level2">
<h2 class="anchored" data-anchor-id="probability-models-summary">Probability models summary</h2>
<ul>
<li>Find patterns when <span class="math inline">\(y\)</span> is binary can be done using model probability with regressions</li>
<li>Linear probability model is mostly good enough, easy inference.
<ul>
<li>to-go for data exploration, quick analysis, and diagnostics</li>
<li>but, predicted values could be below 0, above 1</li>
</ul></li>
<li>Logit (and probit) - better when aim is prediction, predicted values strictly between 0-1</li>
<li>Most often, LPM, logit, probit - similar inference</li>
<li>Use marginal (average) differences (with logit/probit)</li>
<li>No trivial goodness of fit. Brier score or pseudo-R-Squared.</li>
<li>Calibration is important for prediction.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>