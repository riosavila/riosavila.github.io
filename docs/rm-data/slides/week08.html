<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.33">

  <meta name="author" content="Fernando Rios-Avila">
  <meta name="dcterms.date" content="2024-08-26">
  <title>Econometrics MSC Levy – Modeling Probabilities</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-97edfe54b73ff960639f8ac44205bcc0.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

  

  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Modeling Probabilities</h1>
  <p class="subtitle">to be or not to be</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Fernando Rios-Avila 
</div>
        <p class="quarto-title-affiliation">
            Levy Economics Institute
          </p>
    </div>
</div>

  <p class="date">August 26, 2024</p>
</section>
<section id="what-we-will-see-today" class="slide level2">
<h2>What we will see today</h2>
<ul>
<li>Linear Probability Model - LPM</li>
<li>Logit &amp; probit</li>
<li>Goodness of fit</li>
<li>Diagnostics</li>
<li>Summary</li>
</ul>
</section>
<section id="motivation" class="slide level2">
<h2>Motivation</h2>
<ul>
<li>What are the health benefits of not smoking? Considering the 50+ population, we can investigate if differences in smoking habits are correlated with differences in health status.
<ul>
<li>good health vs bad health</li>
</ul></li>
</ul>
</section>
<section id="binary-events" class="slide level2">
<h2>Binary events</h2>
<ul>
<li>Some outcomes are things that either happen or don’t happen, which can be captured by binary variables
<ul>
<li>e.g.&nbsp;a person is healthy or not, a person is employed or not, a person is a smoker or not. We dont see a person that is half healthy, half employed, or half a smoker.</li>
</ul></li>
<li>How can we model these events?
<ul>
<li>We have seen this before. Instead of modeling the value itself, we model the probability of the event happening.</li>
</ul></li>
</ul>
<p><span class="math display">\[E[y] = P[y = 1]\]</span></p>
<ul>
<li>In fact, the average of a 0–1 event is the probability of that event happening. Which can also be estimated as conditional probabilities:</li>
</ul>
<p><span class="math display">\[E[y|x_1, x_2, ...] = P[y = 1|x_1, x_2, ...]\]</span></p>
<ul>
<li>Good news, we can use the same tools we have been using to model these probabilities.</li>
</ul>
</section>
<section>
<section id="modelling-events-lpm" class="title-slide slide level1 center">
<h1>Modelling events: LPM</h1>

</section>
<section id="lpm-linear-probability-model" class="slide level2">
<h2>LPM: Linear probability model</h2>
<ul>
<li>Linear Probability Model (LPM) is a <strong>linear regression</strong> with a binary dependent variable
<ul>
<li>It has the goal of modeling the probability of an event happening</li>
</ul></li>
<li>A linear regressions with binary dependent variables shows:
<ul>
<li>differences in expected <span class="math inline">\(y\)</span> by <span class="math inline">\(x\)</span>, represent diferences in probability of <span class="math inline">\(y = 1\)</span> by <span class="math inline">\(x\)</span>.</li>
</ul></li>
<li>Introduce notation for probability: <span class="math inline">\(y^P = P[y = 1|x_1, x_2, . . .]\)</span></li>
<li>Linear probability model (LPM) regression is <span class="math inline">\(y^P = \beta_0 + \beta_1 x_1 + \beta_2 x_2\)</span></li>
</ul>
</section>
<section id="lpm-interpretation" class="slide level2">
<h2>LPM: Interpretation</h2>
<p><span class="math display">\[y^P = \beta_0 + \beta_1 x_1 + \beta_2 x_2\]</span></p>
<ul>
<li>So far nothing changes in terms of modelling or estimation. However, the interpretation of the coefficients changes.
<ul>
<li><span class="math inline">\(y^P\)</span> denotes the probability that the dependent variable is one, conditional on the right-hand-side variables of the model.</li>
<li><span class="math inline">\(\beta_0\)</span> shows the <em>predicted</em> probability of <span class="math inline">\(y\)</span> if all <span class="math inline">\(x\)</span> are zero.</li>
<li><span class="math inline">\(\beta_1\)</span> shows the difference in the probability that <span class="math inline">\(y = 1\)</span> for observations that are different in <span class="math inline">\(x_1\)</span> but are the same in terms of <span class="math inline">\(x_2\)</span>. (ceteris paribus)</li>
</ul></li>
</ul>
</section>
<section id="lpm-modelling" class="slide level2">
<h2>LPM: Modelling</h2>
<ul>
<li>Linear probability model (<strong>LPM</strong>) can be estimated using OLS. (just like linear regression)</li>
<li>We can use all transformations in <span class="math inline">\(x\)</span>, that we used before:
<ul>
<li>Log, Polinomials, Splines, dummies, interactions, etc. They all work.</li>
</ul></li>
<li>All formulae and interpretations for standard errors, confidence intervals, hypotheses and p-values of tests are the same.</li>
<li><span class="red"><strong>IMPORTANT</strong></span> Heteroskedasticity robust error are essential in this case!
<ul>
<li>By construction LPMs are heteroskedastic!</li>
<li>And ignoring this fact will lead to biased standard errors and confidence intervals.</li>
</ul></li>
</ul>
</section>
<section id="lpm-prediction" class="slide level2">
<h2>LPM: Prediction</h2>
<ul>
<li>Predicted values - <span class="math inline">\(\hat{y}_P\)</span> - may be problematic. Although they are calculated the same way, they need to be interpreted as <strong>probabilities</strong>.</li>
</ul>
<p><span class="math display">\[\hat{y}^P = \hat{\beta}_0 + \hat{\beta}_1 x_1 + \hat{\beta}_2 x_2\]</span></p>
<ul>
<li>Predicted values <strong>need to be</strong> between 0 and 1 because they are probabilities</li>
<li>But in LPM, predictions may be below 0 and above 1. No formal bounds in the model.
<ul>
<li>more likely than certain, less likely than impossible</li>
</ul></li>
</ul>
</section>
<section id="lpm-prediction-1" class="slide level2">
<h2>LPM: Prediction</h2>
<ul>
<li>When to get worried?:
<ul>
<li>With continuous variables that can take any value (GDP, Population, sales, etc), this could be a serious issue (extrapolation)
<ul>
<li>We need to check if predictions are within the 0-1 range at least “in-sample”. But, this is not a guarantee that it will be the case “out-of-sample”.</li>
</ul></li>
<li>With binary variables, no problem (‘saturated models’) (interpolation)
<ul>
<li>Not problem because “simple” means will always be between 0 and 1.</li>
</ul></li>
</ul></li>
<li>So, a problem if goal is prediction!</li>
<li>Not a big issue for inference → uncover patterns of association.
<ul>
<li>But it may give biased estimates…(in <strong>theory</strong>)</li>
</ul></li>
</ul>
</section>
<section id="cs-does-smoking-pose-a-health-risk" class="slide level2">
<h2>CS: Does smoking pose a health risk?</h2>
<blockquote>
<p>This is on of the few datasets from the book that is not directly available from their website. If interested, you need to go over the repository, and follow the instructions to access the data.</p>
</blockquote>
<p>Thus, we will use a different dataset to illustrate the concepts.</p>
</section>
<section id="cs-does-smoking-during-pregnancy-affect-birth-weight" class="slide level2">
<h2>CS: Does smoking during pregnancy affect birth weight?</h2>
<ul>
<li>The question is whether, and by how much, smoking during pregnancy affects the likelihood that a baby is born with low birth weight.</li>
<li>We will use “lbw” dataset from Stata’s example datasets.</li>
<li>The dataset contains information on 189 observations of mothers and their newborns.
<ul>
<li><code>low</code> is a binary variable indicating whether the baby was born with low birth weight (&lt;2500gr &lt;5.5lbs).</li>
<li><code>smoke</code> is a binary variable indicating whether the mother smoked during pregnancy.</li>
</ul></li>
</ul>
</section>
<section id="data" class="slide level2">
<h2>Data</h2>
<ul>
<li><span class="math inline">\(low = 1\)</span> if baby was born with low birth weight</li>
<li><span class="math inline">\(low = 0\)</span> if baby was born with normal weight -Some demographic information on all individual</li>
<li>We exclude women &lt;15 years old and &gt;40 years old<br>
</li>
<li>Also exclude women with Weight &gt; 200lbs (before pregnancy)</li>
</ul>
</section>
<section id="lpm-in-stata" class="slide level2">
<h2>LPM: in Stata</h2>
<ul>
<li>Start with a simple univariate model: <span class="math inline">\(P[low|smoke] = \alpha + \beta[smoke]\)</span></li>
</ul>
<div id="92d6978f" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a></a><span class="kw">webuse</span> lbw, <span class="kw">clear</span></span>
<span id="cb1-2"><a></a><span class="kw">drop</span> <span class="kw">if</span> age &lt; 15 | age &gt; 40 | lwt &gt; 200</span>
<span id="cb1-3"><a></a><span class="kw">reg</span> low smoke, <span class="kw">robust</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Hosmer &amp; Lemeshow data)
(10 observations deleted)

Linear regression                               Number of obs     =        179
                                                F(1, 177)         =       4.70
                                                Prob &gt; F          =     0.0316
                                                R-squared         =     0.0272
                                                Root MSE          =     .46208

------------------------------------------------------------------------------
             |               Robust
         low | Coefficient  std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
       smoke |    .157405   .0726412     2.17   0.032     .0140507    .3007593
       _cons |   .2568807   .0420845     6.10   0.000     .1738289    .3399326
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="lpm-interpretation-1" class="slide level2">
<h2>LPM: Interpretation</h2>
<p>Interpretation:</p>
<ul>
<li>The coefficient on <code>smoker</code> shows the difference in the probability of a baby.</li>
<li>Babies are <strong>15.7</strong> percentage points more likely to be born with low birth weight if the mother smoked during pregnancy.
<ul>
<li>Are you comparing Apples to apples?</li>
<li>Lets add additional controls to capture other factors</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-i" class="slide level2">
<h2>LPM: with many regressors I</h2>
<ul>
<li>Multiple regression – closer to causality</li>
<li>Compare women who are very similar in many respects but are different in smoking habits</li>
<li>Smokers / non-smokers – different in many other behaviors and conditions:
<ul>
<li>personal traits (age, race)</li>
<li>behavior pre-pregnancy (Pre-pregnancy weight)</li>
<li>Medical history (History of Hypertension)</li>
<li>background for pregnancy (Number of prenatal visits, Previous premature labor)</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-ii" class="slide level2">
<h2>LPM with many regressors II</h2>
<ul>
<li>May also consider functional form selection or interactions</li>
<li>Trial and error, or theory-based</li>
<li>Useful to check bivariate relationships (scatter plots, Lpoly, correlations)
<ul>
<li>For now, assume linear relationships</li>
</ul></li>
</ul>
</section>
<section id="lpm-with-many-regressors-iii" class="slide level2">
<h2>LPM with many regressors III</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a></a><span class="kw">qui</span> {</span>
<span id="cb3-2"><a></a><span class="kw">gen</span> any_premature = ptl &gt;0</span>
<span id="cb3-3"><a></a><span class="kw">ren</span> ftv no_of_visits_1tr</span>
<span id="cb3-4"><a></a><span class="kw">ren</span> ht hist_hyper</span>
<span id="cb3-5"><a></a><span class="kw">ren</span> lwt wgt_bef_preg</span>
<span id="cb3-6"><a></a><span class="kw">reg</span> low smoke age i.race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg, <span class="kw">robust</span> nohead</span>
<span id="cb3-7"><a></a>}</span>
<span id="cb3-8"><a></a><span class="kw">est</span> <span class="kw">store</span> lpm_results</span>
<span id="cb3-9"><a></a>esttab lpm_results,   se  <span class="kw">wide</span> nonumber <span class="co">///</span></span>
<span id="cb3-10"><a></a>collabel(b se) md <span class="kw">drop</span>(1.race) nomtitle b(3) <span class="kw">nonotes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">b</th>
<th style="text-align: center;">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>smoke</td>
<td style="text-align: center;">0.151<sup>*</sup></td>
<td style="text-align: center;">(0.075)</td>
</tr>
<tr class="even">
<td>age</td>
<td style="text-align: center;">-0.005</td>
<td style="text-align: center;">(0.007)</td>
</tr>
<tr class="odd">
<td>2.race</td>
<td style="text-align: center;">0.210</td>
<td style="text-align: center;">(0.112)</td>
</tr>
<tr class="even">
<td>3.race</td>
<td style="text-align: center;">0.126</td>
<td style="text-align: center;">(0.079)</td>
</tr>
<tr class="odd">
<td>any_premature</td>
<td style="text-align: center;">0.275<sup>**</sup></td>
<td style="text-align: center;">(0.097)</td>
</tr>
<tr class="even">
<td>hist_hyper</td>
<td style="text-align: center;">0.396<sup>**</sup></td>
<td style="text-align: center;">(0.143)</td>
</tr>
<tr class="odd">
<td>no_of_visits_1tr</td>
<td style="text-align: center;">-0.005</td>
<td style="text-align: center;">(0.034)</td>
</tr>
<tr class="even">
<td>wgt_bef_preg</td>
<td style="text-align: center;">-0.002</td>
<td style="text-align: center;">(0.002)</td>
</tr>
<tr class="odd">
<td>_cons</td>
<td style="text-align: center;">0.464</td>
<td style="text-align: center;">(0.252)</td>
</tr>
<tr class="even">
<td><em>N</em></td>
<td style="text-align: center;">179</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p><span class="table-note">Robust standard errors in parentheses</span> <span class="table-note"><sup>*</sup> <em>p</em> &lt; 0.05, <sup>**</sup> <em>p</em> &lt; 0.01, <sup>***</sup> <em>p</em> &lt; 0.001</span></p>
</section>
<section id="detour-regression-tables" class="slide level2">
<h2>Detour: Regression Tables</h2>
<ul>
<li>If need to show many explanatory variables</li>
<li>Do not show table 12*2 rows, people will not see it.
<ul>
<li>Avoid copy pasting from your document! Those tables are unwieldy.</li>
</ul></li>
<li>Either only show selected variables (smoke + 2-3 others)</li>
<li>Or may need to create two columns. (a bit more work)
<ul>
<li>In my case, Wide format did the trick.</li>
</ul></li>
<li>Make site you have title, N of observations, footnote on SE, stars.</li>
<li>SE, stars: many different notations. Check carefully.
<ul>
<li><code>esttab</code> default is <span class="math inline">\(p^{***}= p&lt;0.001\)</span>, <span class="math inline">\(0.01\)</span> and <span class="math inline">\(0.05\)</span></li>
<li>In papers there is <span class="math inline">\(p^{***}=p&lt;0.01\)</span>, <span class="math inline">\(0.05\)</span> and <span class="math inline">\(0.1\)</span>.</li>
</ul></li>
</ul>
</section>
<section id="does-smoking-pose-a-health-risk-for-the-baby" class="slide level2">
<h2>Does smoking pose a health risk for the baby?</h2>
<ul>
<li>Coefficient on smoking during pregnancy is <strong>-.151</strong>.
<ul>
<li>Women who smoked during pregnancy are <strong>15.1</strong> percentage points more likely to have a baby with low birth weight.</li>
</ul></li>
<li>The 95% confidence interval is relatively wide <span class="math inline">\([0.002, 0.300]\)</span>, but it does not contain zero</li>
<li>Age, Race?, Nr of Visits and Pre-pregnancy weight do not seem to be factors</li>
<li>Hypertension and previous premature labor are significant factors, increasing the probability of low birth weight by 40pp and 27.5pp, respectively.</li>
</ul>
</section>
<section id="lpms-predicted-probabilities" class="slide level2">
<h2>LPM’s predicted probabilities</h2>
<div id="dd249d47" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a></a><span class="kw">qui</span>: <span class="kw">reg</span> low smoke age i.race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg, <span class="kw">robust</span> nohead</span>
<span id="cb4-2"><a></a><span class="kw">qui</span>: <span class="kw">predict</span> low_hat</span>
<span id="cb4-3"><a></a><span class="kw">qui</span>:<span class="kw">histogram</span> low_hat</span>
<span id="cb4-4"><a></a><span class="kw">sum</span> low_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
     low_hat |        179    .3184358    .1878437  -.0346098   .9483117</code></pre>
</div>

</div>
<img data-src="week08_files/figure-revealjs/cell-4-output-2.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="analysis-of-lpms-predicted-probabilities" class="slide level2">
<h2>Analysis of LPM’s predicted probabilities</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">What to do</a></li><li><a href="#tabset-1-2">What we find</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<ul>
<li>Drill down in distribution:
<ul>
<li>Looking at the composition of people: top vs bottom part of probability distribution</li>
<li>Look at average values of covariates for top and bottom X% of predicted probabilities!</li>
</ul></li>
</ul>
</div>
<div id="tabset-1-2">
<div id="74bb6707" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a></a><span class="kw">sort</span> low_hat</span>
<span id="cb6-2"><a></a><span class="kw">set</span> <span class="dv">linesize</span> 255</span>
<span id="cb6-3"><a></a> </span>
<span id="cb6-4"><a></a><span class="kw">qui</span>: <span class="kw">gen</span> flag = 1 <span class="kw">if</span> <span class="dt">_n</span>&lt;=5</span>
<span id="cb6-5"><a></a><span class="kw">qui</span>: <span class="kw">replace</span>  flag = 2 <span class="kw">if</span> <span class="dt">_n</span>&gt;=_N-4</span>
<span id="cb6-6"><a></a><span class="ot">list</span> low_hat smoke age race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg   <span class="kw">if</span> flag==1</span>
<span id="cb6-7"><a></a><span class="ot">list</span> low_hat smoke age race any_premature hist_hyper  no_of_visits_1tr wgt_bef_preg   <span class="kw">if</span> flag==2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     +---------------------------------------------------------------------------------+
     |   low_hat       smoke   age    race   any_pr~e   hist_h~r   no_of_~r   wgt_be~g |
     |---------------------------------------------------------------------------------|
  1. | -.0346098   Nonsmoker    32   White          0          0          2        186 |
  2. | -.0280454   Nonsmoker    36   White          0          0          0        175 |
  3. |  .0019138   Nonsmoker    32   White          0          0          0        170 |
  4. |  .0158307   Nonsmoker    23   White          0          0          0        190 |
  5. |  .0284496   Nonsmoker    28   White          0          0          0        167 |
     +---------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------+
     |  low_hat       smoke   age    race   any_pr~e   hist_h~r   no_of_~r   wgt_be~g |
     |--------------------------------------------------------------------------------|
175. | .7197446      Smoker    34   Black          0          1          0        187 |
176. | .7369648   Nonsmoker    17   Black          0          1          0        142 |
177. | .8160616      Smoker    18   Black          1          0          0        110 |
178. | .8545191   Nonsmoker    26   Other          1          1          1        154 |
179. | .9483117   Nonsmoker    25   Other          1          1          0        105 |
     +--------------------------------------------------------------------------------+</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="modelling-events-logprobit" class="title-slide slide level1 center">
<h1>Modelling events: <br> [log/prob]it</h1>

</section>
<section id="probability-models-logit-and-probit" class="slide level2">
<h2>Probability models: logit and probit</h2>
<ul>
<li><strong>Prediction:</strong> predicted probability need to be between 0 and 1
<ul>
<li>Thus, for prediction, we <strong>must</strong> use non-linear models</li>
<li>Actually, its a quasi-linear model.</li>
</ul></li>
<li>The model, itself, is linear in the parameters</li>
<li>but need to relate this to the probability of the <span class="math inline">\(y = 1\)</span> event, using a nonlinear function that maps the linear index into a 0-1 range: <strong>‘Link function’</strong></li>
</ul>
<p><span class="math display">\[\begin{aligned}
XB &amp;= \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ... \\
y^P &amp;= F(XB) \rightarrow y^P \in (0,1)
\end{aligned}
\]</span></p>
<ul>
<li>Two options: Logit and probit – different link function</li>
</ul>
</section>
<section id="link-functions-i." class="slide level2">
<h2>Link functions I.</h2>
<p>Call <span class="math inline">\(XB = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + ...\)</span></p>
<ul>
<li><p>The Logit:<br>
<span class="math inline">\(y^P = \Lambda(XB) = \frac{\exp(XB)}{1 + \exp(XB)}\)</span></p></li>
<li><p>The probit:<br>
<span class="math inline">\(y^P = \Phi(XB) \rightarrow \Phi(z) = \int_{-\infty}^z \frac{1}{\sqrt{2\pi}} \exp\left(-\frac{z^2}{2}\right) dz\)</span></p></li>
</ul>
<p>where <span class="math inline">\(\Lambda()\)</span> is called logistic function, and <span class="math inline">\(\Phi()\)</span> is the cumulative distribution function (CDF) of the standard normal distribution.</p>
</section>
<section id="link-functions-ii." class="slide level2">
<h2>Link functions II.</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>Both link functions are S-shaped curves bounded between 0 and 1.</li>
<li>There is but a small difference between the two.</li>
<li>but estimated coefficients will be different.</li>
</ul>
</div><div class="column" style="width:60%;">
<div id="874d63fc" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a></a><span class="kw">qui</span> {</span>
<span id="cb8-2"><a></a><span class="kw">clear</span></span>
<span id="cb8-3"><a></a><span class="kw">range</span> <span class="kw">p</span> 0 1 202</span>
<span id="cb8-4"><a></a><span class="kw">drop</span> <span class="kw">if</span> <span class="kw">p</span>==0 | <span class="kw">p</span>==1 </span>
<span id="cb8-5"><a></a><span class="kw">gen</span> x = <span class="fu">invnormal</span>(<span class="kw">p</span>)</span>
<span id="cb8-6"><a></a><span class="kw">gen</span> <span class="fu">y</span> = (x+rnormal())&gt;0</span>
<span id="cb8-7"><a></a><span class="kw">reg</span>  <span class="fu">y</span> x</span>
<span id="cb8-8"><a></a><span class="kw">predict</span> y_1</span>
<span id="cb8-9"><a></a><span class="kw">logit</span> <span class="fu">y</span> x</span>
<span id="cb8-10"><a></a><span class="kw">predict</span> y_2</span>
<span id="cb8-11"><a></a><span class="kw">probit</span> <span class="fu">y</span> x</span>
<span id="cb8-12"><a></a><span class="kw">predict</span> y_3</span>
<span id="cb8-13"><a></a><span class="kw">drop</span> <span class="kw">if</span> <span class="fu">abs</span>(x)&gt;2</span>
<span id="cb8-14"><a></a><span class="kw">two</span> (<span class="kw">line</span> y_1 x ) (<span class="kw">line</span> y_2 x) (<span class="kw">line</span> y_3 x), <span class="co">///</span></span>
<span id="cb8-15"><a></a><span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"LPM"</span> 2 <span class="st">"Logit"</span> 3 <span class="st">"Probit"</span>) pos(3) <span class="bn">ring</span>(0) col(1)) </span>
<span id="cb8-16"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="week08_files/figure-revealjs/cell-6-output-1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="logit-and-probit-interpretation" class="slide level2">
<h2>Logit and probit interpretation</h2>
<ul>
<li>Both the probit and the logit transform the <span class="math inline">\(\beta_0 + \beta_1 x_1 + ...\)</span> linear combination using a link function that shows an S-shaped curve.</li>
<li>The slope of this curve keeps changing as we change whatever is inside, but it’s steepest when <span class="math inline">\(y^P = 0.5\)</span> (inflection point)</li>
<li>The difference in <span class="math inline">\(y^P\)</span> corresponds to changes in probabilities, between any two values of <span class="math inline">\(x\)</span>.</li>
<li>To find how much is related to a particular <span class="math inline">\(x\)</span>, You need to take the partial derivatives.</li>
<li><strong>Important consequence</strong>: no direct interpretation of the raw coefficient values!
<ul>
<li>Thus, always know if you are interpreting the raw coefficients or the marginal differences.</li>
</ul></li>
</ul>
</section>
<section id="marginal-differences-marginal-effects" class="slide level2">
<h2>Marginal differences (marginal effects)</h2>
<blockquote>
<p><strong>NOTE</strong> As before, the word “effect” should be used with caution. In the book, they use “marginal differences” instead. as a more neutral term.</p>
</blockquote>
<ul>
<li><p>Link functions makes associates <span class="math inline">\(\Delta x\)</span> into <span class="math inline">\(\Delta y_P\)</span>. we do not interpret raw coefficients! (except for direction)</p></li>
<li><p>Instead, transform them into ‘marginal differences’ for interpretation purposes</p></li>
<li><p>They are also called ‘marginal effects’ or ‘average marginal effects (AME)’ or ‘average partial effects’.</p></li>
<li><p>Average marginal difference has the same interpretation as the coefficient of linear probability models, but with caveats.</p></li>
</ul>
</section>
<section id="marginal-differences-discrete-x" class="slide level2">
<h2>Marginal differences: Discrete <span class="math inline">\(x\)</span></h2>
<ul>
<li>if <span class="math inline">\(x\)</span> is a categorical (0-1), the marginal difference is the difference in the predicted probability of <span class="math inline">\(y = 1\)</span>, that corresponds to a change from <span class="math inline">\(x = 0\)</span> to <span class="math inline">\(x = 1\)</span>.</li>
</ul>
<p><span class="math display">\[\Delta y^P = y^P(x = 1) - y^P(x = 0)\]</span></p>
<ul>
<li>Then we simply “average” this difference across all observations.</li>
</ul>
</section>
<section id="marginal-differences-continous-x" class="slide level2">
<h2>Marginal differences: continous <span class="math inline">\(x\)</span></h2>
<ul>
<li>If <span class="math inline">\(x\)</span> is continuous, the marginal difference is calculated as the derivative (for a small change in <span class="math inline">\(x\)</span>).</li>
</ul>
<p><span class="math display">\[\frac{\partial y^P}{\partial x_1} = \beta_1 \cdot f(XB)\]</span></p>
<ul>
<li><p>Which is then averaged across all observations to report a single number.</p></li>
<li><p>In practice, we interpret this as the change in the probability of <span class="math inline">\(y = 1\)</span> for a one-unit change in <span class="math inline">\(x_1\)</span>.</p></li>
</ul>
</section>
<section id="how-to-estimate-this-models" class="slide level2">
<h2>How to estimate this models?</h2>
<h3 id="maximum-likelihood-estimation">Maximum likelihood estimation!</h3>
<ul>
<li>When estimating a logit or probit model, we use ‘maximum likelihood’ estimation.
<ul>
<li>See 11.U2 for details.</li>
</ul></li>
<li>Idea for maximum likelihood is another way to get coefficient estimates.
<ul>
<li><strong>1st</strong> You specify a (conditional) distribution, that you will use during the estimation.
<ul>
<li>This is logistic for logit and normal for probit model.</li>
</ul></li>
<li><strong>2nd</strong> You maximize this function w.r.t. your <span class="math inline">\(\beta\)</span> parameters → gives the maximum likelihood for this model.</li>
</ul></li>
<li>Different from OLS: No closed form solution → need to use search algorithms.
<ul>
<li>Thus… more computationally intensive.</li>
</ul></li>
</ul>
</section>
<section id="predictions-for-lmp-logit-and-probit-i." class="slide level2">
<h2>Predictions for LMP, Logit and Probit I.</h2>
<div id="023916e9" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a></a><span class="kw">qui</span> {</span>
<span id="cb9-2"><a></a>  <span class="kw">webuse</span> lbw, <span class="kw">clear</span></span>
<span id="cb9-3"><a></a>  <span class="kw">drop</span> <span class="kw">if</span> age &lt; 15 | age &gt; 40 | lwt &gt; 200</span>
<span id="cb9-4"><a></a>  <span class="kw">gen</span> any_premature = ptl &gt;0</span>
<span id="cb9-5"><a></a>  <span class="kw">ren</span> ftv no_of_visits_1tr</span>
<span id="cb9-6"><a></a>  <span class="kw">ren</span> ht hist_hyper</span>
<span id="cb9-7"><a></a>  <span class="kw">ren</span> lwt wgt_bef_preg</span>
<span id="cb9-8"><a></a>  <span class="kw">gen</span> <span class="bn">black</span> = 2.race</span>
<span id="cb9-9"><a></a>  <span class="kw">gen</span> other = 3.race</span>
<span id="cb9-10"><a></a>  <span class="kw">reg</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-11"><a></a>  <span class="kw">predict</span> low_hat_ols</span>
<span id="cb9-12"><a></a>  <span class="kw">est</span> sto lpm_results</span>
<span id="cb9-13"><a></a>  <span class="kw">logit</span> low smoke age <span class="bn">black</span> other any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-14"><a></a>  <span class="kw">predict</span> low_hat_logit</span>
<span id="cb9-15"><a></a>   <span class="kw">probit</span> low smoke age <span class="bn">black</span> other any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb9-16"><a></a>  <span class="kw">predict</span> low_hat_probit</span>
<span id="cb9-17"><a></a>   <span class="kw">two</span> (<span class="kw">scatter</span>  low_hat_logit low_hat_probit low_hat_ols) <span class="co">///</span></span>
<span id="cb9-18"><a></a>      (<span class="kw">line</span> low_hat_ols low_hat_ols, <span class="kw">sort</span>), <span class="co">///</span></span>
<span id="cb9-19"><a></a>      <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Logit"</span> 2 <span class="st">"Probit"</span> 3 <span class="st">"LPM"</span>) pos(3) <span class="bn">ring</span>(0) col(1))</span>
<span id="cb9-20"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="week08_files/figure-revealjs/cell-7-output-1.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="coefficient-results-for-logit-and-probit" class="slide level2 smaller">
<h2>Coefficient results for logit and probit</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a></a><span class="kw">qui</span> {</span>
<span id="cb10-2"><a></a>  <span class="kw">logit</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead</span>
<span id="cb10-3"><a></a>  <span class="kw">est</span> sto logit_results</span>
<span id="cb10-4"><a></a>  margins, <span class="kw">dydx</span>(*) <span class="kw">post</span></span>
<span id="cb10-5"><a></a>  <span class="kw">est</span> sto logit_mfx</span>
<span id="cb10-6"><a></a>  <span class="kw">probit</span> low smoke age i.<span class="bn">black</span> i.other i.any_premature hist_hyper , <span class="kw">robust</span> nohead  </span>
<span id="cb10-7"><a></a>  <span class="kw">est</span> sto probit_results</span>
<span id="cb10-8"><a></a>  margins, <span class="kw">dydx</span>(*) <span class="kw">post</span></span>
<span id="cb10-9"><a></a>  <span class="kw">est</span> sto probit_mfx</span>
<span id="cb10-10"><a></a>}</span>
<span id="cb10-11"><a></a>esttab lpm_results logit_results  logit_mfx probit_results probit_mfx, se  nonumber <span class="kw">drop</span>(0.*) <span class="co">///</span></span>
<span id="cb10-12"><a></a>mtitle(LPM Logit Logit_MFX Probit Probit_MFX) collabel(<span class="kw">none</span>) md <span class="co">///</span></span>
<span id="cb10-13"><a></a><span class="kw">star</span>(* 0.10 ** 0.05 *** 0.01) <span class="kw">nonotes</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top">
<colgroup>
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">LPM</th>
<th style="text-align: center;">Logit</th>
<th style="text-align: center;">Logit_MFX</th>
<th style="text-align: center;">Probit</th>
<th style="text-align: center;">Probit_MFX</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>main</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>smoke</td>
<td style="text-align: center;">0.166**</td>
<td style="text-align: center;">0.925**</td>
<td style="text-align: center;">0.169**</td>
<td style="text-align: center;">0.549**</td>
<td style="text-align: center;">0.169**</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0739)</td>
<td style="text-align: center;">(0.397)</td>
<td style="text-align: center;">(0.0695)</td>
<td style="text-align: center;">(0.235)</td>
<td style="text-align: center;">(0.0697)</td>
</tr>
<tr class="even">
<td>age</td>
<td style="text-align: center;">-0.00703</td>
<td style="text-align: center;">-0.0447</td>
<td style="text-align: center;">-0.00818</td>
<td style="text-align: center;">-0.0271</td>
<td style="text-align: center;">-0.00835</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.00669)</td>
<td style="text-align: center;">(0.0377)</td>
<td style="text-align: center;">(0.00688)</td>
<td style="text-align: center;">(0.0221)</td>
<td style="text-align: center;">(0.00679)</td>
</tr>
<tr class="even">
<td>1.black</td>
<td style="text-align: center;">0.192*</td>
<td style="text-align: center;">1.012*</td>
<td style="text-align: center;">0.202*</td>
<td style="text-align: center;">0.607*</td>
<td style="text-align: center;">0.202*</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.111)</td>
<td style="text-align: center;">(0.526)</td>
<td style="text-align: center;">(0.109)</td>
<td style="text-align: center;">(0.314)</td>
<td style="text-align: center;">(0.108)</td>
</tr>
<tr class="even">
<td>1.other</td>
<td style="text-align: center;">0.150*</td>
<td style="text-align: center;">0.884**</td>
<td style="text-align: center;">0.164**</td>
<td style="text-align: center;">0.524**</td>
<td style="text-align: center;">0.163**</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0770)</td>
<td style="text-align: center;">(0.435)</td>
<td style="text-align: center;">(0.0787)</td>
<td style="text-align: center;">(0.254)</td>
<td style="text-align: center;">(0.0779)</td>
</tr>
<tr class="even">
<td>1.any_premature</td>
<td style="text-align: center;">0.284***</td>
<td style="text-align: center;">1.330***</td>
<td style="text-align: center;">0.279***</td>
<td style="text-align: center;">0.810***</td>
<td style="text-align: center;">0.280***</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.0972)</td>
<td style="text-align: center;">(0.441)</td>
<td style="text-align: center;">(0.0944)</td>
<td style="text-align: center;">(0.270)</td>
<td style="text-align: center;">(0.0956)</td>
</tr>
<tr class="even">
<td>hist_hyper</td>
<td style="text-align: center;">0.370***</td>
<td style="text-align: center;">1.720**</td>
<td style="text-align: center;">0.315***</td>
<td style="text-align: center;">1.063**</td>
<td style="text-align: center;">0.327***</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.137)</td>
<td style="text-align: center;">(0.674)</td>
<td style="text-align: center;">(0.117)</td>
<td style="text-align: center;">(0.415)</td>
<td style="text-align: center;">(0.122)</td>
</tr>
<tr class="even">
<td>_cons</td>
<td style="text-align: center;">0.270</td>
<td style="text-align: center;">-0.971</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">-0.576</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">(0.183)</td>
<td style="text-align: center;">(0.983)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.577)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td><em>N</em></td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
<td style="text-align: center;">179</td>
</tr>
</tbody>
</table>
<p><span class="table-note">Standard errors in parentheses</span> <span class="table-note"><sup>*</sup> <em>p</em> &lt; 0.1, <sup>**</sup> <em>p</em> &lt; 0.04, <sup>***</sup> <em>p</em> &lt; 0.01</span></p>
</section>
<section id="does-smoking-pose-a-health-risk-logit-and-probit" class="slide level2">
<h2>Does smoking pose a health risk?– logit and probit</h2>
<ul>
<li>LPM – interpret the coefficients as usual.</li>
<li>Logit, probit - Interpret the marginal differences. Basically the same.
<ul>
<li>Marginal differences are essentially the same across the logit and the probit.</li>
<li><strong>Essentially</strong> the same as the corresponding LPM coefficients.</li>
</ul></li>
<li>Happens often:
<ul>
<li>Often LPM is good enough for interpretation.</li>
<li>Check if logit/probit very different.
<ul>
<li>if so, Investigate functional forms if yes.</li>
</ul></li>
</ul></li>
</ul>
</section></section>
<section>
<section id="goodness-of-fit-measures" class="title-slide slide level1 center">
<h1>Goodness of fit measures</h1>

</section>
<section id="goodness-of-fit" class="slide level2">
<h2>Goodness of fit</h2>
<ul>
<li>There is no generally accepted goodness of fit measure
<ul>
<li>This is because we do not observe probabilities only 1 and 0, so we cannot FIT those probabilities.</li>
</ul></li>
<li>There are, however, other options to evaluate the quality of the model.
<ul>
<li>R-squared</li>
<li>Brier score</li>
<li>Pseudo R-squared</li>
<li>log-loss</li>
</ul></li>
</ul>
</section>
<section id="goodness-of-fit-r-squared" class="slide level2">
<h2>Goodness of fit: R-squared</h2>
<p><span class="math display">\[R^2 = 1 - \frac{\sum_{i=1}^n (\hat{y}_P^i - y_i)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}\]</span></p>
<ul>
<li>R-squared is not useful for binary outcomes
<ul>
<li>It can be calculated, but it lacks the interpretation we had for linear models, because we are fitting the probabilities, not the outcomes.</li>
</ul></li>
</ul>
</section>
<section id="brier-score" class="slide level2">
<h2>Brier score</h2>
<p><span class="math display">\[\text{Brier} = \frac{1}{n}\sum_{i=1}^n (\hat{y}_P^i - y_i)^2\]</span></p>
<ul>
<li>The Brier score is the average distance (mean squared difference) between predicted probabilities and the actual value of <span class="math inline">\(y\)</span>.</li>
<li>Smaller the Brier score, the better.</li>
<li>When comparing two predictions, the one with the smaller Brier score is the better prediction because it produces less (squared) error on average.</li>
<li>Related to a main concept in prediction: mean squared error (MSE)</li>
</ul>
</section>
<section id="pseudo-r2" class="slide level2">
<h2>Pseudo R2</h2>
<p><span class="math display">\[pR^2 = 1 - \frac{\text{Log-likelihood}_{\text{model}}}{\text{Log-likelihood}_{\text{intercept only}}}\]</span></p>
<ul>
<li><p>It is similar to the R-squared, as it measures the goodness of fit, tailored to nonlinear models and binary outcomes.</p>
<ul>
<li>Most widely used: McFadden’s R-squared (<code>Stata</code> uses this)</li>
</ul></li>
<li><p>Computes the ratio of log-likelihood of the model vs <strong>intercept only</strong>.</p></li>
<li><p>Can be computed for the logit and the probit but not for the linear probability model. (unless you re-define the Log-likelihood)</p></li>
</ul>
</section>
<section id="log-loss" class="slide level2">
<h2>Log-loss</h2>
<p><span class="math display">\[\text{Log-loss} = \frac{1}{n}\sum_{i=1}^n \left[y_i \log(\hat{y}_P^i) + (1-y_i) \log(1-\hat{y}_P^i) \right]\]</span></p>
<ul>
<li><p>The log-loss is a measured derived from the log-likelihood function. It measures how much observed data dissagrees with the predicted probabilities.</p></li>
<li><p>The smaller (close to zero) the log-loss, the better the model.</p></li>
</ul>
</section>
<section id="practical-use" class="slide level2">
<h2>Practical use</h2>
<ul>
<li>There are several measured of model fit, but they often give the same ranking of models.</li>
<li>Do not use R-squared. Even for LPM, it has no interpretation.</li>
<li>If using probit vs logit: pseudo R-squared may be used to rank logit and probit models.</li>
<li>Use, especially for prediction: Brier score is a metric that can be computed for all models and is used in prediction.</li>
</ul>
</section>
<section id="bias-of-the-predictions" class="slide level2">
<h2>Bias of the predictions</h2>
<ul>
<li>Post-prediction: we may be interested to study some features of our model</li>
<li>One specific goal: evaluating the bias of the prediction.
<ul>
<li>Probability predictions are unbiased if they are right on average = the average of predicted probabilities is equal to the actual probability of the outcome.</li>
<li>If the prediction is unbiased, the bias is zero.</li>
</ul></li>
<li>Unless the model is really bad, unconditional bias is not a big issue.
<ul>
<li>Only Probit will be biased.</li>
</ul></li>
</ul>
</section>
<section id="calibration" class="slide level2">
<h2>Calibration</h2>
<ul>
<li><p>Unbiasedness refers to the whole distribution of probability predictions.</p></li>
<li><p>A finer and stricter concept is calibration</p></li>
<li><p>A prediction is well calibrated if the actual probability of the outcome is equal to the predicted probability for each and every value of the predicted probability. <span class="math display">\[E(y|y^P) = y^P\]</span></p></li>
<li><p>‘Calibration curve’ is used to show this.</p></li>
<li><p>A model may be unbiased (right on average) but not well calibrated</p>
<ul>
<li>underestimate high probability events and overestimate low probability ones</li>
</ul></li>
</ul>
</section>
<section id="calibration-curve" class="slide level2">
<h2>Calibration curve</h2>
<ul>
<li>Horizontal axis shows the values of all predicted probabilities (<span class="math inline">\(\hat{y}_P\)</span>).</li>
<li>Vertical axis shows the fraction of <span class="math inline">\(y = 1\)</span> observations for all observations with the corresponding predicted probability.</li>
<li>The closer the curve is to the 45-degree line, the better the calibration.</li>
</ul>
<p>In practice:</p>
<ul>
<li>Create bins for predicted probabilities and make comparisons of the actual event’s probability.</li>
<li>Or use non-parametric methods to estimate the calibration curve.</li>
</ul>
</section>
<section id="calibration-curve-1" class="slide level2">
<h2>Calibration curve</h2>
<div id="1b07866b" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource stata number-lines code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><a></a><span class="kw">two</span> (lpoly low low_hat_ols) (lpoly low low_hat_logit) <span class="co">///</span></span>
<span id="cb11-2"><a></a>(lpoly low low_hat_probit) (<span class="kw">function</span> <span class="fu">y</span> = x, <span class="kw">range</span>(0 1) lcolor(<span class="bn">black</span>%50)), <span class="co">///</span></span>
<span id="cb11-3"><a></a><span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"LPM"</span> 2 <span class="st">"Logit"</span> 3 <span class="st">"Probit"</span>) ) <span class="kw">scale</span>(1.5) <span class="co">///</span></span>
<span id="cb11-4"><a></a><span class="bn">xtitle</span>(<span class="st">"Predicted probability"</span>) <span class="bn">ytitle</span>(<span class="st">"Avg outcome"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="week08_files/figure-revealjs/cell-9-output-1.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="probability-models-summary" class="slide level2">
<h2>Probability models summary</h2>
<ul>
<li>Find patterns when <span class="math inline">\(y\)</span> is binary can be done using model probability with regressions</li>
<li>Linear probability model is mostly good enough, easy inference.
<ul>
<li>to-go for data exploration, quick analysis, and diagnostics</li>
<li>but, predicted values could be below 0, above 1</li>
</ul></li>
<li>Logit (and probit) - better when aim is prediction, predicted values strictly between 0-1</li>
<li>Most often, LPM, logit, probit - similar inference</li>
<li>Use marginal (average) differences (with logit/probit)</li>
<li>No trivial goodness of fit. Brier score or pseudo-R-Squared.</li>
<li>Calibration is important for prediction.</li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><em>Rios-Avila and Cia</em></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1300,

        height: 675,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>