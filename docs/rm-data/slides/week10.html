<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">
<meta name="dcterms.date" content="2024-10-10">

<title>Prediction Setup – Econometrics MSC Levy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Prediction Setup</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Courses</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../adv_class/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advance Econometrics: Causal Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rm-data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods I: Data Analysis for Economics and Policy</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Math Refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#prediction-basics" id="toc-prediction-basics" class="nav-link" data-scroll-target="#prediction-basics">Prediction Basics</a></li>
  <li><a href="#cs-price-cars" id="toc-cs-price-cars" class="nav-link" data-scroll-target="#cs-price-cars">CS: Price cars</a></li>
  <li><a href="#cs-price-apartments" id="toc-cs-price-apartments" class="nav-link" data-scroll-target="#cs-price-apartments">CS: Price apartments</a></li>
  <li><a href="#cs-predict-companys-exit-from-business" id="toc-cs-predict-companys-exit-from-business" class="nav-link" data-scroll-target="#cs-predict-companys-exit-from-business">CS: Predict company’s exit from business</a></li>
  <li><a href="#predictive-analysis-what-is-new" id="toc-predictive-analysis-what-is-new" class="nav-link" data-scroll-target="#predictive-analysis-what-is-new">Predictive Analysis: what is new?</a></li>
  <li><a href="#different-types-of-prediction" id="toc-different-types-of-prediction" class="nav-link" data-scroll-target="#different-types-of-prediction">Different types of prediction</a>
  <ul class="collapse">
  <li><a href="#what-are-we-predicting" id="toc-what-are-we-predicting" class="nav-link" data-scroll-target="#what-are-we-predicting">What are we predicting?</a></li>
  <li><a href="#what-is-different" id="toc-what-is-different" class="nav-link" data-scroll-target="#what-is-different">What is Different?</a></li>
  <li><a href="#supervised-machine-learning-technique-regression" id="toc-supervised-machine-learning-technique-regression" class="nav-link" data-scroll-target="#supervised-machine-learning-technique-regression">Supervised Machine Learning Technique: Regression</a></li>
  <li><a href="#the-prediction-error" id="toc-the-prediction-error" class="nav-link" data-scroll-target="#the-prediction-error">The Prediction Error</a></li>
  <li><a href="#the-prediction-error-1" id="toc-the-prediction-error-1" class="nav-link" data-scroll-target="#the-prediction-error-1">The Prediction Error</a></li>
  <li><a href="#decomposing-the-prediction-error" id="toc-decomposing-the-prediction-error" class="nav-link" data-scroll-target="#decomposing-the-prediction-error">Decomposing the prediction error</a></li>
  <li><a href="#interval-prediction-for-quantitative-target-variables" id="toc-interval-prediction-for-quantitative-target-variables" class="nav-link" data-scroll-target="#interval-prediction-for-quantitative-target-variables">Interval prediction for quantitative target variables</a></li>
  </ul></li>
  <li><a href="#the-loss-function" id="toc-the-loss-function" class="nav-link" data-scroll-target="#the-loss-function">The Loss function</a>
  <ul class="collapse">
  <li><a href="#loss-functions" id="toc-loss-functions" class="nav-link" data-scroll-target="#loss-functions">Loss Functions</a></li>
  <li><a href="#loss-functions-1" id="toc-loss-functions-1" class="nav-link" data-scroll-target="#loss-functions-1">Loss Functions</a></li>
  <li><a href="#loss-functions-of-various-shapes" id="toc-loss-functions-of-various-shapes" class="nav-link" data-scroll-target="#loss-functions-of-various-shapes">Loss Functions of Various Shapes</a></li>
  <li><a href="#examples-1-used-cars" id="toc-examples-1-used-cars" class="nav-link" data-scroll-target="#examples-1-used-cars">Examples 1 – used cars</a></li>
  <li><a href="#examples-2---creditors" id="toc-examples-2---creditors" class="nav-link" data-scroll-target="#examples-2---creditors">Examples 2 - creditors</a></li>
  <li><a href="#some-common-loss-functions" id="toc-some-common-loss-functions" class="nav-link" data-scroll-target="#some-common-loss-functions">Some common loss functions</a></li>
  <li><a href="#some-common-loss-functions-1" id="toc-some-common-loss-functions-1" class="nav-link" data-scroll-target="#some-common-loss-functions-1">Some common loss functions</a></li>
  <li><a href="#mean-squared-error-mse" id="toc-mean-squared-error-mse" class="nav-link" data-scroll-target="#mean-squared-error-mse">Mean Squared Error: MSE</a></li>
  <li><a href="#mse-decomposition-bias-and-variance" id="toc-mse-decomposition-bias-and-variance" class="nav-link" data-scroll-target="#mse-decomposition-bias-and-variance">MSE decomposition : Bias and Variance</a></li>
  <li><a href="#mse-decomposition-bias-and-variance-1" id="toc-mse-decomposition-bias-and-variance-1" class="nav-link" data-scroll-target="#mse-decomposition-bias-and-variance-1">MSE decomposition : Bias and Variance</a></li>
  <li><a href="#case-study-used-cars-data" id="toc-case-study-used-cars-data" class="nav-link" data-scroll-target="#case-study-used-cars-data">Case study: used cars data</a></li>
  <li><a href="#case-study-used-cars-data-1" id="toc-case-study-used-cars-data-1" class="nav-link" data-scroll-target="#case-study-used-cars-data-1">Case study: used cars data</a></li>
  <li><a href="#case-study-loss-function" id="toc-case-study-loss-function" class="nav-link" data-scroll-target="#case-study-loss-function">Case study: Loss function</a></li>
  <li><a href="#case-study---used-cars-features" id="toc-case-study---used-cars-features" class="nav-link" data-scroll-target="#case-study---used-cars-features">Case study - used cars: features</a></li>
  <li><a href="#case-study-models-by-hand" id="toc-case-study-models-by-hand" class="nav-link" data-scroll-target="#case-study-models-by-hand">Case study: models by hand</a></li>
  <li><a href="#case-study-car-price-model-results" id="toc-case-study-car-price-model-results" class="nav-link" data-scroll-target="#case-study-car-price-model-results">Case study: Car price model results</a></li>
  <li><a href="#case-study-results" id="toc-case-study-results" class="nav-link" data-scroll-target="#case-study-results">Case study: Results</a></li>
  <li><a href="#case-study-prediction-interval" id="toc-case-study-prediction-interval" class="nav-link" data-scroll-target="#case-study-prediction-interval">Case study: Prediction Interval</a></li>
  <li><a href="#case-study-prediction-interval-1" id="toc-case-study-prediction-interval-1" class="nav-link" data-scroll-target="#case-study-prediction-interval-1">Case study: Prediction Interval</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model selection</a></li>
  <li><a href="#data-for-prediction" id="toc-data-for-prediction" class="nav-link" data-scroll-target="#data-for-prediction">Data for prediction</a></li>
  <li><a href="#model-selection-1" id="toc-model-selection-1" class="nav-link" data-scroll-target="#model-selection-1">Model selection</a></li>
  <li><a href="#external-validity-avoiding-overfitting-and-model-selection" id="toc-external-validity-avoiding-overfitting-and-model-selection" class="nav-link" data-scroll-target="#external-validity-avoiding-overfitting-and-model-selection">External validity, avoiding overfitting and model selection</a></li>
  <li><a href="#underfit-overfit" id="toc-underfit-overfit" class="nav-link" data-scroll-target="#underfit-overfit">Underfit, overfit</a></li>
  <li><a href="#overfitting" id="toc-overfitting" class="nav-link" data-scroll-target="#overfitting">Overfitting</a></li>
  <li><a href="#reason-for-overfitting" id="toc-reason-for-overfitting" class="nav-link" data-scroll-target="#reason-for-overfitting">Reason for overfitting</a></li>
  <li><a href="#increasing-model-complexity" id="toc-increasing-model-complexity" class="nav-link" data-scroll-target="#increasing-model-complexity">Increasing model complexity</a></li>
  <li><a href="#finding-the-best-model-by-best-fit-and-penalty-the-bic" id="toc-finding-the-best-model-by-best-fit-and-penalty-the-bic" class="nav-link" data-scroll-target="#finding-the-best-model-by-best-fit-and-penalty-the-bic">Finding the best model by best fit and penalty: The BIC</a></li>
  <li><a href="#indirect-evaluation-criteria" id="toc-indirect-evaluation-criteria" class="nav-link" data-scroll-target="#indirect-evaluation-criteria">Indirect evaluation criteria</a></li>
  <li><a href="#model-fit-evaluation" id="toc-model-fit-evaluation" class="nav-link" data-scroll-target="#model-fit-evaluation">Model fit evaluation</a></li>
  <li><a href="#finding-the-best-model-by-training-and-test-samples" id="toc-finding-the-best-model-by-training-and-test-samples" class="nav-link" data-scroll-target="#finding-the-best-model-by-training-and-test-samples">Finding the best model by training and test samples</a></li>
  <li><a href="#training-and-test-samples" id="toc-training-and-test-samples" class="nav-link" data-scroll-target="#training-and-test-samples">Training and Test Samples</a></li>
  <li><a href="#fold-cross-validation" id="toc-fold-cross-validation" class="nav-link" data-scroll-target="#fold-cross-validation">5-fold cross-validation</a></li>
  <li><a href="#bic-vs-test-rmse" id="toc-bic-vs-test-rmse" class="nav-link" data-scroll-target="#bic-vs-test-rmse">BIC vs test RMSE</a></li>
  <li><a href="#case-study-model-selection" id="toc-case-study-model-selection" class="nav-link" data-scroll-target="#case-study-model-selection">Case study: Model selection</a></li>
  <li><a href="#case-study-model-selection-1" id="toc-case-study-model-selection-1" class="nav-link" data-scroll-target="#case-study-model-selection-1">Case study: Model selection</a></li>
  <li><a href="#case-study-model-selection-2" id="toc-case-study-model-selection-2" class="nav-link" data-scroll-target="#case-study-model-selection-2">Case study: Model selection</a></li>
  <li><a href="#case-study-model-selection-3" id="toc-case-study-model-selection-3" class="nav-link" data-scroll-target="#case-study-model-selection-3">Case study: Model selection</a></li>
  <li><a href="#external-validity-and-stable-patterns" id="toc-external-validity-and-stable-patterns" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns">External validity and stable patterns</a></li>
  <li><a href="#external-validity-and-stable-patterns-1" id="toc-external-validity-and-stable-patterns-1" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns-1">External validity and stable patterns</a></li>
  <li><a href="#external-validity-and-stable-patterns-2" id="toc-external-validity-and-stable-patterns-2" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns-2">External validity and stable patterns</a></li>
  <li><a href="#algorithms" id="toc-algorithms" class="nav-link" data-scroll-target="#algorithms">Algorithms</a></li>
  <li><a href="#machine-learning-and-the-role-of-algorithms" id="toc-machine-learning-and-the-role-of-algorithms" class="nav-link" data-scroll-target="#machine-learning-and-the-role-of-algorithms">Machine Learning and the Role of Algorithms</a></li>
  <li><a href="#machine-learning-algorithms" id="toc-machine-learning-algorithms" class="nav-link" data-scroll-target="#machine-learning-algorithms">Machine Learning Algorithms</a></li>
  <li><a href="#what-is-machine-learning" id="toc-what-is-machine-learning" class="nav-link" data-scroll-target="#what-is-machine-learning">What is, machine learning?</a></li>
  <li><a href="#main-takeaways" id="toc-main-takeaways" class="nav-link" data-scroll-target="#main-takeaways">Main takeaways</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week10.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prediction Setup</h1>
<p class="subtitle lead">How far should we go?</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Fernando Rios-Avila </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Levy Economics Institute
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<ul>
<li><p>Imagine you want to sell your car soon and need to predict its price. You have data on similar used cars, and several regression models could help estimate its value now and in a year. How do you choose the best model?</p></li>
<li><p>Or, take an ice cream shop—using past sales and temperature data, you want to predict sales for the coming days. What factors should you consider to ensure your prediction is as accurate as possible?</p></li>
</ul>
</section>
<section id="prediction-basics" class="level2">
<h2 class="anchored" data-anchor-id="prediction-basics">Prediction Basics</h2>
<ul>
<li><p>We start with original data (what we have) <span class="math inline">\(\rightarrow\)</span> to build a model</p></li>
<li><p>There is Live data (data we do not have yet)</p></li>
<li><p>The Target variable <span class="math inline">\(Y\)</span> (=dependent variable, response, outcome)</p></li>
<li><p>Predictor variables <span class="math inline">\(X\)</span> (= inputs, covariates, features, independent variables)</p></li>
<li><p>The goal is to predict value of <span class="math inline">\(Y\)</span> for target observation <span class="math inline">\(j\)</span> in live data</p>
<ul>
<li>Actual value for <span class="math inline">\(Y_j\)</span> unknown</li>
<li>but value for <span class="math inline">\(X_j\)</span> known</li>
<li>Need predicted value of <span class="math inline">\(Y\)</span> for each target observation <span class="math inline">\(j\)</span></li>
</ul></li>
</ul>
</section>
<section id="cs-price-cars" class="level2">
<h2 class="anchored" data-anchor-id="cs-price-cars">CS: Price cars</h2>
<ul>
<li>You want to sell your car through online advertising</li>
<li>Target is continuous (in dollars)</li>
<li>Features are continuous or categorical</li>
<li>The business question:
<ul>
<li>What price should you put into the ad?</li>
</ul></li>
</ul>
</section>
<section id="cs-price-apartments" class="level2">
<h2 class="anchored" data-anchor-id="cs-price-apartments">CS: Price apartments</h2>
<ul>
<li>You are planning to run an AirBnB business
<ul>
<li>Maybe several rooms</li>
</ul></li>
<li>Target is continuous (in dollars)</li>
<li>Features are varied from text to binary</li>
<li>The business question:
<ul>
<li>How should you price apartments/houses?</li>
</ul></li>
</ul>
</section>
<section id="cs-predict-companys-exit-from-business" class="level2">
<h2 class="anchored" data-anchor-id="cs-predict-companys-exit-from-business">CS: Predict company’s exit from business</h2>
<ul>
<li>You have a consulting company</li>
<li>Predict which firms will go out of business (exit) from a pool of partners</li>
<li>Target is binary: exit / stay</li>
<li>Features of financial and management info</li>
<li>Business decision:
<ul>
<li>Which firms to give loan to?</li>
</ul></li>
</ul>
</section>
<section id="predictive-analysis-what-is-new" class="level2">
<h2 class="anchored" data-anchor-id="predictive-analysis-what-is-new">Predictive Analysis: what is new?</h2>
<ul>
<li>Most of econometrics focused on finding relationships between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>
<ul>
<li>What is the relationship like (+/-, linear, etc.)</li>
<li>Is it a robust relationship – true in the population /general pattern? (causal?)</li>
</ul></li>
<li>Now, we use <span class="math inline">\(x_1, x_2, \dots\)</span> to predict <span class="math inline">\(y\)</span>: <span class="math inline">\(\hat{y}_j = \hat{f}(x_j)\)</span></li>
<li>How is this different?</li>
</ul>
<div class="fragment">
<ul>
<li>We care less about
<ul>
<li>Individual coefficient values, multicollinearity</li>
</ul></li>
<li>We still care about the stability of our results.</li>
<li>Should we care about causality?
<ul>
<li>Not so much, we care more about making the best prediction.</li>
</ul></li>
</ul>
</div>
</section>
<section id="different-types-of-prediction" class="level1">
<h1>Different types of prediction</h1>
<section id="what-are-we-predicting" class="level2">
<h2 class="anchored" data-anchor-id="what-are-we-predicting">What are we predicting?</h2>
<ul>
<li><span class="math inline">\(Y\)</span> is quantitative (e.g price)
<ul>
<li>Quantitative prediction</li>
<li>“Regression” problem</li>
</ul></li>
<li><span class="math inline">\(Y\)</span> is binary (e.g.&nbsp;Default or nor)
<ul>
<li>Probability prediction</li>
<li>Classification problem</li>
<li>Broadly: <span class="math inline">\(Y\)</span> takes values in a finite set of (unordered) classes (survived/died, sold/not sold, car model)</li>
</ul></li>
<li>Time series prediction (Forecasting). Make predictions about the future based on historical and current data.</li>
</ul>
</section>
<section id="what-is-different" class="level2">
<h2 class="anchored" data-anchor-id="what-is-different">What is Different?</h2>
<ul>
<li>Feature engineering (variable selection) including variable selection, coding and functional form</li>
<li>Model building and prediction
<ul>
<li>Decision regarding model complexity and estimation
<ul>
<li>Remember splines, polynomials</li>
</ul></li>
<li>Machine learning methods
<ul>
<li>Automated model selection under some conditions</li>
</ul></li>
</ul></li>
<li>Model evaluation and selection
<ul>
<li>Compare models based on some measure of fit</li>
</ul></li>
<li>Key idea: Focus on systematically combine estimation and model selection</li>
</ul>
</section>
<section id="supervised-machine-learning-technique-regression" class="level2">
<h2 class="anchored" data-anchor-id="supervised-machine-learning-technique-regression">Supervised Machine Learning Technique: Regression</h2>
<ul>
<li>Linear regression produces a predicted value for the dependent variable.
<ul>
<li><strong>Predictions</strong>: are the expected value of <span class="math inline">\(y\)</span> if we know <span class="math inline">\(x\)</span>.</li>
</ul></li>
<li>Linear regression with <span class="math inline">\(y, x_1, x_2, etc.,\)</span>, is a model for the conditional expected value of <span class="math inline">\(y\)</span>, which provide us with <span class="math inline">\(\beta's\)</span>.</li>
<li>We need estimated coefficients <span class="math inline">\((\hat{\beta})\)</span> and actual <span class="math inline">\(x\)</span> values <span class="math inline">\((x_j)\)</span> to predict an actual value <span class="math inline">\(\hat{y}\)</span></li>
</ul>
<p><span class="math display">\[\begin{aligned}
y^E &amp;= \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \dots \\
\hat{y}_j &amp;= \hat{\beta}_0 + \hat{\beta}_1 x_{1j} + \hat{\beta}_2 x_{2j} + \dots
\end{aligned}
\]</span></p>
</section>
<section id="the-prediction-error" class="level2">
<h2 class="anchored" data-anchor-id="the-prediction-error">The Prediction Error</h2>
<ul>
<li>The Regression model can produce a Predicted value <span class="math inline">\(\hat{y}_j\)</span> for target observation <span class="math inline">\(j\)</span></li>
<li>but, actual value <span class="math inline">\(y_j\)</span> is not known (that is why we are predicting)</li>
<li>Thus, there will be a prediction error</li>
</ul>
<p><span class="math display">\[e_j = \hat{y}_j - y_j
\]</span></p>
<ul>
<li>Error = actual value - predicted value</li>
</ul>
</section>
<section id="the-prediction-error-1" class="level2">
<h2 class="anchored" data-anchor-id="the-prediction-error-1">The Prediction Error</h2>
<ul>
<li>The <strong>ideal</strong> prediction error, is zero: our predicted value is right on target.</li>
<li>The prediction error is defined by the direction of miss and size.</li>
<li>Direction of miss:
<ul>
<li>Positive if we overpredict the value: we predict a higher value than actual value.</li>
<li>Negative if we underpredict the value: our prediction is too low.</li>
<li>Degree of wrongness depends on the decision problem.</li>
</ul></li>
<li>Size:
<ul>
<li>Larger in absolute value the further away our prediction is from the actual value.</li>
<li>It is smaller the closer we are.</li>
<li>It is always better to have a prediction with as small an error as possible.</li>
</ul></li>
</ul>
</section>
<section id="decomposing-the-prediction-error" class="level2">
<h2 class="anchored" data-anchor-id="decomposing-the-prediction-error">Decomposing the prediction error</h2>
<p>Assume the best model for <span class="math inline">\(Y\)</span> is <span class="math inline">\(Y = f(X,Z,XZ) + \epsilon\)</span></p>
<ul>
<li>The prediction error can be decomposed into three parts:
<ol type="1">
<li><strong>estimation error</strong>: Difference between <span class="math inline">\(f(X,Z,XZ)\)</span> and <span class="math inline">\(\hat f(X,Z,XZ)\)</span></li>
<li><strong>model error</strong>: If we using <span class="math inline">\(f(X,Z)\)</span>, it would be the Difference between <span class="math inline">\(f(X,Z)\)</span> and <span class="math inline">\(f(X,Z,XZ)\)</span>.</li>
<li><strong>genuine error</strong>: error even if have the best possible model. <span class="math inline">\(\epsilon\)</span></li>
</ol></li>
</ul>
</section>
<section id="interval-prediction-for-quantitative-target-variables" class="level2">
<h2 class="anchored" data-anchor-id="interval-prediction-for-quantitative-target-variables">Interval prediction for quantitative target variables</h2>
<ul>
<li>One advantage of regressions - it’s easy quantify uncertainty of prediction
<ul>
<li>This can be used to obtain <strong>Interval predictions</strong></li>
</ul></li>
<li>Interval predictions quantify 2-out-of-3 sources of prediction uncertainty: estimation error and genuine (or irreducible) error.</li>
<li>They do not include the third source, model uncertainty! (Bayesian methods can help with this)</li>
<li>The 95% prediction interval (PI) tells where to expect the actual value for the target observation.</li>
<li>The PI for linear regression requires homoskedasticity. (but could be relaxed)</li>
</ul>
</section>
</section>
<section id="the-loss-function" class="level1">
<h1>The Loss function</h1>
<p>Choosing the best</p>
<section id="loss-functions" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions">Loss Functions</h2>
<ul>
<li>We use a Loss function to quantify the <strong>cost</strong> of prediction error
<ul>
<li>It attaches a value to the prediction error, specifying how <strong>bad</strong> it is</li>
<li>Thus, Loss function determines best predictor</li>
</ul></li>
<li>Ideally, it is derived from decision problem,
<ul>
<li>How much more costly is to overpredict than underpredict? (price is right!)</li>
<li>The shape and functional form could depent on the decision problem</li>
</ul></li>
<li>In practice, highly crafted loss functions are rare (Machine learning, Neural Networks, Etc), so we use common ones</li>
<li>Loss functions could be used to both estimate, but also to <strong>evaluate/compare</strong> models</li>
</ul>
</section>
<section id="loss-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions-1">Loss Functions</h2>
<ul>
<li>The most important Loss functions have the following characteristics:
<ul>
<li><strong>Symmetry</strong>: losses due to errors in opposing direction are similar
<ul>
<li><strong>Asymmetric loss</strong>: overprediction is more costly than underprediction</li>
</ul></li>
<li><strong>Convexity</strong>: Twice as large errors generate more than twice as large losses. (We penalize large errors more than small ones)
<ul>
<li><strong>Linear loss</strong>: Errors are penalized proportionally to their size</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="loss-functions-of-various-shapes" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions-of-various-shapes">Loss Functions of Various Shapes</h2>
<div id="2d075875" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">scheme</span> white2</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>color_style tableau</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 301</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">range</span> <span class="fu">r</span> -5 5 </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll = <span class="fu">r</span>^2</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll2 = 2*<span class="fu">abs</span>(<span class="fu">r</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll3 = 1.5*<span class="fu">r</span>^2*(<span class="fu">r</span>&gt;0)+0.5*<span class="fu">r</span>^2*(<span class="fu">r</span>&lt;0)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> ll&gt;30 | ll2&gt;30 | ll3&gt;30</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">line</span> ll ll2 ll3 <span class="fu">r</span>, lw(1 1 1) <span class="co">///</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Symetric-Convex"</span> 2 <span class="st">"Symetric-Linear"</span> 3 <span class="st">"Asymetric-Convex"</span>) )</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week10_files/figure-revealjs/cell-2-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="examples-1-used-cars" class="level2">
<h2 class="anchored" data-anchor-id="examples-1-used-cars">Examples 1 – used cars</h2>
<ul>
<li>The loss function for predicting the value of our used car depends on how we value money and how we value how much time it takes to sell our car (value of your car).</li>
<li>A too low prediction may lead to selling our car cheap but fast;</li>
<li>A too high prediction may make us wait a long time and, possibly, revising the sales price downwards before selling our car.</li>
<li>What kind of loss function would make sense?</li>
</ul>
</section>
<section id="examples-2---creditors" class="level2">
<h2 class="anchored" data-anchor-id="examples-2---creditors">Examples 2 - creditors</h2>
<ul>
<li>Creditors decide whether to issue a loan only to potential debtors that are predicted to pay it back with high likelihood.</li>
<li>Two kinds of errors are possible:
<ul>
<li>debtors that would pay back their loan don’t get a loan</li>
<li>debtors that would not pay back their loan get one nevertheless.</li>
</ul></li>
<li>The costs of the first error are due to missed business opportunity; the costs of the second error are due to direct loss of money.</li>
<li>These losses may be quantified in relatively straightforward ways.</li>
<li>What kind of loss function would make sense?</li>
</ul>
</section>
<section id="some-common-loss-functions" class="level2">
<h2 class="anchored" data-anchor-id="some-common-loss-functions">Some common loss functions</h2>
<p>Squared loss function:</p>
<p><span class="math display">\[L(e_j) = e^2_j = (\hat{y}_j - y_j)^2
\]</span></p>
<ul>
<li>The most widely used loss function</li>
<li>Symmetric: Losses due to errors in opposing direction are same</li>
<li>Convex: Twice as large errors generate more than twice (4x) as large losses</li>
</ul>
</section>
<section id="some-common-loss-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="some-common-loss-functions-1">Some common loss functions</h2>
<p>Absolute loss function:</p>
<p><span class="math display">\[L(e_j) = e^2_j = Abs(\hat{y}_j - y_j)
\]</span></p>
<ul>
<li><p>Used for Median regression (Quantile regression)</p></li>
<li><p>Symmetric: Losses due to errors in opposing direction are same</p></li>
<li><p>Linear: Twice as large errors generate twice as large losses</p></li>
<li><p>Quantile Regressions use Asymetric loss functions</p></li>
</ul>
</section>
<section id="mean-squared-error-mse" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-mse">Mean Squared Error: MSE</h2>
<ul>
<li>The most common way to quantify and aggregate the loss function is using the Mean Squared Error (MSE)</li>
<li>Squared loss <span class="math inline">\(\rightarrow\)</span> Mean Squared Error (MSE)</li>
</ul>
<p><span class="math display">\[\begin{align*}
\text{MSE} &amp;= \frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2 \\
\text{RMSE} &amp;= \sqrt{\text{MSE}} = \sqrt{\frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2}
\end{align*}
\]</span></p>
<ul>
<li>Using this function typically implies we are interested in the Mean as the best predictor</li>
</ul>
</section>
<section id="mse-decomposition-bias-and-variance" class="level2">
<h2 class="anchored" data-anchor-id="mse-decomposition-bias-and-variance">MSE decomposition : Bias and Variance</h2>
<ul>
<li><p>The MSE can be decomposed into two parts: <strong>Bias</strong> and <strong>Variance</strong> <span class="math display">\[\begin{align*}
MSE &amp;= \frac{1}{J}\sum_{j=1}^J (\hat{y}_j - y_j)^2 \\
&amp;= \left(\frac{1}{J}\sum_{j=1}^J (\hat{y}_j - y_j)\right)^2 + \frac{1}{J}\sum_{j=1}^J (\hat y_j - \bar{\hat y})^2 \\
&amp;= \text{Bias}^2 + \text{PredictionVariance}
\end{align*}
\]</span></p></li>
<li><p>The bias of a prediction is the average of its prediction error.</p>
<ul>
<li>How far off is the average prediction from the actual value?</li>
</ul></li>
<li><p>The variance of a prediction describes shows how it varies around its average.</p></li>
</ul>
</section>
<section id="mse-decomposition-bias-and-variance-1" class="level2">
<h2 class="anchored" data-anchor-id="mse-decomposition-bias-and-variance-1">MSE decomposition : Bias and Variance</h2>
<p><span class="math display">\[\begin{align*}
\text{MSE} &amp;= \frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2 \\
         &amp;= \left(\frac{1}{K} \sum_{k=1}^K (\hat{y}_k - \bar{y})\right)^2 + \frac{1}{K} \sum_{k=1}^K (y_k - \bar{y})^2 \\
         &amp;= \text{Bias}^2 + \text{PredictionVariance}
\end{align*}\]</span></p>
<ul>
<li>OLS is unbiased. Some other methods will allow for some bias in return for lower variance.</li>
</ul>
</section>
<section id="case-study-used-cars-data" class="level2">
<h2 class="anchored" data-anchor-id="case-study-used-cars-data">Case study: used cars data</h2>
<ul>
<li>Suppose you want to sell your car of a certain make, type, year, miles, condition and other features.</li>
<li>The prediction analysis helps uncover the average advertised price of cars with these characteristics</li>
<li>That helps decide what price you may want to put on your ad.</li>
</ul>
</section>
<section id="case-study-used-cars-data-1" class="level2">
<h2 class="anchored" data-anchor-id="case-study-used-cars-data-1">Case study: used cars data</h2>
<ul>
<li>Scraped from a website</li>
<li>Year of make (age), Odometer (miles)</li>
<li>Tech specifications such as fuel and drive</li>
<li>Dealer or private seller</li>
</ul>
</section>
<section id="case-study-loss-function" class="level2">
<h2 class="anchored" data-anchor-id="case-study-loss-function">Case study: Loss function</h2>
<ul>
<li>The loss function for predicting the value of our used car depends on how we value money and how we value how much time it takes to sell our car.</li>
<li>A too low prediction may lead to selling our car cheap but fast;</li>
<li>A too high prediction may make us wait a long time and, possibly, revising the sales price downwards before selling our car.</li>
<li>Symmetric</li>
<li>Sensitive to big deviations</li>
<li>RMSE and OLS</li>
</ul>
</section>
<section id="case-study---used-cars-features" class="level2">
<h2 class="anchored" data-anchor-id="case-study---used-cars-features">Case study - used cars: features</h2>
<ul>
<li>Odometer, measuring miles the car traveled (Continuous, linear)</li>
<li>More specific type of the car: LE, XLE, SE (missing in about 30% of the observations). (Factor – set of dummies , incl N/A)</li>
<li>Good condition, excellent condition or it is like new (missing for about one third of the ads). (Factor – set of dummies, incl N/A)</li>
<li>Car’s engine has 6 cylinders (20% of ads say this; 43% says 4 cylinders, and the rest has no information on this). (Binary for 6 cylinders)</li>
</ul>
</section>
<section id="case-study-models-by-hand" class="level2">
<h2 class="anchored" data-anchor-id="case-study-models-by-hand">Case study: models by hand</h2>
<ul>
<li>Model 1: age, age squared</li>
<li>Model 2: age, age squared, odometer, odometer squared</li>
<li>Model 3: age, age squared, odometer, odometer squared, LE, excellent condition, good condition, dealer</li>
<li>Model 4: age, age squared, odometer, odometer squared, LE, excellent condition, good condition, dealer, LE, XLE, cylinder</li>
<li>Model 5: same as Model 4 but with all variables interacted with age (won’t show in next table)</li>
</ul>
</section>
<section id="case-study-car-price-model-results" class="level2">
<h2 class="anchored" data-anchor-id="case-study-car-price-model-results">Case study: Car price model results</h2>
<pre><code>(1)   (2)   (3)   (4)
Variables Model 1 Model 2 Model 3 Model 4
age     -1,530.09 -1,149.22 -873.47 -836.64
agesq    35.05   27.65   18.21   17.63
odometer           -303.84 -779.90 -788.70
odometersq                 18.81   19.20
LE                         28.11  -20.48
XLE                                301.69
SE                                1,338.79
cond_likenew                       558.67
cond_excellent                     176.49  190.40
cond_good                          293.36  321.56
cylind6                           -370.27
dealer                            572.98  822.65
Constant 18,365.45 18,860.20 19,431.89 18,963.35</code></pre>
</section>
<section id="case-study-results" class="level2">
<h2 class="anchored" data-anchor-id="case-study-results">Case study: Results</h2>
<ul>
<li>When doing prediction, coefficients are less important.</li>
<li>But we shall use them for sanity check: age negative, convex (flattens out)</li>
<li>SE may not be even displayed. It is helpful for model selection, but only along with other measures</li>
<li>and values of the predictor variables for our car: age = 10 (years), odometer= 12 (10 thousand miles), type= LE, excellent condition=1.</li>
<li>A point prediction, Model 3: age: -873.47, age squared=18.21, odometer -799.90, odometer sq = 18.81, LE=28.11, cond excellent: 176.49+ C=19.431.89</li>
<li>Predicted is price is 6073.</li>
</ul>
</section>
<section id="case-study-prediction-interval" class="level2">
<h2 class="anchored" data-anchor-id="case-study-prediction-interval">Case study: Prediction Interval</h2>
<ul>
<li>Calculating prediction intervals for the baseline models</li>
<li>Very wide interval despite high R2</li>
<li>Prediction is hard!</li>
<li>Even with a good model, you’ll make plenty of errors</li>
<li>Should be aware</li>
<li>Let your clients know in advance…</li>
</ul>
</section>
<section id="case-study-prediction-interval-1" class="level2">
<h2 class="anchored" data-anchor-id="case-study-prediction-interval-1">Case study: Prediction Interval</h2>
<p>Based on the third model, we have a point prediction of <span class="math inline">\(6073\)</span> Have a 80% prediction intervals (PI) – Ads for cars just like ours may ask a price ranging from <span class="math inline">\(4,317\)</span> to <span class="math inline">\(7,829\)</span> with a 80% chance.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model 1</th>
<th>Model 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Point prediction 6,569</td>
<td>6,073</td>
</tr>
<tr class="even">
<td>Prediction Interval (80%) [4,296-8,843]</td>
<td>[4,317-7,829]</td>
</tr>
<tr class="odd">
<td>Prediction Interval (95%) [3,085-10,053]</td>
<td>[3,382-8,763]</td>
</tr>
</tbody>
</table>
<p>Note: Chicago cars. Prices in dollars. Source: used-cars dataset.</p>
</section>
<section id="model-selection" class="level2">
<h2 class="anchored" data-anchor-id="model-selection">Model selection</h2>
</section>
<section id="data-for-prediction" class="level2">
<h2 class="anchored" data-anchor-id="data-for-prediction">Data for prediction</h2>
<ul>
<li>We have a dataset</li>
<li>We wanna make some prediction</li>
</ul>
</section>
<section id="model-selection-1" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-1">Model selection</h2>
<p>Model selection is finding the best fit while avoiding overfitting and aiming for high external validity</p>
</section>
<section id="external-validity-avoiding-overfitting-and-model-selection" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-avoiding-overfitting-and-model-selection">External validity, avoiding overfitting and model selection</h2>
<ul>
<li>Have a dataset and a target variable. Compare various models of prediction.</li>
<li>How to choose a model?</li>
<li>Pick a model that can predict well….</li>
<li>Best prediction - best model that would produce the smallest prediction error.</li>
<li>Context of squared loss function <span class="math inline">\(\rightarrow\)</span> finding the regression that would produce the smallest RMSE for the target observations.</li>
<li>Pick a model that can predict well on the live data</li>
</ul>
</section>
<section id="underfit-overfit" class="level2">
<h2 class="anchored" data-anchor-id="underfit-overfit">Underfit, overfit</h2>
<ul>
<li>Comparing two models (model 1 and model 2)</li>
<li>Model 1 can give a worse fit in the live data than model 2 in two ways.
<ul>
<li>Model 1 may give a worse fit both in the original data and the live data. In this case, we say that model 1 underfits the original data.
<ul>
<li>Simple: we should build a better model.</li>
</ul></li>
<li>Model 1 may actually give a better fit in the original, but a worse fit in the live data. In this case, we say that model 1 overfits the original data.</li>
</ul></li>
</ul>
</section>
<section id="overfitting" class="level2">
<h2 class="anchored" data-anchor-id="overfitting">Overfitting</h2>
<ul>
<li>Overfitting is a key aspect of external validity</li>
<li>finding a model that fits the data better than alternative models</li>
<li>but makes worse actual prediction.</li>
<li>Thus, the problem of overfitting the original data is best split into two problems:
<ul>
<li>fitting patterns in the original data that are not there in the population, or general pattern, it represents;</li>
<li>fitting patterns in the world of the original data that will not be there in the world of the live data.</li>
</ul></li>
</ul>
</section>
<section id="reason-for-overfitting" class="level2">
<h2 class="anchored" data-anchor-id="reason-for-overfitting">Reason for overfitting</h2>
<ul>
<li>The typical reason for overfitting is fitting a model that is too complex on the dataset.</li>
<li>Complexity: number of estimated coefficients</li>
<li>Often: fitting a model with too many predictor variables.</li>
<li>Including too many variables from the dataset that do not really add to the predictive power of the regression,</li>
<li>often because they are strongly correlated with other predictor variables.</li>
<li>Specifying too many interactions,</li>
<li>Too detailed nonlinear patterns
<ul>
<li>as piecewise linear splines with many knots</li>
<li>polynomials of high degree.</li>
</ul></li>
</ul>
</section>
<section id="increasing-model-complexity" class="level2">
<h2 class="anchored" data-anchor-id="increasing-model-complexity">Increasing model complexity</h2>
<ul>
<li>As we increase model complexity
<ul>
<li>Such as number of features (variables)</li>
<li>By adding interactions, etc.</li>
</ul></li>
<li>We will see
<ul>
<li>RMSE within dataset to fall monotonously</li>
<li>RMSE for target observations (ie. not in our dataset) to fall and then rise as we overfit</li>
</ul></li>
<li>example to come in class 2</li>
</ul>
</section>
<section id="finding-the-best-model-by-best-fit-and-penalty-the-bic" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-model-by-best-fit-and-penalty-the-bic">Finding the best model by best fit and penalty: The BIC</h2>
<ul>
<li>Approach 1: Indirectly</li>
<li>Estimate it by an adjustment</li>
<li>Use a method based on some distributional assumptions</li>
<li>Need to pick an evaluation criterion</li>
<li>=In-sample evaluation with penalty</li>
<li>Specify and estimate model using all data</li>
<li>Use a measure of fit that helps avoid overfitting
<ul>
<li>Such as
<ul>
<li>adjusted <span class="math inline">\(R^2\)</span></li>
<li>BIC = Bayesian Information Criterion, or Schwarz criterion</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="indirect-evaluation-criteria" class="level2">
<h2 class="anchored" data-anchor-id="indirect-evaluation-criteria">Indirect evaluation criteria</h2>
<ul>
<li>Main methods: AIC, BIC and adjusted <span class="math inline">\(R^2\)</span></li>
<li>Advantage: easy to compute</li>
<li>Disadvantage: assumptions</li>
<li>Adjusted <span class="math inline">\(R^2\)</span> – just add a penalty for having many RHS vars
<ul>
<li>corrects with <span class="math inline">\((n - 1)/(n - p - 1)\)</span></li>
</ul></li>
<li>Akaike Information Criterion
<ul>
<li>AIC = <span class="math inline">\(-2 \times \ln(\text{likelihood}) + 2 \times k\)</span></li>
</ul></li>
<li>Schwarz – Bayesian Information Criterion
<ul>
<li>BIC = <span class="math inline">\(-2 \times \ln(\text{likelihood}) + \ln(N) \times k\)</span></li>
</ul></li>
<li>Both quantities that take the log likelihood and apply a penalty for the number of parameters being estimated.Both are based on information loss theory from the fifties.</li>
<li>BIC puts heavier penalty on models with many RHS variables, than AIC.</li>
</ul>
</section>
<section id="model-fit-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-fit-evaluation">Model fit evaluation</h2>
<ul>
<li>Use a good measure of fit to compare models.</li>
<li>Don’t
<ul>
<li>Don’t use MSE or R-squared (the two very closely related).</li>
<li>They choose best fit in data and don’t care about overfitting.</li>
</ul></li>
<li>In practice, use BIC.</li>
<li>BIC good approximation of what more sophisticated methods would pick. Or even more conservative…</li>
<li>That introduces a “penalty term”</li>
<li>More predictor variables leads to worse value</li>
<li>Even more so in large samples.</li>
</ul>
</section>
<section id="finding-the-best-model-by-training-and-test-samples" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-model-by-training-and-test-samples">Finding the best model by training and test samples</h2>
<ul>
<li>Approach Nr.2: Directly</li>
<li>Estimate it using a test (validation) set approach.</li>
<li>Needs cutting the dataset into training and test sample</li>
<li>No assumption</li>
<li>Need to pick evaluation criterion (loss function) = RMSE (root mean squared error)</li>
<li>Estimate the model in part of the data (say, 80%).
<ul>
<li>Training sample</li>
</ul></li>
<li>Evaluate predictive performance on the rest of the data.
<ul>
<li>Test sample</li>
</ul></li>
<li>Avoid overfitting in training data by evaluating on test data.</li>
</ul>
</section>
<section id="training-and-test-samples" class="level2">
<h2 class="anchored" data-anchor-id="training-and-test-samples">Training and Test Samples</h2>
<ul>
<li>Creating two sub-samples</li>
<li>Randomly! (ie. not 1—80 and 81—100)</li>
<li>Randomly generate an ID, sort and create two sub-samples.</li>
<li>Training sample 80%
<ul>
<li>Regressions will be on run on this sample</li>
<li>Coefficients estimated</li>
</ul></li>
<li>Test (validation) sample 20%
<ul>
<li>Using estimated coefficients, we predict values for flats in the validation sample</li>
<li>Calculate residual, RMSE in the test sample</li>
</ul></li>
<li>RMSE rather than MSE – smaller numbers….</li>
</ul>
</section>
<section id="fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="fold-cross-validation">5-fold cross-validation</h2>
<ul>
<li>Split sample <span class="math inline">\(k=5\)</span> times to train and test</li>
<li>For each folds:
<ul>
<li>Estimate model on training.</li>
<li>Get coefficients.</li>
<li>Use them to estimate on Test</li>
<li>Calculate test MSE</li>
</ul></li>
<li>Average and take Sqrt</li>
<li>Repeat for models</li>
<li>Pick model w lowest avg RMSE</li>
</ul>
</section>
<section id="bic-vs-test-rmse" class="level2">
<h2 class="anchored" data-anchor-id="bic-vs-test-rmse">BIC vs test RMSE</h2>
<ul>
<li>In our experience, in practice, BIC is the best indirect criterion – closest to test sample.</li>
<li>The advantage of BIC is that it needs no sample splitting which may be a problem in small samples.</li>
<li>The advantage of test MSE is that it makes no assumption.</li>
<li>BIC is a good first run, quick, is often not very wrong.</li>
<li>Ultimately, you want to do a test MSE.</li>
</ul>
</section>
<section id="case-study-model-selection" class="level2">
<h2 class="anchored" data-anchor-id="case-study-model-selection">Case study: Model selection</h2>
<ul>
<li>We have the ingredients, we need to pick a model.</li>
<li>This process involves variable selection and a decision rule of choosing the model based on some loss function.</li>
<li>BIC on the actual data</li>
<li>Test-sample RMSE</li>
<li>Cross-validated (CV) RMSE</li>
<li>If enough data / computer power, use CV RMSE</li>
<li>With larger dataset, overfit becomes less of an issue.</li>
</ul>
</section>
<section id="case-study-model-selection-1" class="level2">
<h2 class="anchored" data-anchor-id="case-study-model-selection-1">Case study: Model selection</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>N vars</th>
<th>N coeff</th>
<th>R-squared</th>
<th>RMSE</th>
<th>BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 Model 1</td>
<td>3</td>
<td>0.85</td>
<td>1,755</td>
<td>5,018</td>
<td></td>
</tr>
<tr class="even">
<td>2 Model 2</td>
<td>5</td>
<td>0.90</td>
<td>1,433</td>
<td>4,910</td>
<td></td>
</tr>
<tr class="odd">
<td>3 Model 3</td>
<td>9</td>
<td>0.91</td>
<td>1,322</td>
<td>4,893</td>
<td></td>
</tr>
<tr class="even">
<td>4 Model 4</td>
<td>12</td>
<td>0.92</td>
<td>1,273</td>
<td>4,894</td>
<td></td>
</tr>
<tr class="odd">
<td>5 Model 5</td>
<td>22</td>
<td>0.92</td>
<td>1,239</td>
<td>4,935</td>
<td></td>
</tr>
</tbody>
</table>
<p>Note: In sample values. Model 1: age, age squared, Model 2= Model 1 +odometer, odometer squared, Model 3= Model2 + SE, excellent condition, good condition, dealer, Model 4= Model 3 + LE, XLE, like new condition, 6cylinder, Model 5 = Model 4 + many interactions. Source: used-cars dataset.</p>
</section>
<section id="case-study-model-selection-2" class="level2">
<h2 class="anchored" data-anchor-id="case-study-model-selection-2">Case study: Model selection</h2>
<ul>
<li>Cross-validate using 4-fold cross validation.</li>
<li>Run the regression on 3/4 of the sample, predicting on the remaining 1/4 of the sample, get RMSE on test sample.</li>
<li>We then average out RMSE values over the 4 test samples</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Fold No.</th>
<th>Model 1</th>
<th>Model 2</th>
<th>Model 3</th>
<th>Model 4</th>
<th>Model 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 Fold1</td>
<td>1,734</td>
<td>1,428</td>
<td>1,331</td>
<td>1,395</td>
<td>1,391</td>
</tr>
<tr class="even">
<td>2 Fold2</td>
<td>2,010</td>
<td>1,781</td>
<td>1,692</td>
<td>1,638</td>
<td>1,693</td>
</tr>
<tr class="odd">
<td>3 Fold3</td>
<td>1,465</td>
<td>1,251</td>
<td>1,256</td>
<td>1,253</td>
<td>1,436</td>
</tr>
<tr class="even">
<td>4 Fold4</td>
<td>1,823</td>
<td>1,325</td>
<td>1,250</td>
<td>1,246</td>
<td>1,307</td>
</tr>
<tr class="odd">
<td>5 Average</td>
<td>1,769</td>
<td>1,460</td>
<td>1,394</td>
<td>1,392</td>
<td>1,464</td>
</tr>
</tbody>
</table>
<p>Source: used-cars dataset.</p>
</section>
<section id="case-study-model-selection-3" class="level2">
<h2 class="anchored" data-anchor-id="case-study-model-selection-3">Case study: Model selection</h2>
<ul>
<li>Model 3 has lowest BIC, lowest average RMSE on test samples. Model 4 is close.</li>
<li>Interestingly, both approaches suggests that Model 3 is the one that has the best prediction properties</li>
<li>Small sample, simple model.</li>
</ul>
</section>
<section id="external-validity-and-stable-patterns" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns">External validity and stable patterns</h2>
<ul>
<li>BIC, Training-test, k-fold cross-validation…</li>
<li>All very nice</li>
<li>But, in the end, they all use the information in the data.</li>
<li>How would things look for the target observation(s)?</li>
<li>The issue of stationarity – how our data is related to other datasets we may use our model</li>
<li>We may have some ideas</li>
<li>We may use non-random test samples that may mimic the difference in our data and the target observations</li>
<li>In the end we can’t know but need to think about it.</li>
<li>Plus be aware, that some difference is likely, so your model fit in an outside data source is likely to be worse…</li>
</ul>
</section>
<section id="external-validity-and-stable-patterns-1" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns-1">External validity and stable patterns</h2>
<ul>
<li>Most predictions will be on future data</li>
<li>High external validity requires that the environment is stationary.</li>
<li>Stationarity means that the way variables are distributed remains the same over time.</li>
<li>Here that distribution is to be understood in a general way: the joint distribution of predictor variables and target variable are required to remain the same throughout the time covered in the data and the time of the forecast.</li>
<li>Stationarity ensures that the relationship between predictors and the target variable is the same in the data and the forecasted future.</li>
<li>If the relationship breaks down whatever we establish in our data won’t be true in the future, leading to wrong forecasts.</li>
</ul>
</section>
<section id="external-validity-and-stable-patterns-2" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns-2">External validity and stable patterns</h2>
<ul>
<li>External validity and stable patterns - Very broad concept</li>
<li>It’s about representativeness of actual data <span class="math inline">\(\rightarrow\)</span> to live data</li>
<li>Often hard to know.</li>
<li>Remember hotels (other dates, other cities).</li>
<li>Domain knowledge can help.</li>
<li>Study if patterns were stable in the past / other locations were stable can help.</li>
</ul>
</section>
<section id="algorithms" class="level2">
<h2 class="anchored" data-anchor-id="algorithms">Algorithms</h2>
</section>
<section id="machine-learning-and-the-role-of-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning-and-the-role-of-algorithms">Machine Learning and the Role of Algorithms</h2>
<ul>
<li>Predictive analytics is often used for data analysis whose goal is prediction. But a more popular, and related, term is machine learning.</li>
<li>Machine learning is an umbrella concept for methods that use algorithms to find patterns in data and use them for prediction purposes.</li>
<li>An algorithm is a set of rules and steps that defines how to generate an output (predicted values) using various inputs (variables, observations in the original data).</li>
<li>A formula is an example of an algorithm – one that can be formulated in terms of an equation.</li>
<li>OLS formula for estimating the coefficients of a linear regression is an algorithm.</li>
</ul>
</section>
<section id="machine-learning-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning-algorithms">Machine Learning Algorithms</h2>
<ul>
<li>Machine learning is about algorithms, machines and learning</li>
<li>Algorithms specify each and every step to follow in a clear way.</li>
<li>Not all algorithms can be translated into a formula.
<ul>
<li>The bootstrap estimation of a standard error (Chapter 5, Section 5.6) is an example.</li>
<li>K-fold cross-validation.</li>
</ul></li>
<li>Heavy use of machines = computers. Steps of algorithm translated into computer code and make the computer follow those steps. Fast.</li>
<li>Learning - learn something from the data with data and an algorithms.
<ul>
<li>Predicted value of <span class="math inline">\(y =?\)</span> If combine <span class="math inline">\(x\)</span> variables using a particular model.</li>
<li>learning which model is best for predicting <span class="math inline">\(y\)</span> as well as what that predicted value is.</li>
</ul></li>
</ul>
</section>
<section id="what-is-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="what-is-machine-learning">What is, machine learning?</h2>
<ul>
<li>Many definitions, discussions.</li>
<li>Here: Machine learning is an approach to predictive data analysis – achieving the best possible prediction from available data.</li>
<li>Consequence 1: understanding the patterns of associations between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> is of secondary importance.</li>
<li>We need stable patterns for good prediction in live data, but that is it.</li>
<li>The machine learning attitude - a preference for evaluating methods based on data as opposed to abstract principles.</li>
<li>Original data to live data</li>
<li>Not a general rule or philosophy</li>
<li>Machine learning broadly: all prediction models including OLS</li>
<li>Machine learning narrowly: prediction models with no formula, ie not OLS</li>
</ul>
</section>
<section id="main-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="main-takeaways">Main takeaways</h2>
<ul>
<li>Prediction uses the original data with <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> to predict the value of <span class="math inline">\(y\)</span> for observations in the live data, in which <span class="math inline">\(x\)</span> is observed but <span class="math inline">\(y\)</span> is not</li>
<li>Prediction uses a model that describes the patterns of association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> in the original data</li>
<li>Cross-validation can help find the best model in the population, or general pattern, represented by the original data</li>
<li>Stability of the patterns of association is needed for a prediction with high external validity</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>