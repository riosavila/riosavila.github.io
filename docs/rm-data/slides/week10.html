<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fernando Rios-Avila">
<meta name="dcterms.date" content="2024-11-05">

<title>Prediction Setup – Econometrics MSC Levy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Econometrics MSC Levy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Prediction Setup</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Courses</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../adv_class/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advance Econometrics: Causal Effects</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods: Econometrics I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rmethods2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../rm-data/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Methods I: Data Analysis for Economics and Policy</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Math Refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../mathref/math_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Math Refresher</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#prediction-basics-the-process" id="toc-prediction-basics-the-process" class="nav-link" data-scroll-target="#prediction-basics-the-process">Prediction Basics: The Process</a></li>
  <li><a href="#prediction-basics-the-process-1" id="toc-prediction-basics-the-process-1" class="nav-link" data-scroll-target="#prediction-basics-the-process-1">Prediction Basics: The Process</a></li>
  <li><a href="#cs-price-cars" id="toc-cs-price-cars" class="nav-link" data-scroll-target="#cs-price-cars">CS: Price cars</a></li>
  <li><a href="#cs-price-apartments" id="toc-cs-price-apartments" class="nav-link" data-scroll-target="#cs-price-apartments">CS: Price apartments</a></li>
  <li><a href="#cs-predict-companys-exit-from-business" id="toc-cs-predict-companys-exit-from-business" class="nav-link" data-scroll-target="#cs-predict-companys-exit-from-business">CS: Predict company’s exit from business</a></li>
  <li><a href="#predictive-analysis-what-is-new" id="toc-predictive-analysis-what-is-new" class="nav-link" data-scroll-target="#predictive-analysis-what-is-new">Predictive Analysis: what is new?</a></li>
  <li><a href="#different-types-of-prediction" id="toc-different-types-of-prediction" class="nav-link" data-scroll-target="#different-types-of-prediction">Different types of prediction</a>
  <ul class="collapse">
  <li><a href="#what-are-we-predicting" id="toc-what-are-we-predicting" class="nav-link" data-scroll-target="#what-are-we-predicting">What are we predicting?</a></li>
  <li><a href="#what-is-different" id="toc-what-is-different" class="nav-link" data-scroll-target="#what-is-different">What is Different?</a></li>
  <li><a href="#the-tool-supervised-machine-learning" id="toc-the-tool-supervised-machine-learning" class="nav-link" data-scroll-target="#the-tool-supervised-machine-learning">The Tool: Supervised Machine Learning</a></li>
  <li><a href="#the-prediction-error" id="toc-the-prediction-error" class="nav-link" data-scroll-target="#the-prediction-error">The Prediction Error</a></li>
  <li><a href="#the-prediction-error-1" id="toc-the-prediction-error-1" class="nav-link" data-scroll-target="#the-prediction-error-1">The Prediction Error</a></li>
  <li><a href="#decomposing-the-prediction-error" id="toc-decomposing-the-prediction-error" class="nav-link" data-scroll-target="#decomposing-the-prediction-error">Decomposing the prediction error</a></li>
  <li><a href="#interval-prediction-for-quantitative-target-variables" id="toc-interval-prediction-for-quantitative-target-variables" class="nav-link" data-scroll-target="#interval-prediction-for-quantitative-target-variables">Interval prediction for quantitative target variables</a></li>
  </ul></li>
  <li><a href="#the-loss-function" id="toc-the-loss-function" class="nav-link" data-scroll-target="#the-loss-function">The Loss function</a>
  <ul class="collapse">
  <li><a href="#loss-functions" id="toc-loss-functions" class="nav-link" data-scroll-target="#loss-functions">Loss Functions</a></li>
  <li><a href="#loss-functions-1" id="toc-loss-functions-1" class="nav-link" data-scroll-target="#loss-functions-1">Loss Functions</a></li>
  <li><a href="#loss-functions-of-various-shapes" id="toc-loss-functions-of-various-shapes" class="nav-link" data-scroll-target="#loss-functions-of-various-shapes">Loss Functions of Various Shapes</a></li>
  <li><a href="#examples-1-used-cars" id="toc-examples-1-used-cars" class="nav-link" data-scroll-target="#examples-1-used-cars">Examples 1 – used cars</a></li>
  <li><a href="#examples-2---creditors" id="toc-examples-2---creditors" class="nav-link" data-scroll-target="#examples-2---creditors">Examples 2 - creditors</a></li>
  <li><a href="#common-loss-functions" id="toc-common-loss-functions" class="nav-link" data-scroll-target="#common-loss-functions">Common loss functions</a></li>
  <li><a href="#mean-squared-error-mse" id="toc-mean-squared-error-mse" class="nav-link" data-scroll-target="#mean-squared-error-mse">Mean Squared Error: MSE</a></li>
  <li><a href="#mse-decomposition-bias-and-variance" id="toc-mse-decomposition-bias-and-variance" class="nav-link" data-scroll-target="#mse-decomposition-bias-and-variance">MSE decomposition : Bias and Variance</a></li>
  <li><a href="#mse-decomposition-bias-and-variance-1" id="toc-mse-decomposition-bias-and-variance-1" class="nav-link" data-scroll-target="#mse-decomposition-bias-and-variance-1">MSE decomposition : Bias and Variance</a></li>
  </ul></li>
  <li><a href="#finding-the-best-model" id="toc-finding-the-best-model" class="nav-link" data-scroll-target="#finding-the-best-model">Finding the best model</a>
  <ul class="collapse">
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model selection</a></li>
  <li><a href="#how-to-choose-a-model" id="toc-how-to-choose-a-model" class="nav-link" data-scroll-target="#how-to-choose-a-model">How to choose a model?</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example 2</a></li>
  <li><a href="#underfit-vs-overfit" id="toc-underfit-vs-overfit" class="nav-link" data-scroll-target="#underfit-vs-overfit">Underfit vs overfit</a>
  <ul class="collapse">
  <li><a href="#overfitting" id="toc-overfitting" class="nav-link" data-scroll-target="#overfitting">Overfitting</a></li>
  </ul></li>
  <li><a href="#reason-for-overfitting" id="toc-reason-for-overfitting" class="nav-link" data-scroll-target="#reason-for-overfitting">Reason for overfitting</a></li>
  <li><a href="#finding-the-best-model-by-best-fit-and-penalty" id="toc-finding-the-best-model-by-best-fit-and-penalty" class="nav-link" data-scroll-target="#finding-the-best-model-by-best-fit-and-penalty">Finding the best model by best fit and penalty</a></li>
  <li><a href="#indirect-evaluation-criteria" id="toc-indirect-evaluation-criteria" class="nav-link" data-scroll-target="#indirect-evaluation-criteria">Indirect evaluation criteria</a></li>
  <li><a href="#example-redone" id="toc-example-redone" class="nav-link" data-scroll-target="#example-redone">Example, redone</a></li>
  <li><a href="#finding-the-best-model-by-training-and-test-samples" id="toc-finding-the-best-model-by-training-and-test-samples" class="nav-link" data-scroll-target="#finding-the-best-model-by-training-and-test-samples">Finding the best model by training and test samples</a></li>
  <li><a href="#lets-make-things-better-k-fold-cross-validation" id="toc-lets-make-things-better-k-fold-cross-validation" class="nav-link" data-scroll-target="#lets-make-things-better-k-fold-cross-validation">Lets make things Better: K-fold cross-validation</a></li>
  <li><a href="#k-fold-cross-validation" id="toc-k-fold-cross-validation" class="nav-link" data-scroll-target="#k-fold-cross-validation">K-fold cross-validation</a></li>
  <li><a href="#when-k-rightarrow-n.-loocv" id="toc-when-k-rightarrow-n.-loocv" class="nav-link" data-scroll-target="#when-k-rightarrow-n.-loocv">When K <span class="math inline">\(\rightarrow\)</span> N. LooCV</a></li>
  <li><a href="#bic-vs-test-rmse" id="toc-bic-vs-test-rmse" class="nav-link" data-scroll-target="#bic-vs-test-rmse">BIC vs test RMSE</a></li>
  <li><a href="#external-validity-and-stable-patterns" id="toc-external-validity-and-stable-patterns" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns">External validity and stable patterns</a></li>
  <li><a href="#external-validity-and-stable-patterns-1" id="toc-external-validity-and-stable-patterns-1" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns-1">External validity and stable patterns</a></li>
  <li><a href="#external-validity-and-stable-patterns-2" id="toc-external-validity-and-stable-patterns-2" class="nav-link" data-scroll-target="#external-validity-and-stable-patterns-2">External validity and stable patterns</a></li>
  <li><a href="#main-takeaways" id="toc-main-takeaways" class="nav-link" data-scroll-target="#main-takeaways">Main takeaways</a></li>
  <li><a href="#cs-predicting-the-price-of-used-cars" id="toc-cs-predicting-the-price-of-used-cars" class="nav-link" data-scroll-target="#cs-predicting-the-price-of-used-cars">CS: Predicting the price of used cars</a></li>
  <li><a href="#cs-competing-models" id="toc-cs-competing-models" class="nav-link" data-scroll-target="#cs-competing-models">CS: Competing models:</a></li>
  <li><a href="#cs-test-data" id="toc-cs-test-data" class="nav-link" data-scroll-target="#cs-test-data">CS: Test Data</a></li>
  <li><a href="#cs-results" id="toc-cs-results" class="nav-link" data-scroll-target="#cs-results">CS: Results</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="week10.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prediction Setup</h1>
<p class="subtitle lead">How far should we go?</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Fernando Rios-Avila </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Levy Economics Institute
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<ul>
<li><p>Imagine you want to sell your car soon and need to predict its price. You have data on similar used cars, and several regression models could help estimate its value now and in a year. How do you choose the best model?</p></li>
<li><p>Or, take an ice cream shop—using past sales and temperature data, you want to predict sales for the coming days. What factors should you consider to ensure your prediction is as accurate as possible?</p></li>
</ul>
</section>
<section id="prediction-basics-the-process" class="level2">
<h2 class="anchored" data-anchor-id="prediction-basics-the-process">Prediction Basics: The Process</h2>
<ul>
<li>The idea of behind prediction is that we want to assign a value of <span class="math inline">\(y\)</span>(<span class="math inline">\(\hat y\)</span>) (target or outcome) for observations we do not have the value.</li>
<li>What we have, in our original data or working sample, is a set of observations with <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> values. We use them to “learn” the patterns of association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span>.</li>
<li>But for the target observations, we only have <span class="math inline">\(x\)</span> values.</li>
</ul>
</section>
<section id="prediction-basics-the-process-1" class="level2">
<h2 class="anchored" data-anchor-id="prediction-basics-the-process-1">Prediction Basics: The Process</h2>
<ul>
<li>The process of prediction involves:
<ul>
<li>Determine what is the <strong>target</strong> variable <span class="math inline">\(y\)</span> and the <strong>features</strong> <span class="math inline">\(x\)</span>.</li>
<li>Using the original data to estimate a model that describes the patterns of association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span>.</li>
<li>Using the estimated model to predict the value of <span class="math inline">\(y\)</span> for the target observations.</li>
</ul></li>
<li>Evaluation of the prediction (how actual data compares to predicted data)</li>
<li>Rinse and repeat: Choose a different model, evaluate, choose the best model.
<ul>
<li>Best model for the Live data not the original data.</li>
</ul></li>
</ul>
</section>
<section id="cs-price-cars" class="level2">
<h2 class="anchored" data-anchor-id="cs-price-cars">CS: Price cars</h2>
<ul>
<li>You want to sell your car through online advertising</li>
<li>Target is continuous (in dollars)</li>
<li>Features are continuous or categorical</li>
<li>The business question:
<ul>
<li>What price should you put into the ad?</li>
</ul></li>
</ul>
</section>
<section id="cs-price-apartments" class="level2">
<h2 class="anchored" data-anchor-id="cs-price-apartments">CS: Price apartments</h2>
<ul>
<li>You are planning to run an AirBnB business</li>
<li>Target is continuous (in dollars)</li>
<li>Features are varied from text to binary</li>
<li>The business question:
<ul>
<li>How should you price apartments/houses?</li>
</ul></li>
</ul>
</section>
<section id="cs-predict-companys-exit-from-business" class="level2">
<h2 class="anchored" data-anchor-id="cs-predict-companys-exit-from-business">CS: Predict company’s exit from business</h2>
<ul>
<li>You have a consulting company</li>
<li>Predict which firms will go out of business (exit) from a pool of partners</li>
<li>Target is binary: exit / stay</li>
<li>Features of financial and management info</li>
<li>Business decision:
<ul>
<li>Which firms to give loan to?</li>
</ul></li>
</ul>
</section>
<section id="predictive-analysis-what-is-new" class="level2">
<h2 class="anchored" data-anchor-id="predictive-analysis-what-is-new">Predictive Analysis: what is new?</h2>
<ul>
<li>Most of econometrics focused on finding relationships between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>
<ul>
<li>What is the relationship like (+/-, linear, etc.)</li>
<li>Is it a robust relationship – true in the population /general pattern? (causal?)</li>
</ul></li>
<li>Now, we use <span class="math inline">\(x_1, x_2, \dots\)</span> to predict <span class="math inline">\(y\)</span>: <span class="math inline">\(\hat{y}_j = \hat{f}(x_j)\)</span>, How is this different?</li>
</ul>
<div class="fragment">
<ul>
<li>We care less about
<ul>
<li>Individual coefficient values, multicollinearity</li>
</ul></li>
<li>We still care about the stability of our results.</li>
<li>But, should we care about causality?
<ul>
<li>Not so much, we care more about making the best prediction.</li>
</ul></li>
</ul>
</div>
</section>
<section id="different-types-of-prediction" class="level1">
<h1>Different types of prediction</h1>
<p>Target variables</p>
<section id="what-are-we-predicting" class="level2">
<h2 class="anchored" data-anchor-id="what-are-we-predicting">What are we predicting?</h2>
<ul>
<li><span class="math inline">\(Y\)</span> is quantitative (e.g price)
<ul>
<li>Quantitative prediction. Expected price of a car given its characteristics.</li>
<li>its a “Regression” problem</li>
<li>We could obtain a point prediction or an interval prediction (As before)</li>
</ul></li>
<li><span class="math inline">\(Y\)</span> is binary (e.g.&nbsp;Default or nor)
<ul>
<li><span class="math inline">\(Y\)</span> takes values in a finite set of (unordered) classes (survived/died, sold/not sold, car model)</li>
<li>We may want to types of predictions: Probability prediction (<span class="math inline">\(\hat P(y|x=1)\)</span>) or classification (<span class="math inline">\(\hat y = 1 \text{ or }0| x\)</span>)</li>
</ul></li>
<li>Time series prediction (<strong>Forecasting</strong>).
<ul>
<li>Make predictions about the future based on historical and current data.</li>
<li><span class="math inline">\(\hat y_t = f(x_{t-1}, x_{t-2}, \dots)\)</span></li>
</ul></li>
</ul>
</section>
<section id="what-is-different" class="level2">
<h2 class="anchored" data-anchor-id="what-is-different">What is Different?</h2>
<ul>
<li>In principle, the process is the same as before, but we have a diffent goal.
<ul>
<li>We need to pay more attention to other aspects of the process.</li>
</ul></li>
<li>Label Engeneering: What transformation is suitable for the target variable?</li>
<li>Feature engineering (variable selection): What variables and functional forms should be included</li>
<li>Model estimation and prediction, based on variable selection
<ul>
<li>Decisions regarding model complexity and Specification (Know-How or Machine Learning)</li>
</ul></li>
<li>Model evaluation considering complexity and loss</li>
<li>Key idea: Focus on systematically combine estimation and model selection</li>
</ul>
</section>
<section id="the-tool-supervised-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="the-tool-supervised-machine-learning">The Tool: Supervised Machine Learning</h2>
<ul>
<li>Supervised Machine Learning is a set of tools that help us predict the value of a target variable <span class="math inline">\(Y\)</span> based on a set of features <span class="math inline">\(X\)</span>.</li>
<li>We will use one of the oldest and most commonly used method:</li>
</ul>
<div class="fragment">
<ul>
<li>Linear Regression</li>
</ul>
</div>
</section>
<section id="the-prediction-error" class="level2">
<h2 class="anchored" data-anchor-id="the-prediction-error">The Prediction Error</h2>
<ul>
<li>We have seen this.</li>
<li>The Regression model can produce a Predicted value <span class="math inline">\(\hat{y}_j\)</span> for target observation <span class="math inline">\(j\)</span></li>
<li>but, actual value <span class="math inline">\(y_j\)</span> is not known (that is why we are predicting)</li>
<li>Thus, there will be a prediction error</li>
</ul>
<p><span class="math display">\[e_j = \hat{y}_j - y_j
\]</span></p>
<ul>
<li>Error = actual value - predicted value</li>
</ul>
</section>
<section id="the-prediction-error-1" class="level2">
<h2 class="anchored" data-anchor-id="the-prediction-error-1">The Prediction Error</h2>
<ul>
<li>The <strong>ideal</strong> prediction error, is zero: our predicted value is right on target.
<ul>
<li>Rare…</li>
</ul></li>
<li>The prediction error carries information: direction and size.</li>
<li>Direction of miss:
<ul>
<li>Positive if we overpredict</li>
<li>Negative if we underpredict</li>
<li>Degree of wrongness depends on the decision problem. (price is right?)</li>
</ul></li>
<li>Size:
<ul>
<li>magnitude of the error may depend on the nature of the problem and the loss function.</li>
</ul></li>
</ul>
</section>
<section id="decomposing-the-prediction-error" class="level2">
<h2 class="anchored" data-anchor-id="decomposing-the-prediction-error">Decomposing the prediction error</h2>
<p>Assume the best model for <span class="math inline">\(Y\)</span> is <span class="math inline">\(Y= f(X,Z)+\epsilon\)</span>, but we estimate <span class="math inline">\(Y^E = g(X,Z)\)</span>, and obtain <span class="math inline">\(\hat g(X,Z)\)</span></p>
<ul>
<li>The prediction error can be decomposed into three parts:
<ol type="1">
<li><strong>estimation error</strong>: Difference between <span class="math inline">\(g(X)\)</span> and <span class="math inline">\(\hat g(X)\)</span></li>
<li><strong>model error</strong>: Difference between <span class="math inline">\(f(X)\)</span> and <span class="math inline">\(g(X)\)</span>.</li>
<li><strong>genuine error</strong>: error that cant be eliminated even if have the best possible model. <span class="math inline">\(\epsilon\)</span></li>
</ol></li>
</ul>
</section>
<section id="interval-prediction-for-quantitative-target-variables" class="level2">
<h2 class="anchored" data-anchor-id="interval-prediction-for-quantitative-target-variables">Interval prediction for quantitative target variables</h2>
<ul>
<li><p>One advantage of regressions - it’s easy quantify uncertainty of prediction</p>
<ul>
<li>This can be used to obtain <strong>Interval predictions</strong></li>
</ul></li>
<li><p>Interval predictions quantify 2-out-of-3 sources of prediction uncertainty: estimation error and genuine (or irreducible) error.</p></li>
<li><p>They do not include the third source, model uncertainty! (Bayesian methods can help with this)</p></li>
<li><p>The 95% prediction interval (PI) tells where to expect the actual value for the target observation.</p></li>
<li><p>The PI for linear regression requires homoskedasticity. (but could be relaxed)</p></li>
</ul>
</section>
</section>
<section id="the-loss-function" class="level1">
<h1>The Loss function</h1>
<p>Not all errors are created equal</p>
<section id="loss-functions" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions">Loss Functions</h2>
<ul>
<li><p>We use a <strong>Loss</strong> function to quantify the <strong>cost</strong> of prediction error</p>
<ul>
<li>It attaches a value to the prediction error, specifying how <strong>bad</strong> it is</li>
<li>Thus, Loss function determines best predictor</li>
</ul></li>
<li><p>Ideally, it is derived from decision problem,</p>
<ul>
<li>How much more costly is to overpredict than underpredict?</li>
</ul></li>
<li><p>In practice, highly crafted loss functions are rare (Machine learning, Neural Networks, Etc), so we use common ones</p></li>
<li><p>Loss functions could be used to both estimate, but also to <strong>evaluate/compare</strong> models</p></li>
<li><p>Plot Twist: Loss function for OLS is the L2 Square loss function</p></li>
</ul>
</section>
<section id="loss-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions-1">Loss Functions</h2>
<ul>
<li>The most important Loss functions have the following characteristics:
<ul>
<li><strong>Symmetry</strong>: losses due to errors in opposing direction are similar
<ul>
<li><strong>Asymmetric loss</strong>: overprediction is more costly than underprediction</li>
</ul></li>
<li><strong>Convexity</strong>: Twice as large errors generate more than twice as large losses. (We penalize large errors more than small ones)
<ul>
<li><strong>Linear loss</strong>: Errors are penalized proportionally to their size</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="loss-functions-of-various-shapes" class="level2">
<h2 class="anchored" data-anchor-id="loss-functions-of-various-shapes">Loss Functions of Various Shapes</h2>
<div id="448f0684" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">scheme</span> white2</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>color_style tableau</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 301</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">range</span> <span class="fu">r</span> -5 5 </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll = <span class="fu">r</span>^2</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll2 = 2*<span class="fu">abs</span>(<span class="fu">r</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ll3 = 1.5*<span class="fu">r</span>^2*(<span class="fu">r</span>&gt;0)+0.5*<span class="fu">r</span>^2*(<span class="fu">r</span>&lt;0)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> ll&gt;30 | ll2&gt;30 | ll3&gt;30</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">line</span> ll ll2 ll3 <span class="fu">r</span>, lw(1 1 1) <span class="co">///</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"Symetric-Convex"</span> 2 <span class="st">"Symetric-Linear"</span> 3 <span class="st">"Asymetric-Convex"</span>) )</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>div.jp-Notebook .datagrid-container {min-height: 448px; }</style>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week10_files/figure-revealjs/cell-2-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="examples-1-used-cars" class="level2">
<h2 class="anchored" data-anchor-id="examples-1-used-cars">Examples 1 – used cars</h2>
<ul>
<li>The loss function for predicting the value of our used car depends on how we value money and how we value how much time it takes to sell our car (value of your car).</li>
<li>A too low prediction may lead to selling our car cheap but fast;</li>
<li>A too high prediction may make us wait a long time and, possibly, revising the sales price downwards before selling our car.</li>
<li>What kind of loss function would make sense?</li>
</ul>
</section>
<section id="examples-2---creditors" class="level2">
<h2 class="anchored" data-anchor-id="examples-2---creditors">Examples 2 - creditors</h2>
<ul>
<li>Creditors decide whether to issue a loan only to potential debtors that are predicted to pay it back with high likelihood.</li>
<li>Two kinds of errors are possible:
<ul>
<li>debtors that would pay back their loan don’t get a loan</li>
<li>debtors that would not pay back their loan get one nevertheless.</li>
</ul></li>
<li>The costs of the first error are due to missed business opportunity; the costs of the second error are due to direct loss of money.</li>
<li>These losses may be quantified in relatively straightforward ways.</li>
<li>What kind of loss function would make sense?</li>
</ul>
</section>
<section id="common-loss-functions" class="level2">
<h2 class="anchored" data-anchor-id="common-loss-functions">Common loss functions</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[SQR: L(e_j) = e^2_j = (\hat{y}_j - y_j)^2
\]</span></p>
<ul>
<li>The most widely used loss function</li>
<li>Symmetric: Losses due to errors in opposing direction are same</li>
<li>Convex: Twice as large errors generate more than twice (4x) as large losses</li>
</ul>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[ABS: L(e_j) = |e_j| = Abs(\hat{y}_j - y_j)
\]</span></p>
<ul>
<li><p>Used for Median regression (Quantile regression)</p></li>
<li><p>Symmetric: Losses due to errors in opposing direction are same</p></li>
<li><p>Linear: Twice as large errors generate twice as large losses</p></li>
<li><p>Quantile Regressions use <strong>Asymetric</strong> loss functions</p></li>
</ul>
</div>
</div>
</section>
<section id="mean-squared-error-mse" class="level2">
<h2 class="anchored" data-anchor-id="mean-squared-error-mse">Mean Squared Error: MSE</h2>
<ul>
<li>The most common way to quantify and aggregate the loss function is using the Mean Squared Error (MSE)</li>
<li>Squared loss <span class="math inline">\(\rightarrow\)</span> Mean Squared Error (MSE)</li>
</ul>
<p><span class="math display">\[\begin{align*}
\text{MSE} &amp;= \frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2 \\
\text{RMSE} &amp;= \sqrt{\text{MSE}} = \sqrt{\frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2}
\end{align*}
\]</span></p>
<ul>
<li>Using this function typically implies we are interested in the Mean as the best predictor</li>
</ul>
</section>
<section id="mse-decomposition-bias-and-variance" class="level2">
<h2 class="anchored" data-anchor-id="mse-decomposition-bias-and-variance">MSE decomposition : Bias and Variance</h2>
<ul>
<li><p>The MSE can be decomposed into two parts: <strong>Bias</strong> and <strong>Variance</strong> <span class="math display">\[\begin{align*}
MSE &amp;= \frac{1}{J}\sum_{j=1}^J (\hat{y}_j - y_j)^2 \\
&amp;= \left(\frac{1}{J}\sum_{j=1}^J (\hat{y}_j - y_j)\right)^2 + \frac{1}{J}\sum_{j=1}^J (\hat y_j - \bar{\hat y})^2 \\
&amp;= \text{Bias}^2 + \text{PredictionVariance}
\end{align*}
\]</span></p></li>
<li><p>The bias of a prediction is the average of its prediction error.</p>
<ul>
<li>How far off is the average prediction from the actual value?</li>
</ul></li>
<li><p>The variance of a prediction describes shows how it varies around its average.</p></li>
</ul>
</section>
<section id="mse-decomposition-bias-and-variance-1" class="level2">
<h2 class="anchored" data-anchor-id="mse-decomposition-bias-and-variance-1">MSE decomposition : Bias and Variance</h2>
<p><span class="math display">\[\begin{align*}
\text{MSE} &amp;= \frac{1}{K} \sum_{k=1}^K (\hat{y}_k - y_k)^2 \\
         &amp;= \left(\frac{1}{K} \sum_{k=1}^K (\hat{y}_k - \bar{y})\right)^2 + \frac{1}{K} \sum_{k=1}^K (y_k - \bar{y})^2 \\
         &amp;= \text{Bias}^2 + \text{PredictionVariance}
\end{align*}\]</span></p>
<ul>
<li>OLS is unbiased. Some other methods will allow for some bias in return for lower variance.</li>
</ul>
<!-- ## Case study: used cars data

- Suppose you want to sell your car of a certain make, type, year, miles, condition and other features.
- The prediction analysis helps uncover the average advertised price of cars with these characteristics
- That helps decide what price you may want to put on your ad.

What to do?

- Scraped from a website
- Year of make (age), Odometer (miles)
- Tech specifications such as fuel and drive
- Dealer or private seller

## Case study: Loss function

- The loss function for predicting the value of our used car depends on how we value money and how we value how much time it takes to sell our car.
- A too low prediction may lead to selling our car cheap but fast;
- A too high prediction may make us wait a long time and, possibly, revising the sales price downwards before selling our car.
- Symmetric
- Sensitive to big deviations
- RMSE and OLS

## Case study - used cars: features

- Odometer, measuring miles the car traveled (Continuous, linear)
- More specific type of the car: LE, XLE, SE (missing in about 30% of the observations). (Factor – set of dummies , incl N/A)
- Good condition, excellent condition or it is like new (missing for about one third of the ads). (Factor – set of dummies, incl N/A)
- Car's engine has 6 cylinders (20% of ads say this; 43% says 4 cylinders, and the rest has no information on this). (Binary for 6 cylinders)

## Case study: models by hand

- Model 1: age, age squared
- Model 2: age, age squared, odometer, odometer squared
- Model 3: age, age squared, odometer, odometer squared, LE, excellent condition, good condition, dealer
- Model 4: age, age squared, odometer, odometer squared, LE, excellent condition, good condition, dealer, LE, XLE, cylinder
- Model 5: same as Model 4 but with all variables interacted with age (won't show in next table)

## Case study: Car price model results

```
(1)   (2)   (3)   (4)
Variables Model 1 Model 2 Model 3 Model 4
age     -1,530.09 -1,149.22 -873.47 -836.64
agesq    35.05   27.65   18.21   17.63
odometer           -303.84 -779.90 -788.70
odometersq                 18.81   19.20
LE                         28.11  -20.48
XLE                                301.69
SE                                1,338.79
cond_likenew                       558.67
cond_excellent                     176.49  190.40
cond_good                          293.36  321.56
cylind6                           -370.27
dealer                            572.98  822.65
Constant 18,365.45 18,860.20 19,431.89 18,963.35
```

## Case study: Results

- When doing prediction, coefficients are less important.
- But we shall use them for sanity check: age negative, convex (flattens out)
- SE may not be even displayed. It is helpful for model selection, but only along with other measures
- and values of the predictor variables for our car: age = 10 (years), odometer= 12 (10 thousand miles), type= LE, excellent condition=1.
- A point prediction, Model 3: age: -873.47, age squared=18.21, odometer -799.90, odometer sq = 18.81, LE=28.11, cond excellent: 176.49+ C=19.431.89
- Predicted is price is 6073.

## Case study: Prediction Interval

- Calculating prediction intervals for the baseline models
- Very wide interval despite high R2
- Prediction is hard!
- Even with a good model, you'll make plenty of errors
- Should be aware
- Let your clients know in advance...

## Case study: Prediction Interval

Based on the third model, we have a point prediction of $6073$
Have a 80% prediction intervals (PI) – Ads for cars just like ours may ask a price ranging from $4,317$ to $7,829$ with a 80% chance.

| Model 1 | Model 3 |
|---------|---------|
| Point prediction 6,569 | 6,073 |
| Prediction Interval (80%) [4,296-8,843] | [4,317-7,829] |
| Prediction Interval (95%) [3,085-10,053] | [3,382-8,763] |

Note: Chicago cars. Prices in dollars.
Source: used-cars dataset.
-->
</section>
</section>
<section id="finding-the-best-model" class="level1">
<h1>Finding the best model</h1>
<p>Too hot nor too cold, but just right</p>
<section id="model-selection" class="level2">
<h2 class="anchored" data-anchor-id="model-selection">Model selection</h2>
<ul>
<li>Model selection is finding the best fit while avoiding overfitting, and aiming for high external validity.</li>
<li>To do this, we aim to choose a model that is flexible enough to capture the patterns in the data but not too flexible to capture noise.
<ul>
<li>Bias-Variance tradeoff</li>
<li>Balancing the complexity of the model</li>
</ul></li>
<li>Consider two models. They could be different for two reasons:
<ul>
<li>different functional forms (spline vs.&nbsp;quadratic)</li>
<li>different number of variables (simple vs.&nbsp;complex)</li>
</ul></li>
</ul>
</section>
<section id="how-to-choose-a-model" class="level2">
<h2 class="anchored" data-anchor-id="how-to-choose-a-model">How to choose a model?</h2>
<ul>
<li><p>Typically, we would say that the best model is the one that has the highest <span class="math inline">\(R^2\)</span> or the lowest MSE.</p>
<ul>
<li>This may be true for the original data, but not for the <strong>target</strong> observations.</li>
<li>Also, <span class="math inline">\(R^2\)</span> and MSE always increase when we add more variables.</li>
</ul></li>
<li><p>So, what we need is a way to check how well the models predict the target observations. (unobserved cases)</p></li>
<li><p>We want to avoid overfitting at all costs.</p></li>
</ul>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<ul>
<li>Assume the true model is <span class="math inline">\(y = 1 + x -.5 x^2 + \epsilon\)</span>, with <span class="math inline">\(\epsilon ~ N(0,1.5)\)</span></li>
<li>we create 100 observations from the above process but use only 30 for modeling. We try running regressions with ever more complex models</li>
<li>Make predictions, and see how well we did.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;"><span class="math inline">\(R^2\)</span></th>
<th style="text-align: center;">MSE</th>
<th style="text-align: center;">OoS MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>^1</td>
<td style="text-align: center;">.3224669</td>
<td style="text-align: center;">1.934762</td>
<td style="text-align: center;">2.949084</td>
</tr>
<tr class="even">
<td>^2</td>
<td style="text-align: center;">.6255072</td>
<td style="text-align: center;">1.069401</td>
<td style="text-align: center;">2.93478</td>
</tr>
<tr class="odd">
<td>^3</td>
<td style="text-align: center;">.6344791</td>
<td style="text-align: center;">1.043781</td>
<td style="text-align: center;">2.978827</td>
</tr>
<tr class="even">
<td>^4</td>
<td style="text-align: center;">.713217</td>
<td style="text-align: center;">.8189369</td>
<td style="text-align: center;">4.138006</td>
</tr>
<tr class="odd">
<td>^5</td>
<td style="text-align: center;">.7259535</td>
<td style="text-align: center;">.7825666</td>
<td style="text-align: center;">3.557651</td>
</tr>
</tbody>
</table>
<p>See how <span class="math inline">\(R^2\)</span> increases monotonously, improving “in-sample fit”. But, the OoS MSE worsens after a certain point.</p>
</section>
<section id="example-2" class="level2">
<h2 class="anchored" data-anchor-id="example-2">Example 2</h2>
<p><img src="images/paste-8.png" class="img-fluid"></p>
</section>
<section id="underfit-vs-overfit" class="level2">
<h2 class="anchored" data-anchor-id="underfit-vs-overfit">Underfit vs overfit</h2>
<ul>
<li>A model that fits the data worse in the “working/original” data compared to the “live/target” data is said to “underfit” the model.
<ul>
<li>Simple: we should build a better model.</li>
</ul></li>
<li>If the model fits the data working better than target data, then it over-fits it. Needs to be corrected.</li>
</ul>
<section id="overfitting" class="level3">
<h3 class="anchored" data-anchor-id="overfitting">Overfitting</h3>
<ul>
<li>Overfitting is a key aspect of external validity
<ul>
<li>Finding a model that fits the data better than alternative models, but makes worse actual prediction.</li>
</ul></li>
<li>Overfitting is a common problem in prediction analysis</li>
</ul>
</section>
</section>
<section id="reason-for-overfitting" class="level2">
<h2 class="anchored" data-anchor-id="reason-for-overfitting">Reason for overfitting</h2>
<p>The typical reason for overfitting is fitting a model that is too complex on the dataset. - Complexity: number of estimated coefficients - Often: fitting a model with too many predictor variables. - Including too many variables from the dataset that do not really add to the predictive power of the regression. - Problems of multicollinearity, too many interactions, etc. - Too detailed nonlinear patterns - as piecewise linear splines with many knots - polynomials of high degree.</p>
</section>
<section id="finding-the-best-model-by-best-fit-and-penalty" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-model-by-best-fit-and-penalty">Finding the best model by best fit and penalty</h2>
<ul>
<li>As shown earlier, traditional measures of fit, such as <span class="math inline">\(R^2\)</span> and MSE, are not good for finding the best model. They always increase with the number of variables.</li>
<li>We were only able to conclude model fitness because we had the true model (and the Out-of-Sample data)
<ul>
<li>This is not the case in practice.</li>
</ul></li>
<li>So, how do we find the best model?
<ul>
<li>Indirectly: Penalize the number of variables</li>
<li>Directly: Use a training-test sample</li>
</ul></li>
</ul>
</section>
<section id="indirect-evaluation-criteria" class="level2">
<h2 class="anchored" data-anchor-id="indirect-evaluation-criteria">Indirect evaluation criteria</h2>
<ul>
<li>Main methods: AIC, BIC and adjusted <span class="math inline">\(R^2\)</span>
<ul>
<li>Advantage: easy to compute</li>
<li>Disadvantage: assumptions. They may not penalize enough.</li>
</ul></li>
<li>Adjusted <span class="math inline">\(R^2\)</span> – just add a penalty for having many RHS vars
<ul>
<li>corrects with <span class="math inline">\((n - 1)/(n - k - 1)\)</span></li>
</ul></li>
<li>AIC = <span class="math inline">\(-2 \times \ln(\text{likelihood}) + 2 \times k\)</span></li>
<li>BIC = <span class="math inline">\(-2 \times \ln(\text{likelihood}) + \ln(N) \times k\)</span>
<ul>
<li>Both are based on information loss theory</li>
<li>BIC puts heavier penalty on models with many RHS variables, than AIC.</li>
</ul></li>
</ul>
</section>
<section id="example-redone" class="level2">
<h2 class="anchored" data-anchor-id="example-redone">Example, redone</h2>
<div id="3d0133a6" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>* This is the full code <span class="kw">for</span> previous and current example</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 10</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 100</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x = runiform(-2 ,2)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = 1 + x - 0.5 * x^2 + 1.5* rnormal()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> fit_stat1</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> fit_stat1, rclass</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> yhat smp</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`smp'</span> = <span class="fu">e</span>(<span class="kw">sample</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">predict</span> <span class="ot">`yhat'</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> <span class="ot">`yhat'</span>=(<span class="fu">y</span>-<span class="ot">`yhat'</span>)^2</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=<span class="fu">e</span>(r2)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> <span class="ot">`smp'</span>, <span class="kw">meanonly</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=result, <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> !<span class="ot">`smp'</span>, <span class="kw">meanonly</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=result, <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">matrix</span> result = result</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>fit_stat1</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=<span class="fu">r</span>(result)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>fit_stat1</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>fit_stat1</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>fit_stat1</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>fit_stat1</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> fit_stat2</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> fit_stat2, rclass</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> yhat smp</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> <span class="ot">`smp'</span> = <span class="fu">e</span>(<span class="kw">sample</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">predict</span> <span class="ot">`yhat'</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> <span class="ot">`yhat'</span>=(<span class="fu">y</span>-<span class="ot">`yhat'</span>)^2    </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=<span class="fu">e</span>(r2), <span class="fu">e</span>(r2_a)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> <span class="ot">`smp'</span>, <span class="kw">meanonly</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=result, <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> !<span class="ot">`smp'</span>, <span class="kw">meanonly</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=result, <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>: <span class="kw">estat</span> <span class="kw">ic</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result=result, <span class="fu">r</span>(S)[1,5..6]</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">matrix</span> result = result</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>fit_stat2</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=<span class="fu">r</span>(result)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>fit_stat2</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>fit_stat2</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>fit_stat2</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="fu">y</span> c.x##c.x##c.x##c.x##c.x <span class="kw">if</span> <span class="dt">_n</span>&lt;=30</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>fit_stat2</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rr2=rr2\<span class="fu">r</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;"><span class="math inline">\(R^2\)</span></th>
<th style="text-align: center;"><span class="math inline">\(aR^2\)</span></th>
<th style="text-align: center;">MSE</th>
<th style="text-align: center;">OoS MSE</th>
<th style="text-align: center;">AIC</th>
<th style="text-align: center;">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>^1</td>
<td style="text-align: center;">0.3225</td>
<td style="text-align: center;">0.2983</td>
<td style="text-align: center;">1.9348</td>
<td style="text-align: center;">2.9491</td>
<td style="text-align: center;">108.9358</td>
<td style="text-align: center;">111.7382</td>
</tr>
<tr class="even">
<td>^2</td>
<td style="text-align: center;">0.6255</td>
<td style="text-align: center;">0.5978</td>
<td style="text-align: center;">1.0694</td>
<td style="text-align: center;">2.9348</td>
<td style="text-align: center;">93.1493</td>
<td style="text-align: center;">97.3529</td>
</tr>
<tr class="odd">
<td>^3</td>
<td style="text-align: center;">0.6345</td>
<td style="text-align: center;">0.5923</td>
<td style="text-align: center;">1.0438</td>
<td style="text-align: center;">2.9788</td>
<td style="text-align: center;">94.4218</td>
<td style="text-align: center;">100.0266</td>
</tr>
<tr class="even">
<td>^4</td>
<td style="text-align: center;">0.7132</td>
<td style="text-align: center;">0.6673</td>
<td style="text-align: center;">0.8189</td>
<td style="text-align: center;">4.1380</td>
<td style="text-align: center;">89.1439</td>
<td style="text-align: center;">96.1499</td>
</tr>
<tr class="odd">
<td>^5</td>
<td style="text-align: center;">0.7260</td>
<td style="text-align: center;">0.6689</td>
<td style="text-align: center;">0.7826</td>
<td style="text-align: center;">3.5577</td>
<td style="text-align: center;">89.7810</td>
<td style="text-align: center;">98.1882</td>
</tr>
</tbody>
</table>
</section>
<section id="finding-the-best-model-by-training-and-test-samples" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-model-by-training-and-test-samples">Finding the best model by training and test samples</h2>
<ul>
<li>Similar to bootstrapping (brute force approach for SE), its also possible to use a “bute-force” approach to find the best model.</li>
<li>This would require “imitating” the process of out-of-sample prediction.
<ol type="1">
<li><strong>Cut</strong> the dataset into training and test sample (80-20 ?)</li>
<li>Choose Some evaluation criterion (loss function)</li>
<li>Estimate the model on the training sample</li>
<li>Predict and evaluate the model on the test sample</li>
</ol></li>
<li>Problem: 80% (or less), may be too small training. And 20% (one shoot) could be different from the rest of the data.</li>
</ul>
</section>
<section id="lets-make-things-better-k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="lets-make-things-better-k-fold-cross-validation">Lets make things Better: K-fold cross-validation</h2>
<ul>
<li>If one is not enough, why not use more?</li>
<li>Split sample into <span class="math inline">\(k=5\)</span> groups (equal size)</li>
<li>Now, assume that each “fold” is the test sample, and the rest is the training sample.
<ul>
<li>Do the excercise k times, and every observation will be in the test sample once.</li>
</ul></li>
<li>Add up the MSEs, or get the average MSE.</li>
<li>Still has a random component, but less so than a single split.</li>
</ul>
</section>
<section id="k-fold-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="k-fold-cross-validation">K-fold cross-validation</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>* This is the full code <span class="kw">for</span> previous and current example</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 10</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">set</span> <span class="kw">obs</span> 30</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x = runiform(-2 ,2)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = 1 + x - 0.5 * x^2 + 1.5* rnormal()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>** Create 5 folds</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> fold = <span class="fu">mod</span>(<span class="dt">_n</span>,5)+1</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> fit_stat3</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> fit_stat3, rclass</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> yhat aux</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">gen</span> <span class="ot">`yhat'</span> = .</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">reg</span> <span class="ot">`0'</span> <span class="kw">if</span> fold!=<span class="ot">`i'</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> <span class="ot">`aux'</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> <span class="ot">`yhat'</span> = <span class="ot">`aux'</span> <span class="kw">if</span> fold==<span class="ot">`i'</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">drop</span> <span class="ot">`aux'</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>: <span class="kw">replace</span> <span class="ot">`yhat'</span>=(<span class="fu">y</span>-<span class="ot">`yhat'</span>)^2    </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span>, <span class="kw">meanonly</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">scalar</span> <span class="kw">mse</span> = <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>fit_stat3 <span class="fu">y</span> c.x </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"^1, mse: "</span> %5.3f <span class="ot">`r(mse)'</span> <span class="dt">_n</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>fit_stat3 <span class="fu">y</span> c.x##c.x </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"^2, mse: "</span> %5.3f <span class="ot">`r(mse)'</span> <span class="dt">_n</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>fit_stat3 <span class="fu">y</span> c.x##c.x##c.x </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"^3, mse: "</span> %5.3f <span class="ot">`r(mse)'</span> <span class="dt">_n</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>fit_stat3 <span class="fu">y</span> c.x##c.x##c.x##c.x </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"^4, mse: "</span> %5.3f <span class="ot">`r(mse)'</span> <span class="dt">_n</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>fit_stat3 <span class="fu">y</span> c.x##c.x##c.x##c.x##c.x </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="st">"^5, mse: "</span> %5.3f <span class="ot">`r(mse)'</span> <span class="dt">_n</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>^1, mse: 4.851</p>
<p>^2, mse: 3.196</p>
<p>^3, mse: 2.805</p>
<p>^4, mse: 3.085</p>
<p>^5, mse: 3.160</p>
</section>
<section id="when-k-rightarrow-n.-loocv" class="level2">
<h2 class="anchored" data-anchor-id="when-k-rightarrow-n.-loocv">When K <span class="math inline">\(\rightarrow\)</span> N. LooCV</h2>
<ul>
<li>K-fold cross-validation has two weaknesses:
<ol type="1">
<li>Randomness: different splits may lead to different results</li>
<li>Small sample size for training may be too small</li>
</ol></li>
<li>An alternative to address both is increasing K … until K=N
<ul>
<li>This is the Leave-one-out cross-validation (LOOCV)</li>
<li>Train on N-1 observations, predict on the left-out (N=1) observation</li>
</ul></li>
<li>This can be computationally expensive, unless you are estimating Linear regression models.
<ul>
<li>LOOCV its really fast for OLS</li>
</ul></li>
</ul>
</section>
<section id="bic-vs-test-rmse" class="level2">
<h2 class="anchored" data-anchor-id="bic-vs-test-rmse">BIC vs test RMSE</h2>
<ul>
<li>In practice, BIC is the best indirect criterion – closest to test sample.</li>
<li>The advantage of BIC is that it needs no sample splitting which may be a problem in small samples.</li>
<li>The advantage of test MSE is that it makes no assumption.</li>
<li>BIC is a good first run, quick, is often not very wrong.</li>
<li>Test MSE is the best, but may be computationally expensive.</li>
</ul>
</section>
<section id="external-validity-and-stable-patterns" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns">External validity and stable patterns</h2>
<ul>
<li>BIC, Training-test, k-fold cross-validation… All very nice
<ul>
<li>In the end, they all use the information in the data.</li>
</ul></li>
<li>How would things look for the target observation(s)? unknown!!</li>
<li>The issue of stationarity – how our data is related to other datasets we may use our model</li>
<li>In the end we can’t know but need to think about it.
<ul>
<li>Plus, if there is no external validity, your model fit in an outside data source is likely to be worse…</li>
</ul></li>
</ul>
</section>
<section id="external-validity-and-stable-patterns-1" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns-1">External validity and stable patterns</h2>
<ul>
<li>Most predictions will be on future data</li>
<li>High external validity requires that the environment is stationary.</li>
<li>Stationarity means that the way variables are distributed remains the same over time.
<ul>
<li>Ensures that the relationship between predictors and the target variable is the same in the data and the forecasted future.</li>
</ul></li>
<li>If the relationship breaks down whatever we establish in our data won’t be true in the future, leading to wrong forecasts.</li>
</ul>
</section>
<section id="external-validity-and-stable-patterns-2" class="level2">
<h2 class="anchored" data-anchor-id="external-validity-and-stable-patterns-2">External validity and stable patterns</h2>
<ul>
<li>External validity and stable patterns - Very broad concept</li>
<li>It’s about representativeness of actual data <span class="math inline">\(\rightarrow\)</span> to live data
<ul>
<li>Remember hotels? (other dates, other cities).</li>
</ul></li>
<li>Domain knowledge can help. Inner knowledge of the process can help.</li>
<li>Study if patterns were stable in the past / other locations were stable can help.</li>
</ul>
</section>
<section id="main-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="main-takeaways">Main takeaways</h2>
<ul>
<li>Prediction uses the original data with <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> to predict the value of <span class="math inline">\(y\)</span> for observations in the live data, in which <span class="math inline">\(x\)</span> is observed but <span class="math inline">\(y\)</span> is not</li>
<li>Prediction uses a model that describes the patterns of association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> in the original data</li>
<li>Cross-validation can help find the best model in the population, or general pattern, represented by the original data</li>
<li>Stability of the patterns of association is needed for a prediction with high external validity</li>
</ul>
</section>
<section id="cs-predicting-the-price-of-used-cars" class="level2">
<h2 class="anchored" data-anchor-id="cs-predicting-the-price-of-used-cars">CS: Predicting the price of used cars</h2>
<ul>
<li>SUse data from <a href="data_slides/used-cars.dta">here</a> for replication.</li>
<li>Drop car with price&gt;20k or those price = 1$.</li>
<li>While distribution is skewed, Log(price) is not normal either. We will keep it as is.</li>
<li>Two areas, we keep Chicago only.</li>
<li>drop if odometer&gt;100K miles</li>
<li>Variables: price, age, odometer, type, condition, cylinders, dealer</li>
</ul>
</section>
<section id="cs-competing-models" class="level2">
<h2 class="anchored" data-anchor-id="cs-competing-models">CS: Competing models:</h2>
<ul>
<li>Model 1 age, age squared</li>
<li>Model 2 age, age squared, odometer, odometer squared</li>
<li>Model 3 age, age squared, odometer, odometer squared, LE, condition , dealer</li>
<li>Model 4 age, age squared, odometer, odometer squared, LE, condition , dealer, SE, XLE, cylinder</li>
<li>Model 5 same as Model 4 but with all variables interacted with age</li>
<li>Model 6 same as Model 4 but with all variables interacted with condition</li>
</ul>
<div id="7042ea2c" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>* setup</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> data_slides/used-cars.dta, <span class="kw">clear</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model1 age c.age#c.age</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model2 <span class="ot">$model1</span> lnodometer c.lnodometer#c.lnodometer</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model3 <span class="ot">$model2</span> LE i.condition_recode i.dealer</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model4 <span class="ot">$model3</span> <span class="kw">SE</span> XLE cylinder</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model5 c.(<span class="ot">$model4</span>)##c.age</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> model6 c.(<span class="ot">$model4</span>)##i.condition_recode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cs-test-data" class="level2">
<h2 class="anchored" data-anchor-id="cs-test-data">CS: Test Data</h2>
<ul>
<li>Assume that 20% of the data is “target” data.</li>
<li>Lets run all models, using different evaluation criteria. And see which one is the best.</li>
<li>See below for the program..Rather long</li>
</ul>
<div id="53816d9d" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> rnd = runiform()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> rnd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">test</span> = <span class="dt">_n</span>/_N&lt;=.2</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">program</span> <span class="kw">drop</span> fit_stat4</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> fit_stat4, rclass</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">reg</span> <span class="ot">`0'</span> <span class="kw">if</span> <span class="kw">test</span>==0</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> yxhat</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">predict</span> <span class="ot">`yxhat'</span> <span class="kw">if</span> <span class="kw">test</span>==1</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> <span class="ot">`yxhat'</span> = (price-<span class="ot">`yxhat'</span>)^2  <span class="kw">if</span> <span class="kw">test</span>==1</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result = <span class="fu">e</span>(r2), <span class="fu">e</span>(r2_a)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">estat</span> <span class="kw">ic</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result = result, <span class="fu">r</span>(S)[1,5..6]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ** K-fold <span class="kw">cross</span>-validation</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">capture</span> <span class="kw">drop</span> fold</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> fold = runiform() <span class="kw">if</span> <span class="kw">test</span>==0</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> fold </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> fold</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> fold = <span class="fu">mod</span>(<span class="dt">_n</span>,5)+1 <span class="kw">if</span> <span class="kw">test</span>==0</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    *** Kfold1</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">tempvar</span> yhat aux</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">gen</span> <span class="ot">`yhat'</span> = .</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">reg</span> <span class="ot">`0'</span> <span class="kw">if</span> fold!=<span class="ot">`i'</span> &amp; <span class="kw">test</span>==0</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> <span class="ot">`aux'</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> <span class="ot">`yhat'</span> = <span class="ot">`aux'</span> <span class="kw">if</span> fold==<span class="ot">`i'</span> &amp; <span class="kw">test</span>==0</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">drop</span> <span class="ot">`aux'</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>: <span class="kw">replace</span> <span class="ot">`yhat'</span>=(price-<span class="ot">`yhat'</span>)^2     </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> <span class="kw">test</span>==0, <span class="kw">meanonly</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result = result, <span class="fu">sqrt</span>(<span class="fu">r</span>(<span class="kw">mean</span>))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    *** Kfold2</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">capture</span> <span class="kw">drop</span> fold</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> fold = runiform() <span class="kw">if</span> <span class="kw">test</span>==0</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sort</span> fold </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> fold</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> fold = <span class="fu">mod</span>(<span class="dt">_n</span>,5)+1 <span class="kw">if</span> <span class="kw">test</span>==0</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">drop</span> <span class="ot">`yhat'</span>  </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">gen</span> <span class="ot">`yhat'</span> = .</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>:<span class="kw">forvalues</span> i = 1/5 {</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">reg</span> <span class="ot">`0'</span> <span class="kw">if</span> fold!=<span class="ot">`i'</span> &amp; <span class="kw">test</span>==0</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">predict</span> <span class="ot">`aux'</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">replace</span> <span class="ot">`yhat'</span> = <span class="ot">`aux'</span> <span class="kw">if</span> fold==<span class="ot">`i'</span> &amp; <span class="kw">test</span>==0</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">drop</span> <span class="ot">`aux'</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>: <span class="kw">replace</span> <span class="ot">`yhat'</span>=(price-<span class="ot">`yhat'</span>)^2    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yhat'</span> <span class="kw">if</span> <span class="kw">test</span>==0, <span class="kw">meanonly</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result = result, <span class="fu">sqrt</span>(<span class="fu">r</span>(<span class="kw">mean</span>))</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    ** <span class="kw">test</span> <span class="kw">on</span> live <span class="kw">data</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">sum</span> <span class="ot">`yxhat'</span> <span class="kw">if</span> <span class="kw">test</span>==1, <span class="kw">meanonly</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> result = result, <span class="fu">sqrt</span>(<span class="fu">r</span>(<span class="kw">mean</span>))</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span> colname result = r2 r2_a AIC BIC Kfold1 Kfold2 <span class="kw">test</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    ** </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> <span class="fu">matrix</span> result = result</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cs-results" class="level2">
<h2 class="anchored" data-anchor-id="cs-results">CS: Results</h2>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = <span class="fu">r</span>(result)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model2</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = fresults\<span class="fu">r</span>(result)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model3</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = fresults\<span class="fu">r</span>(result)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model4</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = fresults\<span class="fu">r</span>(result)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model5</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = fresults\<span class="fu">r</span>(result)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: fit_stat4 price <span class="ot">$model6</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> fresults = fresults\<span class="fu">r</span>(result)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span> rowname fresults = Model1 Model2 Model3 Model4 Model5 Model6</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">linesize</span> 250</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>esttab <span class="fu">matrix</span>(fresults, fmt(%8.3f)) , md  nomtitle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">r2</th>
<th style="text-align: center;">r2_a</th>
<th style="text-align: center;">AIC</th>
<th style="text-align: center;">BIC</th>
<th style="text-align: center;">Kfold1</th>
<th style="text-align: center;">Kfold2</th>
<th style="text-align: center;">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Model1</td>
<td style="text-align: center;">0.711</td>
<td style="text-align: center;">0.708</td>
<td style="text-align: center;">4823.338</td>
<td style="text-align: center;">4834.032</td>
<td style="text-align: center;">2472.245</td>
<td style="text-align: center;">2470.654</td>
<td style="text-align: center;">1697.617</td>
</tr>
<tr class="even">
<td>Model2</td>
<td style="text-align: center;">0.776</td>
<td style="text-align: center;">0.772</td>
<td style="text-align: center;">4760.551</td>
<td style="text-align: center;">4778.374</td>
<td style="text-align: center;">2185.247</td>
<td style="text-align: center;">2204.960</td>
<td style="text-align: center;">1345.265</td>
</tr>
<tr class="odd">
<td>Model3</td>
<td style="text-align: center;">0.779</td>
<td style="text-align: center;">0.771</td>
<td style="text-align: center;">4766.944</td>
<td style="text-align: center;">4802.590</td>
<td style="text-align: center;">2270.672</td>
<td style="text-align: center;">2307.392</td>
<td style="text-align: center;">1346.395</td>
</tr>
<tr class="even">
<td>Model4</td>
<td style="text-align: center;">0.785</td>
<td style="text-align: center;">0.775</td>
<td style="text-align: center;">4765.275</td>
<td style="text-align: center;">4811.613</td>
<td style="text-align: center;">2388.426</td>
<td style="text-align: center;">2259.348</td>
<td style="text-align: center;">1381.180</td>
</tr>
<tr class="odd">
<td>Model5</td>
<td style="text-align: center;">0.797</td>
<td style="text-align: center;">0.778</td>
<td style="text-align: center;">4772.246</td>
<td style="text-align: center;">4857.794</td>
<td style="text-align: center;">2605.005</td>
<td style="text-align: center;">2425.626</td>
<td style="text-align: center;">1481.571</td>
</tr>
<tr class="even">
<td>Model6</td>
<td style="text-align: center;">0.851</td>
<td style="text-align: center;">0.824</td>
<td style="text-align: center;">4724.611</td>
<td style="text-align: center;">4867.191</td>
<td style="text-align: center;">2555.466</td>
<td style="text-align: center;">2670.216</td>
<td style="text-align: center;">1523.569</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>